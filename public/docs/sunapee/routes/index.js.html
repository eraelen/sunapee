<!DOCTYPE html>
<html>
<head>
  <title>index.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../", thisFile = "sunapee/routes/index.js", defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#route-handler--index.js">Route Handler: index.js</a>
      </div>
      <div class="heading h2">
        <a href="#handles-routes-related-to-post-user-login.">Handles routes related to post user login.</a>
      </div>
      <div class="heading h2">
        <a href="#global-variables">Global variables</a>
      </div>
      <div class="heading h2">
        <a href="#user-server-side-route-handlers">User Server-Side Route-Handlers</a>
      </div>
      <div class="heading h3">
        <a href="#home">home</a>
      </div>
      <div class="heading h3">
        <a href="#newtweet">newtweet</a>
      </div>
      <div class="heading h3">
        <a href="#retweet">retweet</a>
      </div>
      <div class="heading h3">
        <a href="#profile">profile</a>
      </div>
      <div class="heading h3">
        <a href="#follower">follower</a>
      </div>
      <div class="heading h3">
        <a href="#following">following</a>
      </div>
      <div class="heading h3">
        <a href="#unfollow">Unfollow</a>
      </div>
      <div class="heading h3">
        <a href="#follow">follow</a>
      </div>
      <div class="heading h3">
        <a href="#interaction">interaction</a>
      </div>
      <div class="heading h3">
        <a href="#help">Help</a>
      </div>
      <div class="heading h3">
        <a href="#search-tweets-result-page">Search Tweets Result Page</a>
      </div>
      <div class="heading h3">
        <a href="#search-people-result-page">Search People Result Page</a>
      </div>
      <div class="heading h3">
        <a href="#search-box-from-navigation-bar">Search Box from Navigation Bar</a>
      </div>
      <div class="heading h3">
        <a href="#detailed-tweet-page">Detailed Tweet Page</a>
      </div>
      <div class="heading h3">
        <a href="#detailed-tweet-reply-page">Detailed Tweet REPLY Page</a>
      </div>
      <div class="heading h3">
        <a href="#simple-reply-page-view">Simple Reply Page View</a>
      </div>
      <div class="heading h3">
        <a href="#simple-reply-page-handler">Simple Reply Page Handler</a>
      </div>
      <div class="heading h3">
        <a href="#edit-settings-page-view">Edit Settings Page View</a>
      </div>
      <div class="heading h3">
        <a href="#change-settings">Change Settings</a>
      </div>
      <div class="heading h3">
        <a href="#edit-profile-page-view">Edit Profile Page View</a>
      </div>
      <div class="heading h3">
        <a href="#changeprofilepic">changeProfilePic</a>
      </div>
      <div class="heading h3">
        <a href="#chat">chat</a>
      </div>
      <div class="heading h3">
        <a href="#pm">pm</a>
      </div>
      <div class="heading h3">
        <a href="#deletetweet">deleteTweet</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="route-handler--index.js">
  <h1>
    <a href="#route-handler--index.js" class="pilcrow">&#182;</a>
    Route Handler: index.js
  </h1>
</div>



<div class="pilwrap" id="handles-routes-related-to-post-user-login.">
  <h2>
    <a href="#handles-routes-related-to-post-user-login." class="pilcrow">&#182;</a>
    Handles routes related to post user login.
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="global-variables">
  <h2>
    <a href="#global-variables" class="pilcrow">&#182;</a>
    Global variables
  </h2>
</div>


<p>The user and tweet files in the lib directory is accessed. 
Variable 'online' is a logged in database.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">entry</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../routes/entry&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">online</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">online</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">chat</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../chat/index&#39;</span><span class="p">);</span>


<span class="kd">var</span> <span class="nx">profileMsg</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../lib/sql.js&#39;</span><span class="p">);</span>




</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="user-server-side-route-handlers">
  <h2>
    <a href="#user-server-side-route-handlers" class="pilcrow">&#182;</a>
    User Server-Side Route-Handlers
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="home">
  <h3>
    <a href="#home" class="pilcrow">&#182;</a>
    home
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET home page.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">home</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;userAuth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">uname</span> <span class="o">=</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span> <span class="o">!==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/home&#39;</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getRecentT</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tl</span><span class="p">){</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">getUserStats</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stats</span><span class="p">){</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;home&#39;</span><span class="p">,</span> 
             <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Home&#39;</span><span class="p">,</span>
              <span class="nx">name</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
              <span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
              <span class="nx">profilepic</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">,</span>
              <span class="nx">tweetN</span><span class="o">:</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">tweetN</span><span class="p">,</span>
              <span class="nx">followerN</span><span class="o">:</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">followerN</span><span class="p">,</span>
              <span class="nx">followingN</span><span class="o">:</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">followingN</span><span class="p">,</span>
              <span class="nx">tweets</span><span class="o">:</span> <span class="nx">tl</span><span class="p">,</span>
              <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
              <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
              <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span>
               <span class="p">}</span> <span class="p">);</span>
          <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span> 
  <span class="p">}</span>
  <span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="newtweet">
  <h3>
    <a href="#newtweet" class="pilcrow">&#182;</a>
    newtweet
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>POST newtweet.
Handles submiting request from new tweet button on Home page.
And redirect to Home page.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">newtweet</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">addTweet</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">msg</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getUserNT</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">getUserStats</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stats</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">([</span><span class="nx">t</span><span class="p">,</span><span class="nx">stats</span><span class="p">.</span><span class="nx">tweetN</span><span class="p">]);</span>
      <span class="p">});</span>
    <span class="p">});</span>
    
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="retweet">
  <h3>
    <a href="#retweet" class="pilcrow">&#182;</a>
    retweet
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET retweet and redirect to home.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">retweet</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">retid</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">tweetId</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">getTweetById</span><span class="p">(</span><span class="nx">retid</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">addTweet</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="s2">&quot;retweet from @&quot;</span><span class="o">+</span><span class="nx">t</span><span class="p">.</span><span class="nx">username</span><span class="o">+</span><span class="s2">&quot; : &quot;</span><span class="o">+</span><span class="nx">t</span><span class="p">.</span><span class="nx">msg</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">retid</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="profile">
  <h3>
    <a href="#profile" class="pilcrow">&#182;</a>
    profile
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET profile page.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">profile</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>user exists</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">db</span><span class="p">.</span><span class="nx">checkProfilePermission</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">allow</span><span class="p">){</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">allow</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">getUserStats</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stats</span><span class="p">){</span>
              <span class="nx">db</span><span class="p">.</span><span class="nx">isFollowing</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isFollowing</span><span class="p">){</span>
                <span class="nx">db</span><span class="p">.</span><span class="nx">getUserT</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tl</span><span class="p">){</span>
                  <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
                    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;profile&#39;</span><span class="p">,</span>
                      <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Profile&#39;</span><span class="p">,</span>
                       <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                       <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                       <span class="nx">name</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                       <span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                       <span class="nx">profilepic</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">,</span>
                       <span class="nx">tweetN</span><span class="o">:</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">tweetN</span><span class="p">,</span>
                       <span class="nx">followerN</span><span class="o">:</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">followerN</span><span class="p">,</span>
                       <span class="nx">followingN</span><span class="o">:</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">followingN</span><span class="p">,</span>
                       <span class="nx">isFollowing</span><span class="o">:</span> <span class="nx">isFollowing</span><span class="p">,</span>
                       <span class="nx">tweets</span><span class="o">:</span> <span class="nx">tl</span><span class="p">,</span>
                       <span class="nx">background</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                       <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span>
                       <span class="p">});</span>
                  <span class="p">});</span>
                <span class="p">});</span>
              <span class="p">});</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Error - Profile Permission&#39;</span><span class="p">,</span>
                    <span class="nx">background</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span> 
              <span class="nx">errorHeader</span><span class="o">:</span> <span class="s2">&quot;Profile Permission&quot;</span><span class="p">,</span>
              <span class="nx">msg</span><span class="o">:</span> <span class="s2">&quot;You are not allowed to view &quot;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="o">+</span> <span class="s2">&quot;&#39;s profile.&quot;</span><span class="p">,</span>
              <span class="nx">username</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
              <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">});</span>
          <span class="p">}</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>user doesn't exist</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Error - User Nonexistent&#39;</span><span class="p">,</span>
            <span class="nx">background</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
            <span class="nx">errorHeader</span><span class="o">:</span> <span class="s2">&quot;User does NOT exist&quot;</span><span class="p">,</span>
            <span class="nx">msg</span><span class="o">:</span> <span class="s2">&quot;No one with the username &#39;&quot;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span> <span class="o">+</span> <span class="s2">&quot;&#39; exists in Tweetee. Invite your friend to register: tweetee.com/register&quot;</span><span class="p">,</span>
            <span class="nx">username</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
            <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>

  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="follower">
  <h3>
    <a href="#follower" class="pilcrow">&#182;</a>
    follower
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET follower page.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">follower</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span> <span class="o">===</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getFollowerList</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fl</span><span class="p">){</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;myfollower&#39;</span><span class="p">,</span>
              <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Follower&#39;</span><span class="p">,</span>
               <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
               <span class="nx">background</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
               <span class="nx">name</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
               <span class="nx">username</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
               <span class="nx">followers</span><span class="o">:</span> <span class="nx">fl</span><span class="p">,</span>
               <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span>
               <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getFollowerList</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">fl</span><span class="p">){</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;follower&#39;</span><span class="p">,</span> 
              <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Follower&#39;</span><span class="p">,</span>
                <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">background</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                <span class="nx">username</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">followers</span><span class="o">:</span> <span class="nx">fl</span><span class="p">,</span>
                <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span>
                <span class="p">});</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span> 
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>### Delete Follower</p>

<div class="dox">
  <div class="summary"><p>In our implementation, users can delete followers.
 Deleting followers use AJAX. 
  The user to be deleted is passed to this route and that same user is passed back to the script to delete the user from the list displayed.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">deleteFollower</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">usertbd</span><span class="p">;</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">deleteFollower</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">username</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="following">
  <h3>
    <a href="#following" class="pilcrow">&#182;</a>
    following
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET following page</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">following</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">){</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">getFollowingList</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">fl</span><span class="p">){</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;following&#39;</span><span class="p">,</span> 
          <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Following&#39;</span><span class="p">,</span>
            <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
            <span class="nx">background</span><span class="o">:</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
            <span class="nx">name</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
            <span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
            <span class="nx">following</span><span class="o">:</span> <span class="nx">fl</span><span class="p">,</span>
            <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span>
            <span class="p">}</span> <span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="unfollow">
  <h3>
    <a href="#unfollow" class="pilcrow">&#182;</a>
    Unfollow
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Unfollowing users implemented using AJAX</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">unfollow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">rmusername</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">rmusername</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">unfollow</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">rmusername</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">getUserStats</span><span class="p">(</span><span class="nx">rmusername</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">stats</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">([</span><span class="nx">rmusername</span><span class="p">,</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">followerN</span><span class="p">]);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="follow">
  <h3>
    <a href="#follow" class="pilcrow">&#182;</a>
    follow
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>POST follow tweets of a user implemented using AJAX</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">follow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">adduname</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">adduname</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">follow</span><span class="p">(</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">adduname</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">getUserStats</span><span class="p">(</span><span class="nx">adduname</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">stats</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">([</span><span class="nx">adduname</span><span class="p">,</span> <span class="nx">stats</span><span class="p">.</span><span class="nx">followerN</span><span class="p">]);</span>
      <span class="p">})</span>
    <span class="p">});</span>
  <span class="p">}</span>

<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="interaction">
  <h3>
    <a href="#interaction" class="pilcrow">&#182;</a>
    interaction
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET interaction page</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">interaction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
   <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
     <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">username</span> <span class="o">!==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/interaction&#39;</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

       <span class="nx">db</span><span class="p">.</span><span class="nx">getTByMention</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tl</span><span class="p">){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;interaction&#39;</span><span class="p">,</span>
              <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Interaction&#39;</span><span class="p">,</span>
                <span class="nx">name</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
                <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span>
                <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                <span class="nx">tweets</span><span class="o">:</span> <span class="nx">tl</span><span class="p">,</span>
                <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
        <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span>
                <span class="p">});</span>
    <span class="p">});</span>
       <span class="p">});</span>
     <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="help">
  <h3>
    <a href="#help" class="pilcrow">&#182;</a>
    Help
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Renders help page.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">help</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>res.send("Login to view this page.");</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;help&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Help&#39;</span><span class="p">,</span> 
                        <span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> 
                        <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
              <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="search-tweets-result-page">
  <h3>
    <a href="#search-tweets-result-page" class="pilcrow">&#182;</a>
    Search Tweets Result Page
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Searches through tweets (message only).</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">searchT</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">searchTweets</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">results</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">results</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
                <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;searchT&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Search Result&#39;</span><span class="p">,</span>
                <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                <span class="nx">searchPhrase</span><span class="o">:</span> <span class="nx">query</span><span class="p">,</span>
                <span class="nx">tweets</span><span class="o">:</span> <span class="nx">results</span><span class="p">,</span> 
                <span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span><span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span> 
    <span class="p">});</span>
   <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="search-people-result-page">
  <h3>
    <a href="#search-people-result-page" class="pilcrow">&#182;</a>
    Search People Result Page
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Searches through users (name and username only).</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">searchP</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">searchPeople</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">results</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">results</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getTrendingHT</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">){</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;searchP&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Search Result&#39;</span><span class="p">,</span>
                <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                <span class="nx">searchPhrase</span><span class="o">:</span> <span class="nx">query</span><span class="p">,</span>
                <span class="nx">users</span><span class="o">:</span> <span class="nx">results</span><span class="p">,</span> <span class="nx">username</span><span class="o">:</span> 
                <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
                <span class="nx">ht</span><span class="o">:</span><span class="nx">ht</span><span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span> 
    <span class="p">});</span>
   <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="search-box-from-navigation-bar">
  <h3>
    <a href="#search-box-from-navigation-bar" class="pilcrow">&#182;</a>
    Search Box from Navigation Bar
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Supports searching using the search box. Simply passes query string from search box to search.
Default for result in search box is searching tweets.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">searchBox</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">query</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>performs additional check - found that # as first character for url causes issues</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">query</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;#&quot;</span><span class="p">)</span> <span class="p">{</span><span class="nx">query</span> <span class="o">=</span> <span class="nx">query</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nx">query</span><span class="p">.</span><span class="nx">length</span><span class="p">);}</span>
  <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/searchT/&#39;</span><span class="o">+</span><span class="nx">query</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="detailed-tweet-page">
  <h3>
    <a href="#detailed-tweet-page" class="pilcrow">&#182;</a>
    Detailed Tweet Page
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Renders detailed conversation. A conversation is a thread of tweets through replies.
The page displays the first "original" tweet in the conversation and the user information of who posted that tweet.
There is a default text box that allows users to reply to the "original" tweet.
The rest of the conversation appears below the box.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">detailedTweet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;userAuth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>loggedInUser = users.getUserById(loggedInUser.username);*/</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">loggedinusername</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">tweetId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">tweetId</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">isFollowing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">//default</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getTweetConvoByTweetID</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">tweetId</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">myReturn</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">tc</span> <span class="o">=</span> <span class="nx">myReturn</span><span class="p">.</span><span class="nx">tc</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">myReturn</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">len</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">tc</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">isFollowing</span><span class="p">(</span><span class="nx">loggedinusername</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isFollowing</span><span class="p">){</span>  
            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;detailedTweet&#39;</span><span class="p">,{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Detailed Tweet&#39;</span><span class="p">,</span>
                  <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedinusername</span><span class="p">,</span> 
                  <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                  <span class="nx">convo</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> 
                  <span class="nx">profilePic</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">,</span> 
                  <span class="nx">origTweet</span><span class="o">:</span> <span class="nx">tc</span><span class="p">,</span>
                  <span class="nx">isFollowing</span><span class="o">:</span> <span class="nx">isFollowing</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>had to include this because text area did not like &lt;%= origTweet.username %></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                  <span class="nx">username</span><span class="o">:</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">username</span><span class="p">});</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">tc</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">username</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">isFollowing</span><span class="p">(</span><span class="nx">loggedinusername</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isFollowing</span><span class="p">){</span>  
            <span class="kd">var</span> <span class="nx">temp</span> <span class="o">=</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
            <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;detailedTweet&#39;</span><span class="p">,{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Detailed Tweet&#39;</span><span class="p">,</span>
                    <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedinusername</span><span class="p">,</span> 
                    <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                    <span class="nx">convo</span><span class="o">:</span> <span class="nx">tc</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> 
                    <span class="nx">profilePic</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">,</span> 
                    <span class="nx">origTweet</span><span class="o">:</span> <span class="nx">tc</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                    <span class="nx">isFollowing</span><span class="o">:</span> <span class="nx">isFollowing</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>had to include this because text area did not like &lt;%= origTweet.username %></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                    <span class="nx">username</span><span class="o">:</span> <span class="nx">tc</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">username</span><span class="p">});</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="detailed-tweet-reply-page">
  <h3>
    <a href="#detailed-tweet-reply-page" class="pilcrow">&#182;</a>
    Detailed Tweet REPLY Page
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>In our system, we have two kinds of replies that we track. One is replying from the detailed page and the other is replying from the "Reply" link from the tweet itself.
 This route handles replies from the detailed page. The reply is composed from the compose tweet box. It is a direct reply to the original tweet of the current conversation displayed and not to the last tweet of the conversation. </p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">detailedTweetReply</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;userAuth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tweetId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">tweetId</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">addTweet</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tweetId</span><span class="p">),</span> <span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">tweetId</span><span class="o">+</span><span class="s1">&#39;/detailedTweet&#39;</span><span class="p">);</span>
    <span class="p">});</span>   
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="simple-reply-page-view">
  <h3>
    <a href="#simple-reply-page-view" class="pilcrow">&#182;</a>
    Simple Reply Page View
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>In our system, we have two kinds of replies that we track. One is replying from the detailed page and the other is replying from the "Reply" link from the tweet itself.
 This renders the detailed tweet page view with the tweet that the user wants to reply to appears. 
 Can be improved: Create a div for compose box once the "Reply" link is clicked.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">simpleReply</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">isFollowing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">loggedInUser</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">loggedInUser</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;userAuth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">loggedinusername</span> <span class="o">=</span> <span class="nx">loggedInUser</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">tweetId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">tweetId</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getTweetById</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">tweetId</span><span class="p">),</span> <span class="kd">function</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">getUserById</span><span class="p">(</span><span class="nx">t</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">isFollowing</span><span class="p">(</span><span class="nx">loggedinusername</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isFollowing</span><span class="p">){</span> 
          <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;detailedTweet&#39;</span><span class="p">,{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Simple Reply&#39;</span><span class="p">,</span>
                <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">loggedinusername</span><span class="p">,</span> 
                <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
                <span class="nx">convo</span><span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> 
                <span class="nx">profilePic</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">,</span> 
                <span class="nx">origTweet</span><span class="o">:</span> <span class="nx">t</span><span class="p">,</span>
                <span class="nx">isFollowing</span><span class="o">:</span> <span class="nx">isFollowing</span><span class="p">,</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>had to include this because text area did not like &lt;%= origTweet.username %></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">username</span><span class="o">:</span> <span class="nx">t</span><span class="p">.</span><span class="nx">username</span><span class="p">});</span>
        <span class="p">});</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="simple-reply-page-handler">
  <h3>
    <a href="#simple-reply-page-handler" class="pilcrow">&#182;</a>
    Simple Reply Page Handler
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>In our system, we have two kinds of replies that we track. One is replying from the detailed page and the other is replying from the "Reply" link from the tweet itself.
 This route handles replies from clicking on the "Reply" link attached to each tweet. </p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">displaySimpleReply</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;userAuth&#39;</span><span class="p">,</span> <span class="s1">&#39;Not logged in!&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tweetId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">tweetId</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">addTweet</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">message</span><span class="p">,</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">tweetId</span><span class="p">),</span> <span class="kc">null</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">tweetId</span><span class="o">+</span><span class="s1">&#39;/simpleReply&#39;</span><span class="p">);</span>
    <span class="p">});</span>   
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="edit-settings-page-view">
  <h3>
    <a href="#edit-settings-page-view" class="pilcrow">&#182;</a>
    Edit Settings Page View
  </h3>
</div>


<div class="dox">
  <div class="summary">
  </div>
  <div class="body"><p>This page also has the link for Edit Profile.
To get to this page, user can click on Tools icon.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">editSettings</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">settingsMsg</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;changeSettings&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">username</span> <span class="o">!==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">){</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/editSettings&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">getUserInfo</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;editSettings&#39;</span><span class="p">,</span> <span class="p">{</span><span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Edit Settings&#39;</span><span class="p">,</span> 
              <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
              <span class="nx">msg</span><span class="o">:</span> <span class="nx">settingsMsg</span><span class="p">,</span> 
              <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
              <span class="nx">pv</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">profvis</span><span class="p">,</span> 
              <span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">});</span>
      <span class="p">});</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="change-settings">
  <h3>
    <a href="#change-settings" class="pilcrow">&#182;</a>
    Change Settings
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Makes changes to user settings.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">changeSettings</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">changeUserSettings</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">profVis</span><span class="p">);</span>    
    <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;changeSettings&#39;</span><span class="p">,</span> <span class="s1">&#39;Changes saved.&#39;</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/editSettings&#39;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="edit-profile-page-view">
  <h3>
    <a href="#edit-profile-page-view" class="pilcrow">&#182;</a>
    Edit Profile Page View
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Allows users to edit name, username, email, location, website, profile picture and password.
User's name, username and email cannot be empty.
User must always enter current password to allow changes.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">editProfile</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">profileMsg</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;changeProfile&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getUserInfo</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;editProfile&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Edit Profile&#39;</span><span class="p">,</span>
              <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
              <span class="nx">msg</span><span class="o">:</span> <span class="nx">profileMsg</span><span class="p">,</span>
              <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">,</span>
              <span class="nx">name</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span>
              <span class="nx">username</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
              <span class="nx">email</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
              <span class="nx">location</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span>
              <span class="nx">website</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">website</span><span class="p">,</span>
              <span class="nx">profilePic</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">});</span>
    <span class="p">});</span>
   <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>### Change Profile Page</p>

<div class="dox">
  <div class="summary"><p>Route for actually changing the profile page.
 For changes to be valid and take effect, users must input the correct current password. If users want to change the password, the new password entered must be entered twice and those passwords must match.
 Users will be informed whether the changes are saved or not.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">changeProfile</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">changeUserProfile</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">location</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">website</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">newpass</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">confirmnewpass</span><span class="p">,</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">currentpass</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">validChange</span><span class="p">)</span> <span class="p">{</span>    
      <span class="k">if</span> <span class="p">(</span><span class="nx">validChange</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">username</span> <span class="o">=</span> <span class="nx">validChange</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">getUserInfoById</span><span class="p">(</span><span class="nx">validChange</span><span class="p">.</span><span class="nx">uid</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">user</span><span class="p">)</span> <span class="p">{</span>  
          <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
          <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;changeProfile&#39;</span><span class="p">,</span> <span class="s1">&#39;Changes saved.&#39;</span><span class="p">);</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/editProfile&#39;</span><span class="p">);</span>  
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span><span class="p">(</span><span class="s1">&#39;changeProfile&#39;</span><span class="p">,</span> <span class="nx">validChange</span><span class="p">.</span><span class="nx">error</span><span class="p">);</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/editProfile&#39;</span><span class="p">);</span>
      <span class="p">}</span>
      
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="changeprofilepic">
  <h3>
    <a href="#changeprofilepic" class="pilcrow">&#182;</a>
    changeProfilePic
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Makes changes to profile picture. This is separated from the rest of the form for changing profile information.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">changeProfilePic</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">flag</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Login to view this page.&quot;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">username</span> <span class="o">=</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">;</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">username</span> <span class="o">!==</span> <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">id</span><span class="p">){</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/editProfile&#39;</span><span class="p">);</span> 
      <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
      <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">newPath</span> <span class="o">=</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s2">&quot;/../public/images/users/&quot;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFile</span><span class="p">(</span><span class="nx">newPath</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">ppp</span> <span class="o">=</span> <span class="s2">&quot;/images/users/&quot;</span> <span class="o">+</span> <span class="nx">req</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">profilepic</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">changeprofilepic</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">ppp</span><span class="p">);</span>
          <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="o">+</span><span class="s1">&#39;/editProfile&#39;</span><span class="p">);</span>
        <span class="p">});</span>
      <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="chat">
  <h3>
    <a href="#chat" class="pilcrow">&#182;</a>
    chat
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET global chat page</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">chat</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;chat&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;Chat&#39;</span><span class="p">,</span> <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">username</span><span class="o">:</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">online</span><span class="o">:</span> <span class="nx">online</span><span class="p">,</span> <span class="nx">messageList</span><span class="o">:</span> <span class="nx">chat</span><span class="p">.</span><span class="nx">messageList</span><span class="p">,</span> <span class="nx">background</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">background</span><span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="pm">
  <h3>
    <a href="#pm" class="pilcrow">&#182;</a>
    pm
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>GET pm page</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">pm</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="kd">var</span> <span class="nx">messageList</span><span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Here is a test list&quot;</span><span class="p">,</span> <span class="s2">&quot;Of different things&quot;</span><span class="p">,</span> <span class="s2">&quot;This is the third element&quot;</span><span class="p">]</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="s1">&#39;pm&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;PM&#39;</span><span class="p">,</span> <span class="nx">loggedInUser</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">username</span><span class="o">:</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="nx">pmfollowers</span><span class="o">:</span> <span class="nx">user</span><span class="p">.</span><span class="nx">follower</span><span class="p">,</span> <span class="nx">messageList</span><span class="o">:</span> <span class="s2">&quot;&quot;</span> <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="deletetweet">
  <h3>
    <a href="#deletetweet" class="pilcrow">&#182;</a>
    deleteTweet
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Deletes tweet using AJAX. Users can only delete their own tweets.</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">deleteTweet</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">session</span><span class="p">.</span><span class="nx">user</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">user</span> <span class="o">===</span> <span class="kc">undefined</span> <span class="o">||</span> <span class="nx">online</span><span class="p">[</span><span class="nx">user</span><span class="p">.</span><span class="nx">uid</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">tweetId</span> <span class="o">=</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">tweetID</span><span class="p">;</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">deleteTweet</span><span class="p">(</span><span class="nx">tweetId</span><span class="p">);</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">getTNumberById</span><span class="p">(</span><span class="nx">user</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tc</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">([</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">tweetID</span><span class="p">,</span><span class="nx">tc</span><span class="p">]);</span>
    <span class="p">});</span>   
  <span class="p">}</span> 
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
