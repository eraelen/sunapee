<!DOCTYPE html>
<html>
<head>
  <title>BigInteger.as</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../../../../../../doc-style.css" />
  <script src="../../../../../../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../../../../../../", thisFile = "node_modules/socket.io/node_modules/socket.io-client/lib/vendor/web-socket-js/flash-src/com/hurlant/math/BigInteger.as", defaultSidebar = true;
  </script>
  <script src="../../../../../../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>BigInteger.as</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>*
* BigInteger
* 
* An ActionScript 3 implementation of BigInteger (light version)
* Copyright (c) 2007 Henri Torgemane
* 
* Derived from:
*     The jsbn library, Copyright (c) 2003-2005 Tom Wu
* 
* See LICENSE.txt for full license information.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="kd">package</span> <span class="nx">com</span><span class="p">.</span><span class="nx">hurlant</span><span class="p">.</span><span class="nx">math</span>
<span class="p">{</span>

  <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">hurlant</span><span class="p">.</span><span class="nx">crypto</span><span class="p">.</span><span class="nx">prng</span><span class="p">.</span><span class="nx">Random</span><span class="o">;</span>
  <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">hurlant</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Hex</span><span class="o">;</span>
  <span class="kd">import</span> <span class="nx">com</span><span class="p">.</span><span class="nx">hurlant</span><span class="p">.</span><span class="nx">util</span><span class="p">.</span><span class="nx">Memory</span><span class="o">;</span>
  
  <span class="kd">import</span> <span class="nx">flash</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nb">ByteArray</span><span class="o">;</span>
  <span class="nx">use</span> <span class="kd">namespace</span> <span class="nx">bi_internal</span><span class="o">;</span>

  <span class="kd">public</span> <span class="kd">class</span> <span class="nx">BigInteger</span>
  <span class="p">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">DB</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">30</span><span class="o">;</span> <span class="c1">// number of significant bits per chunk</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">DV</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">DB</span><span class="p">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">DM</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="nx">DV</span><span class="o">-</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// Max value in a chunk</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">BI_FP</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">52</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">FV</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="nx">BI_FP</span><span class="p">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">F1</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">BI_FP</span> <span class="o">-</span> <span class="nx">DB</span><span class="o">;</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">F2</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nx">DB</span> <span class="o">-</span> <span class="nx">BI_FP</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">ZERO</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">ONE</span><span class="o">:</span><span class="nx">BigInteger</span>  <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    
    <span class="cm">/*bi_internal */</span><span class="kd">public</span> <span class="k">var</span> <span class="nx">t</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span> <span class="c1">// number of chunks.</span>
    <span class="nx">bi_internal</span> <span class="k">var</span> <span class="nx">s</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span> <span class="c1">// sign</span>
    <span class="nx">bi_internal</span> <span class="k">var</span> <span class="nx">a</span><span class="o">:</span><span class="nb">Array</span><span class="o">;</span> <span class="c1">// chunks</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>*
* 
* @param value
* @param radix  WARNING: If value is ByteArray, this holds the number of bytes to use.
* @param unsigned
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">BigInteger</span><span class="p">(</span><span class="nx">value</span><span class="o">:*</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="nx">radix</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">unsigned</span><span class="o">:</span><span class="nb">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">a</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Array</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="nx">is</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">radix</span><span class="o">&amp;&amp;</span><span class="nx">radix</span><span class="o">!=</span><span class="mi">16</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;BigInteger construction with radix!=16 is not supported.&quot;</span><span class="p">);</span>
        <span class="nx">value</span> <span class="o">=</span> <span class="nx">Hex</span><span class="p">.</span><span class="nx">toArray</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
        <span class="nx">radix</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="nx">is</span> <span class="nb">ByteArray</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">array</span><span class="o">:</span><span class="nb">ByteArray</span> <span class="o">=</span> <span class="nx">value</span> <span class="nx">as</span> <span class="nb">ByteArray</span><span class="o">;</span>
        <span class="k">var</span> <span class="nx">length</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">radix</span> <span class="o">||</span> <span class="p">(</span><span class="nx">array</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">array</span><span class="p">.</span><span class="nx">position</span><span class="p">);</span>
        <span class="nx">fromArray</span><span class="p">(</span><span class="nx">array</span><span class="o">,</span> <span class="nx">length</span><span class="o">,</span> <span class="nx">unsigned</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">dispose</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">Random</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Random</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">uint</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">nextByte</span><span class="p">();</span>
        <span class="nx">delete</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">a</span><span class="o">=</span><span class="kc">null</span><span class="o">;</span>
      <span class="nx">t</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
      <span class="nx">s</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
      <span class="nx">Memory</span><span class="p">.</span><span class="nx">gc</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">toString</span><span class="p">(</span><span class="nx">radix</span><span class="o">:</span><span class="nb">Number</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span><span class="o">:</span><span class="nb">String</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="s2">&quot;-&quot;</span><span class="o">+</span><span class="nx">negate</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="nx">radix</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">k</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">radix</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>   <span class="nx">k</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="mi">4</span><span class="o">:</span>   <span class="nx">k</span><span class="o">=</span><span class="mi">2</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="mi">8</span><span class="o">:</span>   <span class="nx">k</span><span class="o">=</span><span class="mi">3</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="mi">16</span><span class="o">:</span>  <span class="nx">k</span><span class="o">=</span><span class="mi">4</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">case</span> <span class="mi">32</span><span class="o">:</span>  <span class="nx">k</span><span class="o">=</span><span class="mi">5</span><span class="o">;</span> <span class="k">break</span><span class="o">;</span>
        <span class="k">default</span><span class="o">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>

<div class="highlight"><pre><code>            <span class="k">return</span> <span class="nf">toRadix</span><span class="p">(</span><span class="n">radix</span><span class="p">);</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">km</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">k</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">d</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">m</span><span class="o">:</span><span class="nb">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">String</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">p</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">-</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="nx">DB</span><span class="p">)</span><span class="o">%</span><span class="nx">k</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">--&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;</span><span class="nx">DB</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="nx">p</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">m</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">p</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">k</span><span class="o">-</span><span class="nx">p</span><span class="p">);</span>
            <span class="nx">d</span><span class="o">|=</span> <span class="nx">a</span><span class="p">[</span><span class="o">--</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">p</span><span class="o">+=</span><span class="nx">DB</span><span class="o">-</span><span class="nx">k</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">p</span><span class="o">-=</span><span class="nx">k</span><span class="p">))</span><span class="o">&amp;</span><span class="nx">km</span><span class="o">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">p</span> <span class="o">+=</span> <span class="nx">DB</span><span class="o">;</span>
              <span class="o">--</span><span class="nx">i</span><span class="o">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">r</span> <span class="o">+=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">36</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">m</span><span class="o">?</span><span class="nx">r</span><span class="o">:</span><span class="s2">&quot;0&quot;</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">toArray</span><span class="p">(</span><span class="nx">array</span><span class="o">:</span><span class="nb">ByteArray</span><span class="p">)</span><span class="o">:</span><span class="nb">uint</span> <span class="p">{</span>
      <span class="kd">const</span> <span class="nx">k</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="o">;</span>
      <span class="kd">const</span> <span class="nx">km</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">8</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">d</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">p</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">-</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="nx">DB</span><span class="p">)</span><span class="o">%</span><span class="nx">k</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">m</span><span class="o">:</span><span class="nb">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">c</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">--&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;</span><span class="nx">DB</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="nx">p</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">m</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="nx">array</span><span class="p">.</span><span class="nx">writeByte</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
          <span class="nx">c</span><span class="o">++;</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;</span><span class="nx">k</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">p</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">k</span><span class="o">-</span><span class="nx">p</span><span class="p">);</span>
            <span class="nx">d</span><span class="o">|=</span> <span class="nx">a</span><span class="p">[</span><span class="o">--</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">p</span><span class="o">+=</span><span class="nx">DB</span><span class="o">-</span><span class="nx">k</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">p</span><span class="o">-=</span><span class="nx">k</span><span class="p">))</span><span class="o">&amp;</span><span class="nx">km</span><span class="o">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">p</span> <span class="o">+=</span> <span class="nx">DB</span><span class="o">;</span>
              <span class="o">--</span><span class="nx">i</span><span class="o">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">m</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">array</span><span class="p">.</span><span class="nx">writeByte</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
            <span class="nx">c</span><span class="o">++;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">c</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>*
* best-effort attempt to fit into a Number.
* precision can be lost if it just can't fit.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">valueOf</span><span class="p">()</span><span class="o">:</span><span class="nb">Number</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="o">==-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="nx">negate</span><span class="p">().</span><span class="nx">valueOf</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">coef</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">value</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">uint</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">value</span> <span class="o">+=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">*</span><span class="nx">coef</span><span class="o">;</span>
        <span class="nx">coef</span> <span class="o">*=</span> <span class="nx">DV</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">value</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>*
* -this</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">negate</span><span class="p">()</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="nx">ZERO</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>*
* |this|</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">abs</span><span class="p">()</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nx">negate</span><span class="p">()</span><span class="o">:</span><span class="k">this</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>*
* return + if this > v, - if this &lt; v, 0 if equal</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">compareTo</span><span class="p">(</span><span class="nx">v</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">s</span> <span class="o">-</span> <span class="nx">v</span><span class="p">.</span><span class="nx">s</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
      <span class="nx">r</span> <span class="o">=</span> <span class="nx">i</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">-</span><span class="nx">v</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>*
* returns bit length of the integer x</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">nbits</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">t</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">t</span><span class="o">=</span><span class="nx">x</span><span class="o">&gt;&gt;&gt;</span><span class="mi">16</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span> <span class="mi">16</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">t</span><span class="o">=</span><span class="nx">x</span><span class="o">&gt;&gt;</span><span class="mi">8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span> <span class="mi">8</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">t</span><span class="o">=</span><span class="nx">x</span><span class="o">&gt;&gt;</span><span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span> <span class="mi">4</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">t</span><span class="o">=</span><span class="nx">x</span><span class="o">&gt;&gt;</span><span class="mi">2</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">t</span><span class="o">=</span><span class="nx">x</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span> <span class="mi">1</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>*
* returns the number of bits in this</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">bitLength</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">return</span> <span class="nx">DB</span><span class="o">*</span><span class="p">(</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="nx">nbits</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">^</span><span class="p">(</span><span class="nx">s</span><span class="o">&amp;</span><span class="nx">DM</span><span class="p">));</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>*
* 
* @param v
* @return this % v
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">mod</span><span class="p">(</span><span class="nx">v</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="nx">abs</span><span class="p">().</span><span class="nx">divRemTo</span><span class="p">(</span><span class="nx">v</span><span class="o">,</span><span class="kc">null</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">r</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">ZERO</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">v</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>*
* this^e % m, 0 &lt;= e &lt; 2^32</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">modPowInt</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">m</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">z</span><span class="o">:</span><span class="nx">IReduction</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span><span class="o">&lt;</span><span class="mi">256</span> <span class="o">||</span> <span class="nx">m</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ClassicReduction</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MontgomeryReduction</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">exp</span><span class="p">(</span><span class="nx">e</span><span class="o">,</span> <span class="nx">z</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>*
* copy this to r</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">copyTo</span><span class="p">(</span><span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>*
* set from integer value "value", -DV &lt;= value &lt; DV</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">fromInt</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="nx">t</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
      <span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="nx">value</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?-</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">value</span><span class="o">+</span><span class="nx">DV</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>*
* set from ByteArray and length,
* starting a current position
* If length goes beyond the array, pad with zeroes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">fromArray</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="nb">ByteArray</span><span class="o">,</span> <span class="nx">length</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">unsigned</span><span class="o">:</span><span class="nb">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">p</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">position</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">p</span><span class="o">+</span><span class="nx">length</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">sh</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="kd">const</span> <span class="nx">k</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="o">;</span>
      <span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="o">?</span><span class="nx">value</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">:</span><span class="mi">0</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sh</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">sh</span><span class="o">+</span><span class="nx">k</span> <span class="o">&gt;</span> <span class="nx">DB</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="nx">x</span><span class="o">&amp;</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">DB</span><span class="o">-</span><span class="nx">sh</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="nx">sh</span><span class="o">;</span>
          <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">DB</span><span class="o">-</span><span class="nx">sh</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="nx">x</span><span class="o">&lt;&lt;</span><span class="nx">sh</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">sh</span> <span class="o">+=</span> <span class="nx">k</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sh</span> <span class="o">&gt;=</span> <span class="nx">DB</span><span class="p">)</span> <span class="nx">sh</span> <span class="o">-=</span> <span class="nx">DB</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">unsigned</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;</span><span class="mh">0x80</span><span class="p">)</span><span class="o">==</span><span class="mh">0x80</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">s</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">sh</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">DB</span><span class="o">-</span><span class="nx">sh</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="nx">sh</span><span class="o">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">clamp</span><span class="p">();</span>
      <span class="nx">value</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">p</span><span class="o">+</span><span class="nx">length</span><span class="o">,</span><span class="nx">value</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>*
* clamp off excess high words</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">clamp</span><span class="p">()</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">c</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">s</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">t</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
        <span class="o">--</span><span class="nx">t</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>*
* r = this &lt;&lt; n*DB</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">dlShiftTo</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="o">+</span><span class="nx">n</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>*
* r = this >> n*DB</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">drShiftTo</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">n</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">t</span><span class="o">-</span><span class="nx">n</span><span class="o">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>*
* r = this &lt;&lt; n</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">lShiftTo</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">bs</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">n</span><span class="o">%</span><span class="nx">DB</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">cbs</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">-</span><span class="nx">bs</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">bm</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">cbs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">ds</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">n</span><span class="o">/</span><span class="nx">DB</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">c</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;&lt;</span><span class="nx">bs</span><span class="p">)</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">ds</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="nx">cbs</span><span class="p">)</span><span class="o">|</span><span class="nx">c</span><span class="o">;</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;</span><span class="nx">bm</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="nx">bs</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">ds</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;</span> <span class="o">--</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">ds</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="o">+</span><span class="nx">ds</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>*
* r = this >> n</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">rShiftTo</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">ds</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">n</span><span class="o">/</span><span class="nx">DB</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ds</span> <span class="o">&gt;=</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">bs</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">n</span><span class="o">%</span><span class="nx">DB</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">cbs</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">-</span><span class="nx">bs</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">bm</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">bs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">ds</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="nx">bs</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">ds</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="nx">ds</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;</span><span class="nx">bm</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="nx">cbs</span><span class="o">;</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="nx">ds</span><span class="p">]</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="nx">bs</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">bs</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">-</span><span class="nx">ds</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">|=</span> <span class="p">(</span><span class="nx">s</span><span class="o">&amp;</span><span class="nx">bm</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="nx">cbs</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="o">-</span><span class="nx">ds</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>*
* r = this - v</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">subTo</span><span class="p">(</span><span class="nx">v</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">c</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">m</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">t</span><span class="o">,</span> <span class="nx">t</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="nx">v</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span> <span class="o">&amp;</span> <span class="nx">DM</span><span class="o">;</span>
        <span class="nx">c</span> <span class="o">&gt;&gt;=</span> <span class="nx">DB</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">t</span> <span class="o">&lt;</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">s</span><span class="o">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span><span class="o">+=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
          <span class="nx">c</span> <span class="o">&gt;&gt;=</span> <span class="nx">DB</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="nx">s</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="nx">s</span><span class="o">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">v</span><span class="p">.</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
          <span class="nx">c</span> <span class="o">&gt;&gt;=</span> <span class="nx">DB</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">c</span> <span class="o">-=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">s</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="nx">c</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?-</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">DV</span><span class="o">+</span><span class="nx">c</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">i</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>*
* am: Compute w_j += (x<em>this_i), propagates carries,
* c is initial carry, returns final carry.
* c &lt; 3</em>dvalue, x &lt; 2*dvalue, this_i &lt; dvalue</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">am</span><span class="p">(</span><span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span><span class="nx">w</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span><span class="nx">j</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span><span class="nx">c</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">xl</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">x</span><span class="o">&amp;</span><span class="mh">0x7fff</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">xh</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">x</span><span class="o">&gt;&gt;</span><span class="mi">15</span><span class="o">;</span>
      <span class="k">while</span><span class="p">(</span><span class="o">--</span><span class="nx">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">l</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;</span><span class="mh">0x7fff</span><span class="o">;</span>
        <span class="k">var</span> <span class="nx">h</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="mi">15</span><span class="o">;</span>
        <span class="k">var</span> <span class="nx">m</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">xh</span><span class="o">*</span><span class="nx">l</span> <span class="o">+</span> <span class="nx">h</span><span class="o">*</span><span class="nx">xl</span><span class="o">;</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="nx">xl</span><span class="o">*</span><span class="nx">l</span> <span class="o">+</span> <span class="p">((</span><span class="nx">m</span><span class="o">&amp;</span><span class="mh">0x7fff</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">15</span><span class="p">)</span><span class="o">+</span><span class="nx">w</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="nx">c</span><span class="o">&amp;</span><span class="mh">0x3fffffff</span><span class="p">);</span>
        <span class="nx">c</span> <span class="o">=</span> <span class="p">(</span><span class="nx">l</span><span class="o">&gt;&gt;&gt;</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="nx">m</span><span class="o">&gt;&gt;&gt;</span><span class="mi">15</span><span class="p">)</span><span class="o">+</span><span class="nx">xh</span><span class="o">*</span><span class="nx">h</span><span class="o">+</span><span class="p">(</span><span class="nx">c</span><span class="o">&gt;&gt;&gt;</span><span class="mi">30</span><span class="p">);</span>
        <span class="nx">w</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">l</span><span class="o">&amp;</span><span class="mh">0x3fffffff</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">c</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>*
* r = this * v, r != this,a (HAC 14.12)
* "this" should be the larger one if appropriate</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">multiplyTo</span><span class="p">(</span><span class="nx">v</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">abs</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">y</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">v</span><span class="p">.</span><span class="nx">abs</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">i</span><span class="o">+</span><span class="nx">y</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">y</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="p">]</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">am</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nx">y</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="nx">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="o">!=</span><span class="nx">v</span><span class="p">.</span><span class="nx">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ZERO</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>*
* r = this^2, r != this (HAC 14.16)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">squareTo</span><span class="p">(</span><span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">abs</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">c</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">am</span><span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">am</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">x</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="o">,</span> <span class="nx">c</span><span class="o">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="o">-</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="nx">DV</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">DV</span><span class="o">;</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">x</span><span class="p">.</span><span class="nx">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">r</span><span class="p">.</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">am</span><span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">x</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="mi">2</span><span class="o">*</span><span class="nx">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>*
* divide this by m, quotient and remainder to q, r (HAC 14.20)
* r != q, this != m. q or r may be null.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">divRemTo</span><span class="p">(</span><span class="nx">m</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">q</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="kc">null</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="kc">null</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">pm</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">abs</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pm</span><span class="p">.</span><span class="nx">t</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">pt</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">abs</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pt</span><span class="p">.</span><span class="nx">t</span> <span class="o">&lt;</span> <span class="nx">pm</span><span class="p">.</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span> <span class="nx">q</span><span class="p">.</span><span class="nx">fromInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span> <span class="nx">copyTo</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
        <span class="k">return</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">y</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">ts</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">ms</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">s</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">nsh</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">-</span><span class="nx">nbits</span><span class="p">(</span><span class="nx">pm</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">pm</span><span class="p">.</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">// normalize modulus</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nsh</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pm</span><span class="p">.</span><span class="nx">lShiftTo</span><span class="p">(</span><span class="nx">nsh</span><span class="o">,</span> <span class="nx">y</span><span class="p">);</span>
        <span class="nx">pt</span><span class="p">.</span><span class="nx">lShiftTo</span><span class="p">(</span><span class="nx">nsh</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">pm</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">y</span><span class="p">);</span>
        <span class="nx">pt</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">ys</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">y0</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">ys</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">y0</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">yt</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="nx">y0</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">F1</span><span class="p">)</span><span class="o">+</span><span class="p">((</span><span class="nx">ys</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span><span class="o">?</span><span class="nx">y</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">ys</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="nx">F2</span><span class="o">:</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">d1</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="nx">FV</span><span class="o">/</span><span class="nx">yt</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">d2</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">F1</span><span class="p">)</span><span class="o">/</span><span class="nx">yt</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">e</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">F2</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">j</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">i</span><span class="o">-</span><span class="nx">ys</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">t</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="p">(</span><span class="nx">q</span><span class="o">==</span><span class="kc">null</span><span class="p">)</span><span class="o">?</span><span class="nx">nbi</span><span class="p">()</span><span class="o">:</span><span class="nx">q</span><span class="o">;</span>
      <span class="nx">y</span><span class="p">.</span><span class="nx">dlShiftTo</span><span class="p">(</span><span class="nx">j</span><span class="o">,</span><span class="nx">t</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">t</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">r</span><span class="p">.</span><span class="nx">t</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">t</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">ONE</span><span class="p">.</span><span class="nx">dlShiftTo</span><span class="p">(</span><span class="nx">ys</span><span class="o">,</span><span class="nx">t</span><span class="p">);</span>
      <span class="nx">t</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">y</span><span class="o">,</span><span class="nx">y</span><span class="p">);</span> <span class="c1">// &quot;negative&quot; y so we can replace sub with am later.</span>
      <span class="k">while</span><span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">t</span><span class="o">&lt;</span><span class="nx">ys</span><span class="p">)</span> <span class="nx">y</span><span class="p">.(</span><span class="nx">y</span><span class="p">.</span><span class="nx">t</span><span class="o">++,</span> <span class="mi">0</span><span class="p">);</span>
      <span class="k">while</span><span class="p">(</span><span class="o">--</span><span class="nx">j</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>Estimate quotient digit</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">var</span> <span class="nx">qd</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="o">--</span><span class="nx">i</span><span class="p">]</span><span class="o">==</span><span class="nx">y0</span><span class="p">)</span><span class="o">?</span><span class="nx">DM</span><span class="o">:</span><span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="o">*</span><span class="nx">d1</span><span class="o">+</span><span class="p">(</span><span class="nb">Number</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="nx">e</span><span class="p">)</span><span class="o">*</span><span class="nx">d2</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">am</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nx">qd</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="nx">j</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">ys</span><span class="p">))</span><span class="o">&lt;</span><span class="nx">qd</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Try it out</span>
          <span class="nx">y</span><span class="p">.</span><span class="nx">dlShiftTo</span><span class="p">(</span><span class="nx">j</span><span class="o">,</span> <span class="nx">t</span><span class="p">);</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">t</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&lt;--</span><span class="nx">qd</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">r</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">t</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">q</span><span class="o">!=</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">drShiftTo</span><span class="p">(</span><span class="nx">ys</span><span class="o">,</span><span class="nx">q</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">ts</span><span class="o">!=</span><span class="nx">ms</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">ZERO</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">q</span><span class="o">,</span><span class="nx">q</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">ys</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nsh</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="nx">nsh</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span> <span class="c1">// Denormalize remainder</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ts</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ZERO</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>*
* return "-1/this % 2^DB"; useful for Mont. reduction
* justification:
*         xy == 1 (mod n)
*         xy =  1+km
*    xy(2-xy) = (1+km)(1-km)
* x[y(2-xy)] =  1-k^2.m^2
* x[y(2-xy)] == 1 (mod m^2)
* if y is 1/x mod m, then y(2-xy) is 1/x mod m^2
* should reduce x and y(2-xy) by m^2 at each step to keep size bounded
* [XXX unit test the living shit out of this.]</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">invDigit</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">&lt;</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">x</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">y</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">x</span><span class="o">&amp;</span><span class="mi">3</span><span class="o">;</span>              <span class="c1">// y == 1/x mod 2^2</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0xf</span> <span class="p">)</span><span class="o">*</span><span class="nx">y</span><span class="p">))</span>             <span class="o">&amp;</span><span class="mh">0xf</span><span class="o">;</span>  <span class="c1">// y == 1/x mod 2^4</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="p">(</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="p">)</span><span class="o">*</span><span class="nx">y</span><span class="p">))</span>             <span class="o">&amp;</span><span class="mh">0xff</span><span class="o">;</span> <span class="c1">// y == 1/x mod 2^8</span>
      <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="p">(((</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0xffff</span><span class="p">)</span><span class="o">*</span><span class="nx">y</span><span class="p">)</span><span class="o">&amp;</span><span class="mh">0xffff</span><span class="p">)))</span><span class="o">&amp;</span><span class="mh">0xffff</span><span class="o">;</span> <span class="c1">// y == 1/x mod 2^16</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>last step - calculate inverse mod DV directly;
assumes 16 &lt; DB &lt;= 32 and assumes ability to handle 48-bit ints
XXX 48 bit ints? Whaaaa? is there an implicit float conversion in here?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">y</span> <span class="o">=</span> <span class="p">(</span><span class="nx">y</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="nx">x</span><span class="o">*</span><span class="nx">y</span><span class="o">%</span><span class="nx">DV</span><span class="p">))</span><span class="o">%</span><span class="nx">DV</span><span class="o">;</span>  <span class="c1">// y == 1/x mod 2^dbits</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>we really want the negative inverse, and -DV &lt; y &lt; DV</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">return</span> <span class="p">(</span><span class="nx">y</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nx">DV</span><span class="o">-</span><span class="nx">y</span><span class="o">:-</span><span class="nx">y</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>*
* true iff this is even</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">isEven</span><span class="p">()</span><span class="o">:</span><span class="nb">Boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">((</span><span class="nx">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span><span class="nx">s</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>*
* this^e, e &lt; 2^32, doing sqr and mul with "r" (HAC 14.79)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">exp</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">z</span><span class="o">:</span><span class="nx">IReduction</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">&gt;</span> <span class="mh">0xffffffff</span> <span class="o">||</span> <span class="nx">e</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="nx">ONE</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">r2</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">g</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">convert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">nbits</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="nx">g</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
      <span class="k">while</span><span class="p">(</span><span class="o">--</span><span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">z</span><span class="p">.</span><span class="nx">sqrTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span> <span class="nx">r2</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">e</span><span class="o">&amp;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">i</span><span class="p">))</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">z</span><span class="p">.</span><span class="nx">mulTo</span><span class="p">(</span><span class="nx">r2</span><span class="o">,</span><span class="nx">g</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">var</span> <span class="nx">t</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">r</span><span class="o">;</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="nx">r2</span><span class="o">;</span>
          <span class="nx">r2</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
        <span class="p">}</span>
        
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">z</span><span class="p">.</span><span class="nx">revert</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">intAt</span><span class="p">(</span><span class="nx">str</span><span class="o">:</span><span class="nb">String</span><span class="o">,</span> <span class="nx">index</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nf">parseInt</span><span class="p">(</span><span class="nx">str</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span><span class="o">,</span> <span class="mi">36</span><span class="p">);</span>
    <span class="p">}</span>


    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">nbi</span><span class="p">()</span><span class="o">:*</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
    <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>*
* return bigint initialized to value</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">function</span> <span class="nx">nbv</span><span class="p">(</span><span class="nx">value</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">bn</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">bn</span><span class="p">.</span><span class="nx">fromInt</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">bn</span><span class="o">;</span>
    <span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>Functions above are sufficient for RSA encryption.
The stuff below is useful for decryption and key generation</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">lowprimes</span><span class="o">:</span><span class="nb">Array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">,</span><span class="mi">5</span><span class="o">,</span><span class="mi">7</span><span class="o">,</span><span class="mi">11</span><span class="o">,</span><span class="mi">13</span><span class="o">,</span><span class="mi">17</span><span class="o">,</span><span class="mi">19</span><span class="o">,</span><span class="mi">23</span><span class="o">,</span><span class="mi">29</span><span class="o">,</span><span class="mi">31</span><span class="o">,</span><span class="mi">37</span><span class="o">,</span><span class="mi">41</span><span class="o">,</span><span class="mi">43</span><span class="o">,</span><span class="mi">47</span><span class="o">,</span><span class="mi">53</span><span class="o">,</span><span class="mi">59</span><span class="o">,</span><span class="mi">61</span><span class="o">,</span><span class="mi">67</span><span class="o">,</span><span class="mi">71</span><span class="o">,</span><span class="mi">73</span><span class="o">,</span><span class="mi">79</span><span class="o">,</span><span class="mi">83</span><span class="o">,</span><span class="mi">89</span><span class="o">,</span><span class="mi">97</span><span class="o">,</span><span class="mi">101</span><span class="o">,</span><span class="mi">103</span><span class="o">,</span><span class="mi">107</span><span class="o">,</span><span class="mi">109</span><span class="o">,</span><span class="mi">113</span><span class="o">,</span><span class="mi">127</span><span class="o">,</span><span class="mi">131</span><span class="o">,</span><span class="mi">137</span><span class="o">,</span><span class="mi">139</span><span class="o">,</span><span class="mi">149</span><span class="o">,</span><span class="mi">151</span><span class="o">,</span><span class="mi">157</span><span class="o">,</span><span class="mi">163</span><span class="o">,</span><span class="mi">167</span><span class="o">,</span><span class="mi">173</span><span class="o">,</span><span class="mi">179</span><span class="o">,</span><span class="mi">181</span><span class="o">,</span><span class="mi">191</span><span class="o">,</span><span class="mi">193</span><span class="o">,</span><span class="mi">197</span><span class="o">,</span><span class="mi">199</span><span class="o">,</span><span class="mi">211</span><span class="o">,</span><span class="mi">223</span><span class="o">,</span><span class="mi">227</span><span class="o">,</span><span class="mi">229</span><span class="o">,</span><span class="mi">233</span><span class="o">,</span><span class="mi">239</span><span class="o">,</span><span class="mi">241</span><span class="o">,</span><span class="mi">251</span><span class="o">,</span><span class="mi">257</span><span class="o">,</span><span class="mi">263</span><span class="o">,</span><span class="mi">269</span><span class="o">,</span><span class="mi">271</span><span class="o">,</span><span class="mi">277</span><span class="o">,</span><span class="mi">281</span><span class="o">,</span><span class="mi">283</span><span class="o">,</span><span class="mi">293</span><span class="o">,</span><span class="mi">307</span><span class="o">,</span><span class="mi">311</span><span class="o">,</span><span class="mi">313</span><span class="o">,</span><span class="mi">317</span><span class="o">,</span><span class="mi">331</span><span class="o">,</span><span class="mi">337</span><span class="o">,</span><span class="mi">347</span><span class="o">,</span><span class="mi">349</span><span class="o">,</span><span class="mi">353</span><span class="o">,</span><span class="mi">359</span><span class="o">,</span><span class="mi">367</span><span class="o">,</span><span class="mi">373</span><span class="o">,</span><span class="mi">379</span><span class="o">,</span><span class="mi">383</span><span class="o">,</span><span class="mi">389</span><span class="o">,</span><span class="mi">397</span><span class="o">,</span><span class="mi">401</span><span class="o">,</span><span class="mi">409</span><span class="o">,</span><span class="mi">419</span><span class="o">,</span><span class="mi">421</span><span class="o">,</span><span class="mi">431</span><span class="o">,</span><span class="mi">433</span><span class="o">,</span><span class="mi">439</span><span class="o">,</span><span class="mi">443</span><span class="o">,</span><span class="mi">449</span><span class="o">,</span><span class="mi">457</span><span class="o">,</span><span class="mi">461</span><span class="o">,</span><span class="mi">463</span><span class="o">,</span><span class="mi">467</span><span class="o">,</span><span class="mi">479</span><span class="o">,</span><span class="mi">487</span><span class="o">,</span><span class="mi">491</span><span class="o">,</span><span class="mi">499</span><span class="o">,</span><span class="mi">503</span><span class="o">,</span><span class="mi">509</span><span class="p">];</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">const</span> <span class="nx">lplim</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="mi">26</span><span class="p">)</span><span class="o">/</span><span class="nx">lowprimes</span><span class="p">[</span><span class="nx">lowprimes</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>


    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">clone</span><span class="p">()</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>*
* 
* @return value as integer
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">intValue</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="nx">DV</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>assumes 16 &lt; DB &lt; 32</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">return</span>  <span class="p">((</span><span class="nx">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&amp;</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">32</span><span class="o">-</span><span class="nx">DB</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="nx">DB</span><span class="p">)</span><span class="o">|</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>*
* 
* @return value as byte
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">byteValue</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nx">s</span><span class="o">:</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">24</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">24</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>*
* 
* @return value as short (assumes DB>=16)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">shortValue</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nx">s</span><span class="o">:</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;&lt;</span><span class="mi">16</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">16</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>*
* 
* @param r
* @return x s.t. r^x &lt; DV
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">chunkSize</span><span class="p">(</span><span class="nx">r</span><span class="o">:</span><span class="nb">Number</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">LN2</span><span class="o">*</span><span class="nx">DB</span><span class="o">/</span><span class="nb">Math</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">r</span><span class="p">));</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>*
* 
* @return 0 if this ==0, 1 if this >0
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">sigNum</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">&lt;=</span><span class="mi">0</span> <span class="o">||</span> <span class="p">(</span><span class="nx">t</span><span class="o">==</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span><span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<p>*
* 
* @param b: radix to use
* @return a string representing the integer converted to the radix.
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">toRadix</span><span class="p">(</span><span class="nx">b</span><span class="o">:</span><span class="nb">uint</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span><span class="o">:</span><span class="nb">String</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">sigNum</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span> <span class="o">||</span> <span class="nx">b</span><span class="o">&lt;</span><span class="mi">2</span> <span class="o">||</span> <span class="nx">b</span><span class="o">&gt;</span><span class="mi">32</span><span class="p">)</span> <span class="k">return</span> <span class="s2">&quot;0&quot;</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">cs</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">chunkSize</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">a</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">b</span><span class="o">,</span> <span class="nx">cs</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">d</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">y</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">z</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbi</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">String</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="o">;</span>
      <span class="nx">divRemTo</span><span class="p">(</span><span class="nx">d</span><span class="o">,</span> <span class="nx">y</span><span class="o">,</span> <span class="nx">z</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">sigNum</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="o">+</span><span class="nx">z</span><span class="p">.</span><span class="nx">intValue</span><span class="p">()).</span><span class="nx">toString</span><span class="p">(</span><span class="nx">b</span><span class="p">).</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="nx">r</span><span class="o">;</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">divRemTo</span><span class="p">(</span><span class="nx">d</span><span class="o">,</span><span class="nx">y</span><span class="o">,</span><span class="nx">z</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">z</span><span class="p">.</span><span class="nx">intValue</span><span class="p">().</span><span class="nx">toString</span><span class="p">(</span><span class="nx">b</span><span class="p">)</span> <span class="o">+</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>*
* 
* @param s a string to convert from using radix.
* @param b a radix
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">fromRadix</span><span class="p">(</span><span class="nx">s</span><span class="o">:</span><span class="nb">String</span><span class="o">,</span> <span class="nx">b</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="nx">fromInt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">cs</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">chunkSize</span><span class="p">(</span><span class="nx">b</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">d</span><span class="o">:</span><span class="nb">Number</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">b</span><span class="o">,</span> <span class="nx">cs</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">mi</span><span class="o">:</span><span class="nb">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">j</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">w</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">s</span><span class="p">.</span><span class="nx">length</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">intAt</span><span class="p">(</span><span class="nx">s</span><span class="o">,</span> <span class="nx">i</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;-&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">sigNum</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">mi</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
          <span class="p">}</span>
          <span class="k">continue</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">w</span> <span class="o">=</span> <span class="nx">b</span><span class="o">*</span><span class="nx">w</span><span class="o">+</span><span class="nx">x</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">j</span> <span class="o">&gt;=</span> <span class="nx">cs</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">dMultiply</span><span class="p">(</span><span class="nx">d</span><span class="p">);</span>
          <span class="nx">dAddOffset</span><span class="p">(</span><span class="nx">w</span><span class="o">,</span><span class="mi">0</span><span class="p">);</span>
          <span class="nx">j</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
          <span class="nx">w</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">j</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">dMultiply</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">pow</span><span class="p">(</span><span class="nx">b</span><span class="o">,</span><span class="nx">j</span><span class="p">));</span>
        <span class="nx">dAddOffset</span><span class="p">(</span><span class="nx">w</span><span class="o">,</span><span class="mi">0</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">mi</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ZERO</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="k">this</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>XXX function fromNumber not written yet.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>*
* 
* @return a byte array.
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">toByteArray</span><span class="p">()</span><span class="o">:</span><span class="nb">ByteArray</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">ByteArray</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">ByteArray</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">s</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">p</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">-</span><span class="p">(</span><span class="nx">i</span><span class="o">*</span><span class="nx">DB</span><span class="p">)</span><span class="o">%</span><span class="mi">8</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">d</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">k</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">--&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;</span><span class="nx">DB</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">d</span><span class="o">=</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="nx">p</span><span class="p">)</span><span class="o">!=</span><span class="p">(</span><span class="nx">s</span><span class="o">&amp;</span><span class="nx">DM</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="o">|</span><span class="p">(</span><span class="nx">s</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">DB</span><span class="o">-</span><span class="nx">p</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span><span class="p">(</span><span class="nx">p</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&amp;</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">p</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="mi">8</span><span class="o">-</span><span class="nx">p</span><span class="p">);</span>
            <span class="nx">d</span><span class="o">|=</span> <span class="nx">a</span><span class="p">[</span><span class="o">--</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">p</span><span class="o">+=</span><span class="nx">DB</span><span class="o">-</span><span class="mi">8</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">p</span><span class="o">-=</span><span class="mi">8</span><span class="p">))</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="o">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">p</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">p</span> <span class="o">+=</span> <span class="nx">DB</span><span class="o">;</span>
              <span class="o">--</span><span class="nx">i</span><span class="o">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">((</span><span class="nx">d</span><span class="o">&amp;</span><span class="mh">0x80</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="nx">d</span><span class="o">|=-</span><span class="mi">256</span><span class="o">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="o">==</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">s</span><span class="o">&amp;</span><span class="mh">0x80</span><span class="p">)</span><span class="o">!=</span><span class="p">(</span><span class="nx">d</span><span class="o">&amp;</span><span class="mh">0x80</span><span class="p">))</span> <span class="o">++</span><span class="nx">k</span><span class="o">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="o">&gt;</span><span class="mi">0</span> <span class="o">||</span> <span class="nx">d</span><span class="o">!=</span><span class="nx">s</span><span class="p">)</span> <span class="nx">r</span><span class="p">[</span><span class="nx">k</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">d</span><span class="o">;</span>
        <span class="p">}</span> 
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">equals</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nb">Boolean</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">compareTo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="k">this</span><span class="o">:</span><span class="nx">a</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">max</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">a</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="k">this</span><span class="o">:</span><span class="nx">a</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>*
* 
* @param a  a BigInteger to perform the operation with
* @param op a Function implementing the operation
* @param r a BigInteger to store the result of the operation
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">bitwiseTo</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">op</span><span class="o">:</span><span class="nb">Function</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">f</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">m</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">,</span> <span class="nx">t</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">m</span><span class="o">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">op</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">&lt;</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">f</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">s</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">m</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">op</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span><span class="nx">f</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">f</span> <span class="o">=</span> <span class="nx">s</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nx">m</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">op</span><span class="p">(</span><span class="nx">f</span><span class="o">,</span><span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">op</span><span class="p">(</span><span class="nx">s</span><span class="o">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">s</span><span class="p">);</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">function</span> <span class="nx">op_and</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">y</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span><span class="k">return</span> <span class="nx">x</span><span class="o">&amp;</span><span class="nx">y</span><span class="o">;</span><span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">and</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">bitwiseTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span> <span class="nx">op_and</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">function</span> <span class="nx">op_or</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">y</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span><span class="k">return</span> <span class="nx">x</span><span class="o">|</span><span class="nx">y</span><span class="o">;</span><span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">or</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">bitwiseTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span> <span class="nx">op_or</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">function</span> <span class="nx">op_xor</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">y</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span><span class="k">return</span> <span class="nx">x</span><span class="o">^</span><span class="nx">y</span><span class="o">;</span><span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">xor</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">bitwiseTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span> <span class="nx">op_xor</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">function</span> <span class="nx">op_andnot</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">y</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">x</span><span class="o">&amp;~</span><span class="nx">y</span><span class="o">;</span><span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">andNot</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">bitwiseTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span> <span class="nx">op_andnot</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">not</span><span class="p">()</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">DM</span><span class="o">&amp;~</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="o">~</span><span class="nx">s</span><span class="o">;</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">shiftLeft</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">rShiftTo</span><span class="p">(</span><span class="o">-</span><span class="nx">n</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">lShiftTo</span><span class="p">(</span><span class="nx">n</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">shiftRight</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">lShiftTo</span><span class="p">(</span><span class="o">-</span><span class="nx">n</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">rShiftTo</span><span class="p">(</span><span class="nx">n</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>*
* 
* @param x
* @return index of lowet 1-bit in x, x &lt; 2^31
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">private</span> <span class="kd">function</span> <span class="nx">lbit</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0xffff</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span><span class="o">&gt;&gt;=</span> <span class="mi">16</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span> <span class="mi">16</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0xff</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span><span class="o">&gt;&gt;=</span>  <span class="mi">8</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span>  <span class="mi">8</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0xf</span><span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span><span class="o">&gt;&gt;=</span>  <span class="mi">4</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span>  <span class="mi">4</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0x3</span><span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span><span class="o">&gt;&gt;=</span>  <span class="mi">2</span><span class="o">;</span> <span class="nx">r</span> <span class="o">+=</span>  <span class="mi">2</span><span class="o">;</span> <span class="p">}</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">x</span><span class="o">&amp;</span><span class="mh">0x1</span><span class="p">)</span>  <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="o">++</span><span class="nx">r</span><span class="o">;</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>*
* 
* @return index of lowest 1-bit (or -1 if none)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">getLowestSetBit</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">i</span><span class="o">*</span><span class="nx">DB</span><span class="o">+</span><span class="nx">lbit</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">t</span><span class="o">*</span><span class="nx">DB</span><span class="o">;</span>
      <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>*
* 
* @param x
* @return number of 1 bits in x
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">private</span> <span class="kd">function</span> <span class="nx">cbit</span><span class="p">(</span><span class="nx">x</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">uint</span> <span class="o">=</span><span class="mi">0</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">x</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="nx">x</span> <span class="o">&amp;=</span> <span class="nx">x</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="o">++</span><span class="nx">r</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>*
* 
* @return number of set bits
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">bitCount</span><span class="p">()</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">s</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span> <span class="o">+=</span> <span class="nx">cbit</span><span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">^</span><span class="nx">x</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>*
* 
* @param n
* @return true iff nth bit is set
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">testBit</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">Boolean</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">j</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nx">n</span><span class="o">/</span><span class="nx">DB</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">j</span><span class="o">&gt;=</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">s</span><span class="o">!=</span><span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">((</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">&amp;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">n</span><span class="o">%</span><span class="nx">DB</span><span class="p">)))</span><span class="o">!=</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>*
* 
* @param n
* @param op
* @return this op (1&lt;<n)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">changeBit</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span><span class="nx">op</span><span class="o">:</span><span class="nb">Function</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ONE</span><span class="p">.</span><span class="nx">shiftLeft</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span>
      <span class="nx">bitwiseTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span> <span class="nx">op</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>*
* 
* @param n
* @return this | (1&lt;<n)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">setBit</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">changeBit</span><span class="p">(</span><span class="nx">n</span><span class="o">,</span> <span class="nx">op_or</span><span class="p">);</span> <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>*
* 
* @param n
* @return this &amp; ~(1&lt;<n)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">clearBit</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">changeBit</span><span class="p">(</span><span class="nx">n</span><span class="o">,</span> <span class="nx">op_andnot</span><span class="p">);</span> <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>*
* 
* @param n
* @return this ^ (1&lt;<n)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">flipBit</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">changeBit</span><span class="p">(</span><span class="nx">n</span><span class="o">,</span> <span class="nx">op_xor</span><span class="p">);</span> <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53">&#182;</a>
</div>
<p>*
* 
* @param a
* @param r = this + a
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">addTo</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">c</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">m</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">,</span> <span class="nx">t</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
        <span class="nx">c</span><span class="o">&gt;&gt;=</span><span class="nx">DB</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span> <span class="o">&lt;</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">s</span><span class="o">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
          <span class="nx">c</span> <span class="o">&gt;&gt;=</span> <span class="nx">DB</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="nx">s</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="nx">s</span><span class="o">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">c</span> <span class="o">+=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">&amp;</span><span class="nx">DM</span><span class="o">;</span>
          <span class="nx">c</span> <span class="o">&gt;&gt;=</span> <span class="nx">DB</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="nx">c</span> <span class="o">+=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">s</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="p">(</span><span class="nx">c</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?-</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">c</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="o">&lt;-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="nx">DV</span><span class="o">+</span><span class="nx">c</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">i</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>*
* 
* @param a
* @return this + a
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">add</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">addTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>*
* 
* @param a
* @return this - a
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">subtract</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">subTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>*
* 
* @param a
* @return this * a
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">multiply</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">multiplyTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>*
* 
* @param a
* @return this / a
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">divide</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">divRemTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="kc">null</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">remainder</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">divRemTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span> <span class="kc">null</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>*
* 
* @param a
* @return [this/a, this%a]
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">divideAndRemainder</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nb">Array</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">q</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">divRemTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span> <span class="nx">q</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="k">return</span> <span class="p">[</span><span class="nx">q</span><span class="o">,</span><span class="nx">r</span><span class="p">];</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<p>*
* 
* this *= n, this >=0, 1 &lt; n &lt; DV
* 
* @param n
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">dMultiply</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="p">]</span> <span class="o">=</span> <span class="nx">am</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="k">this</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">t</span><span class="p">);</span>
      <span class="o">++</span><span class="nx">t</span><span class="o">;</span>
      <span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<p>*
* 
* this += n &lt;&lt; w words, this >= 0
* 
* @param n
* @param w
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">dAddOffset</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">w</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">t</span><span class="o">&lt;=</span><span class="nx">w</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="nx">a</span><span class="p">[</span><span class="nx">w</span><span class="p">]</span> <span class="o">+=</span> <span class="nx">n</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">a</span><span class="p">[</span><span class="nx">w</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="nx">DV</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">[</span><span class="nx">w</span><span class="p">]</span> <span class="o">-=</span> <span class="nx">DV</span><span class="o">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">w</span> <span class="o">&gt;=</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="o">++</span><span class="nx">a</span><span class="p">[</span><span class="nx">w</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>*
* 
* @param e
* @return this^e
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">pow</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">exp</span><span class="p">(</span><span class="nx">e</span><span class="o">,</span> <span class="k">new</span> <span class="nx">NullReduction</span><span class="p">);</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62">&#182;</a>
</div>
<p>*
* 
* @param a
* @param n
* @param r = lower n words of "this * a", a.t &lt;= n
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">multiplyLowerTo</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">t</span><span class="o">+</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">,</span> <span class="nx">n</span><span class="p">);</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// assumes a, this &gt;= 0</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">i</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="o">--</span><span class="nx">i</span><span class="p">]</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">j</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="nx">r</span><span class="p">.</span><span class="nx">t</span><span class="o">-</span><span class="nx">t</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">j</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="o">+</span><span class="nx">t</span><span class="p">]</span> <span class="o">=</span> <span class="nx">am</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="nx">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">t</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span><span class="o">=</span><span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">,</span><span class="nx">n</span><span class="p">);</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">j</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">am</span><span class="p">(</span><span class="mi">0</span><span class="o">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="nx">i</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">n</span><span class="o">-</span><span class="nx">i</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<p>*
* 
* @param a
* @param n
* @param r = "this * a" without lower n words, n > 0
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">bi_internal</span> <span class="kd">function</span> <span class="nx">multiplyUpperTo</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="o">--</span><span class="nx">n</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">r</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="nx">t</span><span class="o">+</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">-</span><span class="nx">n</span><span class="o">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// assumes a,this &gt;= 0</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="nx">t</span><span class="o">,</span><span class="mi">0</span><span class="p">);</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">a</span><span class="p">.</span><span class="nx">t</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">t</span><span class="o">+</span><span class="nx">i</span><span class="o">-</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="nx">am</span><span class="p">(</span><span class="nx">n</span><span class="o">-</span><span class="nx">i</span><span class="o">,</span> <span class="nx">a</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="nx">t</span><span class="o">+</span><span class="nx">i</span><span class="o">-</span><span class="nx">n</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">clamp</span><span class="p">();</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">drShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="nx">r</span><span class="p">);</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<p>*
* 
* @param e
* @param m
* @return this^e % m (HAC 14.85)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">modPow</span><span class="p">(</span><span class="nx">e</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">,</span> <span class="nx">m</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">bitLength</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">k</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">z</span><span class="o">:</span><span class="nx">IReduction</span><span class="o">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">18</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span><span class="o">=</span><span class="mi">1</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">48</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span><span class="o">=</span><span class="mi">3</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">144</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span><span class="o">=</span><span class="mi">4</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">768</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">k</span><span class="o">=</span><span class="mi">5</span><span class="o">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">k</span><span class="o">=</span><span class="mi">6</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ClassicReduction</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BarrettReduction</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">z</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MontgomeryReduction</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65">&#182;</a>
</div>
<p>precomputation</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">var</span> <span class="nx">g</span><span class="o">:</span><span class="nb">Array</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="k">var</span> <span class="nx">n</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">k1</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">k</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">km</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">k</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="nx">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">z</span><span class="p">.</span><span class="nx">convert</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">k</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">g2</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
        <span class="nx">z</span><span class="p">.</span><span class="nx">sqrTo</span><span class="p">(</span><span class="nx">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">,</span> <span class="nx">g2</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">n</span><span class="o">&lt;=</span><span class="nx">km</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">g</span><span class="p">[</span><span class="nx">n</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
          <span class="nx">z</span><span class="p">.</span><span class="nx">mulTo</span><span class="p">(</span><span class="nx">g2</span><span class="o">,</span> <span class="nx">g</span><span class="p">[</span><span class="nx">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">,</span> <span class="nx">g</span><span class="p">[</span><span class="nx">n</span><span class="p">]);</span>
          <span class="nx">n</span> <span class="o">+=</span> <span class="mi">2</span><span class="o">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">var</span> <span class="nx">j</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">w</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">is1</span><span class="o">:</span><span class="nb">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r2</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">t</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">;</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="nx">nbits</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">j</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&gt;=</span><span class="nx">k1</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">w</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">i</span><span class="o">-</span><span class="nx">k1</span><span class="p">))</span><span class="o">&amp;</span><span class="nx">km</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">w</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">&amp;</span><span class="p">((</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="p">(</span><span class="nx">k1</span><span class="o">-</span><span class="nx">i</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">j</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">w</span> <span class="o">|=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;&gt;</span><span class="p">(</span><span class="nx">DB</span><span class="o">+</span><span class="nx">i</span><span class="o">-</span><span class="nx">k1</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        <span class="nx">n</span> <span class="o">=</span> <span class="nx">k</span><span class="o">;</span>
        <span class="k">while</span> <span class="p">((</span><span class="nx">w</span><span class="o">&amp;</span><span class="mi">1</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">w</span> <span class="o">&gt;&gt;=</span> <span class="mi">1</span><span class="o">;</span>
          <span class="o">--</span><span class="nx">n</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">i</span> <span class="o">-=</span> <span class="nx">n</span><span class="p">)</span> <span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">i</span> <span class="o">+=</span> <span class="nx">DB</span><span class="o">;</span>
          <span class="o">--</span><span class="nx">j</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">is1</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// ret == 1, don&#39;t bother squaring or multiplying it</span>
          <span class="nx">g</span><span class="p">[</span><span class="nx">w</span><span class="p">].</span><span class="nx">copyTo</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
          <span class="nx">is1</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">n</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">z</span><span class="p">.</span><span class="nx">sqrTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span> <span class="nx">r2</span><span class="p">);</span>
            <span class="nx">z</span><span class="p">.</span><span class="nx">sqrTo</span><span class="p">(</span><span class="nx">r2</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
            <span class="nx">n</span> <span class="o">-=</span> <span class="mi">2</span><span class="o">;</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">z</span><span class="p">.</span><span class="nx">sqrTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span> <span class="nx">r2</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">t</span> <span class="o">=</span> <span class="nx">r</span><span class="o">;</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="nx">r2</span><span class="o">;</span>
            <span class="nx">r2</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
          <span class="p">}</span>
          <span class="nx">z</span><span class="p">.</span><span class="nx">mulTo</span><span class="p">(</span><span class="nx">r2</span><span class="o">,</span> <span class="nx">g</span><span class="p">[</span><span class="nx">w</span><span class="p">]</span><span class="o">,</span> <span class="nx">r</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">j</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="nx">j</span><span class="p">]</span><span class="o">&amp;</span><span class="p">(</span><span class="mi">1</span><span class="o">&lt;&lt;</span><span class="nx">i</span><span class="p">))</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">z</span><span class="p">.</span><span class="nx">sqrTo</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span> <span class="nx">r2</span><span class="p">);</span>
          <span class="nx">t</span> <span class="o">=</span> <span class="nx">r</span><span class="o">;</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="nx">r2</span><span class="o">;</span>
          <span class="nx">r2</span> <span class="o">=</span> <span class="nx">t</span><span class="o">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">--</span><span class="nx">i</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">i</span> <span class="o">=</span> <span class="nx">DB</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span>
            <span class="o">--</span><span class="nx">j</span><span class="o">;</span>
          <span class="p">}</span>
          
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">z</span><span class="p">.</span><span class="nx">revert</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66">&#182;</a>
</div>
<p>*
* 
* @param a
* @return gcd(this, a) (HAC 14.54)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">gcd</span><span class="p">(</span><span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nx">negate</span><span class="p">()</span><span class="o">:</span><span class="nx">clone</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">y</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nx">a</span><span class="p">.</span><span class="nx">negate</span><span class="p">()</span><span class="o">:</span><span class="nx">a</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">t</span><span class="o">:</span><span class="nx">BigInteger</span><span class="o">=</span><span class="nx">x</span><span class="o">;</span>
        <span class="nx">x</span><span class="o">=</span><span class="nx">y</span><span class="o">;</span>
        <span class="nx">y</span><span class="o">=</span><span class="nx">t</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">getLowestSetBit</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">g</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">getLowestSetBit</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">g</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="nx">x</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">g</span><span class="p">)</span> <span class="nx">g</span><span class="o">=</span> <span class="nx">i</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">g</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">x</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="nx">g</span><span class="o">,</span> <span class="nx">x</span><span class="p">);</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="nx">g</span><span class="o">,</span> <span class="nx">y</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">sigNum</span><span class="p">()</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">getLowestSetBit</span><span class="p">())</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">x</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">x</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">((</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">getLowestSetBit</span><span class="p">())</span> <span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">y</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="nx">i</span><span class="o">,</span> <span class="nx">y</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">y</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">x</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">y</span><span class="o">,</span> <span class="nx">x</span><span class="p">);</span>
          <span class="nx">x</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">x</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">y</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">x</span><span class="o">,</span> <span class="nx">y</span><span class="p">);</span>
          <span class="nx">y</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span> <span class="nx">y</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">g</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">y</span><span class="p">.</span><span class="nx">lShiftTo</span><span class="p">(</span><span class="nx">g</span><span class="o">,</span> <span class="nx">y</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">y</span><span class="o">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67">&#182;</a>
</div>
<p>*
* 
* @param n
* @return this % n, n &lt; 2^DB
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">modInt</span><span class="p">(</span><span class="nx">n</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">int</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">n</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">d</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">DV</span><span class="o">%</span><span class="nx">n</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="p">(</span><span class="nx">s</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span><span class="o">?</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">%</span><span class="nx">n</span><span class="o">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="nx">t</span><span class="o">-</span><span class="mi">1</span><span class="o">;</span><span class="nx">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="o">;--</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">d</span><span class="o">*</span><span class="nx">r</span><span class="o">+</span><span class="nx">a</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="o">%</span><span class="nx">n</span><span class="o">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">r</span><span class="o">;</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>*
* 
* @param m
* @return 1/this %m (HAC 14.61)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">modInverse</span><span class="p">(</span><span class="nx">m</span><span class="o">:</span><span class="nx">BigInteger</span><span class="p">)</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">ac</span><span class="o">:</span><span class="nb">Boolean</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">isEven</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">((</span><span class="nx">isEven</span><span class="p">()</span><span class="o">&amp;&amp;</span><span class="nx">ac</span><span class="p">)</span> <span class="o">||</span> <span class="nx">m</span><span class="p">.</span><span class="nx">sigNum</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ZERO</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">u</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">clone</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">v</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">clone</span><span class="p">();</span>
      <span class="k">var</span> <span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">b</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">c</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">d</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">nbv</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">sigNum</span><span class="p">()</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">u</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="nx">u</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">a</span><span class="p">.</span><span class="nx">isEven</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
              <span class="nx">a</span><span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="k">this</span><span class="o">,</span><span class="nx">a</span><span class="p">);</span>
              <span class="nx">b</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">m</span><span class="o">,</span><span class="nx">b</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">a</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="nx">a</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">b</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">b</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">m</span><span class="o">,</span><span class="nx">b</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">b</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="nx">b</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
          <span class="nx">v</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="nx">v</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">c</span><span class="p">.</span><span class="nx">isEven</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
              <span class="nx">c</span><span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="k">this</span><span class="o">,</span><span class="nx">c</span><span class="p">);</span>
              <span class="nx">d</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">m</span><span class="o">,</span><span class="nx">d</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">c</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="nx">c</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
            <span class="nx">d</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">m</span><span class="o">,</span><span class="nx">d</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">d</span><span class="p">.</span><span class="nx">rShiftTo</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="nx">d</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">u</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">u</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">v</span><span class="o">,</span><span class="nx">u</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">a</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">c</span><span class="o">,</span><span class="nx">a</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">b</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">d</span><span class="o">,</span><span class="nx">b</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="nx">v</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">u</span><span class="o">,</span><span class="nx">v</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">ac</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">c</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">a</span><span class="o">,</span><span class="nx">c</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">d</span><span class="p">.</span><span class="nx">subTo</span><span class="p">(</span><span class="nx">b</span><span class="o">,</span><span class="nx">d</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ONE</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ZERO</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">m</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">subtract</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">sigNum</span><span class="p">()</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">d</span><span class="p">.</span><span class="nx">addTo</span><span class="p">(</span><span class="nx">m</span><span class="o">,</span><span class="nx">d</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">d</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">d</span><span class="p">.</span><span class="nx">sigNum</span><span class="p">()</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">d</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">d</span><span class="o">;</span>
      <span class="p">}</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<p>*
* 
* @param t
* @return primality with certainty >= 1-.5^t
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">isProbablePrime</span><span class="p">(</span><span class="nx">t</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">Boolean</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">;</span>
      <span class="k">var</span> <span class="nx">x</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">abs</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">t</span> <span class="o">==</span> <span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="nx">x</span><span class="p">.</span><span class="nx">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;=</span><span class="nx">lowprimes</span><span class="p">[</span><span class="nx">lowprimes</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">lowprimes</span><span class="p">.</span><span class="nx">length</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="nx">lowprimes</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">x</span><span class="p">.</span><span class="nx">isEven</span><span class="p">())</span> <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">lowprimes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">var</span> <span class="nx">m</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">lowprimes</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">var</span> <span class="nx">j</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">i</span><span class="o">+</span><span class="mi">1</span><span class="o">;</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">j</span><span class="o">&lt;</span><span class="nx">lowprimes</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> <span class="nx">m</span><span class="o">&lt;</span><span class="nx">lplim</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">m</span> <span class="o">*=</span> <span class="nx">lowprimes</span><span class="p">[</span><span class="nx">j</span><span class="o">++</span><span class="p">];</span>
        <span class="p">}</span>
        <span class="nx">m</span> <span class="o">=</span> <span class="nx">x</span><span class="p">.</span><span class="nx">modInt</span><span class="p">(</span><span class="nx">m</span><span class="p">);</span>
        <span class="k">while</span> <span class="p">(</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">j</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">m</span><span class="o">%</span><span class="nx">lowprimes</span><span class="p">[</span><span class="nx">i</span><span class="o">++</span><span class="p">]</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">x</span><span class="p">.</span><span class="nx">millerRabin</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
    <span class="p">}</span>
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>*
* 
* @param t
* @return true if probably prime (HAC 4.24, Miller-Rabin)
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">protected</span> <span class="kd">function</span> <span class="nx">millerRabin</span><span class="p">(</span><span class="nx">t</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nb">Boolean</span> <span class="p">{</span>
      <span class="k">var</span> <span class="nx">n1</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">subtract</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ONE</span><span class="p">);</span>
      <span class="k">var</span> <span class="nx">k</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">getLowestSetBit</span><span class="p">();</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">k</span><span class="o">&lt;=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">r</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">n1</span><span class="p">.</span><span class="nx">shiftRight</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
      <span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="nx">t</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">&gt;&gt;</span><span class="mi">1</span><span class="o">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">t</span><span class="o">&gt;</span><span class="nx">lowprimes</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">t</span> <span class="o">=</span> <span class="nx">lowprimes</span><span class="p">.</span><span class="nx">length</span><span class="o">;</span>
      <span class="p">}</span>
      <span class="k">var</span> <span class="nx">a</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigInteger</span><span class="o">;</span>
      <span class="k">for</span> <span class="p">(</span><span class="k">var</span> <span class="nx">i</span><span class="o">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">t</span><span class="o">;++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">a</span><span class="p">.</span><span class="nx">fromInt</span><span class="p">(</span><span class="nx">lowprimes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="k">var</span> <span class="nx">y</span><span class="o">:</span><span class="nx">BigInteger</span> <span class="o">=</span> <span class="nx">a</span><span class="p">.</span><span class="nx">modPow</span><span class="p">(</span><span class="nx">r</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ONE</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">n1</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">var</span> <span class="nx">j</span><span class="o">:</span><span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">j</span><span class="o">++&lt;</span><span class="nx">k</span> <span class="o">&amp;&amp;</span> <span class="nx">y</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">n1</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">y</span> <span class="o">=</span> <span class="nx">y</span><span class="p">.</span><span class="nx">modPowInt</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ONE</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">y</span><span class="p">.</span><span class="nx">compareTo</span><span class="p">(</span><span class="nx">n1</span><span class="p">)</span><span class="o">!=</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71">&#182;</a>
</div>
<p>*
* Tweak our BigInteger until it looks prime enough
* 
* @param bits
* @param t
* </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">public</span> <span class="kd">function</span> <span class="nx">primify</span><span class="p">(</span><span class="nx">bits</span><span class="o">:</span><span class="nb">int</span><span class="o">,</span> <span class="nx">t</span><span class="o">:</span><span class="nb">int</span><span class="p">)</span><span class="o">:</span><span class="nx">void</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">testBit</span><span class="p">(</span><span class="nx">bits</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="p">{</span> <span class="c1">// force MSB set</span>
        <span class="nx">bitwiseTo</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ONE</span><span class="p">.</span><span class="nx">shiftLeft</span><span class="p">(</span><span class="nx">bits</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">,</span> <span class="nx">op_or</span><span class="o">,</span> <span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">isEven</span><span class="p">())</span> <span class="p">{</span>
        <span class="nx">dAddOffset</span><span class="p">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">0</span><span class="p">);</span>  <span class="c1">// force odd</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">isProbablePrime</span><span class="p">(</span><span class="nx">t</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">dAddOffset</span><span class="p">(</span><span class="mi">2</span><span class="o">,</span><span class="mi">0</span><span class="p">);</span>
        <span class="k">while</span><span class="p">(</span><span class="nx">bitLength</span><span class="p">()</span><span class="o">&gt;</span><span class="nx">bits</span><span class="p">)</span> <span class="nx">subTo</span><span class="p">(</span><span class="nx">BigInteger</span><span class="p">.</span><span class="nx">ONE</span><span class="p">.</span><span class="nx">shiftLeft</span><span class="p">(</span><span class="nx">bits</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">,</span><span class="k">this</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>

  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
