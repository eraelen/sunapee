<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../../doc-style.css" />
  <script src="../../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../../", thisFile = "node_modules/socket.io/node_modules/socket.io-client/lib/vendor/web-socket-js/README.md", defaultSidebar = true;
  </script>
  <script src="../../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h2">
        <a href="#how-to-try-the-sample">How to try the sample</a>
      </div>
      <div class="heading h2">
        <a href="#how-to-use-it-in-your-application">How to use it in your application</a>
      </div>
      <div class="heading h2">
        <a href="#troubleshooting">Troubleshooting</a>
      </div>
      <div class="heading h2">
        <a href="#supported-environments">Supported environments</a>
      </div>
      <div class="heading h2">
        <a href="#limitations-differences-compared-to-native-websocket">Limitations/differences compared to native WebSocket</a>
      </div>
      <div class="heading h3">
        <a href="#flash-socket-policy-file">Flash socket policy file</a>
      </div>
      <div class="heading h3">
        <a href="#cookie-support">Cookie support</a>
      </div>
      <div class="heading h3">
        <a href="#proxy-support">Proxy support</a>
      </div>
      <div class="heading h2">
        <a href="#how-to-host-html-file-and-swf-file-in-different-domains">How to host HTML file and SWF file in different domains</a>
      </div>
      <div class="heading h2">
        <a href="#how-to-build-websocketmain.swf">How to build WebSocketMain.swf</a>
      </div>
      <div class="heading h2">
        <a href="#websocket-protocol-versions">WebSocket protocol versions</a>
      </div>
      <div class="heading h2">
        <a href="#license">License</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="docs markdown">
<div class="pilwrap" id="how-to-try-the-sample">
  <h2>
    <a href="#how-to-try-the-sample" class="pilcrow">&#182;</a>
    How to try the sample
  </h2>
</div>


<p>Assuming you have Web server (e.g. Apache) running at <strong><a href='http://example.com/'>http://example.com/</a></strong> .</p>

<ol>
<li>Download <a href="http://github.com/gimite/web-socket-ruby/tree/master">web-socket-ruby</a>.</li>
<li>Run sample Web Socket server (echo server) in example.com with: (#1)<br></li>
</ol>

<div class='highlight'><pre><code language=''>$ ruby web-socket-ruby/samples/echo_server.rb example.com 10081
</code></pre></div>

<ol>
<li>If your server already provides socket policy file at port <strong>843</strong>, modify the file to allow access to port <strong>10081</strong>. Otherwise you can skip this step. See below for details.</li>
<li>Publish the web-socket-js directory with your Web server (e.g. put it in ~/public_html).</li>
<li>Change ws://localhost:10081 to <strong>ws://example.com:10081</strong> in sample.html.</li>
<li>Open sample.html in your browser.</li>
<li>After "onopen" is shown, input something, click [Send] and confirm echo back.</li>
</ol>

<p>#1: First argument of echo_server.rb means that it accepts Web Socket connection from HTML pages in example.com.</p>


<div class="pilwrap" id="how-to-use-it-in-your-application">
  <h2>
    <a href="#how-to-use-it-in-your-application" class="pilcrow">&#182;</a>
    How to use it in your application
  </h2>
</div>


<ul>
<li>Copy swfobject.js, web_socket.js, WebSocketMain.swf to your application directory.</li>
<li>Write JavaScript code:</li>
</ul>


<div class="highlight"><pre><code><span class="c">&lt;!-- Import JavaScript Libraries. --&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;swfobject.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span> <span class="na">src=</span><span class="s">&quot;web_socket.js&quot;</span><span class="nt">&gt;&lt;/script&gt;</span>

<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>

  <span class="c1">// Let the library know where WebSocketMain.swf is:</span>
  <span class="nx">WEB_SOCKET_SWF_LOCATION</span> <span class="o">=</span> <span class="s2">&quot;WebSocketMain.swf&quot;</span><span class="p">;</span>

  <span class="c1">// Write your code in the same way as for native WebSocket:</span>
  <span class="kd">var</span> <span class="nx">ws</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WebSocket</span><span class="p">(</span><span class="s2">&quot;ws://example.com:10081/&quot;</span><span class="p">);</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">onopen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ws</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;Hello&quot;</span><span class="p">);</span>  <span class="c1">// Sends a message.</span>
  <span class="p">};</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">onmessage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Receives a message.</span>
    <span class="nx">alert</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">};</span>
  <span class="nx">ws</span><span class="p">.</span><span class="nx">onclose</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">alert</span><span class="p">(</span><span class="s2">&quot;closed&quot;</span><span class="p">);</span>
  <span class="p">};</span>

<span class="nt">&lt;/script&gt;</span>
</code></pre></div>



<ul>
<li>Put Flash socket policy file to your server unless you use web-socket-ruby or em-websocket as your WebSocket server. See "Flash socket policy file" section below for details.</li>
</ul>


<div class="pilwrap" id="troubleshooting">
  <h2>
    <a href="#troubleshooting" class="pilcrow">&#182;</a>
    Troubleshooting
  </h2>
</div>


<p>If it doesn't work, try these:</p>

<ol>
<li><p>Try Chrome and Firefox 3.x.</p>

<ul><li>It doesn't work on Chrome:<br>
It's likely an issue of your code or the server. Debug your code as usual e.g. using console.log.</li>
<li>It works on Chrome but it doesn't work on Firefox:<br>
It's likely an issue of web-socket-js specific configuration (e.g. 3 and 4 below).</li>
<li>It works on both Chrome and Firefox, but it doesn't work on your browser:<br>
Check "Supported environment" section below. Your browser may not be supported by web-socket-js.</li></ul></li>
<li><p>Add this line before your code:
   WEB_SOCKET_DEBUG = true;
and use Developer Tools (Chrome/Safari) or Firebug (Firefox) to see if console.log outputs any errors.</p></li>
<li><p>Make sure you do NOT open your HTML page as local file e.g. file:///.../sample.html. web-socket-js doesn't work on local file. Open it via Web server e.g. <a href='http:///.../sample.html'>http:///.../sample.html</a>.</p></li>
<li><p>If you are NOT using web-socket-ruby or em-websocket as your WebSocket server, you need to place Flash socket policy file on your server. See "Flash socket policy file" section below for details.</p></li>
<li><p>Check if sample.html bundled with web-socket-js works.</p></li>
<li><p>Make sure the port used for WebSocket (10081 in example above) is not blocked by your server/client's firewall.</p></li>
<li><p>Install <a href="http://www.adobe.com/support/flashplayer/downloads.html">debugger version of Flash Player</a> to see Flash errors.</p></li>
</ol>


<div class="pilwrap" id="supported-environments">
  <h2>
    <a href="#supported-environments" class="pilcrow">&#182;</a>
    Supported environments
  </h2>
</div>


<p>It should work on:</p>

<ul>
<li>Google Chrome 4 or later (just uses native implementation)</li>
<li>Firefox 3.x, 4.x, Internet Explorer 8, 9 + Flash Player 10 or later</li>
</ul>

<p>It may or may not work on other browsers such as Safari, Opera or IE 6. Patch for these browsers are appreciated, but I will not work on fixing issues specific to these browsers by myself.</p>


<div class="pilwrap" id="limitations-differences-compared-to-native-websocket">
  <h2>
    <a href="#limitations-differences-compared-to-native-websocket" class="pilcrow">&#182;</a>
    Limitations/differences compared to native WebSocket
  </h2>
</div>


<ul>
<li>You need some more lines in your JavaScript code. See "How to use it in your application" section above for details.</li>
<li>It requires Flash Player 10 or later unless the browser supports native WebSocket.</li>
<li>Your server must provide Flash socket policy file, unless you use web-socket-ruby or em-websocket. See "Flash socket policy file" section below for details.</li>
<li>It has limited support for Cookies on WebSocket. See "Cookie support" section below for details.</li>
<li>It doesn't use proxies specified in browser config. See "Proxy support" section below for details.</li>
</ul>


<div class="pilwrap" id="flash-socket-policy-file">
  <h3>
    <a href="#flash-socket-policy-file" class="pilcrow">&#182;</a>
    Flash socket policy file
  </h3>
</div>


<p>This implementation uses Flash's socket, which means that your server must provide Flash socket policy file to declare the server accepts connections from Flash.</p>

<p>If you use <a href="http://github.com/gimite/web-socket-ruby/tree/master">web-socket-ruby</a> or <a href="https://github.com/igrigorik/em-websocket">em-websocket</a>, you don't need anything special, because they handle Flash socket policy file request. But if you already provide socket policy file at port <strong>843</strong>, you need to modify the file to allow access to Web Socket port, because it precedes what the libraries provide.</p>

<p>If you use other Web Socket server implementation, you need to provide socket policy file yourself. See <a href="http://www.lightsphere.com/dev/articles/flash_socket_policy.html">Setting up A Flash Socket Policy File</a> for details and sample script to run socket policy file server. <a href="http://github.com/LearnBoost/Socket.IO-node/blob/master/lib/socket.io/transports/flashsocket.js">node.js implementation is available here</a>.</p>

<p>Actually, it's still better to provide socket policy file at port 843 even if you use web-socket-ruby or em-websocket. Flash always try to connect to port 843 first, so providing the file at port 843 makes startup faster.</p>


<div class="pilwrap" id="cookie-support">
  <h3>
    <a href="#cookie-support" class="pilcrow">&#182;</a>
    Cookie support
  </h3>
</div>


<p>web-socket-js has limited supported for Cookies on WebSocket.</p>

<p>Cookie is sent if Web Socket host is exactly the same as the origin of JavaScript (The port can be different). Otherwise it is not sent, because I don't know way to send right Cookie (which is Cookie of the host of Web Socket, I heard). Also, HttpOnly Cookies are not sent.</p>

<p>Note that it's technically possible that client sends arbitrary string as Cookie and any other headers (by modifying this library for example) once you place Flash socket policy file in your server. So don't trust Cookie and other headers if you allow connection from untrusted origin.</p>


<div class="pilwrap" id="proxy-support">
  <h3>
    <a href="#proxy-support" class="pilcrow">&#182;</a>
    Proxy support
  </h3>
</div>


<p><a href="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol">The WebSocket spec</a> specifies instructions for User Agents to support proxied connections by implementing the HTTP CONNECT method.</p>

<p>The AS3 Socket class doesn't implement this mechanism, which renders it useless for the scenarios where the user trying to open a socket is behind a proxy. </p>

<p>The class RFC2817Socket (by Christian Cantrell) effectively lets us implement this, as long as the proxy settings are known and provided by the interface that instantiates the WebSocket. As such, if you want to support proxied conncetions, you'll have to supply this information to the WebSocket constructor when Flash is being used. One way to go about it would be to ask the user for proxy settings information if the initial connection fails.</p>


<div class="pilwrap" id="how-to-host-html-file-and-swf-file-in-different-domains">
  <h2>
    <a href="#how-to-host-html-file-and-swf-file-in-different-domains" class="pilcrow">&#182;</a>
    How to host HTML file and SWF file in different domains
  </h2>
</div>


<p>By default, HTML file and SWF file must be in the same domain. You can follow steps below to allow hosting them in different domain.</p>

<p><strong>WARNING</strong>: If you use the method below, HTML files in ANY domains can send arbitrary TCP data to your WebSocket server, regardless of configuration in Flash socket policy file. Arbitrary TCP data means that they can even fake request headers including Origin and Cookie.</p>

<ol>
<li>Unzip WebSocketMainInsecure.zip to extract WebSocketMainInsecure.swf.</li>
<li>Put WebSocketMainInsecure.swf on your server, instead of WebSocketMain.swf.</li>
<li>In JavaScript, set WEB_SOCKET_SWF_LOCATION to URL of your WebSocketMainInsecure.swf.</li>
</ol>


<div class="pilwrap" id="how-to-build-websocketmain.swf">
  <h2>
    <a href="#how-to-build-websocketmain.swf" class="pilcrow">&#182;</a>
    How to build WebSocketMain.swf
  </h2>
</div>


<p>Install <a href="http://opensource.adobe.com/wiki/display/flexsdk/Download+Flex+4">Flex 4 SDK</a>.</p>


<div class="highlight"><pre><code><span class="err">$</span> <span class="n">cd</span> <span class="n">flash</span><span class="o">-</span><span class="n">src</span>
<span class="err">$</span> <span class="p">.</span><span class="o">/</span><span class="n">build</span><span class="p">.</span><span class="n">sh</span>
</code></pre></div>




<div class="pilwrap" id="websocket-protocol-versions">
  <h2>
    <a href="#websocket-protocol-versions" class="pilcrow">&#182;</a>
    WebSocket protocol versions
  </h2>
</div>


<ul>
<li>web-socket-js supports <a href="http://tools.ietf.org/html/draft-hixie-thewebsocketprotocol-76">Hixie 76 version</a> of WebSocket protocol by default i.e. in <a href="https://github.com/gimite/web-socket-js">master branch</a>.</li>
<li>If you want to try newer <a href="http://tools.ietf.org/html/draft-ietf-hybi-thewebsocketprotocol-07">Hybi 07 version</a>, check out from <a href="https://github.com/gimite/web-socket-js/tree/hybi-07">hybi-07 branch</a>. This will become the master branch in the future, probably when Chrome switches to Hybi 07.</li>
<li>Hixie 75 or before is no longer supported.</li>
</ul>


<div class="pilwrap" id="license">
  <h2>
    <a href="#license" class="pilcrow">&#182;</a>
    License
  </h2>
</div>


<p>New BSD License.</p></div>
  </div>
</body>
</html>
