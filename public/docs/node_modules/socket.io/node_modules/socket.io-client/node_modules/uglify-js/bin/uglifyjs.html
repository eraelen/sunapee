<!DOCTYPE html>
<html>
<head>
  <title>uglifyjs</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../../doc-style.css" />
  <script src="../../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../../", thisFile = "node_modules/socket.io/node_modules/socket.io-client/node_modules/uglify-js/bin/uglifyjs", defaultSidebar = true;
  </script>
  <script src="../../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>uglifyjs</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="err">#</span><span class="o">!</span><span class="err">/usr/bin/env node</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>-<em>- js -</em>-</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nx">global</span><span class="p">.</span><span class="nx">sys</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="sr">/^v0\.[012]/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">version</span><span class="p">)</span> <span class="o">?</span> <span class="s2">&quot;sys&quot;</span> <span class="o">:</span> <span class="s2">&quot;util&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;fs&quot;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">uglify</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&quot;uglify-js&quot;</span><span class="p">),</span> <span class="c1">// symlink ~/.node_libraries/uglify-js.js to ../uglify-js.js</span>
    <span class="nx">jsp</span> <span class="o">=</span> <span class="nx">uglify</span><span class="p">.</span><span class="nx">parser</span><span class="p">,</span>
    <span class="nx">pro</span> <span class="o">=</span> <span class="nx">uglify</span><span class="p">.</span><span class="nx">uglify</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">ast</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">mangle</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">mangle_toplevel</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">no_mangle_functions</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">squeeze</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">make_seqs</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">dead_code</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">verbose</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">show_copyright</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="nx">out_same_file</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">max_line_length</span><span class="o">:</span> <span class="mi">32</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>
        <span class="nx">unsafe</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">reserved_names</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
        <span class="nx">defines</span><span class="o">:</span> <span class="p">{</span> <span class="p">},</span>
        <span class="nx">lift_vars</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">codegen_options</span><span class="o">:</span> <span class="p">{</span>
                <span class="nx">ascii_only</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nx">beautify</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nx">indent_level</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
                <span class="nx">indent_start</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="nx">quote_keys</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nx">space_colon</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
                <span class="nx">inline_script</span><span class="o">:</span> <span class="kc">false</span>
        <span class="p">},</span>
        <span class="nx">make</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
        <span class="nx">output</span><span class="o">:</span> <span class="kc">true</span>            <span class="c1">// stdout</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">jsp</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">argv</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">filename</span><span class="p">;</span>

<span class="nx">out</span><span class="o">:</span> <span class="k">while</span> <span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
        <span class="k">switch</span> <span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">case</span> <span class="s2">&quot;-b&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--beautify&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">codegen_options</span><span class="p">.</span><span class="nx">beautify</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;-i&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--indent&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">codegen_options</span><span class="p">.</span><span class="nx">indent_level</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;-q&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--quote-keys&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">codegen_options</span><span class="p">.</span><span class="nx">quote_keys</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;-mt&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--mangle-toplevel&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">mangle_toplevel</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;-nmf&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--no-mangle-functions&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">no_mangle_functions</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--no-mangle&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;-nm&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">mangle</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--no-squeeze&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;-ns&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">squeeze</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--no-seqs&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">make_seqs</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--no-dead-code&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">dead_code</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--no-copyright&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;-nc&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">show_copyright</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;-o&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--output&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">output</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--overwrite&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">out_same_file</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;-v&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--verbose&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">verbose</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--ast&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">ast</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--unsafe&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">unsafe</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--max-line-len&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">max_line_length</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--reserved-names&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">reserved_names</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">().</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">);</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--lift-vars&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">lift_vars</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;-d&quot;</span><span class="o">:</span>
            <span class="k">case</span> <span class="s2">&quot;--define&quot;</span><span class="o">:</span>
                 <span class="kd">var</span> <span class="nx">defarg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
                 <span class="k">try</span> <span class="p">{</span>
                     <span class="kd">var</span> <span class="nx">defsym</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sym</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>KEYWORDS_ATOM doesn't include NaN or Infinity - should we check
for them too ?? We don't check reserved words and the like as the
define values are only substituted AFTER parsing</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                             <span class="k">if</span> <span class="p">(</span><span class="nx">jsp</span><span class="p">.</span><span class="nx">KEYWORDS_ATOM</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">sym</span><span class="p">))</span> <span class="p">{</span>
                                 <span class="k">throw</span> <span class="s2">&quot;Don&#39;t define values for inbuilt constant &#39;&quot;</span><span class="o">+</span><span class="nx">sym</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
                             <span class="p">}</span>
                             <span class="k">return</span> <span class="nx">sym</span><span class="p">;</span>
                         <span class="p">},</span>
                         <span class="nx">defval</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
                             <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^&quot;(.*)&quot;$/</span><span class="p">)</span> <span class="o">||</span> <span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^&#39;(.*)&#39;$/</span><span class="p">))</span> <span class="p">{</span>
                                 <span class="k">return</span> <span class="p">[</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">$1</span> <span class="p">];</span>
                             <span class="p">}</span>
                             <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nb">isNaN</span><span class="p">(</span><span class="nb">parseFloat</span><span class="p">(</span><span class="nx">v</span><span class="p">)))</span> <span class="p">{</span>
                                 <span class="k">return</span> <span class="p">[</span> <span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">];</span>
                             <span class="p">}</span>
                             <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^[a-z\$_][a-z\$_0-9]*$/i</span><span class="p">))</span> <span class="p">{</span>
                                 <span class="k">return</span> <span class="p">[</span> <span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="nx">v</span> <span class="p">];</span>
                             <span class="p">}</span>
                             <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/&quot;/</span><span class="p">))</span> <span class="p">{</span>
                                 <span class="k">return</span> <span class="p">[</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">v</span> <span class="p">];</span>
                             <span class="p">}</span>
                             <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">v</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/&#39;/</span><span class="p">))</span> <span class="p">{</span>
                                 <span class="k">return</span> <span class="p">[</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">v</span> <span class="p">];</span>
                             <span class="p">}</span>
                             <span class="k">throw</span> <span class="s2">&quot;Can&#39;t understand the specified value: &quot;</span><span class="o">+</span><span class="nx">v</span><span class="p">;</span>
                         <span class="p">};</span>
                     <span class="k">if</span> <span class="p">(</span><span class="nx">defarg</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/^([a-z_\$][a-z_\$0-9]*)(=(.*))?$/i</span><span class="p">))</span> <span class="p">{</span>
                         <span class="kd">var</span> <span class="nx">sym</span> <span class="o">=</span> <span class="nx">defsym</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">.</span><span class="nx">$1</span><span class="p">),</span>
                             <span class="nx">val</span> <span class="o">=</span> <span class="nb">RegExp</span><span class="p">.</span><span class="nx">$2</span> <span class="o">?</span> <span class="nx">defval</span><span class="p">(</span><span class="nb">RegExp</span><span class="p">.</span><span class="nx">$2</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span> <span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span> <span class="p">];</span>
                         <span class="nx">options</span><span class="p">.</span><span class="nx">defines</span><span class="p">[</span><span class="nx">sym</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
                     <span class="p">}</span>
                     <span class="k">else</span> <span class="p">{</span>
                         <span class="k">throw</span> <span class="s2">&quot;The --define option expects SYMBOL[=value]&quot;</span><span class="p">;</span>
                     <span class="p">}</span>
                 <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
                     <span class="nx">sys</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="s2">&quot;ERROR: In option --define &quot;</span><span class="o">+</span><span class="nx">defarg</span><span class="o">+</span><span class="s2">&quot;\n&quot;</span><span class="o">+</span><span class="nx">ex</span><span class="o">+</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
                     <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                 <span class="p">}</span>
                 <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--define-from-module&quot;</span><span class="o">:</span>
                <span class="kd">var</span> <span class="nx">defmodarg</span> <span class="o">=</span> <span class="nx">args</span><span class="p">.</span><span class="nx">shift</span><span class="p">(),</span>
                    <span class="nx">defmodule</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">defmodarg</span><span class="p">),</span>
                    <span class="nx">sym</span><span class="p">,</span>
                    <span class="nx">val</span><span class="p">;</span>
                <span class="k">for</span> <span class="p">(</span><span class="nx">sym</span> <span class="k">in</span> <span class="nx">defmodule</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">defmodule</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">sym</span><span class="p">))</span> <span class="p">{</span>
                        <span class="nx">options</span><span class="p">.</span><span class="nx">defines</span><span class="p">[</span><span class="nx">sym</span><span class="p">]</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">==</span> <span class="s2">&quot;string&quot;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="p">[</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">val</span> <span class="p">];</span>
                            <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">val</span> <span class="o">==</span> <span class="s2">&quot;number&quot;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="p">[</span> <span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="nx">val</span> <span class="p">];</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span>
                                <span class="k">return</span> <span class="p">[</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;true&#39;</span> <span class="p">];</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span>
                                <span class="k">return</span> <span class="p">[</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;false&#39;</span> <span class="p">];</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span>
                                <span class="k">return</span> <span class="p">[</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;null&#39;</span> <span class="p">];</span>
                            <span class="k">if</span> <span class="p">(</span><span class="nx">val</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span>
                                <span class="k">return</span> <span class="p">[</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;undefined&#39;</span> <span class="p">];</span>
                            <span class="nx">sys</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="s2">&quot;ERROR: In option --define-from-module &quot;</span><span class="o">+</span><span class="nx">defmodarg</span><span class="o">+</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
                            <span class="nx">sys</span><span class="p">.</span><span class="nx">print</span><span class="p">(</span><span class="s2">&quot;ERROR: Unknown object type for: &quot;</span><span class="o">+</span><span class="nx">sym</span><span class="o">+</span><span class="s2">&quot;=&quot;</span><span class="o">+</span><span class="nx">val</span><span class="o">+</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
                            <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
                            <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
                        <span class="p">}(</span><span class="nx">defmodule</span><span class="p">[</span><span class="nx">sym</span><span class="p">]);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--ascii&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">codegen_options</span><span class="p">.</span><span class="nx">ascii_only</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--make&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">make</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">case</span> <span class="s2">&quot;--inline-script&quot;</span><span class="o">:</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">codegen_options</span><span class="p">.</span><span class="nx">inline_script</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="k">default</span><span class="o">:</span>
                <span class="nx">filename</span> <span class="o">=</span> <span class="nx">v</span><span class="p">;</span>
                <span class="k">break</span> <span class="nx">out</span><span class="p">;</span>
        <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">verbose</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">pro</span><span class="p">.</span><span class="nx">set_logger</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
                <span class="nx">sys</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
        <span class="p">});</span>
<span class="p">}</span>

<span class="nx">jsp</span><span class="p">.</span><span class="nx">set_logger</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">msg</span><span class="p">){</span>
        <span class="nx">sys</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">make</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">options</span><span class="p">.</span><span class="nx">out_same_file</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// doesn&#39;t make sense in this case</span>
        <span class="kd">var</span> <span class="nx">makefile</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">filename</span> <span class="o">||</span> <span class="s2">&quot;Makefile.uglify.js&quot;</span><span class="p">).</span><span class="nx">toString</span><span class="p">());</span>
        <span class="nx">output</span><span class="p">(</span><span class="nx">makefile</span><span class="p">.</span><span class="nx">files</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">file</span><span class="p">){</span>
                <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">module</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">code</span> <span class="o">=</span> <span class="s2">&quot;!function(exports, global){global = this;\n&quot;</span> <span class="o">+</span> <span class="nx">code</span> <span class="o">+</span> <span class="s2">&quot;\n;this.&quot;</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">module</span> <span class="o">+</span> <span class="s2">&quot; = exports;}({})&quot;</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">hide</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">code</span> <span class="o">=</span> <span class="s2">&quot;(function(){&quot;</span> <span class="o">+</span> <span class="nx">code</span> <span class="o">+</span> <span class="s2">&quot;}());&quot;</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">squeeze_it</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
        <span class="p">}).</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">));</span>
<span class="p">}</span>
<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s2">&quot;utf8&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">text</span><span class="p">){</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>
                <span class="nx">output</span><span class="p">(</span><span class="nx">squeeze_it</span><span class="p">(</span><span class="nx">text</span><span class="p">));</span>
        <span class="p">});</span>
<span class="p">}</span>
<span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">stdin</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">openStdin</span><span class="p">();</span>
        <span class="nx">stdin</span><span class="p">.</span><span class="nx">setEncoding</span><span class="p">(</span><span class="s2">&quot;utf8&quot;</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">text</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">chunk</span><span class="p">){</span>
                <span class="nx">text</span> <span class="o">+=</span> <span class="nx">chunk</span><span class="p">;</span>
        <span class="p">});</span>
        <span class="nx">stdin</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">output</span><span class="p">(</span><span class="nx">squeeze_it</span><span class="p">(</span><span class="nx">text</span><span class="p">));</span>
        <span class="p">});</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">output</span><span class="p">(</span><span class="nx">text</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">out</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">out_same_file</span> <span class="o">&amp;&amp;</span> <span class="nx">filename</span><span class="p">)</span>
                <span class="nx">options</span><span class="p">.</span><span class="nx">output</span> <span class="o">=</span> <span class="nx">filename</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">output</span> <span class="o">===</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">out</span> <span class="o">=</span> <span class="nx">process</span><span class="p">.</span><span class="nx">stdout</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="nx">out</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">createWriteStream</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">output</span><span class="p">,</span> <span class="p">{</span>
                        <span class="nx">flags</span><span class="o">:</span> <span class="s2">&quot;w&quot;</span><span class="p">,</span>
                        <span class="nx">encoding</span><span class="o">:</span> <span class="s2">&quot;utf8&quot;</span><span class="p">,</span>
                        <span class="nx">mode</span><span class="o">:</span> <span class="mi">0644</span>
                <span class="p">});</span>
        <span class="p">}</span>
        <span class="nx">out</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">text</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/;*$/</span><span class="p">,</span> <span class="s2">&quot;;&quot;</span><span class="p">));</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">output</span> <span class="o">!==</span> <span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">out</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
        <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>--------- main ends here.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="kd">function</span> <span class="nx">show_copyright</span><span class="p">(</span><span class="nx">comments</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">comments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">c</span> <span class="o">=</span> <span class="nx">comments</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">type</span> <span class="o">==</span> <span class="s2">&quot;comment1&quot;</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">ret</span> <span class="o">+=</span> <span class="s2">&quot;//&quot;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s2">&quot;\n&quot;</span><span class="p">;</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="nx">ret</span> <span class="o">+=</span> <span class="s2">&quot;/*&quot;</span> <span class="o">+</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">+</span> <span class="s2">&quot;*/&quot;</span><span class="p">;</span>
                <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">ret</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">squeeze_it</span><span class="p">(</span><span class="nx">code</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">show_copyright</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">tok</span> <span class="o">=</span> <span class="nx">jsp</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">(</span><span class="nx">code</span><span class="p">),</span> <span class="nx">c</span><span class="p">;</span>
                <span class="nx">c</span> <span class="o">=</span> <span class="nx">tok</span><span class="p">();</span>
                <span class="nx">result</span> <span class="o">+=</span> <span class="nx">show_copyright</span><span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">comments_before</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">try</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">time_it</span><span class="p">(</span><span class="s2">&quot;parse&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="nx">jsp</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span> <span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">lift_vars</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">ast</span> <span class="o">=</span> <span class="nx">time_it</span><span class="p">(</span><span class="s2">&quot;lift&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="nx">pro</span><span class="p">.</span><span class="nx">ast_lift_variables</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span> <span class="p">});</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">mangle</span><span class="p">)</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">time_it</span><span class="p">(</span><span class="s2">&quot;mangle&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                        <span class="k">return</span> <span class="nx">pro</span><span class="p">.</span><span class="nx">ast_mangle</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="p">{</span>
                                <span class="nx">toplevel</span>     <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">mangle_toplevel</span><span class="p">,</span>
                                <span class="nx">defines</span>      <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">defines</span><span class="p">,</span>
                                <span class="nx">except</span>       <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">reserved_names</span><span class="p">,</span>
                                <span class="nx">no_functions</span> <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">no_mangle_functions</span>
                        <span class="p">});</span>
                <span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">squeeze</span><span class="p">)</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">time_it</span><span class="p">(</span><span class="s2">&quot;squeeze&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
                        <span class="nx">ast</span> <span class="o">=</span> <span class="nx">pro</span><span class="p">.</span><span class="nx">ast_squeeze</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="p">{</span>
                                <span class="nx">make_seqs</span>  <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">make_seqs</span><span class="p">,</span>
                                <span class="nx">dead_code</span>  <span class="o">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">dead_code</span><span class="p">,</span>
                                <span class="nx">keep_comps</span> <span class="o">:</span> <span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">unsafe</span>
                        <span class="p">});</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">unsafe</span><span class="p">)</span>
                                <span class="nx">ast</span> <span class="o">=</span> <span class="nx">pro</span><span class="p">.</span><span class="nx">ast_squeeze_more</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span>
                        <span class="k">return</span> <span class="nx">ast</span><span class="p">;</span>
                <span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span>
                        <span class="k">return</span> <span class="nx">sys</span><span class="p">.</span><span class="nx">inspect</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
                <span class="nx">result</span> <span class="o">+=</span> <span class="nx">time_it</span><span class="p">(</span><span class="s2">&quot;generate&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="nx">pro</span><span class="p">.</span><span class="nx">gen_code</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">codegen_options</span><span class="p">)</span> <span class="p">});</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">codegen_options</span><span class="p">.</span><span class="nx">beautify</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">max_line_length</span><span class="p">)</span> <span class="p">{</span>
                        <span class="nx">result</span> <span class="o">=</span> <span class="nx">time_it</span><span class="p">(</span><span class="s2">&quot;split&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span> <span class="k">return</span> <span class="nx">pro</span><span class="p">.</span><span class="nx">split_lines</span><span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">max_line_length</span><span class="p">)</span> <span class="p">});</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">catch</span><span class="p">(</span><span class="nx">ex</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">sys</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">ex</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
                <span class="nx">sys</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">sys</span><span class="p">.</span><span class="nx">inspect</span><span class="p">(</span><span class="nx">ex</span><span class="p">));</span>
                <span class="nx">sys</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">ex</span><span class="p">));</span>
                <span class="nx">process</span><span class="p">.</span><span class="nx">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
        <span class="p">}</span>
<span class="p">};</span>

<span class="kd">function</span> <span class="nx">time_it</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">cont</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">options</span><span class="p">.</span><span class="nx">verbose</span><span class="p">)</span>
                <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">t1</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">cont</span><span class="p">();</span> <span class="p">}</span>
        <span class="k">finally</span> <span class="p">{</span> <span class="nx">sys</span><span class="p">.</span><span class="nx">debug</span><span class="p">(</span><span class="s2">&quot;// &quot;</span> <span class="o">+</span> <span class="nx">name</span> <span class="o">+</span> <span class="s2">&quot;: &quot;</span> <span class="o">+</span> <span class="p">((</span><span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">t1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">).</span><span class="nx">toFixed</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; sec.&quot;</span><span class="p">);</span> <span class="p">}</span>
<span class="p">};</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
