<!DOCTYPE html>
<html>
<head>
  <title>ZeParser.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../../../../../doc-style.css" />
  <script src="../../../../../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../../../../../", thisFile = "node_modules/socket.io/node_modules/socket.io-client/node_modules/active-x-obfuscator/node_modules/zeparser/ZeParser.js", defaultSidebar = true;
  </script>
  <script src="../../../../../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#ifdef-test_suite">ifdef TEST_SUITE</a>
      </div>
      <div class="heading h1">
        <a href="#endif">endif</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>ZeParser.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">Tokenizer</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./Tokenizer&#39;</span><span class="p">).</span><span class="nx">Tokenizer</span><span class="p">;</span>
  <span class="nx">exports</span><span class="p">.</span><span class="nx">ZeParser</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">;</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>This is my js Parser: Ze. It's actually the post-dev pre-cleanup version. Clearly.
Some optimizations have been applied :)
(c) Peter van der Zee, qfox.nl</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">inp</span>
      <span class="dox_type">String</span>
      <span>Input</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">tok
</span>
      <span class="dox_type">Tokenizer</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stack</span>
      <span class="dox_type">Array</span>
      <span>The tokens will be put in this array. If you're looking for the AST, this would be it :)</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">ZeParser</span><span class="p">(</span><span class="nx">inp</span><span class="p">,</span> <span class="nx">tok</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="nx">simple</span><span class="p">){</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">input</span> <span class="o">=</span> <span class="nx">inp</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span> <span class="o">=</span> <span class="nx">tok</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">stack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">root</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="p">[{</span><span class="nx">value</span><span class="o">:</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="nx">isDeclared</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">isEcma</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">thisIsGlobal</span><span class="o">:</span><span class="kc">true</span><span class="p">}];</span> <span class="c1">// names of variables</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">global</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">errorStack</span> <span class="o">=</span> <span class="p">[];</span>

  <span class="nx">stack</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span> <span class="c1">// hook root</span>
  <span class="nx">stack</span><span class="p">.</span><span class="nx">labels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">;</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>this.regexStartKeyword = ZeParser.regexStartKeyword;
this.regexKeyword = ZeParser.regexKeyword;
this.regexStartReserved = ZeParser.regexStartReserved;
this.regexReserved = ZeParser.regexReserved;</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexStartKeyOrReserved</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexStartKeyOrReserved</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexAssignments</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexAssignments</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexNonAssignmentBinaryExpressionOperators</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexNonAssignmentBinaryExpressionOperators</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexUnaryKeywords</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexUnaryKeywords</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">hashUnaryKeywordStart</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">hashUnaryKeywordStart</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexUnaryOperators</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexUnaryOperators</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">regexLiteralKeywords</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexLiteralKeywords</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">testing</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;this&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;null&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;true&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="s1">&#39;false&#39;</span><span class="o">:</span><span class="mi">1</span><span class="p">};</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">ast</span> <span class="o">=</span> <span class="o">!</span><span class="nx">simple</span><span class="p">;</span> <span class="c1">///#define FULL_AST</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Returns just a stacked parse tree (regular array)</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">input
</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">simple=false
</span>
      <span class="dox_type">boolean</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Array

</span>
      <span>{Array}</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">parse</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">simple</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">tok</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tokenizer</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tok</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">simple</span><span class="p">)</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">ast</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">stack</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Parser has a bug for this input, please report it :)&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Returns a new parser instance with parse details for input</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">input
</span>
      <span class="dox_type">string</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">createParser</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">input</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">tok</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Tokenizer</span><span class="p">(</span><span class="nx">input</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">try</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">parser</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="nx">tok</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">parser</span><span class="p">.</span><span class="nx">parse</span><span class="p">();</span>
    <span class="k">return</span> <span class="nx">parser</span><span class="p">;</span>
  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;Parser has a bug for this input, please report it :)&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">input</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">tokenizer</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">stack</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">scope</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">statementLabels</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
  <span class="nx">errorStack</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

  <span class="nx">ast</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>

  <span class="nx">parse</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span> <span class="c1">// meh</span>
    <span class="k">else</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// initialization step, dont store the match (there isnt any!)</span>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSourceElements</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>

    <span class="kd">var</span> <span class="nx">cycled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*eof*/</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>if not already an error, insert an error before it</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">14</span><span class="cm">/*error*/</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;UnexpectedToken&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>just parse the token as is and continue.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">);</span>
        <span class="nx">cycled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>keep gobbling any errors...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">14</span><span class="cm">/*error*/</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>now try again (but only if we gobbled at least one token)...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">cycled</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*eof*/</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>pop the last token off the stack if it caused an error at eof</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">errorEscape</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">errorEscape</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">errorEscape</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">eatSemiColon</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>this.stats.eatSemiColon = (+//this.stats.eatSemiColon||0)+1;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>try asi
only if:
- this token was preceeded by at least one newline (match.newline) or next token is }
- this is EOF
- prev token was one of return,continue,break,throw (restricted production), not checked here.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>the exceptions to this rule are 
- if the next line is a regex 
- the semi is part of the for-header. 
these exceptions are automatically caught by the way the parser is built</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>not eof and just parsed semi or no newline preceeding and next isnt }</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*EOF*/</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">semi</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;++&#39;</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;--&#39;</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;NoASI&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>ASI
(match is actually the match <em>after</em> this asi, so the position of asi is match.start, not stop (!)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">asi</span> <span class="o">=</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">stop</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="mi">13</span><span class="cm">/*ASI*/</span><span class="p">};</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">asi</span><span class="p">);</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>slip it in the stream, before the current match.
for the other tokens see the tokenizer near the end of the main parsing function</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">addTokenToStreamBefore</span><span class="p">(</span><span class="nx">asi</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="nx">match</span><span class="p">.</span><span class="nx">semi</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Eat one or more "AssignmentExpression"s. May also eat a labeled statement if
the parameters are set that way. This is the only way to linearly distinct between
an expression-statement and a labeled-statement without double lookahead. (ok, maybe not "only")</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">mayParseLabeledStatementInstead=false</span>
      <span class="dox_type">boolean</span>
      <span>If the first token is an identifier and the second a colon, accept this match as a labeled statement instead... Only true if the match in the parameter is an (unreserved) identifier (so no need to validate that further) </span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">match
</span>
      <span class="dox_type">Object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">stack
</span>
      <span class="dox_type">Array</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">onlyOne=false</span>
      <span class="dox_type">boolean</span>
      <span>Only parse a AssignmentExpression</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">forHeader=false</span>
      <span class="dox_type">boolean</span>
      <span>Do not allow the <code>in</code> operator</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">isBreakOrContinueArg=false</span>
      <span class="dox_type">boolean</span>
      <span>The argument for break or continue is always a single identifier</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Object

</span>
      <span>{Object}</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">eatExpressions</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">mayParseLabeledStatementInstead</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="nx">onlyOne</span><span class="p">,</span> <span class="nx">forHeader</span><span class="p">,</span> <span class="nx">isBreakOrContinueArg</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">pstack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
      <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;expressions&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="nx">pstack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

      <span class="kd">var</span> <span class="nx">parsedExpressions</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">parsedNonAssignmentOperator</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">// once we parse a non-assignment, this expression can no longer parse an assignment</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>TOFIX: can probably get the regex out somehow...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">first</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedAnotherExpressionComma&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="o">++</span><span class="nx">parsedExpressions</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">astack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
        <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;expression&#39;</span><span class="p">;</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
        <span class="nx">astack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>start of expression is given: match
it should indeed be a properly allowed lhs
first eat all unary operators
they can be added to the stack, but we need to ensure they have indeed a valid operator</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

      <span class="kd">var</span> <span class="nx">parseAnotherExpression</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">parseAnotherExpression</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// keep parsing lhs+operator as long as there is an operator after the lhs.</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
          <span class="kd">var</span> <span class="nx">estack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
          <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;sub-expression&#39;</span><span class="p">;</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
          <span class="nx">estack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

          <span class="kd">var</span> <span class="nx">news</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// encountered new operators waiting for parenthesis</span>
        <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>start checking lhs
if lhs is identifier (new/call expression), allow to parse an assignment operator next
otherwise keep eating unary expressions and then any "value"
after that search for a binary operator. if we only ate a new/call expression then
also allow to eat assignments. repeat for the rhs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">parsedUnaryOperator</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">isUnary</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">while</span> <span class="p">(</span>
          <span class="o">!</span><span class="nx">isBreakOrContinueArg</span> <span class="o">&amp;&amp;</span> <span class="c1">// no unary for break/continue</span>
          <span class="p">(</span><span class="nx">isUnary</span> <span class="o">=</span>
            <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">hashUnaryKeywordStart</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexUnaryKeywords</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="o">||</span> <span class="c1">// (match.value == &#39;delete&#39; || match.value == &#39;void&#39; || match.value == &#39;typeof&#39; || match.value == &#39;new&#39;) ||</span>
            <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">11</span><span class="cm">/*PUNCTUATOR*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexUnaryOperators</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span>
          <span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isUnary</span><span class="p">)</span> <span class="nx">match</span><span class="p">.</span><span class="nx">isUnaryOp</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>find parenthesis</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;new&#39;</span><span class="p">)</span> <span class="o">++</span><span class="nx">news</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>

          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>ensure that it is in fact a valid lhs-start</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedAnotherExpressionRhs&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>not allowed to parse assignment</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">parsedUnaryOperator</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>if we parsed any kind of unary operator, we cannot be parsing a labeled statement</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">parsedUnaryOperator</span><span class="p">)</span> <span class="nx">mayParseLabeledStatementInstead</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>so now we know match is a valid lhs-start and not a unary operator
it must be a string, number, regex, identifier 
or the start of an object literal ({), array literal ([) or group operator (().</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

        <span class="kd">var</span> <span class="nx">acceptAssignment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>take care of the "open" cases first (group, array, object)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="kd">var</span> <span class="nx">groupStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
            <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;grouped&#39;</span><span class="p">;</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
            <span class="nx">groupStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">isGroupStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;GroupingShouldStartWithExpression&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>keep parsing expressions as long as they are followed by a comma</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnclosedGroupingOperator&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
            <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">isGroupStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>create ref to this expression group to the opening paren</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="c1">//#endif</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// might be div</span>

          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="nx">stack</span> <span class="o">=</span> <span class="nx">groupStack</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>you can assign to group results. and as long as the group does not contain a comma (and valid ref), it will work too :)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">acceptAssignment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>there's an extra rule for [ namely that, it must start with an expression but after that, expressions are optional</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;array literal&#39;</span><span class="p">;</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">hasArrayLiteral</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">lhsb</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">isArrayLiteralStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">arrays</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">arrays</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">arrayId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">arrays</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">arrays</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">targetScope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>keep parsing expressions as long as they are followed by a comma</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>arrays may start with "elided" commas</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

          <span class="kd">var</span> <span class="nx">foundAtLeastOneComma</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// for entry in while</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">foundAtLeastOneComma</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">foundAtLeastOneComma</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">14</span><span class="cm">/*error*/</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ArrayShouldStartWithExpression&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

            <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">foundAtLeastOneComma</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnclosedPropertyBracket&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhsb</span><span class="p">;</span>
            <span class="nx">lhsb</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">isArrayLiteralStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// might be div</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;++&#39;</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>gobble and ignore?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;InvalidPostfixOperandArray&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>object literals need seperate handling...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;object literal&#39;</span><span class="p">;</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">hasObjectLiteral</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">isObjectLiteralStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">objects</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">objects</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">objectId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">objects</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>

            <span class="kd">var</span> <span class="nx">targetObject</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">targetScope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>
  
            <span class="kd">var</span> <span class="nx">lhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>

          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">12</span><span class="cm">/*eof*/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ObjectLiteralExpectsColonAfterName&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
          <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>ObjectLiteral
PropertyNameAndValueList</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

          <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">14</span><span class="cm">/*error*/</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// will stop if next token is } or throw if not and no comma is found</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>expecting a string, number, or identifier
if (match.name != 5/<em>STRING_SINGLE</em>/ &amp;&amp; match.name != 6/<em>STRING_DOUBLE</em>/ &amp;&amp; match.name != 3/<em>NUMERIC_HEX</em>/ &amp;&amp; match.name != 4/<em>NUMERIC_DEC</em>/ &amp;&amp; match.name != 2/<em>IDENTIFIER</em>/) {
TOFIX: more specific errors depending on type...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">isNumber</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">isString</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;IllegalPropertyNameToken&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="kd">var</span> <span class="nx">objLitStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
              <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;objlit pair&#39;</span><span class="p">;</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">isObjectLiteralPair</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
              <span class="nx">objLitStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

              <span class="kd">var</span> <span class="nx">propNameStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
              <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;objlit pair name&#39;</span><span class="p">;</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
              <span class="nx">propNameStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

              <span class="nx">propNameStack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span><span class="p">;</span>

              <span class="kd">var</span> <span class="nx">propName</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
              <span class="nx">propName</span><span class="p">.</span><span class="nx">isPropertyName</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="c1">//#endif</span>

            <span class="kd">var</span> <span class="nx">getset</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="nx">stack</span> <span class="o">=</span> <span class="nx">propNameStack</span><span class="p">;</span>
            <span class="p">}</span> <span class="c1">//#endif</span>
            

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>for get/set we parse a function-like definition. but only if it's immediately followed by an identifier (otherwise it'll just be the property 'get' or 'set')</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="nx">getset</span> <span class="o">==</span> <span class="s1">&#39;get&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38">&#182;</a>
</div>
<p>"get" PropertyName "(" ")" "{" FunctionBody "}"</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="nx">propName</span><span class="p">.</span><span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="nx">targetObject</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatObjectLiteralColonAndBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="nx">match</span><span class="p">.</span><span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="nx">targetObject</span><span class="p">;</span>
                  <span class="nx">propNameStack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;getter&#39;</span><span class="p">;</span>
                  <span class="nx">propNameStack</span><span class="p">.</span><span class="nx">isAccessor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39">&#182;</a>
</div>
<p>if (match.name != 2/<em>IDENTIFIER</em>/ &amp;&amp; match.name != 5/<em>STRING_SINGLE</em>/ &amp;&amp; match.name != 6/<em>STRING_DOUBLE</em>/ &amp;&amp; match.name != 3/<em>NUMERIC_HEX</em>/ &amp;&amp; match.name != 4/<em>NUMERIC_DEC</em>/) {</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">isNumber</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">isString</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;IllegalGetterSetterNameToken&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;GetterSetterNameFollowedByOpenParen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;GetterHasNoArguments&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
                  <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">getset</span> <span class="o">==</span> <span class="s1">&#39;set&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>"set" PropertyName "(" PropertySetParameterList ")" "{" FunctionBody "}"</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="nx">propName</span><span class="p">.</span><span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="nx">targetObject</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatObjectLiteralColonAndBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="nx">match</span><span class="p">.</span><span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="nx">targetObject</span><span class="p">;</span>
                  <span class="nx">propNameStack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;setter&#39;</span><span class="p">;</span>
                  <span class="nx">propNameStack</span><span class="p">.</span><span class="nx">isAccessor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>
                <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">isNumber</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">isString</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;IllegalGetterSetterNameToken&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;GetterSetterNameFollowedByOpenParen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SettersMustHaveArgument&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                  <span class="k">else</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;IllegalSetterArgumentNameToken&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="p">{</span>
                  <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SettersOnlyGetOneArgument&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                  <span class="k">else</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SetterHeaderShouldHaveClosingParen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                  <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
                  <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
                <span class="p">}</span> <span class="c1">//#endif</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
                <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>PropertyName ":" AssignmentExpression</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                <span class="nx">propName</span><span class="p">.</span><span class="nx">isPropertyOf</span> <span class="o">=</span> <span class="nx">targetObject</span><span class="p">;</span>
              <span class="p">}</span> <span class="c1">//#endif</span>
              <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatObjectLiteralColonAndBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="nx">stack</span> <span class="o">=</span> <span class="nx">objLitStack</span><span class="p">;</span>
            <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>one trailing comma allowed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;IllegalDoubleCommaInObjectLiteral&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnclosedObjectLiteral&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>either the next token is } and the loop breaks or
the next token is the start of the next PropertyAssignment...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>closing curly</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
            <span class="nx">lhc</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">isObjectLiteralStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>

          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// next may be div</span>
          <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;++&#39;</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;InvalidPostfixOperandObject&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// function expression</span>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
            <span class="kd">var</span> <span class="nx">oldstack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
            <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;func expr&#39;</span><span class="p">;</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">isFunction</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span> <span class="o">=</span> <span class="p">[];</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">functionId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
            <span class="nx">oldstack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
            <span class="kd">var</span> <span class="nx">oldscope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>add new scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">match</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="p">[</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">,</span>
              <span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="nx">isDeclared</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">isEcma</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">functionStack</span><span class="o">:</span> <span class="nx">stack</span><span class="p">},</span>
              <span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="nx">isDeclared</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">isEcma</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">varType</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;Object&#39;</span><span class="p">]}</span>
            <span class="p">];</span> <span class="c1">// add the current scope (to build chain up-down)</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">upper</span> <span class="o">=</span> <span class="nx">oldscope</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>ref to back to function that's the cause for this scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">scopeFor</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">targetScope</span> <span class="o">=</span> <span class="nx">oldscope</span><span class="p">;</span> <span class="c1">// consistency</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">isFuncExprKeyword</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">functionStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>
          <span class="kd">var</span> <span class="nx">funcExprToken</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">mayParseLabeledStatementInstead</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;LabelsMayNotBeReserved&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">funcExprToken</span><span class="p">.</span><span class="nx">funcName</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="s2">&quot;func expr name&quot;</span><span class="p">;</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">varType</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Function&#39;</span><span class="p">];</span>
            <span class="nx">match</span><span class="p">.</span><span class="nx">functionStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span> <span class="c1">// ref to the stack, in case we detect the var being a constructor</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>name is only available to inner scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
            <span class="p">}</span> <span class="c1">//#endif</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="cm">/*this.regexStartKeyOrReserved.test(match.value[0])*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;FunctionNameMustNotBeReserved&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionParametersAndBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">funcExprToken</span><span class="p">);</span> <span class="c1">// first token after func-expr is div</span>

          <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;++&#39;</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;InvalidPostfixOperandFunction&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="p">}</span>

          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>restore stack and scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">stack</span> <span class="o">=</span> <span class="nx">oldstack</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="nx">oldscope</span><span class="p">;</span>
          <span class="p">}</span> <span class="c1">//#endif</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// IDENTIFIER STRING_SINGLE STRING_DOUBLE NUMERIC_HEX NUMERIC_DEC REG_EX</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>save it in case it turns out to be a label.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="kd">var</span> <span class="nx">possibleLabel</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>validate the identifier, if any</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>this, null, true, false are actually allowed here</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">regexLiteralKeywords</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="o">&amp;&amp;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>other reserved words are not</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="cm">/*this.regexStartKeyOrReserved.test(match.value[0])*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
            <span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53">&#182;</a>
</div>
<p>if break/continue, we skipped the unary operator check so throw the proper error here</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if</span> <span class="p">(</span><span class="nx">isBreakOrContinueArg</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;BreakOrContinueArgMustBeJustIdentifier&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;else&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;DidNotExpectElseHere&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>if (mayParseLabeledStatementInstead) {new ZeParser.Error('LabelsMayNotBeReserved', match);
TOFIX: lookahead to see if colon is following. throw label error instead if that's the case
any forbidden keyword at this point is likely to be a statement start.
its likely that the parser will take a while to recover from this point...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;UnexpectedToken&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>TOFIX: maybe i should just return at this point. cut my losses and hope for the best.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="p">}</span>
            <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>only accept assignments after a member expression (identifier or ending with a [] suffix)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">acceptAssignment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">isBreakOrContinueArg</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;BreakOrContinueArgMustBeJustIdentifier&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>the current match is the lead value being queried. tag it that way</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>dont mark labels</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isBreakOrContinueArg</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="s1">&#39;lead value&#39;</span><span class="p">;</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">leadValue</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="c1">//#endif</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<p>ok. gobble it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// division allowed</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<p>now check for labeled statement (if mayParseLabeledStatementInstead then the first token for this expression must be an (unreserved) identifier)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">(</span><span class="nx">mayParseLabeledStatementInstead</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">possibleLabel</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>label was not an identifier
TOFIX: this colon might be a different type of error... more analysis required</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;LabelsMayOnlyBeIdentifiers&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="nx">mayParseLabeledStatementInstead</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// mark label parsed (TOFIX:speed?)</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

            <span class="nx">possibleLabel</span><span class="p">.</span><span class="nx">isLabel</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="k">delete</span> <span class="nx">possibleLabel</span><span class="p">.</span><span class="nx">meta</span><span class="p">;</span> <span class="c1">// oh oops, it&#39;s not a lead value.</span>

              <span class="nx">possibleLabel</span><span class="p">.</span><span class="nx">isLabelDeclaration</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">possibleLabel</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

              <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;labeled statement&#39;</span><span class="p">;</span>
            <span class="p">}</span> <span class="c1">//#endif</span>

            <span class="kd">var</span> <span class="nx">errorIdToReplace</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">errorStack</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62">&#182;</a>
</div>
<p>eat another statement now, its the body of the labeled statement (like if and while)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<p>if no statement was found, check here now and correct error</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">error</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">msg</span> <span class="o">==</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">Errors</span><span class="p">.</span><span class="nx">UnableToParseStatement</span><span class="p">.</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<p>replace with better error...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="nx">match</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;LabelRequiresStatement&#39;</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65">&#182;</a>
</div>
<p>also replace on stack</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">this</span><span class="p">.</span><span class="nx">errorStack</span><span class="p">[</span><span class="nx">errorIdToReplace</span><span class="p">]</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">error</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">match</span><span class="p">.</span><span class="nx">wasLabel</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

            <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
          <span class="p">}</span>

          <span class="nx">mayParseLabeledStatementInstead</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66">&#182;</a>
</div>
<p>ignore... its certainly the end of this expression, but maybe asi can be applied...
it might also be an object literal expecting more, but that case has been covered else where.
if it turns out the } is bad after all, .parse() will try to recover</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">14</span><span class="cm">/*error*/</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">do</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">tokenError</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">pe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;TokenizerError&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
              <span class="nx">pe</span><span class="p">.</span><span class="nx">msg</span> <span class="o">+=</span> <span class="s1">&#39;: &#39;</span><span class="o">+</span><span class="nx">match</span><span class="p">.</span><span class="nx">error</span><span class="p">.</span><span class="nx">msg</span><span class="p">;</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">errorStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pe</span><span class="p">);</span>
              
              <span class="k">this</span><span class="p">.</span><span class="nx">failSpecial</span><span class="p">({</span><span class="nx">start</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">stop</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="mi">14</span><span class="cm">/*error*/</span><span class="p">,</span><span class="nx">error</span><span class="o">:</span><span class="nx">pe</span><span class="p">},</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">14</span><span class="cm">/*error*/</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">12</span><span class="cm">/*eof*/</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67">&#182;</a>
</div>
<p>cant parse any further. you're probably just typing...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>if (!this.errorStack.length &amp;&amp; match.name != 12/<em>eof</em>/) console.log(["unknown token", match, stack, Gui.escape(this.input)]);</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;UnknownToken&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<p>we cant really ignore this. eat the token and try again. possibly you're just typing?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>search for "value" suffix. property access and call parens.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isBreakOrContinueArg</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;BreakOrContinueArgMustBeJustIdentifier&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71">&#182;</a>
</div>
<p>property access. read in an IdentifierName (no keyword checks). allow assignments</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;PropertyNamesMayOnlyBeIdentifiers&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">isPropertyName</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="c1">//#endif</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// may parse div</span>
            <span class="nx">acceptAssignment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;[&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="kd">var</span> <span class="nx">lhsb</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">propertyAccessStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72">&#182;</a>
</div>
<p>property access, read expression list. allow assignments</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SquareBracketsMayNotBeEmpty&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
              <span class="k">else</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SquareBracketExpectsExpression&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnclosedSquareBrackets&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhsb</span><span class="p">;</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">propertyAccessStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="nx">lhsb</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">lhsb</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="c1">//#endif</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// might be div</span>
            <span class="nx">acceptAssignment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">isCallExpressionStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="k">if</span> <span class="p">(</span><span class="nx">news</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">match</span><span class="p">.</span><span class="nx">parensBelongToNew</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="o">--</span><span class="nx">news</span><span class="p">;</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74">&#182;</a>
</div>
<p>call expression, eat optional expression list, disallow assignments</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// arguments are optional</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnclosedCallParens&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
              <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">isCallExpressionStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
              <span class="p">}</span>
            <span class="p">}</span> <span class="c1">//#endif</span>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// might be div</span>
            <span class="nx">acceptAssignment</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76">&#182;</a>
</div>
<p>check for postfix operators ++ and --
they are stronger than the + or - binary operators
they can be applied to any lhs (even when it wouldnt make sense)
if there was a newline, it should get an ASI</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">((</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;++&#39;</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;--&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">isBreakOrContinueArg</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;BreakOrContinueArgMustBeJustIdentifier&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// may parse div</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77">&#182;</a>
</div>
<p>restore "expression" stack</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">stack</span> <span class="o">=</span> <span class="nx">estack</span><span class="p">;</span>
        <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78">&#182;</a>
</div>
<p>now see if there is an operator following...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

        <span class="k">do</span> <span class="p">{</span> <span class="c1">// this do allows us to parse multiple ternary expressions in succession without screwing up.</span>
          <span class="kd">var</span> <span class="nx">ternary</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span>
            <span class="p">(</span><span class="o">!</span><span class="nx">forHeader</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="c1">// one of two named binary operators, may not be first expression in for-header (when semi&#39;s occur in the for-header)</span>
            <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;instanceof&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="c1">// only other named binary operator</span>
            <span class="p">((</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">11</span><span class="cm">/*PUNCTUATOR*/</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="c1">// we can only expect a punctuator now</span>
              <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">isAssignment</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexAssignments</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="o">||</span> <span class="c1">// assignments are only okay with proper lhs</span>
              <span class="k">this</span><span class="p">.</span><span class="nx">regexNonAssignmentBinaryExpressionOperators</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="c1">// test all other binary operators</span>
            <span class="p">)</span>
          <span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">isAssignment</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">acceptAssignment</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;IllegalLhsForAssignment&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">parsedNonAssignmentOperator</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;AssignmentNotAllowedAfterNonAssignmentInExpression&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">isBreakOrContinueArg</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;BreakOrContinueArgMustBeJustIdentifier&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">isAssignment</span><span class="p">)</span> <span class="nx">parsedNonAssignmentOperator</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// last allowed assignment</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
              <span class="nx">match</span><span class="p">.</span><span class="nx">isBinaryOperator</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79">&#182;</a>
</div>
<p>we build a stack to ensure any whitespace doesnt break the 1+(n*2) children rule for expressions</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="kd">var</span> <span class="nx">ostack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
              <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;operator-expression&#39;</span><span class="p">;</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">isBinaryOperator</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
              <span class="nx">ostack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
              <span class="nx">stack</span><span class="p">.</span><span class="nx">isAssignment</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">isAssignment</span><span class="p">;</span>
              <span class="nx">ostack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
            <span class="p">}</span> <span class="c1">//#endif</span>
            <span class="nx">ternary</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;?&#39;</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80">&#182;</a>
</div>
<p>math, logic, assignment or in or instanceof</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81">&#182;</a>
</div>
<p>restore "expression" stack</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="nx">stack</span> <span class="o">=</span> <span class="nx">ostack</span><span class="p">;</span>
            <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82">&#182;</a>
</div>
<p>minor exception to ternary operator, we need to parse two expressions nao. leave the trailing expression to the loop.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="nx">ternary</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83">&#182;</a>
</div>
<p>LogicalORExpression "?" AssignmentExpression ":" AssignmentExpression
so that means just one expression center and right.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;InvalidCenterTernaryExpression&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">forHeader</span><span class="p">);</span> <span class="c1">// only one expression allowed inside ternary center/right</span>

              <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;TernarySecondExpressionCanNotContainComma&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
                <span class="k">else</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnfinishedTernaryOperator&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84">&#182;</a>
</div>
<p>we build a stack to ensure any whitespace doesnt break the 1+(n*2) children rule for expressions</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
                <span class="kd">var</span> <span class="nx">ostack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
                <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;operator-expression&#39;</span><span class="p">;</span>
                <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
                <span class="nx">ostack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
                <span class="nx">stack</span><span class="p">.</span><span class="nx">isAssignment</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">isAssignment</span><span class="p">;</span>
                <span class="nx">ostack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
              <span class="p">}</span> <span class="c1">//#endif</span>
              <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
              <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
                <span class="nx">stack</span> <span class="o">=</span> <span class="nx">ostack</span><span class="p">;</span>
              <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85">&#182;</a>
</div>
<p>rhs of the ternary can not contain a comma either</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">forHeader</span><span class="p">);</span> <span class="c1">// only one expression allowed inside ternary center/right</span>
            <span class="p">}</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nx">parseAnotherExpression</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="p">}</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">ternary</span><span class="p">);</span> <span class="c1">// if we just parsed a ternary expression, we need to check _again_ whether the next token is a binary operator.</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86">&#182;</a>
</div>
<p>start over. match is the rhs for the lhs we just parsed, but lhs for the next expression</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">parseAnotherExpression</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87">&#182;</a>
</div>
<p>no idea what to do now. lets just ignore and see where it ends. TOFIX: maybe just break the loop or return?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;InvalidRhsExpression&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88">&#182;</a>
</div>
<p>restore "expressions" stack</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">stack</span> <span class="o">=</span> <span class="nx">astack</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89">&#182;</a>
</div>
<p>at this point we should have parsed one AssignmentExpression
lets see if we can parse another one...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">mayParseLabeledStatementInstead</span> <span class="o">=</span> <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="nx">onlyOne</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90">&#182;</a>
</div>
<p>remove empty array</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">pstack</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">pstack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
      <span class="nx">pstack</span><span class="p">.</span><span class="nx">numberOfExpressions</span> <span class="o">=</span> <span class="nx">parsedExpressions</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">pstack</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="nx">pstack</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">numberOfExpressions</span> <span class="o">=</span> <span class="nx">parsedExpressions</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">expressionCount</span> <span class="o">=</span> <span class="nx">parsedExpressions</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatFunctionDeclaration</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="kd">var</span> <span class="nx">prevscope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;func decl&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">isFunction</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">functionId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">functions</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91">&#182;</a>
</div>
<p>add new scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">match</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="p">[</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">,</span> <span class="c1">// add current scope (build scope chain up-down)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92">&#182;</a>
</div>
<p>Object.create(null,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="s1">&#39;this&#39;</span><span class="p">,</span> <span class="nx">isDeclared</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">isEcma</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">functionStack</span><span class="o">:</span><span class="nx">stack</span><span class="p">},</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93">&#182;</a>
</div>
<p>Object.create(null,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="s1">&#39;arguments&#39;</span><span class="p">,</span> <span class="nx">isDeclared</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">isEcma</span><span class="o">:</span><span class="kc">true</span><span class="p">,</span> <span class="nx">varType</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;Object&#39;</span><span class="p">]}</span>
      <span class="p">];</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94">&#182;</a>
</div>
<p>ref to back to function that's the cause for this scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">scopeFor</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">targetScope</span> <span class="o">=</span> <span class="nx">prevscope</span><span class="p">;</span> <span class="c1">// consistency</span>
      
      <span class="nx">match</span><span class="p">.</span><span class="nx">functionStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>

      <span class="nx">match</span><span class="p">.</span><span class="nx">isFuncDeclKeyword</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95">&#182;</a>
</div>
<p>only place that this function is used already checks whether next token is function</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">functionKeyword</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;FunctionDeclarationsMustHaveName&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="cm">/*this.regexStartKeyOrReserved.test(match.value[0])*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;FunctionNameMayNotBeReserved&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">functionKeyword</span><span class="p">.</span><span class="nx">funcName</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">prevscope</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="s1">&#39;func decl name&#39;</span><span class="p">;</span> <span class="c1">// that&#39;s what it is, really</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">varType</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Function&#39;</span><span class="p">];</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">functionStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionParametersAndBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">functionKeyword</span><span class="p">);</span> <span class="c1">// first token after func-decl is regex</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96">&#182;</a>
</div>
<p>restore previous scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="nx">prevscope</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatObjectLiteralColonAndBody</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">propValueStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
      <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;objlit pair colon&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="nx">propValueStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ObjectLiteralExpectsColonAfterName&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span> <span class="o">=</span> <span class="nx">propValueStack</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97">&#182;</a>
</div>
<p>this might actually fail due to ASI optimization.
if the property name does not exist and it is the last item
of the objlit, the expression parser will see an unexpected
} and ignore it, giving some leeway to apply ASI. of course,
that doesnt work for objlits. but we dont want to break the
existing mechanisms. so we check this differently... :)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">prevMatch</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// only one expression</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">==</span> <span class="nx">prevMatch</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ObjectLiteralMissingPropertyValue&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatFunctionParametersAndBody</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="nx">div</span><span class="p">,</span> <span class="nx">funcToken</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-98" id="section-98">&#182;</a>
</div>
<p>div: the first token <em>after</em> a function expression may be a division...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectingFunctionHeaderStart&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">funcToken</span><span class="p">.</span><span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// params</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="cm">/*this.regexStartKeyOrReserved.test(match.value[0])*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;FunctionArgumentsCanNotBeReserved&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">funcToken</span><span class="p">.</span><span class="nx">paramNames</span><span class="p">)</span> <span class="nx">funcToken</span><span class="p">.</span><span class="nx">paramNames</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">paramNames</span> <span class="o">=</span> <span class="nx">funcToken</span><span class="p">.</span><span class="nx">paramNames</span><span class="p">;</span>
        <span class="nx">funcToken</span><span class="p">.</span><span class="nx">paramNames</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span> <span class="c1">// add param name to scope</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="s1">&#39;parameter&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99">&#182;</a>
</div>
<p>example: if name is 12, the source is incomplete...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;FunctionParametersMustBeIdentifiers&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="cm">/*this.regexStartKeyOrReserved.test(match.value[0])*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;FunctionArgumentsCanNotBeReserved&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100">&#182;</a>
</div>
<p>Object.create(null,</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span> <span class="c1">// add param name to scope</span>
          <span class="nx">match</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="s1">&#39;parameter&#39;</span><span class="p">;</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="nx">funcToken</span><span class="p">.</span><span class="nx">paramNames</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
        <span class="p">}</span> <span class="c1">//#endif</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lhp</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
        <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
        <span class="nx">funcToken</span><span class="p">.</span><span class="nx">rhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedFunctionHeaderClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span> <span class="c1">// TOFIX: can be various things here...</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="nx">div</span><span class="p">,</span> <span class="nx">funcToken</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatFunctionBody</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="nx">div</span><span class="p">,</span> <span class="nx">funcToken</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;func body&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101">&#182;</a>
</div>
<p>create EMPTY list of functions. labels cannot cross function boundaries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="kd">var</span> <span class="nx">labelBackup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">labels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102">&#182;</a>
</div>
<p>if div, a division can occur <em>after</em> this function expression
this.stats.eatFunctionBody = (+//this.stats.eatFunctionBody||0)+1;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedFunctionBodyCurlyOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">funcToken</span><span class="p">)</span> <span class="nx">funcToken</span><span class="p">.</span><span class="nx">lhc</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSourceElements</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedFunctionBodyCurlyClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
      <span class="nx">lhc</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">funcToken</span><span class="p">)</span> <span class="nx">funcToken</span><span class="p">.</span><span class="nx">rhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="nx">div</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-103" id="section-103">&#182;</a>
</div>
<p>restore label set</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span> <span class="o">=</span> <span class="nx">labelBackup</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatVar</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;var&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">stack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">isVarKeyword</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatVarDecl</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatVarDecl</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="nx">forHeader</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104">&#182;</a>
</div>
<p>assumes match is indeed the identifier 'var'</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;var decl&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">targetScope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">targetScope</span><span class="p">.</span><span class="nx">catchScope</span><span class="p">)</span> <span class="nx">targetScope</span> <span class="o">=</span> <span class="nx">targetScope</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="kd">var</span> <span class="nx">first</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">varsDeclared</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">do</span> <span class="p">{</span>
      <span class="o">++</span><span class="nx">varsDeclared</span><span class="p">;</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// start: var, iteration: comma</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="kd">var</span> <span class="nx">declStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;single var decl&#39;</span><span class="p">;</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">varStack</span> <span class="o">=</span> <span class="nx">declStack</span><span class="p">;</span> <span class="c1">// reference to the var statement stack, it might hook to jsdoc needed for these vars</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
        <span class="nx">declStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">singleDecStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
        <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;sub-expression&#39;</span><span class="p">;</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
        <span class="nx">singleDecStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105">&#182;</a>
</div>
<p>next token should be a valid identifier</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">12</span><span class="cm">/*eof*/</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">first</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;VarKeywordMissingName&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-106" id="section-106">&#182;</a>
</div>
<p>else, ignore. TOFIX: return?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">else</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;IllegalTrailingComma&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;VarNamesMayOnlyBeIdentifiers&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="cm">/*this.regexStartKeyOrReserved.test(match.value[0])*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;VarNamesCanNotBeReserved&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
      <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-107" id="section-107">&#182;</a>
</div>
<p>mark the match as being a variable name. we need it for lookup later :)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="s1">&#39;var name&#39;</span><span class="p">;</span>
        <span class="nx">targetScope</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="nx">value</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">});</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span> <span class="o">=</span> <span class="nx">singleDecStack</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-108" id="section-108">&#182;</a>
</div>
<p>next token should either be a = , or ;
if = parse an expression and optionally a comma</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
          <span class="nx">singleDecStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
          <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;operator-expression&#39;</span><span class="p">;</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;=&#39;</span><span class="p">;</span>
          <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
          <span class="nx">singleDecStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

          <span class="nx">stack</span><span class="p">.</span><span class="nx">isAssignment</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span> <span class="c1">//#endif</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">isInitialiser</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
          <span class="nx">stack</span> <span class="o">=</span> <span class="nx">singleDecStack</span><span class="p">;</span>
        <span class="p">}</span> <span class="c1">//#endif</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">14</span><span class="cm">/*error*/</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;VarInitialiserExpressionExpected&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
        <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">forHeader</span><span class="p">);</span> <span class="c1">// only one expression </span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-109" id="section-109">&#182;</a>
</div>
<p>var statement: comma or semi now
for statement: semi, comma or 'in'</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span> <span class="o">=</span> <span class="nx">declStack</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-110" id="section-110">&#182;</a>
</div>
<p>determines proper error message in one case</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">first</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-111" id="section-111">&#182;</a>
</div>
<p>keep parsing name(=expression) sequences as long as you see a comma here</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;,&#39;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">varsDeclared</span> <span class="o">=</span> <span class="nx">varsDeclared</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">eatIf</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;if&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">hasElse</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-112" id="section-112">&#182;</a>
</div>
<p>(
expression
)
statement
[else statement]</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">ifKeyword</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;StatementHeaderIsNotOptional&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-113" id="section-113">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-114" id="section-114">&#182;</a>
</div>
<p>match might be null here... (if the if-statement was end part of the source)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;else&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">ifKeyword</span><span class="p">.</span><span class="nx">hasElse</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatElse</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatElse</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">hasElse</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;else&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatDo</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;do&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">isIteration</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// add &quot;empty&quot;</span>
      <span class="kd">var</span> <span class="nx">doToken</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-115" id="section-115">&#182;</a>
</div>
<p>statement
while
(
expression
)
semi-colon</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;while&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;DoShouldBeFollowedByWhile&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">hasDo</span> <span class="o">=</span> <span class="nx">doToken</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;StatementHeaderIsNotOptional&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">isForDoWhile</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// prevents missing block warnings</span>
      <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-116" id="section-116">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// TOFIX: this is not optional according to the spec, but browsers apply ASI anyways</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatWhile</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;while&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">isIteration</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// add &quot;empty&quot;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-117" id="section-117">&#182;</a>
</div>
<p>(
expression
)
statement</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;StatementHeaderIsNotOptional&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-118" id="section-118">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">eatFor</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;for&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">isIteration</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// add &quot;empty&quot;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-119" id="section-119">&#182;</a>
</div>
<p>either a for(..in..) or for(..;..;..)
start eating an expression but refuse to parse
'in' on the top-level of that expression. they are fine
in sub-levels (group, array, etc). Now the expression
must be followed by either ';' or 'in'. Else throw.
Branch on that case, ; requires two.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">forHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-120" id="section-120">&#182;</a>
</div>
<p>for (either case) may start with var, in which case you'll parse a var declaration before encountering the 'in' or first semi.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;var&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatVarDecl</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// expressions are optional in for-each</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;StatementHeaderIsNotOptional&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// can parse multiple expressions, in is not ok here</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-121" id="section-121">&#182;</a>
</div>
<p>now we parsed an expression if it existed. the next token should be either ';' or 'in'. branch accordingly</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">declStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">declStack</span><span class="p">.</span><span class="nx">varsDeclared</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-122" id="section-122">&#182;</a>
</div>
<p>disallowed. for-in var decls can only have one var name declared</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;ForInCanOnlyDeclareOnVar&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">forType</span> <span class="o">=</span> <span class="s1">&#39;in&#39;</span><span class="p">;</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">forFor</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// make easy distinction between conditional and iterational operator</span>
      <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-123" id="section-123">&#182;</a>
</div>
<p>just parse another expression, where 'in' is allowed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ForHeaderShouldHaveSemisOrIn&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">forType</span> <span class="o">=</span> <span class="s1">&#39;each&#39;</span><span class="p">;</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">forEachHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-124" id="section-124">&#182;</a>
</div>
<p>parse another optional no-in expression, another semi and then one more optional no-in expression</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// in is ok here</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedSecondSemiOfForHeader&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">forEachHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// in is ok here</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">forHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">forType</span> <span class="o">==</span> <span class="s1">&#39;in&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-125" id="section-125">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatContinue</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;continue&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>

      <span class="nx">match</span><span class="p">.</span><span class="nx">restricted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-126" id="section-126">&#182;</a>
</div>
<p>(no-line-break identifier)
;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// may not have line terminator...</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*EOF*/</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">isLabel</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">isLabelTarget</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="kd">var</span> <span class="nx">continueArg</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span> <span class="c1">// remember to see if this continue parsed a label</span>
      <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-127" id="section-127">&#182;</a>
</div>
<p>may only parse exactly an identifier at this point</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// first true=onlyOne, second: continue/break arg</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">hasLabel</span> <span class="o">=</span> <span class="nx">continueArg</span> <span class="o">!=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*eof*/</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;BreakOrContinueArgMustBeJustIdentifier&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatBreak</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">parentstack</span> <span class="o">=</span> <span class="nx">stack</span>
      <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;break&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      
      <span class="nx">parentstack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>

      <span class="nx">match</span><span class="p">.</span><span class="nx">restricted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-128" id="section-128">&#182;</a>
</div>
<p>(no-line-break identifier)
;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// may not have line terminator...</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*EOF*/</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">isLabel</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">match</span><span class="p">.</span><span class="nx">isLabelTarget</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">breakArg</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span> <span class="c1">// remember to see if this break parsed a label</span>
      <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-129" id="section-129">&#182;</a>
</div>
<p>may only parse exactly an identifier at this point</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">false</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span> <span class="c1">// first true=onlyOne, second: continue/break arg</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">hasLabel</span> <span class="o">=</span> <span class="nx">breakArg</span> <span class="o">!=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*eof*/</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;BreakOrContinueArgMustBeJustIdentifier&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatReturn</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;return&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">returnFor</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">scopeFor</span><span class="p">;</span>

      <span class="nx">match</span><span class="p">.</span><span class="nx">restricted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-130" id="section-130">&#182;</a>
</div>
<p>(no-line-break expression)
;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// may not have line terminator...</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;;&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*EOF*/</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatThrow</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;throw&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>

      <span class="nx">match</span><span class="p">.</span><span class="nx">restricted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-131" id="section-131">&#182;</a>
</div>
<p>(no-line-break expression)
;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span> <span class="c1">// may not have line terminator...</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">newline</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ThrowCannotHaveReturn&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ThrowMustHaveArgument&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatSwitch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;switch&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>

      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span> <span class="c1">// add &quot;empty&quot;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-132" id="section-132">&#182;</a>
</div>
<p>meh.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;StatementHeaderIsNotOptional&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-133" id="section-133">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SwitchBodyStartsWithCurly&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-134" id="section-134">&#182;</a>
</div>
<p>you may parse a default case, and only once per switch. but you may do so anywhere.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">parsedAnything</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;case&#39;</span> <span class="o">||</span> <span class="p">(</span><span class="o">!</span><span class="nx">stack</span><span class="p">.</span><span class="nx">parsedSwitchDefault</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">parsedAnything</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSwitchClause</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-135" id="section-135">&#182;</a>
</div>
<p>if you didnt parse anything but not encountering a closing curly now, you might be thinking that switches may start with silly stuff</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">parsedAnything</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SwitchBodyMustStartWithClause&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">.</span><span class="nx">parsedSwitchDefault</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;default&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;SwitchCannotHaveDoubleDefault&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">14</span><span class="cm">/*error*/</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SwitchBodyEndsWithCurly&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
      <span class="nx">lhc</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatSwitchClause</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSwitchHeader</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSwitchBody</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatSwitchHeader</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-136" id="section-136">&#182;</a>
</div>
<p>collect whitespace...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="kd">var</span> <span class="nx">switchHeaderStack</span> <span class="o">=</span> <span class="nx">stack</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;switch clause header&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;case&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSwitchCaseHead</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> <span class="c1">// default</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">switchHeaderStack</span><span class="p">.</span><span class="nx">hasDefaultClause</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSwitchDefaultHead</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-137" id="section-137">&#182;</a>
</div>
<p>just to group whitespace (makes certain navigation easier..)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;colon&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;SwitchClausesEndWithColon&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatSwitchBody</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;switch clause body&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-138" id="section-138">&#182;</a>
</div>
<p>parse body of case or default, just so long case and default keywords are not seen and end of switch is not reached
(clause bodies may be empty, for instance to fall through)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">lastMatch</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;default&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;case&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">14</span><span class="cm">/*error*/</span> <span class="o">&amp;&amp;</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">12</span><span class="cm">/*eof*/</span> <span class="o">&amp;&amp;</span> <span class="nx">lastMatch</span> <span class="o">!=</span> <span class="nx">match</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">lastMatch</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span> <span class="c1">// prevents endless loops on error ;)</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">lastMatch</span> <span class="o">==</span> <span class="nx">match</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnexpectedInputSwitch&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatSwitchCaseHead</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;case&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">caseHeadStack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>

      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;case&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>

      <span class="nx">match</span><span class="p">.</span><span class="nx">isCase</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;:&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;CaseMissingExpression&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">caseHeadStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;case arg&#39;</span><span class="p">;</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatSwitchDefaultHead</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;default&#39;</span><span class="p">;</span>

      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;case&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>

      <span class="nx">match</span><span class="p">.</span><span class="nx">isDefault</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatTryCatchFinally</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;try&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatTry</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;catch&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">hasCatch</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatCatch</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;finally&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">hasFinally</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFinally</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-139" id="section-139">&#182;</a>
</div>
<p>at least a catch or finally block must follow. may be both.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stack</span><span class="p">.</span><span class="nx">tryHasCatchOrFinally</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;TryMustHaveCatchOrFinally&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatTry</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-140" id="section-140">&#182;</a>
</div>
<p>block
(catch ( identifier ) block )
(finally block)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;MissingTryBlockCurlyOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;tryblock&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">lhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatements</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;MissingTryBlockCurlyClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
      <span class="nx">lhc</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatCatch</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="nx">stack</span><span class="p">.</span><span class="nx">tryHasCatchOrFinally</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;catch&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-141" id="section-141">&#182;</a>
</div>
<p>the catch block has a header which can contain at most one parameter
this parameter is bound to a local stack. formally, if that parameter
shadows another variable, changes made to the variable inside the catch
should not be reflected by the variable being shadowed. however, this
is not very safe to rely on so there ought to be a warning. note that
only this parameter gets bound to this inner scope, other parameters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

      <span class="kd">var</span> <span class="nx">catchScopeBackup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="p">[</span><span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">];</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">catchScope</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">// mark this as being a catchScope</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-142" id="section-142">&#182;</a>
</div>
<p>find first function scope or global scope object...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="kd">var</span> <span class="nx">nonCatchScope</span> <span class="o">=</span> <span class="nx">catchScopeBackup</span><span class="p">;</span>
      <span class="k">while</span> <span class="p">(</span><span class="nx">nonCatchScope</span><span class="p">.</span><span class="nx">catchScope</span><span class="p">)</span> <span class="nx">nonCatchScope</span> <span class="o">=</span> <span class="nx">nonCatchScope</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-143" id="section-143">&#182;</a>
</div>
<p>get catch id, which is governed by the function/global scope only</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">nonCatchScope</span><span class="p">.</span><span class="nx">catches</span><span class="p">)</span> <span class="nx">nonCatchScope</span><span class="p">.</span><span class="nx">catches</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">catchId</span> <span class="o">=</span> <span class="nx">nonCatchScope</span><span class="p">.</span><span class="nx">catches</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">nonCatchScope</span><span class="p">.</span><span class="nx">catches</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">targetScope</span> <span class="o">=</span> <span class="nx">nonCatchScope</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">catchScope</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-144" id="section-144">&#182;</a>
</div>
<p>ref to back to function that's the cause for this scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">scopeFor</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-145" id="section-145">&#182;</a>
</div>
<p>catch clauses dont have a special <code>this</code> or <code>arguments</code>, map them to their parent scope</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">catchScopeBackup</span><span class="p">.</span><span class="nx">global</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">catchScopeBackup</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">// global (has no `arguments` but always a `this`)</span>
      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">catchScopeBackup</span><span class="p">.</span><span class="nx">catchScope</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-146" id="section-146">&#182;</a>
</div>
<p>tricky. there will at least be a this</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">catchScopeBackup</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-147" id="section-147">&#182;</a>
</div>
<p>but there might not be an arguments</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">catchScopeBackup</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;&amp;</span> <span class="nx">catchScopeBackup</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;arguments&#39;</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">catchScopeBackup</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">catchScopeBackup</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nx">catchScopeBackup</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="c1">// function scope, copy this and arguments</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;CatchHeaderMissingOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">!=</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;MissingCatchParameter&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span><span class="p">[</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="cm">/*this.regexStartKeyOrReserved.test(match.value[0])*/</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;CatchParameterNameMayNotBeReserved&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">meta</span> <span class="o">=</span> <span class="s1">&#39;var name&#39;</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-148" id="section-148">&#182;</a>
</div>
<p>this is the catch variable. bind it to a scope but keep the scope as
it currently is.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">match</span><span class="p">);</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">isCatchVar</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-149" id="section-149">&#182;</a>
</div>
<p>now the catch body will use the outer scope to bind new variables. the problem is that
inner scopes, if any, should have access to the scope variable, so their scope should
be linked to the catch scope. this is a problem in the current architecture but the 
idea is to pass on the catchScope as the scope to the eatStatements call, etc.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;CatchHeaderMissingClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
      <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;MissingCatchBlockCurlyOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-150" id="section-150">&#182;</a>
</div>
<p>catch body. statements are optional.    </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatements</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;MissingCatchBlockCurlyClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
      <span class="nx">lhc</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">scope</span> <span class="o">=</span> <span class="nx">catchScopeBackup</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatFinally</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="nx">stack</span><span class="p">.</span><span class="nx">tryHasCatchOrFinally</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;finally&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;MissingFinallyBlockCurlyOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatements</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;MissingFinallyBlockCurlyClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
      <span class="nx">lhc</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatDebugger</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;debugger&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatWith</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span> <span class="o">=</span> <span class="p">[]);</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;with&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;(&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderOpen&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">lhp</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="cm">/*is left hand side start?*/</span> <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">&lt;=</span> <span class="mi">6</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)))</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;StatementHeaderIsNotOptional&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;)&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;ExpectedStatementHeaderClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhp</span><span class="p">;</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementHeaderStop</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">lhp</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">].</span><span class="nx">desc</span> <span class="o">==</span> <span class="s1">&#39;expressions&#39;</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-151" id="section-151">&#182;</a>
</div>
<p>create ref to this expression group to the opening bracket</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">lhp</span><span class="p">.</span><span class="nx">expressionArg</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">[</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">];</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatFunction</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nb">Error</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">errorStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pe</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-152" id="section-152">&#182;</a>
</div>
<p>ignore. browsers will accept it anyways</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">stop</span><span class="p">,</span><span class="nx">stop</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">stop</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="mi">14</span><span class="cm">/*error*/</span><span class="p">,</span><span class="nx">error</span><span class="o">:</span><span class="nx">pe</span><span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">specialError</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-153" id="section-153">&#182;</a>
</div>
<p>now try parsing a function declaration...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionDeclaration</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatLabelOrExpression</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="kd">var</span> <span class="nx">parentstack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>

      <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;expression&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="nx">parentstack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-154" id="section-154">&#182;</a>
</div>
<p>must be an expression or a labeled statement.
in order to prevent very weird return constructs, we'll first check the first match
if that's an identifier, we'll gobble it here and move on to the second.
if that's a colon, we'll gobble it as a labeled statement. otherwise, we'll pass on
control to eatExpression, with the note that we've already gobbled a </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-155" id="section-155">&#182;</a>
</div>
<p>if we parsed a label, the returned match (colon) will have this property</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">wasLabel</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;labeled&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-156" id="section-156">&#182;</a>
</div>
<p>it will have already eaten another statement for the label</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;expression&#39;</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-157" id="section-157">&#182;</a>
</div>
<p>only parse semi if we didnt parse a label just now...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatBlock</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">sub</span> <span class="o">=</span> <span class="s1">&#39;block&#39;</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">lhc</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
        <span class="nx">stack</span><span class="p">.</span><span class="nx">isEmptyBlock</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatements</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">!=</span> <span class="s1">&#39;}&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;BlockCurlyClose&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">lhc</span><span class="p">;</span>
      <span class="nx">lhc</span><span class="p">.</span><span class="nx">twin</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>
    <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">storeCurrentAndFetchNextToken</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">eatStatements</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-158" id="section-158">&#182;</a>
</div>
<p>this.stats.eatStatements = (+//this.stats.eatStatements||0)+1;
detecting the start of a statement "quickly" is virtually impossible.
instead we keep eating statements until the match stops changing
the first argument indicates that the statement is optional. if that
statement was not found, the input match will also be the output.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

    <span class="k">while</span> <span class="p">(</span><span class="nx">match</span> <span class="o">!=</span> <span class="p">(</span><span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">)));</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">eatStatement</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">isOptional</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">match</span> <span class="o">&amp;&amp;</span> <span class="nx">isOptional</span><span class="p">)</span> <span class="k">return</span> <span class="nx">match</span><span class="p">;</span> <span class="c1">// eof</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">statementStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">pstack</span> <span class="o">=</span> <span class="nx">stack</span><span class="p">;</span>
      <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">desc</span> <span class="o">=</span> <span class="s1">&#39;statement-parent&#39;</span><span class="p">;</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">nextBlack</span> <span class="o">=</span> <span class="nx">match</span><span class="p">.</span><span class="nx">tokposb</span><span class="p">;</span>
      <span class="nx">pstack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-159" id="section-159">&#182;</a>
</div>
<p>list of labels, these are bound to statements (and can access any label higher up, but not cross functions)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="kd">var</span> <span class="nx">labelBackup</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span> <span class="o">=</span> <span class="p">[</span><span class="nx">labelBackup</span><span class="p">];</span> <span class="c1">// make ref like tree. we need this to catch labels parsed beyond the current position (not yet known to use)</span>
      <span class="nx">stack</span><span class="p">.</span><span class="nx">labels</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">2</span><span class="cm">/*IDENTIFIER*/</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-160" id="section-160">&#182;</a>
</div>
<p>try to determine whether it's a statement
(block/empty statements come later, this branch is only for identifiers)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">switch</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;var&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatVar</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;if&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatIf</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;do&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatDo</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;while&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatWhile</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;for&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFor</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;continue&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatContinue</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;break&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatBreak</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;return&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatReturn</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;throw&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatThrow</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;switch&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSwitch</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;try&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatTryCatchFinally</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;debugger&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatDebugger</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;with&#39;</span><span class="o">:</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatWith</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
          <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;function&#39;</span><span class="o">:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-161" id="section-161">&#182;</a>
</div>
<p>I'm not sure whether this is at all possible.... (but it's bad, either way ;)
so add an error token, but parse the function as if it was a declaration.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">this</span><span class="p">.</span><span class="nx">failignore</span><span class="p">(</span><span class="s1">&#39;StatementMayNotStartWithFunction&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-162" id="section-162">&#182;</a>
</div>
<p>now parse as declaration... (most likely?)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionDeclaration</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>

          <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span> <span class="c1">// either a label or an expression-statement</span>
          <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatLabelOrExpression</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;{&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// Block (make sure you do this before checking for expression...)</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatBlock</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-163" id="section-163">&#182;</a>
</div>
<p>expression statements:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nx">match</span><span class="p">.</span><span class="nx">isString</span> <span class="o">||</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">isNumber</span> <span class="o">||</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">name</span> <span class="o">==</span> <span class="mi">1</span><span class="cm">/*REG_EX*/</span> <span class="o">||</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">regexLhsStart</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span><span class="p">)</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatExpressions</span><span class="p">(</span><span class="kc">false</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span><span class="nx">stack</span><span class="p">);</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;;&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// empty statement</span>
      <span class="nx">match</span><span class="p">.</span><span class="nx">emptyStatement</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatSemiColon</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isOptional</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-164" id="section-164">&#182;</a>
</div>
<p>unmark token as being start of a statement, since it's obviously not</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">match</span><span class="p">.</span><span class="nx">statementStart</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      <span class="p">}</span> <span class="c1">//#endif</span>
      <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">failsafe</span><span class="p">(</span><span class="s1">&#39;UnableToParseStatement&#39;</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-165" id="section-165">&#182;</a>
</div>
<p>unmark token as being start of a statement, since it's obviously not</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="nx">match</span><span class="p">.</span><span class="nx">statementStart</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span> <span class="c1">//#ifdef FULL_AST</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">stack</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="nx">pstack</span><span class="p">.</span><span class="nx">length</span> <span class="o">=</span> <span class="nx">pstack</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-166" id="section-166">&#182;</a>
</div>
<p>restore label set</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">this</span><span class="p">.</span><span class="nx">statementLabels</span> <span class="o">=</span> <span class="nx">labelBackup</span><span class="p">;</span>
    <span class="p">}</span> <span class="c1">//#endif</span>

    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">eatSourceElements</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-167" id="section-167">&#182;</a>
</div>
<p>this.stats.eatSourceElements = (+//this.stats.eatSourceElements||0)+1;
detecting the start of a statement "quickly" is virtually impossible.
instead we keep eating statements until the match stops changing
the first argument indicates that the statement is optional. if that
statement was not found, the input match will also be the output.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">while</span> <span class="p">(</span><span class="nx">match</span> <span class="o">!=</span> <span class="nx">oldMatch</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// difficult to determine whether ` &amp;&amp; match.name != 12/*EOF*/` is actually speeding things up. it&#39;s an extra check vs one less call to eatStatement...</span>
      <span class="kd">var</span> <span class="nx">oldMatch</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-168" id="section-168">&#182;</a>
</div>
<p>always try to eat function declaration first. otherwise 'function' at the start might cause eatStatement to throw up</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="nx">match</span><span class="p">.</span><span class="nx">value</span> <span class="o">==</span> <span class="s1">&#39;function&#39;</span><span class="p">)</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatFunctionDeclaration</span><span class="p">(</span><span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
      <span class="k">else</span> <span class="nx">match</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">eatStatement</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">match</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">failsafe</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">doNotAddMatch</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">errorStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pe</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">doNotAddMatch</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-169" id="section-169">&#182;</a>
</div>
<p>the match was bad, but add it to the ast anyways. in most cases this is the case but in some its not.
the tokenizer will pick up on the errorEscape property and add it after the match we passed on.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">errorEscape</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">errorEscape</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">errorEscape</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">stop</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">len</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span> <span class="nx">name</span><span class="o">:</span><span class="mi">14</span><span class="cm">/*error*/</span><span class="p">,</span><span class="nx">error</span><span class="o">:</span><span class="nx">pe</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">};</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">addTokenToStreamBefore</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">error</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">failignore</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">pe</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nb">Error</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">errorStack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">pe</span><span class="p">);</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-170" id="section-170">&#182;</a>
</div>
<p>ignore the error (this will screw up :)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="p">{</span><span class="nx">start</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">stop</span><span class="o">:</span><span class="nx">match</span><span class="p">.</span><span class="nx">start</span><span class="p">,</span><span class="nx">len</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span><span class="nx">name</span><span class="o">:</span><span class="mi">14</span><span class="cm">/*error*/</span><span class="p">,</span><span class="nx">error</span><span class="o">:</span><span class="nx">pe</span><span class="p">,</span> <span class="nx">value</span><span class="o">:</span><span class="s1">&#39;&#39;</span><span class="p">};</span>
    <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">addTokenToStreamBefore</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">failSpecial</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">match</span><span class="p">,</span> <span class="nx">stack</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-171" id="section-171">&#182;</a>
</div>
<p>we cant really ignore this. eat the token</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">stack</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">error</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tokenizer</span><span class="p">.</span><span class="nx">addTokenToStreamBefore</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">match</span><span class="p">);</span>
  <span class="p">},</span>

<span class="mi">0</span><span class="o">:</span><span class="mi">0</span><span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="ifdef-test_suite">
  <h1>
    <a href="#ifdef-test_suite" class="pilcrow">&#182;</a>
    ifdef TEST_SUITE
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">testSuite</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tests</span><span class="p">){</span>
  <span class="kd">var</span> <span class="nx">ok</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">fail</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">start</span> <span class="o">=</span> <span class="o">+</span><span class="k">new</span> <span class="nb">Date</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">tests</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">test</span> <span class="o">=</span> <span class="nx">tests</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">input</span> <span class="o">=</span> <span class="nx">test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">desc</span> <span class="o">=</span> <span class="nx">test</span><span class="p">[</span><span class="nx">test</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="nx">stack</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">try</span> <span class="p">{</span>
      <span class="k">new</span> <span class="nx">ZeParser</span><span class="p">(</span><span class="nx">input</span><span class="p">,</span> <span class="k">new</span> <span class="nx">Tokenizer</span><span class="p">(</span><span class="nx">input</span><span class="p">),</span> <span class="nx">stack</span><span class="p">).</span><span class="nx">parse</span><span class="p">();</span>
      <span class="o">++</span><span class="nx">ok</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="o">++</span><span class="nx">fail</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;Ze parser test suite finished (&#39;</span><span class="o">+</span><span class="p">(</span><span class="o">+</span><span class="k">new</span> <span class="nb">Date</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; ms). ok:&#39;</span><span class="o">+</span><span class="nx">ok</span><span class="o">+</span><span class="s1">&#39;, fail:&#39;</span><span class="o">+</span><span class="nx">fail</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="endif">
  <h1>
    <a href="#endif" class="pilcrow">&#182;</a>
    endif
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexLhsStart</span> <span class="o">=</span> <span class="sr">/[\+\-\~\!\(\{\[]/</span><span class="p">;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-174" id="section-174">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>ZeParser.regexStartKeyword = /[bcdefinrstvw]/;
ZeParser.regexKeyword = /^break$|^catch$|^continue$|^debugger$|^default$|^delete$|^do$|^else$|^finally$|^for$|^function$|^if$|^in$|^instanceof$|^new$|^return$|^switch$|^this$|^throw$|^try$|^typeof$|^var$|^void$|^while$|^with$/;
ZeParser.regexStartReserved = /[ceis]/;
ZeParser.regexReserved = /^class$|^const$|^enum$|^export$|^extends$|^import$|^super$/;</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexStartKeyOrReserved</span> <span class="o">=</span> <span class="sr">/[bcdefinrstvw]/</span><span class="p">;</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">hashStartKeyOrReserved</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="o">?</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="nx">b</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">c</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">d</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">e</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">f</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">i</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">n</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">r</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">s</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">t</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">v</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">w</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">}})</span> <span class="o">:</span> <span class="p">{</span><span class="nx">b</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">c</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">d</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">e</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">f</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">i</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">n</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">r</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">s</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">t</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">v</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">w</span><span class="o">:</span><span class="mi">1</span><span class="p">};</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexIsKeywordOrReserved</span> <span class="o">=</span> <span class="sr">/^break$|^catch$|^continue$|^debugger$|^default$|^delete$|^do$|^else$|^finally$|^for$|^function$|^if$|^in$|^instanceof$|^new$|^return$|^switch$|^case$|^this$|^true$|^false$|^null$|^throw$|^try$|^typeof$|^var$|^void$|^while$|^with$|^class$|^const$|^enum$|^export$|^extends$|^import$|^super$/</span><span class="p">;</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexAssignments</span> <span class="o">=</span> <span class="sr">/^[\+\-\*\%\&amp;\|\^\/]?=$|^\&lt;\&lt;\=$|^\&gt;{2,3}\=$/</span><span class="p">;</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexNonAssignmentBinaryExpressionOperators</span> <span class="o">=</span> <span class="sr">/^[\+\-\*\%\|\^\&amp;\?\/]$|^[\&lt;\&gt;]\=?$|^[\=\!]\=\=?$|^\&lt;\&lt;|\&gt;\&gt;\&gt;?$|^\&amp;\&amp;$|^\|\|$/</span><span class="p">;</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexUnaryKeywords</span> <span class="o">=</span> <span class="sr">/^delete$|^void$|^typeof$|^new$/</span><span class="p">;</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">hashUnaryKeywordStart</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span> <span class="o">?</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span><span class="nx">d</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">v</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">t</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">n</span><span class="o">:</span><span class="p">{</span><span class="nx">value</span><span class="o">:</span><span class="mi">1</span><span class="p">}})</span> <span class="o">:</span> <span class="p">{</span><span class="nx">d</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">v</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">t</span><span class="o">:</span><span class="mi">1</span><span class="p">,</span><span class="nx">n</span><span class="o">:</span><span class="mi">1</span><span class="p">};</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexUnaryOperators</span> <span class="o">=</span> <span class="sr">/[\+\-\~\!]/</span><span class="p">;</span>
<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">regexLiteralKeywords</span> <span class="o">=</span> <span class="sr">/^this$|^null$|^true$|^false$/</span><span class="p">;</span>

<span class="nx">ZeParser</span><span class="p">.</span><span class="nb">Error</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">match</span><span class="p">){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-175" id="section-175">&#182;</a>
</div>
<p>if (type == 'BreakOrContinueArgMustBeJustIdentifier') throw here;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">this</span><span class="p">.</span><span class="nx">msg</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">Errors</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">msg</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">before</span> <span class="o">=</span> <span class="nx">ZeParser</span><span class="p">.</span><span class="nx">Errors</span><span class="p">[</span><span class="nx">type</span><span class="p">].</span><span class="nx">before</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">match</span> <span class="o">=</span> <span class="nx">match</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">ZeParser</span><span class="p">.</span><span class="nx">Errors</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">NoASI</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected semi-colon, was unable to apply ASI&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedAnotherExpressionComma</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;expecting another (left hand sided) expression after the comma&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedAnotherExpressionRhs</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s2">&quot;expected a rhs expression&quot;</span><span class="p">},</span>
  <span class="nx">UnclosedGroupingOperator</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s2">&quot;Unclosed grouping operator&quot;</span><span class="p">},</span>
  <span class="nx">GroupingShouldStartWithExpression</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The grouping operator (`(`) should start with a left hand sided expression&#39;</span><span class="p">},</span>
  <span class="nx">ArrayShouldStartWithExpression</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The array literal (`[`) should start with a left hand sided expression&#39;</span><span class="p">},</span>
  <span class="nx">UnclosedPropertyBracket</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Property bracket was not closed after expression (expecting `]`)&#39;</span><span class="p">},</span>
  <span class="nx">IllegalPropertyNameToken</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Object literal property names can only be assigned as strings, numbers or identifiers&#39;</span><span class="p">},</span>
  <span class="nx">IllegalGetterSetterNameToken</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Name of a getter/setter can only be assigned as strings, numbers or identifiers&#39;</span><span class="p">},</span>
  <span class="nx">GetterSetterNameFollowedByOpenParen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The name of the getter/setter should immediately be followed by the opening parenthesis `(`&#39;</span><span class="p">},</span>
  <span class="nx">GetterHasNoArguments</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The opening parenthesis `(` of the getter should be immediately followed by the closing parenthesis `)`, the getter cannot have an argument&#39;</span><span class="p">},</span>
  <span class="nx">IllegalSetterArgumentNameToken</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expecting the name of the argument of a setter, can only be assigned as strings, numbers or identifiers&#39;</span><span class="p">},</span>
  <span class="nx">SettersOnlyGetOneArgument</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Setters have one and only one argument, missing the closing parenthesis `)`&#39;</span><span class="p">},</span>
  <span class="nx">SetterHeaderShouldHaveClosingParen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;After the first argument of a setter should come a closing parenthesis `)`&#39;</span><span class="p">},</span>
  <span class="nx">SettersMustHaveArgument</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Setters must have exactly one argument defined&#39;</span><span class="p">},</span>
  <span class="nx">UnclosedObjectLiteral</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected to find a comma `,` for the next expression or a closing curly brace `}` to end the object literal&#39;</span><span class="p">},</span>
  <span class="nx">FunctionNameMustNotBeReserved</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Function name may not be a keyword or a reserved word&#39;</span><span class="p">},</span>
  <span class="nx">ExpressionMayNotStartWithKeyword</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expressions may not start with keywords or reserved words that are not in this list: [this, null, true, false, void, typeof, delete, new]&#39;</span><span class="p">},</span>
  <span class="nx">LabelsMayOnlyBeIdentifiers</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Label names may only be defined as an identifier&#39;</span><span class="p">},</span>
  <span class="nx">LabelsMayNotBeReserved</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Labels may not be a keyword or a reserved word&#39;</span><span class="p">},</span>
  <span class="nx">UnknownToken</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Unknown token encountered, dont know how to proceed&#39;</span><span class="p">},</span>
  <span class="nx">PropertyNamesMayOnlyBeIdentifiers</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The tokens of property names accessed through the dot operator may only be identifiers&#39;</span><span class="p">},</span>
  <span class="nx">SquareBracketExpectsExpression</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The square bracket property access expects an expression&#39;</span><span class="p">},</span>
  <span class="nx">SquareBracketsMayNotBeEmpty</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Square brackets may never be empty, expecting an expression&#39;</span><span class="p">},</span>
  <span class="nx">UnclosedSquareBrackets</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Unclosed square bracket encountered, was expecting `]` after the expression&#39;</span><span class="p">},</span>
  <span class="nx">UnclosedCallParens</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Unclosed call parenthesis, expecting `)` after the optional expression&#39;</span><span class="p">},</span>
  <span class="nx">InvalidCenterTernaryExpression</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Center expression of ternary operator should be a regular expression (but may not contain the comma operator directly)&#39;</span><span class="p">},</span>
  <span class="nx">UnfinishedTernaryOperator</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Encountered a ternary operator start (`?`) but did not find the required colon (`:`) after the center expression&#39;</span><span class="p">},</span>
  <span class="nx">TernarySecondExpressionCanNotContainComma</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The second and third expressions of the ternary operator can/may not &quot;directly&quot; contain a comma operator&#39;</span><span class="p">},</span>
  <span class="nx">InvalidRhsExpression</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected a right hand side expression after the operator (which should also be a valid lhs) but did not find one&#39;</span><span class="p">},</span>
  <span class="nx">FunctionDeclarationsMustHaveName</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Function declaration must have name&#39;</span><span class="p">},</span>
  <span class="nx">FunctionNameMayNotBeReserved</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Function name may not be a keyword or reserved word&#39;</span><span class="p">},</span>
  <span class="nx">ExpectingFunctionHeaderStart</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected the opening parenthesis of the function header&#39;</span><span class="p">},</span>
  <span class="nx">FunctionArgumentsCanNotBeReserved</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Function arguments may not be keywords or reserved words&#39;</span><span class="p">},</span>
  <span class="nx">FunctionParametersMustBeIdentifiers</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Function arguments must be identifiers&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedFunctionHeaderClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected the closing parenthesis `)` of the function header&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedFunctionBodyCurlyOpen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected the opening curly brace `{` for the function body&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedFunctionBodyCurlyClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected the closing curly brace `}` for the function body&#39;</span><span class="p">},</span>
  <span class="nx">VarNamesMayOnlyBeIdentifiers</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing variable name, must be a proper identifier&#39;</span><span class="p">},</span>
  <span class="nx">VarNamesCanNotBeReserved</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Variable names may not be keywords or reserved words&#39;</span><span class="p">},</span>
  <span class="nx">VarInitialiserExpressionExpected</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The initialiser of the variable statement should be an expression without comma&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedStatementHeaderOpen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected opening parenthesis `(` for statement header&#39;</span><span class="p">},</span>
  <span class="nx">StatementHeaderIsNotOptional</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Statement header must not be empty&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedStatementHeaderClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected closing parenthesis `)` for statement header&#39;</span><span class="p">},</span>
  <span class="nx">DoShouldBeFollowedByWhile</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The do-while statement requires the `while` keyword after the expression&#39;</span><span class="p">},</span>
  <span class="nx">ExpectedSecondSemiOfForHeader</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected the second semi-colon of the for-each header&#39;</span><span class="p">},</span>
  <span class="nx">ForHeaderShouldHaveSemisOrIn</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The for-header should contain at least the `in` operator or two semi-colons (`;`)&#39;</span><span class="p">},</span>
  <span class="nx">SwitchBodyStartsWithCurly</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The body of a switch statement starts with a curly brace `{`&#39;</span><span class="p">},</span>
  <span class="nx">SwitchClausesEndWithColon</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Switch clauses (`case` and `default`) end with a colon (`:`)&#39;</span><span class="p">},</span>
  <span class="nx">SwitchCannotHaveDoubleDefault</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Switches cannot have more than one `default` clause&#39;</span><span class="p">},</span>
  <span class="nx">SwitchBodyEndsWithCurly</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The body of a switch statement ends with a curly brace `}`&#39;</span><span class="p">},</span>
  <span class="nx">MissingTryBlockCurlyOpen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the opening curly brace (`{`) for the block of the try statement&#39;</span><span class="p">},</span>
  <span class="nx">MissingTryBlockCurlyClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the closing curly brace (`}`) for the block of the try statement&#39;</span><span class="p">},</span>
  <span class="nx">CatchHeaderMissingOpen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the opening parenthesis of the catch header&#39;</span><span class="p">},</span>
  <span class="nx">MissingCatchParameter</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Catch clauses should have exactly one argument which will be bound to the error object being thrown&#39;</span><span class="p">},</span>
  <span class="nx">CatchParameterNameMayNotBeReserved</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Catch clause parameter may not be a keyword or reserved word&#39;</span><span class="p">},</span>
  <span class="nx">CatchHeaderMissingClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the closing parenthesis of the catch header&#39;</span><span class="p">},</span>
  <span class="nx">MissingCatchBlockCurlyOpen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the opening curly brace (`{`) for the block of the catch statement&#39;</span><span class="p">},</span>
  <span class="nx">MissingCatchBlockCurlyClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the closing curly brace (`}`) for the block of the catch statement&#39;</span><span class="p">},</span>
  <span class="nx">MissingFinallyBlockCurlyOpen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the opening curly brace (`{`) for the block of the finally statement&#39;</span><span class="p">},</span>
  <span class="nx">MissingFinallyBlockCurlyClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing the closing curly brace (`}`) for the block of the finally statement&#39;</span><span class="p">},</span>
  <span class="nx">StatementMayNotStartWithFunction</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;statements may not start with function...&#39;</span><span class="p">,</span> <span class="nx">before</span><span class="o">:</span><span class="kc">true</span><span class="p">},</span>
  <span class="nx">BlockCurlyClose</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected the closing curly (`}`) for a block statement&#39;</span><span class="p">},</span>
  <span class="nx">BlockCurlyOpen</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Expected the closing curly (`}`) for a block statement&#39;</span><span class="p">},</span>
  <span class="nx">UnableToParseStatement</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Was unable to find a statement when it was requested&#39;</span><span class="p">},</span>
  <span class="nx">IllegalDoubleCommaInObjectLiteral</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;A double comma in object literals is not allowed&#39;</span><span class="p">},</span>
  <span class="nx">ObjectLiteralExpectsColonAfterName</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;After every property name (identifier, string or number) a colon (`:`) should follow&#39;</span><span class="p">},</span>
  <span class="nx">ThrowMustHaveArgument</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The expression argument for throw is not optional&#39;</span><span class="p">},</span>
  <span class="nx">ThrowCannotHaveReturn</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;There may not be a return between throw and the start of its expression argument&#39;</span><span class="p">},</span>
  <span class="nx">SwitchBodyMustStartWithClause</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The body of a switch clause must start with at a case or default clause (but may be empty, which would be silly)&#39;</span><span class="p">},</span>
  <span class="nx">BreakOrContinueArgMustBeJustIdentifier</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The argument to a break or continue statement must be exactly and only an identifier (an existing label)&#39;</span><span class="p">},</span>
  <span class="nx">AssignmentNotAllowedAfterNonAssignmentInExpression</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;An assignment is not allowed if it is preceeded by a non-expression operator in the same expression-level&#39;</span><span class="p">},</span>
  <span class="nx">IllegalLhsForAssignment</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Illegal left hand side for assignment (you cannot assign to things like string literals, number literals or function calls}&#39;</span><span class="p">},</span>
  <span class="nx">VarKeywordMissingName</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Var keyword should be followed by a variable name&#39;</span><span class="p">},</span>
  <span class="nx">IllegalTrailingComma</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Illegal trailing comma found&#39;</span><span class="p">},</span>
  <span class="nx">ObjectLiteralMissingPropertyValue</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Missing object literal property value&#39;</span><span class="p">},</span>
  <span class="nx">TokenizerError</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Tokenizer encountered unexpected input&#39;</span><span class="p">},</span>
  <span class="nx">LabelRequiresStatement</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Saw a label without the (required) statement following&#39;</span><span class="p">},</span>
  <span class="nx">DidNotExpectElseHere</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Did not expect an else here. To what if should it belong? Maybe you put a ; after the if-block? (if(x){};else{})&#39;</span><span class="p">},</span>
  <span class="nx">UnexpectedToken</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Found an unexpected token and have no idea why&#39;</span><span class="p">},</span>
  <span class="nx">InvalidPostfixOperandArray</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;You cannot apply ++ or -- to an array&#39;</span><span class="p">},</span>
  <span class="nx">InvalidPostfixOperandObject</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;You cannot apply ++ or -- to an object&#39;</span><span class="p">},</span>
  <span class="nx">InvalidPostfixOperandFunction</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;You cannot apply ++ or -- to a function&#39;</span><span class="p">},</span>
  <span class="nx">CaseMissingExpression</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Case expects an expression before the colon&#39;</span><span class="p">},</span>
  <span class="nx">TryMustHaveCatchOrFinally</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;The try statement must have a catch or finally block&#39;</span><span class="p">},</span>
  <span class="nx">UnexpectedInputSwitch</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;Unexpected input while parsing a switch clause...&#39;</span><span class="p">},</span>
  <span class="nx">ForInCanOnlyDeclareOnVar</span><span class="o">:</span> <span class="p">{</span><span class="nx">msg</span><span class="o">:</span><span class="s1">&#39;For-in header can only introduce one new variable&#39;</span><span class="p">}</span>
<span class="p">};</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
