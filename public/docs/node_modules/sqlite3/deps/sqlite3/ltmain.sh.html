<!DOCTYPE html>
<html>
<head>
  <title>ltmain.sh</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../", thisFile = "node_modules/sqlite3/deps/sqlite3/ltmain.sh", defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h6">
        <a href="#-">#</a>
      </div>
      <div class="heading h1">
        <a href="#okay-now-we-have-a-bunch-of-thin-objects--gotta-fatten-them-up---">Okay now we have a bunch of thin objects, gotta fatten them up :)</a>
      </div>
      <div class="heading h6">
        <a href="#-">#</a>
      </div>
      <div class="heading h3">
        <a href="#begin-libtool-tag-config--disable-shared">BEGIN LIBTOOL TAG CONFIG: disable-shared</a>
      </div>
      <div class="heading h3">
        <a href="#end-libtool-tag-config--disable-shared">END LIBTOOL TAG CONFIG: disable-shared</a>
      </div>
      <div class="heading h3">
        <a href="#begin-libtool-tag-config--disable-static">BEGIN LIBTOOL TAG CONFIG: disable-static</a>
      </div>
      <div class="heading h3">
        <a href="#end-libtool-tag-config--disable-static">END LIBTOOL TAG CONFIG: disable-static</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>ltmain.sh</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>
<p>ltmain.sh - Provide generalized library-building support services.
NOTE: Changing this file will not affect anything until you rerun configure.</p>

<p>Copyright (C) 1996, 1997, 1998, 1999, 2000, 2001, 2003, 2004, 2005, 2006,
2007  Free Software Foundation, Inc.
Originally by Gordon Matzigkeit <a href="&#109;&#97;&#105;&#x6C;&#116;&#x6F;:&#103;&#x6F;&#x72;&#x64;&#64;&#103;&#110;&#117;&#x2E;&#97;&#105;&#x2E;&#109;&#105;&#x74;&#46;&#x65;&#100;&#117;">&#103;&#x6F;&#x72;&#x64;&#64;&#103;&#110;&#117;&#x2E;&#97;&#105;&#x2E;&#109;&#105;&#x74;&#46;&#x65;&#100;&#117;</a>, 1996</p>

<p>This program is free software; you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation; either version 2 of the License, or
(at your option) any later version.</p>

<p>This program is distributed in the hope that it will be useful, but
WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
General Public License for more details.</p>

<p>You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</p>

<p>As a special exception to the GNU General Public License, if you
distribute this file as part of a program that contains a
configuration script generated by Autoconf, you may include it under
the same distribution terms that you use for the rest of that program.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="nv">basename</span><span class="o">=</span><span class="s2">&quot;s,^.*/,,g&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Work around backward compatibility issue on IRIX 6.5. On IRIX 6.4+, sh
is ksh but when the shell is invoked as "sh" and the current value of
the _XPG environment variable is not equal to 1 (one), the special
positional parameter $0, within a function call, is the name of the
function.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">progpath</span><span class="o">=</span><span class="s2">&quot;$0&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>The name of this program:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">progname</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;$progpath&quot;</span> | <span class="nv">$SED</span> <span class="nv">$basename</span><span class="sb">`</span>
<span class="nv">modename</span><span class="o">=</span><span class="s2">&quot;$progname&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>Global variables:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">EXIT_SUCCESS</span><span class="o">=</span>0
<span class="nv">EXIT_FAILURE</span><span class="o">=</span>1

<span class="nv">PROGRAM</span><span class="o">=</span>ltmain.sh
<span class="nv">PACKAGE</span><span class="o">=</span>libtool
<span class="nv">VERSION</span><span class="o">=</span>1.5.24
<span class="nv">TIMESTAMP</span><span class="o">=</span><span class="s2">&quot; (1.1220.2.455 2007/06/24 02:13:29)&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Be Bourne compatible (taken from Autoconf:_AS_BOURNE_COMPATIBLE).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;${ZSH_VERSION+set}&quot;</span> <span class="o">&amp;&amp;</span> <span class="o">(</span>emulate sh<span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
<span class="k">  </span>emulate sh
  <span class="nv">NULLCMD</span><span class="o">=</span>:

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Zsh 3.x and 4.x performs word splitting on ${1+"$@"}, which
is contrary to our usage.  Disable this feature.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">alias</span> -g <span class="s1">&#39;${1+&quot;$@&quot;}&#39;</span><span class="o">=</span><span class="s1">&#39;&quot;$@&quot;&#39;</span>
  setopt NO_GLOB_SUBST
<span class="k">else</span>
<span class="k">  case</span> <span class="sb">`</span><span class="o">(</span><span class="nb">set</span> -o<span class="o">)</span> 2&gt;/dev/null<span class="sb">`</span> in *posix*<span class="o">)</span> <span class="nb">set</span> -o posix;; <span class="k">esac</span>
<span class="k">fi</span>
<span class="nv">BIN_SH</span><span class="o">=</span>xpg4; <span class="nb">export </span>BIN_SH <span class="c"># for Tru64</span>
<span class="nv">DUALCASE</span><span class="o">=</span>1; <span class="nb">export </span>DUALCASE <span class="c"># for MKS sh</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Check that we have a working $echo.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$1&quot;</span> <span class="o">=</span> X--no-reexec; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Discard the --no-reexec flag, and continue.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">shift</span>
<span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;X$1&quot;</span> <span class="o">=</span> X--fallback-echo; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Avoid inline document here, it may be left over</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  :
<span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;X`($echo &#39;\t&#39;) 2&gt;/dev/null`&quot;</span> <span class="o">=</span> <span class="s1">&#39;X\t&#39;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>Yippee, $echo works!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  :
<span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Restart under the correct shell, and then maybe $echo will work.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">exec</span> <span class="nv">$SHELL</span> <span class="s2">&quot;$progpath&quot;</span> --no-reexec <span class="k">${</span><span class="nv">1</span><span class="p">+</span><span class="s2">&quot;$@&quot;</span><span class="k">}</span>
<span class="k">fi</span>

<span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$1&quot;</span> <span class="o">=</span> X--fallback-echo; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>used as fallback echo</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">shift</span>
<span class="nb">  </span>cat <span class="s">&lt;&lt;EOF</span>
<span class="s">$*</span>
<span class="s">EOF</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
<span class="k">fi</span>

<span class="nv">default_mode</span><span class="o">=</span>
<span class="nb">help</span><span class="o">=</span><span class="s2">&quot;Try \`$progname --help&#39; for more information.&quot;</span>
<span class="nv">magic</span><span class="o">=</span><span class="s2">&quot;%%%MAGIC variable%%%&quot;</span>
<span class="nv">mkdir</span><span class="o">=</span><span class="s2">&quot;mkdir&quot;</span>
<span class="nv">mv</span><span class="o">=</span><span class="s2">&quot;mv -f&quot;</span>
<span class="nv">rm</span><span class="o">=</span><span class="s2">&quot;rm -f&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Sed substitution that helps us do robust quoting.  It backslashifies
metacharacters that are still active within double-quoted strings.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">Xsed</span><span class="o">=</span><span class="s2">&quot;${SED}&quot;</span><span class="s1">&#39; -e 1s/^X//&#39;</span>
<span class="nv">sed_quote_subst</span><span class="o">=</span><span class="s1">&#39;s/\([\\`\\&quot;$\\\\]\)/\\\1/g&#39;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>test EBCDIC or ASCII</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">case</span> <span class="sb">`</span><span class="nb">echo </span>X|tr X <span class="s1">&#39;\101&#39;</span><span class="sb">`</span> in
 A<span class="o">)</span> <span class="c"># ASCII based system</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>\n is not interpreted correctly by Solaris 8 /usr/ucb/tr</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">SP2NL</span><span class="o">=</span><span class="s1">&#39;tr \040 \012&#39;</span>
  <span class="nv">NL2SP</span><span class="o">=</span><span class="s1">&#39;tr \015\012 \040\040&#39;</span>
  ;;
 *<span class="o">)</span> <span class="c"># EBCDIC based system</span>
  <span class="nv">SP2NL</span><span class="o">=</span><span class="s1">&#39;tr \100 \n&#39;</span>
  <span class="nv">NL2SP</span><span class="o">=</span><span class="s1">&#39;tr \r\n \100\100&#39;</span>
  ;;
<span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>NLS nuisances.
Only set LANG and LC_ALL to C if already set.
These must not be set unconditionally because not all systems understand
e.g. LANG=C (notably SCO).
We save the old values to restore during execute mode.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">for </span>lt_var in LANG LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
<span class="k">do</span>
<span class="k">  </span><span class="nb">eval</span> <span class="s2">&quot;if test \&quot;\${$lt_var+set}\&quot; = set; then</span>
<span class="s2">    save_$lt_var=\$$lt_var</span>
<span class="s2">    $lt_var=C</span>
<span class="s2">    export $lt_var</span>
<span class="s2">  fi&quot;</span>
<span class="k">done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Make sure IFS has a sensible default</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">lt_nl</span><span class="o">=</span><span class="s1">&#39;</span>
<span class="s1">&#39;</span>
<span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;   $lt_nl&quot;</span>

<span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> !<span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: not configured to build any kind of library&quot;</span> 1&gt;&amp;2
  <span class="nv">$echo</span> <span class="s2">&quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot;</span> 1&gt;&amp;2
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
<span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Global variables.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">mode</span><span class="o">=</span><span class="nv">$default_mode</span>
<span class="nv">nonopt</span><span class="o">=</span>
<span class="nv">prev</span><span class="o">=</span>
<span class="nv">prevopt</span><span class="o">=</span>
<span class="nv">run</span><span class="o">=</span>
<span class="nv">show</span><span class="o">=</span><span class="s2">&quot;$echo&quot;</span>
<span class="nv">show_help</span><span class="o">=</span>
<span class="nv">execute_dlfiles</span><span class="o">=</span>
<span class="nv">duplicate_deps</span><span class="o">=</span>no
<span class="nv">preserve_args</span><span class="o">=</span>
<span class="nv">lo2o</span><span class="o">=</span><span class="s2">&quot;s/\\.lo\$/.${objext}/&quot;</span>
<span class="nv">o2lo</span><span class="o">=</span><span class="s2">&quot;s/\\.${objext}\$/.lo/&quot;</span>
<span class="nv">extracted_archives</span><span class="o">=</span>
<span class="nv">extracted_serial</span><span class="o">=</span>0


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="-">
  <h6>
    <a href="#-" class="pilcrow">&#182;</a>
    #
  </h6>
</div>


<p>Shell function definitions:
This seems to be the best place for them</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>func_mktempdir [string]
Make a temporary directory that won't clash with other running
libtool processes, and avoids race conditions if possible.  If
given, STRING is the basename for that directory.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
func_mktempdir <span class="o">()</span>
<span class="o">{</span>
    <span class="nv">my_template</span><span class="o">=</span><span class="s2">&quot;${TMPDIR-/tmp}/${1-$progname}&quot;</span>

    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$run&quot;</span> <span class="o">=</span> <span class="s2">&quot;:&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Return a directory name, but don't create it in dry-run mode</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">my_tmpdir</span><span class="o">=</span><span class="s2">&quot;${my_template}-$$&quot;</span>
    <span class="k">else</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>If mktemp works, use that first and foremost</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">my_tmpdir</span><span class="o">=</span><span class="sb">`</span>mktemp -d <span class="s2">&quot;${my_template}-XXXXXXXX&quot;</span> 2&gt;/dev/null<span class="sb">`</span>

      <span class="k">if </span><span class="nb">test</span> ! -d <span class="s2">&quot;$my_tmpdir&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>Failing that, at least try and use $RANDOM to avoid a race</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">my_tmpdir</span><span class="o">=</span><span class="s2">&quot;${my_template}-${RANDOM-0}$$&quot;</span>

  <span class="nv">save_mktempdir_umask</span><span class="o">=</span><span class="sb">`</span><span class="nb">umask</span><span class="sb">`</span>
  <span class="nb">umask </span>0077
  <span class="nv">$mkdir</span> <span class="s2">&quot;$my_tmpdir&quot;</span>
  <span class="nb">umask</span> <span class="nv">$save_mktempdir_umask</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>If we're not in dry-run mode, bomb out on failure</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -d <span class="s2">&quot;$my_tmpdir&quot;</span> <span class="o">||</span> <span class="o">{</span>
        <span class="nv">$echo</span> <span class="s2">&quot;cannot create temporary directory \`$my_tmpdir&#39;&quot;</span> 1&gt;&amp;2
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="o">}</span>
    <span class="k">fi</span>

    <span class="nv">$echo</span> <span class="s2">&quot;X$my_tmpdir&quot;</span> | <span class="nv">$Xsed</span>
<span class="o">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>func_win32_libid arg
return the library type of file 'arg'</p>

<p>Need a lot of goo to handle <em>both</em> DLLs and import libs
Has to be a shell function in order to 'eat' the argument
that is supplied when $file_magic_command is called.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
func_win32_libid <span class="o">()</span>
<span class="o">{</span>
  <span class="nv">win32_libid_type</span><span class="o">=</span><span class="s2">&quot;unknown&quot;</span>
  <span class="nv">win32_fileres</span><span class="o">=</span><span class="sb">`</span>file -L <span class="nv">$1</span> 2&gt;/dev/null<span class="sb">`</span>
  <span class="k">case</span> <span class="nv">$win32_fileres</span> in
  *ar<span class="se">\ </span>archive<span class="se">\ </span>import<span class="se">\ </span>library*<span class="o">)</span> <span class="c"># definitely import</span>
    <span class="nv">win32_libid_type</span><span class="o">=</span><span class="s2">&quot;x86 archive import&quot;</span>
    ;;
  *ar<span class="se">\ </span>archive*<span class="o">)</span> <span class="c"># could be an import, or static</span>
    <span class="k">if </span><span class="nb">eval</span> <span class="nv">$OBJDUMP</span> -f <span class="nv">$1</span> | <span class="nv">$SED</span> -e <span class="s1">&#39;10q&#39;</span> 2&gt;/dev/null | <span class="se">\</span>
      <span class="nv">$EGREP</span> -e <span class="s1">&#39;file format pe-i386(.*architecture: i386)?&#39;</span> &gt;/dev/null ; <span class="k">then</span>
<span class="k">      </span><span class="nv">win32_nmres</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="nv">$NM</span> -f posix -A <span class="nv">$1</span> | <span class="se">\</span>
  <span class="nv">$SED</span> -n -e <span class="s1">&#39;1,100{</span>
<span class="s1">    / I /{</span>
<span class="s1">      s,.*,import,</span>
<span class="s1">      p</span>
<span class="s1">      q</span>
<span class="s1">      }</span>
<span class="s1">    }&#39;</span><span class="sb">`</span>
      <span class="k">case</span> <span class="nv">$win32_nmres</span> in
      import*<span class="o">)</span>  <span class="nv">win32_libid_type</span><span class="o">=</span><span class="s2">&quot;x86 archive import&quot;</span>;;
      *<span class="o">)</span>        <span class="nv">win32_libid_type</span><span class="o">=</span><span class="s2">&quot;x86 archive static&quot;</span>;;
      <span class="k">esac</span>
<span class="k">    fi</span>
    ;;
  *DLL*<span class="o">)</span>
    <span class="nv">win32_libid_type</span><span class="o">=</span><span class="s2">&quot;x86 DLL&quot;</span>
    ;;
  *executable*<span class="o">)</span> <span class="c"># but shell scripts are &quot;executable&quot; too...</span>
    <span class="k">case</span> <span class="nv">$win32_fileres</span> in
    *MS<span class="se">\ </span>Windows<span class="se">\ </span>PE<span class="se">\ </span>Intel*<span class="o">)</span>
      <span class="nv">win32_libid_type</span><span class="o">=</span><span class="s2">&quot;x86 DLL&quot;</span>
      ;;
    <span class="k">esac</span>
    ;;
  <span class="k">esac</span>
  <span class="nv">$echo</span> <span class="nv">$win32_libid_type</span>
<span class="o">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>func_infer_tag arg
Infer tagged configuration to use if any are available and
if one wasn't chosen via the "--tag" command line option.
Only attempt this if the compiler in the base compile
command doesn't match the default compiler.
arg is usually of the form 'gcc ...'</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
func_infer_tag <span class="o">()</span>
<span class="o">{</span>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$available_tags&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -z <span class="s2">&quot;$tagname&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">CC_quoted</span><span class="o">=</span>
      <span class="k">for </span>arg in <span class="nv">$CC</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="nv">$arg</span> in
    *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
    <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;\&quot;$arg\&quot;&quot;</span>
    ;;
  <span class="k">esac</span>
<span class="k">  </span><span class="nv">CC_quoted</span><span class="o">=</span><span class="s2">&quot;$CC_quoted $arg&quot;</span>
      <span class="k">done</span>
<span class="k">      case</span> <span class="nv">$@</span> in

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Blanks in the command may have been stripped by the calling shell,
but not from the CC environment variable when configure was run.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="s2">&quot; $CC &quot;</span>* | <span class="s2">&quot;$CC &quot;</span>* | <span class="s2">&quot; `$echo $CC` &quot;</span>* | <span class="s2">&quot;`$echo $CC` &quot;</span>* | <span class="s2">&quot; $CC_quoted&quot;</span>* | <span class="s2">&quot;$CC_quoted &quot;</span>* | <span class="s2">&quot; `$echo $CC_quoted` &quot;</span>* | <span class="s2">&quot;`$echo $CC_quoted` &quot;</span>*<span class="o">)</span> ;;

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>Blanks at the start of $base_compile will cause this to fail
if we don't check for them as well.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      *<span class="o">)</span>
  <span class="k">for </span>z in <span class="nv">$available_tags</span>; <span class="k">do</span>
<span class="k">    if </span>grep <span class="s2">&quot;^# ### BEGIN LIBTOOL TAG CONFIG: $z$&quot;</span> &lt; <span class="s2">&quot;$progpath&quot;</span> &gt; /dev/null; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Evaluate the configuration.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">eval</span> <span class="s2">&quot;`${SED} -n -e &#39;/^# ### BEGIN LIBTOOL TAG CONFIG: &#39;$z&#39;$/,/^# ### END LIBTOOL TAG CONFIG: &#39;$z&#39;$/p&#39; &lt; $progpath`&quot;</span>
      <span class="nv">CC_quoted</span><span class="o">=</span>
      <span class="k">for </span>arg in <span class="nv">$CC</span>; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>Double-quote args containing other shell metacharacters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$arg</span> in
        *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
        <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;\&quot;$arg\&quot;&quot;</span>
        ;;
      <span class="k">esac</span>
<span class="k">      </span><span class="nv">CC_quoted</span><span class="o">=</span><span class="s2">&quot;$CC_quoted $arg&quot;</span>
    <span class="k">done</span>
<span class="k">      case</span> <span class="s2">&quot;$@ &quot;</span> in
        <span class="s2">&quot; $CC &quot;</span>* | <span class="s2">&quot;$CC &quot;</span>* | <span class="s2">&quot; `$echo $CC` &quot;</span>* | <span class="s2">&quot;`$echo $CC` &quot;</span>* | <span class="s2">&quot; $CC_quoted&quot;</span>* | <span class="s2">&quot;$CC_quoted &quot;</span>* | <span class="s2">&quot; `$echo $CC_quoted` &quot;</span>* | <span class="s2">&quot;`$echo $CC_quoted` &quot;</span>*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>The compiler in the base compile command matches
the one in the tagged configuration.
Assume this is the tagged configuration we want.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">tagname</span><span class="o">=</span><span class="nv">$z</span>
        <span class="nb">break</span>
        ;;
      <span class="k">esac</span>
<span class="k">    fi</span>
<span class="k">  done</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>If $tagname still isn't set, then no tagged configuration
was found and let the user know that the "--tag" command
line option must be used.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$tagname&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: unable to infer tagged configuration&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: specify a tag with \`--tag&#39;&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>

<div class="highlight"><pre><code>   <span class="k">else</span>
     <span class="err">$</span><span class="n">echo</span> <span class="s">&quot;$modename: using $tagname tagged configuration&quot;</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">fi</span>
  ;;
      <span class="k">esac</span>
<span class="k">    fi</span>
<span class="o">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34">&#182;</a>
</div>
<p>func_extract_an_archive dir oldlib</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
func_extract_an_archive <span class="o">()</span>
<span class="o">{</span>
    <span class="nv">f_ex_an_ar_dir</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>; <span class="nb">shift</span>
<span class="nb">    </span><span class="nv">f_ex_an_ar_oldlib</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>

    <span class="nv">$show</span> <span class="s2">&quot;(cd $f_ex_an_ar_dir &amp;&amp; $AR x $f_ex_an_ar_oldlib)&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;(cd \$f_ex_an_ar_dir &amp;&amp; $AR x \$f_ex_an_ar_oldlib)&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
    <span class="k">if</span> <span class="o">(</span><span class="nv">$AR</span> t <span class="s2">&quot;$f_ex_an_ar_oldlib&quot;</span> | sort | sort -uc &gt;/dev/null 2&gt;&amp;1<span class="o">)</span>; <span class="k">then</span>
     :
    <span class="k">else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: ERROR: object name conflicts: $f_ex_an_ar_dir/$f_ex_an_ar_oldlib&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="o">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35">&#182;</a>
</div>
<p>func_extract_archives gentop oldlib ...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
func_extract_archives <span class="o">()</span>
<span class="o">{</span>
    <span class="nv">my_gentop</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>; <span class="nb">shift</span>
<span class="nb">    </span><span class="nv">my_oldlibs</span><span class="o">=</span><span class="k">${</span><span class="nv">1</span><span class="p">+</span><span class="s2">&quot;$@&quot;</span><span class="k">}</span>
    <span class="nv">my_oldobjs</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="nv">my_xlib</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="nv">my_xabs</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="nv">my_xdir</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="nv">my_status</span><span class="o">=</span><span class="s2">&quot;&quot;</span>

    <span class="nv">$show</span> <span class="s2">&quot;${rm}r $my_gentop&quot;</span>
    <span class="nv">$run</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="s2">&quot;$my_gentop&quot;</span>
    <span class="nv">$show</span> <span class="s2">&quot;$mkdir $my_gentop&quot;</span>
    <span class="nv">$run</span> <span class="nv">$mkdir</span> <span class="s2">&quot;$my_gentop&quot;</span>
    <span class="nv">my_status</span><span class="o">=</span><span class="nv">$?</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$my_status&quot;</span> -ne 0 <span class="o">&amp;&amp;</span> <span class="nb">test</span> ! -d <span class="s2">&quot;$my_gentop&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nb">exit</span> <span class="nv">$my_status</span>
    <span class="k">fi</span>

<span class="k">    for </span>my_xlib in <span class="nv">$my_oldlibs</span>; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36">&#182;</a>
</div>
<p>Extract the objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$my_xlib</span> in
  <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> <span class="nv">my_xabs</span><span class="o">=</span><span class="s2">&quot;$my_xlib&quot;</span> ;;
  *<span class="o">)</span> <span class="nv">my_xabs</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="s2">&quot;/$my_xlib&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">      </span><span class="nv">my_xlib</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$my_xlib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
      <span class="nv">my_xlib_u</span><span class="o">=</span><span class="nv">$my_xlib</span>
      <span class="k">while</span> :; <span class="k">do</span>
<span class="k">        case</span> <span class="s2">&quot; $extracted_archives &quot;</span> in
  *<span class="s2">&quot; $my_xlib_u &quot;</span>*<span class="o">)</span>
    <span class="nv">extracted_serial</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$extracted_serial</span> + 1<span class="sb">`</span>
    <span class="nv">my_xlib_u</span><span class="o">=</span>lt<span class="nv">$extracted_serial</span>-<span class="nv">$my_xlib</span> ;;
  *<span class="o">)</span> <span class="nb">break</span> ;;
  <span class="k">esac</span>
<span class="k">      done</span>
<span class="k">      </span><span class="nv">extracted_archives</span><span class="o">=</span><span class="s2">&quot;$extracted_archives $my_xlib_u&quot;</span>
      <span class="nv">my_xdir</span><span class="o">=</span><span class="s2">&quot;$my_gentop/$my_xlib_u&quot;</span>

      <span class="nv">$show</span> <span class="s2">&quot;${rm}r $my_xdir&quot;</span>
      <span class="nv">$run</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="s2">&quot;$my_xdir&quot;</span>
      <span class="nv">$show</span> <span class="s2">&quot;$mkdir $my_xdir&quot;</span>
      <span class="nv">$run</span> <span class="nv">$mkdir</span> <span class="s2">&quot;$my_xdir&quot;</span>
      <span class="nv">exit_status</span><span class="o">=</span><span class="nv">$?</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$exit_status&quot;</span> -ne 0 <span class="o">&amp;&amp;</span> <span class="nb">test</span> ! -d <span class="s2">&quot;$my_xdir&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">exit</span> <span class="nv">$exit_status</span>
      <span class="k">fi</span>
<span class="k">      case</span> <span class="nv">$host</span> in
      *-darwin*<span class="o">)</span>
  <span class="nv">$show</span> <span class="s2">&quot;Extracting $my_xabs&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<p>Do not bother doing anything if just a dry run</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">darwin_orig_dir</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
    <span class="nb">cd</span> <span class="nv">$my_xdir</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
    <span class="nv">darwin_archive</span><span class="o">=</span><span class="nv">$my_xabs</span>
    <span class="nv">darwin_curdir</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
    <span class="nv">darwin_base_archive</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$darwin_archive&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
    <span class="nv">darwin_arches</span><span class="o">=</span><span class="sb">`</span>lipo -info <span class="s2">&quot;$darwin_archive&quot;</span> 2&gt;/dev/null | <span class="nv">$EGREP</span> Architectures 2&gt;/dev/null<span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$darwin_arches&quot;</span>; <span class="k">then </span>
<span class="k">      </span><span class="nv">darwin_arches</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;$darwin_arches&quot;</span> | <span class="nv">$SED</span> -e <span class="s1">&#39;s/.*are://&#39;</span><span class="sb">`</span>
      <span class="nv">darwin_arch</span><span class="o">=</span>
      <span class="nv">$show</span> <span class="s2">&quot;$darwin_base_archive has multiple architectures $darwin_arches&quot;</span>
      <span class="k">for </span>darwin_arch in  <span class="nv">$darwin_arches</span> ; <span class="k">do</span>
<span class="k">        </span>mkdir -p <span class="s2">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;</span>
        lipo -thin <span class="nv">$darwin_arch</span> -output <span class="s2">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot;</span> <span class="s2">&quot;${darwin_archive}&quot;</span>
        <span class="nb">cd</span> <span class="s2">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}&quot;</span>
        func_extract_an_archive <span class="s2">&quot;`pwd`&quot;</span> <span class="s2">&quot;${darwin_base_archive}&quot;</span>
        <span class="nb">cd</span> <span class="s2">&quot;$darwin_curdir&quot;</span>
        <span class="nv">$rm</span> <span class="s2">&quot;unfat-$$/${darwin_base_archive}-${darwin_arch}/${darwin_base_archive}&quot;</span>
      <span class="k">done</span> <span class="c"># $darwin_arches</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="okay-now-we-have-a-bunch-of-thin-objects--gotta-fatten-them-up---">
  <h1>
    <a href="#okay-now-we-have-a-bunch-of-thin-objects--gotta-fatten-them-up---" class="pilcrow">&#182;</a>
    Okay now we have a bunch of thin objects, gotta fatten them up :)
  </h1>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">darwin_filelist</span><span class="o">=</span><span class="sb">`</span>find unfat-<span class="nv">$$</span> -type f -name <span class="se">\*</span>.o -print -o -name <span class="se">\*</span>.lo -print| xargs basename | sort -u | <span class="nv">$NL2SP</span><span class="sb">`</span>
      <span class="nv">darwin_file</span><span class="o">=</span>
      <span class="nv">darwin_files</span><span class="o">=</span>
      <span class="k">for </span>darwin_file in <span class="nv">$darwin_filelist</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">darwin_files</span><span class="o">=</span><span class="sb">`</span>find unfat-<span class="nv">$$</span> -name <span class="nv">$darwin_file</span> -print | <span class="nv">$NL2SP</span><span class="sb">`</span>
        lipo -create -output <span class="s2">&quot;$darwin_file&quot;</span> <span class="nv">$darwin_files</span>
      <span class="k">done</span> <span class="c"># $darwin_filelist</span>
      <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r unfat-<span class="nv">$$</span>
      <span class="nb">cd</span> <span class="s2">&quot;$darwin_orig_dir&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nb">cd</span> <span class="s2">&quot;$darwin_orig_dir&quot;</span>
      func_extract_an_archive <span class="s2">&quot;$my_xdir&quot;</span> <span class="s2">&quot;$my_xabs&quot;</span>
    <span class="k">fi</span> <span class="c"># $darwin_arches</span>
  <span class="k">fi</span> <span class="c"># $run</span>
  ;;
      *<span class="o">)</span>
        func_extract_an_archive <span class="s2">&quot;$my_xdir&quot;</span> <span class="s2">&quot;$my_xabs&quot;</span>
        ;;
      <span class="k">esac</span>
<span class="k">      </span><span class="nv">my_oldobjs</span><span class="o">=</span><span class="s2">&quot;$my_oldobjs &quot;</span><span class="sb">`</span>find <span class="nv">$my_xdir</span> -name <span class="se">\*</span>.<span class="nv">$objext</span> -print -o -name <span class="se">\*</span>.lo -print | <span class="nv">$NL2SP</span><span class="sb">`</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nv">func_extract_archives_result</span><span class="o">=</span><span class="s2">&quot;$my_oldobjs&quot;</span>
<span class="o">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><p>End of Shell function definitions</p>


<div class="pilwrap" id="-">
  <h6>
    <a href="#-" class="pilcrow">&#182;</a>
    #
  </h6>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40">&#182;</a>
</div>
<p>Darwin sucks</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nb">eval </span><span class="nv">std_shrext</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$shrext_cmds</span><span class="se">\&quot;</span>

<span class="nv">disable_libs</span><span class="o">=</span>no


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41">&#182;</a>
</div>
<p>Parse our command line options once, thoroughly.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">while </span><span class="nb">test</span> <span class="s2">&quot;$#&quot;</span> -gt 0
<span class="k">do</span>
<span class="k">  </span><span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>
  <span class="nb">shift</span>

<span class="nb">  </span><span class="k">case</span> <span class="nv">$arg</span> in
  -*<span class="o">=</span>*<span class="o">)</span> <span class="nv">optarg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/[-_a-zA-Z0-9]*=//&#39;</span><span class="sb">`</span> ;;
  *<span class="o">)</span> <span class="nv">optarg</span><span class="o">=</span> ;;
  <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42">&#182;</a>
</div>
<p>If the previous option needs an argument, assign it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$prev&quot;</span>; <span class="k">then</span>
<span class="k">    case</span> <span class="nv">$prev</span> in
    execute_dlfiles<span class="o">)</span>
      <span class="nv">execute_dlfiles</span><span class="o">=</span><span class="s2">&quot;$execute_dlfiles $arg&quot;</span>
      ;;
    tag<span class="o">)</span>
      <span class="nv">tagname</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
      <span class="nv">preserve_args</span><span class="o">=</span><span class="s2">&quot;${preserve_args}=$arg&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43">&#182;</a>
</div>
<p>Check whether tagname contains only valid characters</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$tagname</span> in
      *<span class="o">[</span>!-_A-Za-z0-9,/<span class="o">]</span>*<span class="o">)</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$progname: invalid tag name: $tagname&quot;</span> 1&gt;&amp;2
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  ;;
      <span class="k">esac</span>

<span class="k">      case</span> <span class="nv">$tagname</span> in
      CC<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44">&#182;</a>
</div>
<p>Don't test for the "default" C tag, as we know, it's there, but
not specially marked.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  ;;
      *<span class="o">)</span>
  <span class="k">if </span>grep <span class="s2">&quot;^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$&quot;</span> &lt; <span class="s2">&quot;$progpath&quot;</span> &gt; /dev/null; <span class="k">then</span>
<span class="k">    </span><span class="nv">taglist</span><span class="o">=</span><span class="s2">&quot;$taglist $tagname&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>Evaluate the configuration.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">eval</span> <span class="s2">&quot;`${SED} -n -e &#39;/^# ### BEGIN LIBTOOL TAG CONFIG: &#39;$tagname&#39;$/,/^# ### END LIBTOOL TAG CONFIG: &#39;$tagname&#39;$/p&#39; &lt; $progpath`&quot;</span>
  <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$progname: ignoring unknown tag $tagname&quot;</span> 1&gt;&amp;2
  <span class="k">fi</span>
  ;;
      <span class="k">esac</span>
      ;;
    *<span class="o">)</span>
      <span class="nb">eval</span> <span class="s2">&quot;$prev=\$arg&quot;</span>
      ;;
    <span class="k">esac</span>

<span class="k">    </span><span class="nv">prev</span><span class="o">=</span>
    <span class="nv">prevopt</span><span class="o">=</span>
    <span class="k">continue</span>
<span class="k">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Have we seen a non-optional argument yet?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$arg</span> in
  --help<span class="o">)</span>
    <span class="nv">show_help</span><span class="o">=</span>yes
    ;;

  --version<span class="o">)</span>
    <span class="nb">echo</span> <span class="s2">&quot;\</span>
<span class="s2">$PROGRAM (GNU $PACKAGE) $VERSION$TIMESTAMP</span>

<span class="s2">Copyright (C) 2007  Free Software Foundation, Inc.</span>
<span class="s2">This is free software; see the source for copying conditions.  There is NO</span>
<span class="s2">warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.&quot;</span>
    <span class="nb">exit</span> <span class="nv">$?</span>
    ;;

  --config<span class="o">)</span>
    <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;1,/^# ### BEGIN LIBTOOL CONFIG/d&#39;</span> -e <span class="s1">&#39;/^# ### END LIBTOOL CONFIG/,$d&#39;</span> <span class="nv">$progpath</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>Now print the configurations for the tags.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for </span>tagname in <span class="nv">$taglist</span>; <span class="k">do</span>
      <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -n -e <span class="s2">&quot;/^# ### BEGIN LIBTOOL TAG CONFIG: $tagname$/,/^# ### END LIBTOOL TAG CONFIG: $tagname$/p&quot;</span> &lt; <span class="s2">&quot;$progpath&quot;</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nb">exit</span> <span class="nv">$?</span>
    ;;

  --debug<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$progname: enabling shell trace mode&quot;</span>
    <span class="nb">set</span> -x
    <span class="nv">preserve_args</span><span class="o">=</span><span class="s2">&quot;$preserve_args $arg&quot;</span>
    ;;

  --dry-run | -n<span class="o">)</span>
    <span class="nv">run</span><span class="o">=</span>:
    ;;

  --features<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;host: $host&quot;</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;enable shared libraries&quot;</span>
    <span class="k">else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;disable shared libraries&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;enable static libraries&quot;</span>
    <span class="k">else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;disable static libraries&quot;</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nb">exit</span> <span class="nv">$?</span>
    ;;

  --finish<span class="o">)</span> <span class="nv">mode</span><span class="o">=</span><span class="s2">&quot;finish&quot;</span> ;;

  --mode<span class="o">)</span> <span class="nv">prevopt</span><span class="o">=</span><span class="s2">&quot;--mode&quot;</span> <span class="nv">prev</span><span class="o">=</span>mode ;;
  --mode<span class="o">=</span>*<span class="o">)</span> <span class="nv">mode</span><span class="o">=</span><span class="s2">&quot;$optarg&quot;</span> ;;

  --preserve-dup-deps<span class="o">)</span> <span class="nv">duplicate_deps</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> ;;

  --quiet | --silent<span class="o">)</span>
    <span class="nv">show</span><span class="o">=</span>:
    <span class="nv">preserve_args</span><span class="o">=</span><span class="s2">&quot;$preserve_args $arg&quot;</span>
    ;;

  --tag<span class="o">)</span>
    <span class="nv">prevopt</span><span class="o">=</span><span class="s2">&quot;--tag&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>tag
    <span class="nv">preserve_args</span><span class="o">=</span><span class="s2">&quot;$preserve_args --tag&quot;</span>
    ;;
  --tag<span class="o">=</span>*<span class="o">)</span>
    <span class="nb">set </span>tag <span class="s2">&quot;$optarg&quot;</span> <span class="k">${</span><span class="nv">1</span><span class="p">+</span><span class="s2">&quot;$@&quot;</span><span class="k">}</span>
    <span class="nb">shift</span>
<span class="nb">    </span><span class="nv">prev</span><span class="o">=</span>tag
    <span class="nv">preserve_args</span><span class="o">=</span><span class="s2">&quot;$preserve_args --tag&quot;</span>
    ;;

  -dlopen<span class="o">)</span>
    <span class="nv">prevopt</span><span class="o">=</span><span class="s2">&quot;-dlopen&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>execute_dlfiles
    ;;

  -*<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: unrecognized option \`$arg&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;

  *<span class="o">)</span>
    <span class="nv">nonopt</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
    <span class="nb">break</span>
    ;;
  <span class="k">esac</span>
<span class="k">done</span>

<span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$prevopt&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: option \`$prevopt&#39; requires an argument&quot;</span> 1&gt;&amp;2
  <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
<span class="k">fi</span>

<span class="k">case</span> <span class="nv">$disable_libs</span> in
no<span class="o">)</span> 
  ;;
shared<span class="o">)</span>
  <span class="nv">build_libtool_libs</span><span class="o">=</span>no
  <span class="nv">build_old_libs</span><span class="o">=</span>yes
  ;;
static<span class="o">)</span>
  <span class="nv">build_old_libs</span><span class="o">=</span><span class="sb">`</span><span class="k">case</span> <span class="nv">$build_libtool_libs</span> in yes<span class="o">)</span> <span class="nb">echo </span>no;; *<span class="o">)</span> <span class="nb">echo </span>yes;; <span class="k">esac</span><span class="sb">`</span>
  ;;
<span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>If this variable is set in any of the actions, the command in it
will be execed at the end.  This prevents here-documents from being
left over by shells.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">exec_cmd</span><span class="o">=</span>

<span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$show_help&quot;</span>; <span class="k">then</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49">&#182;</a>
</div>
<p>Infer the operation mode.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$mode&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: inferring the mode of operation is deprecated.&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;*** Future versions of Libtool will require --mode=MODE be specified.&quot;</span> 1&gt;&amp;2
    <span class="k">case</span> <span class="nv">$nonopt</span> in
    *cc | cc* | *++ | gcc* | *-gcc* | g++* | xlc*<span class="o">)</span>
      <span class="nv">mode</span><span class="o">=</span>link
      <span class="k">for </span>arg
      <span class="k">do</span>
<span class="k">  case</span> <span class="nv">$arg</span> in
  -c<span class="o">)</span>
     <span class="nv">mode</span><span class="o">=</span>compile
     <span class="nb">break</span>
     ;;
  <span class="k">esac</span>
<span class="k">      done</span>
      ;;
    *db | *dbx | *strace | *truss<span class="o">)</span>
      <span class="nv">mode</span><span class="o">=</span>execute
      ;;
    *install*|cp|mv<span class="o">)</span>
      <span class="nv">mode</span><span class="o">=</span>install
      ;;
    *rm<span class="o">)</span>
      <span class="nv">mode</span><span class="o">=</span>uninstall
      ;;
    *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50">&#182;</a>
</div>
<p>If we have no mode, but dlfiles were specified, then do execute mode.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -n <span class="s2">&quot;$execute_dlfiles&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">mode</span><span class="o">=</span>execute


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51">&#182;</a>
</div>
<p>Just use the default operation mode.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$mode&quot;</span>; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$nonopt&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: cannot infer operation mode from \`$nonopt&#39;&quot;</span> 1&gt;&amp;2
  <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: cannot infer operation mode without MODE-ARGS&quot;</span> 1&gt;&amp;2
  <span class="k">fi</span>
<span class="k">      fi</span>
      ;;
    <span class="k">esac</span>
<span class="k">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>Only execute mode is allowed to have -dlopen flags.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$execute_dlfiles&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> !<span class="o">=</span> execute; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: unrecognized option \`-dlopen&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53">&#182;</a>
</div>
<p>Change the help message to a mode-specific one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">generic_help</span><span class="o">=</span><span class="s2">&quot;$help&quot;</span>
  <span class="nb">help</span><span class="o">=</span><span class="s2">&quot;Try \`$modename --help --mode=$mode&#39; for more information.&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>These modes are in order of execution frequency so that they run quickly.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$mode</span> in

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>libtool compile mode</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  compile<span class="o">)</span>
    <span class="nv">modename</span><span class="o">=</span><span class="s2">&quot;$modename: compile&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>Get the compilation command and the source file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">base_compile</span><span class="o">=</span>
    <span class="nv">srcfile</span><span class="o">=</span><span class="s2">&quot;$nonopt&quot;</span>  <span class="c">#  always keep a non-empty value in &quot;srcfile&quot;</span>
    <span class="nv">suppress_opt</span><span class="o">=</span>yes
    <span class="nv">suppress_output</span><span class="o">=</span>
    <span class="nv">arg_mode</span><span class="o">=</span>normal
    <span class="nv">libobj</span><span class="o">=</span>
    <span class="nv">later</span><span class="o">=</span>

    <span class="k">for </span>arg
    <span class="k">do</span>
<span class="k">      case</span> <span class="nv">$arg_mode</span> in
      arg  <span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57">&#182;</a>
</div>
<p>do not "continue".  Instead, add this to base_compile</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">lastarg</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
  <span class="nv">arg_mode</span><span class="o">=</span>normal
  ;;

      target <span class="o">)</span>
  <span class="nv">libobj</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
  <span class="nv">arg_mode</span><span class="o">=</span>normal
  <span class="k">continue</span>
  ;;

      normal <span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58">&#182;</a>
</div>
<p>Accept any command-line options.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$arg</span> in
  -o<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$libobj&quot;</span> ; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: you cannot specify \`-o&#39; more than once&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">arg_mode</span><span class="o">=</span>target
    <span class="k">continue</span>
    ;;

  -static | -prefer-pic | -prefer-non-pic<span class="o">)</span>
    <span class="nv">later</span><span class="o">=</span><span class="s2">&quot;$later $arg&quot;</span>
    <span class="k">continue</span>
    ;;

  -no-suppress<span class="o">)</span>
    <span class="nv">suppress_opt</span><span class="o">=</span>no
    <span class="k">continue</span>
    ;;

  -Xcompiler<span class="o">)</span>
    <span class="nv">arg_mode</span><span class="o">=</span>arg  <span class="c">#  the next one goes into the &quot;base_compile&quot; arg list</span>
    <span class="k">continue</span>      <span class="c">#  The current &quot;srcfile&quot; will either be retained or</span>
    ;;            <span class="c">#  replaced later.  I would guess that would be a bug.</span>

  -Wc,*<span class="o">)</span>
    <span class="nv">args</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s/^-Wc,//&quot;</span><span class="sb">`</span>
    <span class="nv">lastarg</span><span class="o">=</span>
    <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;,&#39;</span>
    <span class="k">for </span>arg in <span class="nv">$args</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59">&#182;</a>
</div>
<p>Double-quote args containing other shell metacharacters.
Many Bourne shells cannot handle close brackets correctly
in scan sets, so we specify it separately.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$arg</span> in
        *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
        <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;\&quot;$arg\&quot;&quot;</span>
        ;;
      <span class="k">esac</span>
<span class="k">      </span><span class="nv">lastarg</span><span class="o">=</span><span class="s2">&quot;$lastarg $arg&quot;</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="nv">lastarg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$lastarg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s/^ //&quot;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60">&#182;</a>
</div>
<p>Add the arguments to base_compile.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">base_compile</span><span class="o">=</span><span class="s2">&quot;$base_compile $lastarg&quot;</span>
    <span class="k">continue</span>
    ;;

  * <span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61">&#182;</a>
</div>
<p>Accept the current argument as the source file.
The previous "srcfile" becomes the current argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">lastarg</span><span class="o">=</span><span class="s2">&quot;$srcfile&quot;</span>
    <span class="nv">srcfile</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
    ;;
  <span class="k">esac</span>  <span class="c">#  case $arg</span>
  ;;
      <span class="k">esac</span>    <span class="c">#  case $arg_mode</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62">&#182;</a>
</div>
<p>Aesthetically quote the previous argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">lastarg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$lastarg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>

      <span class="k">case</span> <span class="nv">$lastarg</span> in

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63">&#182;</a>
</div>
<p>Double-quote args containing other shell metacharacters.
Many Bourne shells cannot handle close brackets correctly
in scan sets, and some SunOS ksh mistreat backslash-escaping
in scan sets (worked around with variable expansion),
and furthermore cannot handle '|' '&amp;' '(' ')' in scan sets 
at all, so we specify them separately.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
  <span class="nv">lastarg</span><span class="o">=</span><span class="s2">&quot;\&quot;$lastarg\&quot;&quot;</span>
  ;;
      <span class="k">esac</span>

<span class="k">      </span><span class="nv">base_compile</span><span class="o">=</span><span class="s2">&quot;$base_compile $lastarg&quot;</span>
    <span class="k">done</span> <span class="c"># for arg</span>

    <span class="k">case</span> <span class="nv">$arg_mode</span> in
    arg<span class="o">)</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: you must specify an argument for -Xcompile&quot;</span>
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      ;;
    target<span class="o">)</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: you must specify a target with \`-o&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      ;;
    *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64">&#182;</a>
</div>
<p>Get the name of the library object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="o">[</span> -z <span class="s2">&quot;$libobj&quot;</span> <span class="o">]</span> <span class="o">&amp;&amp;</span> <span class="nv">libobj</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$srcfile&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
      ;;
    <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65">&#182;</a>
</div>
<p>Recognize several different file suffixes.
If the user specifies -o file.o, it is replaced with file.lo</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">xform</span><span class="o">=</span><span class="s1">&#39;[cCFSifmso]&#39;</span>
    <span class="k">case</span> <span class="nv">$libobj</span> in
    *.ada<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>ada ;;
    *.adb<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>adb ;;
    *.ads<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>ads ;;
    *.asm<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>asm ;;
    *.c++<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>c++ ;;
    *.cc<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>cc ;;
    *.ii<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>ii ;;
    *.class<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>class ;;
    *.cpp<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>cpp ;;
    *.cxx<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>cxx ;;
    *.<span class="o">[</span>fF<span class="o">][</span>09<span class="o">]</span>?<span class="o">)</span> <span class="nv">xform</span><span class="o">=[</span>fF<span class="o">][</span>09<span class="o">]</span>. ;;
    *.for<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span><span class="k">for</span> ;;
    *.java<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>java ;;
    *.obj<span class="o">)</span> <span class="nv">xform</span><span class="o">=</span>obj ;;
    <span class="k">esac</span>

<span class="k">    </span><span class="nv">libobj</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libobj&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s/\.$xform$/.lo/&quot;</span><span class="sb">`</span>

    <span class="k">case</span> <span class="nv">$libobj</span> in
    *.lo<span class="o">)</span> <span class="nv">obj</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libobj&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span> ;;
    *<span class="o">)</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot determine name of library object from \`$libobj&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      ;;
    <span class="k">esac</span>

<span class="k">    </span>func_infer_tag <span class="nv">$base_compile</span>

    <span class="k">for </span>arg in <span class="nv">$later</span>; <span class="k">do</span>
<span class="k">      case</span> <span class="nv">$arg</span> in
      -static<span class="o">)</span>
  <span class="nv">build_old_libs</span><span class="o">=</span>yes
  <span class="k">continue</span>
  ;;

      -prefer-pic<span class="o">)</span>
  <span class="nv">pic_mode</span><span class="o">=</span>yes
  <span class="k">continue</span>
  ;;

      -prefer-non-pic<span class="o">)</span>
  <span class="nv">pic_mode</span><span class="o">=</span>no
  <span class="k">continue</span>
  ;;
      <span class="k">esac</span>
<span class="k">    done</span>

<span class="k">    </span><span class="nv">qlibobj</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libobj&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
    <span class="k">case</span> <span class="nv">$qlibobj</span> in
      *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
  <span class="nv">qlibobj</span><span class="o">=</span><span class="s2">&quot;\&quot;$qlibobj\&quot;&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nb">test</span> <span class="s2">&quot;X$libobj&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X$qlibobj&quot;</span> <span class="se">\</span>
  <span class="o">&amp;&amp;</span> <span class="nv">$echo</span> <span class="s2">&quot;X$libobj&quot;</span> | grep <span class="s1">&#39;[]~#^*{};&lt;&gt;?&quot;&#39;</span><span class="s2">&quot;&#39;&quot;</span><span class="s1">&#39;  &amp;()|`$[]&#39;</span> <span class="se">\</span>
  <span class="o">&amp;&amp;</span> <span class="nv">$echo</span> <span class="s2">&quot;$modename: libobj name \`$libobj&#39; may not contain shell special characters.&quot;</span>
    <span class="nv">objname</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$obj&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
    <span class="nv">xdir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$obj&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$xdir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$obj&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">xdir</span><span class="o">=</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">xdir</span><span class="o">=</span><span class="nv">$xdir</span>/
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">lobj</span><span class="o">=</span><span class="k">${</span><span class="nv">xdir</span><span class="k">}</span><span class="nv">$objdir</span>/<span class="nv">$objname</span>

    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$base_compile&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: you must specify a compilation command&quot;</span> 1&gt;&amp;2
      <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66">&#182;</a>
</div>
<p>Delete any leftover library objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">      </span><span class="nv">removelist</span><span class="o">=</span><span class="s2">&quot;$obj $lobj $libobj ${libobj}T&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">removelist</span><span class="o">=</span><span class="s2">&quot;$lobj $libobj ${libobj}T&quot;</span>
    <span class="k">fi</span>

    <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
    <span class="nb">trap</span> <span class="s2">&quot;$run $rm $removelist; exit $EXIT_FAILURE&quot;</span> 1 2 15


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67">&#182;</a>
</div>
<p>On Cygwin there's no "real" PIC flag so we must build both object types</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$host_os</span> in
    cygwin* | mingw* | pw32* | os2*<span class="o">)</span>
      <span class="nv">pic_mode</span><span class="o">=</span>default
      ;;
    <span class="k">esac</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$pic_mode&quot;</span> <span class="o">=</span> no <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$deplibs_check_method&quot;</span> !<span class="o">=</span> pass_all; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68">&#182;</a>
</div>
<p>non-PIC code in shared libraries is not supported</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">pic_mode</span><span class="o">=</span>default
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<p>Calculate the filename of the output object if compiler does
not support -o with -c</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$compiler_c_o&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">      </span><span class="nv">output_obj</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$srcfile&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span> -e <span class="s1">&#39;s%\.[^.]*$%%&#39;</span><span class="sb">`</span>.<span class="k">${</span><span class="nv">objext</span><span class="k">}</span>
      <span class="nv">lockfile</span><span class="o">=</span><span class="s2">&quot;$output_obj.lock&quot;</span>
      <span class="nv">removelist</span><span class="o">=</span><span class="s2">&quot;$removelist $output_obj $lockfile&quot;</span>
      <span class="nb">trap</span> <span class="s2">&quot;$run $rm $removelist; exit $EXIT_FAILURE&quot;</span> 1 2 15
    <span class="k">else</span>
<span class="k">      </span><span class="nv">output_obj</span><span class="o">=</span>
      <span class="nv">need_locks</span><span class="o">=</span>no
      <span class="nv">lockfile</span><span class="o">=</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>Lock this critical section if it is needed
We use this script file to make the link, it avoids creating a new file</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$need_locks&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">      until</span> <span class="nv">$run</span> ln <span class="s2">&quot;$progpath&quot;</span> <span class="s2">&quot;$lockfile&quot;</span> 2&gt;/dev/null; <span class="k">do</span>
  <span class="nv">$show</span> <span class="s2">&quot;Waiting for $lockfile to be removed&quot;</span>
  sleep 2
      <span class="k">done</span>
<span class="k">    elif </span><span class="nb">test</span> <span class="s2">&quot;$need_locks&quot;</span> <span class="o">=</span> warn; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -f <span class="s2">&quot;$lockfile&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;\</span>
<span class="s2">*** ERROR, $lockfile exists and contains:</span>
<span class="s2">`cat $lockfile 2&gt;/dev/null`</span>

<span class="s2">This indicates that another process is trying to use the same</span>
<span class="s2">temporary object file, and libtool could not work around it because</span>
<span class="s2">your compiler does not support \`-c&#39; and \`-o&#39; together.  If you</span>
<span class="s2">repeat this compilation, it may succeed, by chance, but you had better</span>
<span class="s2">avoid parallel builds (make -j) in this platform, or get a better</span>
<span class="s2">compiler.&quot;</span>

  <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$srcfile&quot;</span> &gt; <span class="s2">&quot;$lockfile&quot;</span>
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$fix_srcfile_path&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">srcfile</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$fix_srcfile_path</span><span class="se">\&quot;</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">qsrcfile</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$srcfile&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
    <span class="k">case</span> <span class="nv">$qsrcfile</span> in
      *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
      <span class="nv">qsrcfile</span><span class="o">=</span><span class="s2">&quot;\&quot;$qsrcfile\&quot;&quot;</span> ;;
    <span class="k">esac</span>

    <span class="nv">$run</span> <span class="nv">$rm</span> <span class="s2">&quot;$libobj&quot;</span> <span class="s2">&quot;${libobj}T&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71">&#182;</a>
</div>
<p>Create a libtool object file (analogous to a ".la" file),
but don't create it if we're doing a dry run.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> cat &gt; <span class="k">${</span><span class="nv">libobj</span><span class="k">}</span>T <span class="s">&lt;&lt;EOF</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72">&#182;</a>
</div>
<p>$libobj - a libtool object file
Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP</p>

<p>Please DO NOT delete this file!
It is necessary for linking the library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73">&#182;</a>
</div>
<p>Name of the PIC object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s">EOF</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74">&#182;</a>
</div>
<p>Only build a PIC object if we are building libtool libraries.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75">&#182;</a>
</div>
<p>Without this assignment, base_compile gets emptied.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">fbsd_hideous_sh_bug</span><span class="o">=</span><span class="nv">$base_compile</span>

      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pic_mode&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>
<span class="k">  </span><span class="nb">command</span><span class="o">=</span><span class="s2">&quot;$base_compile $qsrcfile $pic_flag&quot;</span>
      <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76">&#182;</a>
</div>
<p>Don't build PIC code</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">command</span><span class="o">=</span><span class="s2">&quot;$base_compile $qsrcfile&quot;</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> ! -d <span class="s2">&quot;${xdir}$objdir&quot;</span>; <span class="k">then</span>
  <span class="nv">$show</span> <span class="s2">&quot;$mkdir ${xdir}$objdir&quot;</span>
  <span class="nv">$run</span> <span class="nv">$mkdir</span> <span class="k">${</span><span class="nv">xdir</span><span class="k">}</span><span class="nv">$objdir</span>
  <span class="nv">exit_status</span><span class="o">=</span><span class="nv">$?</span>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$exit_status&quot;</span> -ne 0 <span class="o">&amp;&amp;</span> <span class="nb">test</span> ! -d <span class="s2">&quot;${xdir}$objdir&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">exit</span> <span class="nv">$exit_status</span>
  <span class="k">fi</span>
<span class="k">      fi</span>

<span class="k">      if </span><span class="nb">test</span> -z <span class="s2">&quot;$output_obj&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77">&#182;</a>
</div>
<p>Place PIC objects in $objdir</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">command</span><span class="o">=</span><span class="s2">&quot;$command -o $lobj&quot;</span>
      <span class="k">fi</span>

      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="s2">&quot;$lobj&quot;</span> <span class="s2">&quot;$output_obj&quot;</span>

      <span class="nv">$show</span> <span class="s2">&quot;$command&quot;</span>
      <span class="k">if</span> <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$command&quot;</span>; <span class="k">then</span> :
      <span class="k">else</span>
<span class="k">  </span><span class="nb">test</span> -n <span class="s2">&quot;$output_obj&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$need_locks&quot;</span> <span class="o">=</span> warn <span class="o">&amp;&amp;</span>
   <span class="nb">test</span> <span class="s2">&quot;X`cat $lockfile 2&gt;/dev/null`&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X$srcfile&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;\</span>
<span class="s2">*** ERROR, $lockfile contains:</span>
<span class="s2">`cat $lockfile 2&gt;/dev/null`</span>

<span class="s2">but it should contain:</span>
<span class="s2">$srcfile</span>

<span class="s2">This indicates that another process is trying to use the same</span>
<span class="s2">temporary object file, and libtool could not work around it because</span>
<span class="s2">your compiler does not support \`-c&#39; and \`-o&#39; together.  If you</span>
<span class="s2">repeat this compilation, it may succeed, by chance, but you had better</span>
<span class="s2">avoid parallel builds (make -j) in this platform, or get a better</span>
<span class="s2">compiler.&quot;</span>

  <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78">&#182;</a>
</div>
<p>Just move the object if needed, then go on to compile the next one</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$output_obj&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;X$output_obj&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X$lobj&quot;</span>; <span class="k">then</span>
  <span class="nv">$show</span> <span class="s2">&quot;$mv $output_obj $lobj&quot;</span>
  <span class="k">if</span> <span class="nv">$run</span> <span class="nv">$mv</span> <span class="nv">$output_obj</span> <span class="nv">$lobj</span>; <span class="k">then</span> :
  <span class="k">else</span>
<span class="k">    </span><span class="nv">error</span><span class="o">=</span><span class="nv">$?</span>
    <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
    <span class="nb">exit</span> <span class="nv">$error</span>
  <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79">&#182;</a>
</div>
<p>Append the name of the PIC object to the libtool object file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> cat &gt;&gt; <span class="k">${</span><span class="nv">libobj</span><span class="k">}</span>T <span class="s">&lt;&lt;EOF</span>
<span class="s">pic_object=&#39;$objdir/$objname&#39;</span>

<span class="s">EOF</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80">&#182;</a>
</div>
<p>Allow error messages only from the first compilation.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$suppress_opt&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">        </span><span class="nv">suppress_output</span><span class="o">=</span><span class="s1">&#39; &gt;/dev/null 2&gt;&amp;1&#39;</span>
      <span class="k">fi</span>
<span class="k">    else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81">&#182;</a>
</div>
<p>No PIC object so indicate it doesn't exist in the libtool
object file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> cat &gt;&gt; <span class="k">${</span><span class="nv">libobj</span><span class="k">}</span>T <span class="s">&lt;&lt;EOF</span>
<span class="s">pic_object=none</span>

<span class="s">EOF</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82">&#182;</a>
</div>
<p>Only build a position-dependent object if we build old libraries.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$pic_mode&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83">&#182;</a>
</div>
<p>Don't build PIC code</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">command</span><span class="o">=</span><span class="s2">&quot;$base_compile $qsrcfile&quot;</span>
      <span class="k">else</span>
<span class="k">  </span><span class="nb">command</span><span class="o">=</span><span class="s2">&quot;$base_compile $qsrcfile $pic_flag&quot;</span>
      <span class="k">fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$compiler_c_o&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">  </span><span class="nb">command</span><span class="o">=</span><span class="s2">&quot;$command -o $obj&quot;</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84">&#182;</a>
</div>
<p>Suppress compiler output if we already did a PIC compilation.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">command</span><span class="o">=</span><span class="s2">&quot;$command$suppress_output&quot;</span>
      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="s2">&quot;$obj&quot;</span> <span class="s2">&quot;$output_obj&quot;</span>
      <span class="nv">$show</span> <span class="s2">&quot;$command&quot;</span>
      <span class="k">if</span> <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$command&quot;</span>; <span class="k">then</span> :
      <span class="k">else</span>
  <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$need_locks&quot;</span> <span class="o">=</span> warn <span class="o">&amp;&amp;</span>
   <span class="nb">test</span> <span class="s2">&quot;X`cat $lockfile 2&gt;/dev/null`&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X$srcfile&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;\</span>
<span class="s2">*** ERROR, $lockfile contains:</span>
<span class="s2">`cat $lockfile 2&gt;/dev/null`</span>

<span class="s2">but it should contain:</span>
<span class="s2">$srcfile</span>

<span class="s2">This indicates that another process is trying to use the same</span>
<span class="s2">temporary object file, and libtool could not work around it because</span>
<span class="s2">your compiler does not support \`-c&#39; and \`-o&#39; together.  If you</span>
<span class="s2">repeat this compilation, it may succeed, by chance, but you had better</span>
<span class="s2">avoid parallel builds (make -j) in this platform, or get a better</span>
<span class="s2">compiler.&quot;</span>

  <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85">&#182;</a>
</div>
<p>Just move the object if needed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$output_obj&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;X$output_obj&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X$obj&quot;</span>; <span class="k">then</span>
  <span class="nv">$show</span> <span class="s2">&quot;$mv $output_obj $obj&quot;</span>
  <span class="k">if</span> <span class="nv">$run</span> <span class="nv">$mv</span> <span class="nv">$output_obj</span> <span class="nv">$obj</span>; <span class="k">then</span> :
  <span class="k">else</span>
<span class="k">    </span><span class="nv">error</span><span class="o">=</span><span class="nv">$?</span>
    <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$removelist</span>
    <span class="nb">exit</span> <span class="nv">$error</span>
  <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86">&#182;</a>
</div>
<p>Append the name of the non-PIC object the libtool object file.
Only append if the libtool object file exists.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> cat &gt;&gt; <span class="k">${</span><span class="nv">libobj</span><span class="k">}</span>T <span class="s">&lt;&lt;EOF</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87">&#182;</a>
</div>
<p>Name of the non-PIC object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s">non_pic_object=&#39;$objname&#39;</span>

<span class="s">EOF</span>
    <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88">&#182;</a>
</div>
<p>Append the name of the non-PIC object the libtool object file.
Only append if the libtool object file exists.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> cat &gt;&gt; <span class="k">${</span><span class="nv">libobj</span><span class="k">}</span>T <span class="s">&lt;&lt;EOF</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89">&#182;</a>
</div>
<p>Name of the non-PIC object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s">non_pic_object=none</span>

<span class="s">EOF</span>
    <span class="k">fi</span>

    <span class="nv">$run</span> <span class="nv">$mv</span> <span class="s2">&quot;${libobj}T&quot;</span> <span class="s2">&quot;${libobj}&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-90" id="section-90">&#182;</a>
</div>
<p>Unlock the critical section if it was locked</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$need_locks&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>
      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="s2">&quot;$lockfile&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
    ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-91" id="section-91">&#182;</a>
</div>
<p>libtool link mode</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  link | relink<span class="o">)</span>
    <span class="nv">modename</span><span class="o">=</span><span class="s2">&quot;$modename: link&quot;</span>
    <span class="k">case</span> <span class="nv">$host</span> in
    *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-92" id="section-92">&#182;</a>
</div>
<p>It is impossible to link a dll without this setting, and
we shouldn't force the makefile maintainer to figure out
which system we are compiling for in order to pass an extra
flag for every libtool invocation.
allow_undefined=no</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-93" id="section-93">&#182;</a>
</div>
<p>FIXME: Unfortunately, there are problems with the above when trying
to make a dll which has undefined symbols, in which case not
even a static library is built.  For now, we need to specify
-no-undefined on the libtool link line when we can be certain
that all symbols are satisfied, otherwise we get a static library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">allow_undefined</span><span class="o">=</span>yes
      ;;
    *<span class="o">)</span>
      <span class="nv">allow_undefined</span><span class="o">=</span>yes
      ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nv">libtool_args</span><span class="o">=</span><span class="s2">&quot;$nonopt&quot;</span>
    <span class="nv">base_compile</span><span class="o">=</span><span class="s2">&quot;$nonopt $@&quot;</span>
    <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$nonopt&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$nonopt&quot;</span>

    <span class="nv">compile_rpath</span><span class="o">=</span>
    <span class="nv">finalize_rpath</span><span class="o">=</span>
    <span class="nv">compile_shlibpath</span><span class="o">=</span>
    <span class="nv">finalize_shlibpath</span><span class="o">=</span>
    <span class="nv">convenience</span><span class="o">=</span>
    <span class="nv">old_convenience</span><span class="o">=</span>
    <span class="nv">deplibs</span><span class="o">=</span>
    <span class="nv">old_deplibs</span><span class="o">=</span>
    <span class="nv">compiler_flags</span><span class="o">=</span>
    <span class="nv">linker_flags</span><span class="o">=</span>
    <span class="nv">dllsearchpath</span><span class="o">=</span>
    <span class="nv">lib_search_path</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>
    <span class="nv">inst_prefix_dir</span><span class="o">=</span>

    <span class="nv">avoid_version</span><span class="o">=</span>no
    <span class="nv">dlfiles</span><span class="o">=</span>
    <span class="nv">dlprefiles</span><span class="o">=</span>
    <span class="nv">dlself</span><span class="o">=</span>no
    <span class="nv">export_dynamic</span><span class="o">=</span>no
    <span class="nv">export_symbols</span><span class="o">=</span>
    <span class="nv">export_symbols_regex</span><span class="o">=</span>
    <span class="nv">generated</span><span class="o">=</span>
    <span class="nv">libobjs</span><span class="o">=</span>
    <span class="nv">ltlibs</span><span class="o">=</span>
    <span class="nv">module</span><span class="o">=</span>no
    <span class="nv">no_install</span><span class="o">=</span>no
    <span class="nv">objs</span><span class="o">=</span>
    <span class="nv">non_pic_objects</span><span class="o">=</span>
    <span class="nv">notinst_path</span><span class="o">=</span> <span class="c"># paths that contain not-installed libtool libraries</span>
    <span class="nv">precious_files_regex</span><span class="o">=</span>
    <span class="nv">prefer_static_libs</span><span class="o">=</span>no
    <span class="nv">preload</span><span class="o">=</span>no
    <span class="nv">prev</span><span class="o">=</span>
    <span class="nv">prevarg</span><span class="o">=</span>
    <span class="nv">release</span><span class="o">=</span>
    <span class="nv">rpath</span><span class="o">=</span>
    <span class="nv">xrpath</span><span class="o">=</span>
    <span class="nv">perm_rpath</span><span class="o">=</span>
    <span class="nv">temp_rpath</span><span class="o">=</span>
    <span class="nv">thread_safe</span><span class="o">=</span>no
    <span class="nv">vinfo</span><span class="o">=</span>
    <span class="nv">vinfo_number</span><span class="o">=</span>no

    func_infer_tag <span class="nv">$base_compile</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94">&#182;</a>
</div>
<p>We need to know -static, to get the right output filenames.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for </span>arg
    <span class="k">do</span>
<span class="k">      case</span> <span class="nv">$arg</span> in
      -all-static | -static | -static-libtool-libs<span class="o">)</span>
  <span class="k">case</span> <span class="nv">$arg</span> in
  -all-static<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> -z <span class="s2">&quot;$link_static_flag&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: complete static linking is impossible in this configuration&quot;</span> 1&gt;&amp;2
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$link_static_flag&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">dlopen_self</span><span class="o">=</span><span class="nv">$dlopen_self_static</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">prefer_static_libs</span><span class="o">=</span>yes
    ;;
  -static<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$pic_flag&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$link_static_flag&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">dlopen_self</span><span class="o">=</span><span class="nv">$dlopen_self_static</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">prefer_static_libs</span><span class="o">=</span>built
    ;;
  -static-libtool-libs<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$pic_flag&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$link_static_flag&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">dlopen_self</span><span class="o">=</span><span class="nv">$dlopen_self_static</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">prefer_static_libs</span><span class="o">=</span>yes
    ;;
  <span class="k">esac</span>
<span class="k">  </span><span class="nv">build_libtool_libs</span><span class="o">=</span>no
  <span class="nv">build_old_libs</span><span class="o">=</span>yes
  <span class="nb">break</span>
  ;;
      <span class="k">esac</span>
<span class="k">    done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95">&#182;</a>
</div>
<p>See if our shared archives depend on static archives.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">test</span> -n <span class="s2">&quot;$old_archive_from_new_cmds&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">build_old_libs</span><span class="o">=</span>yes


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-96" id="section-96">&#182;</a>
</div>
<p>Go through the arguments, transforming them on the way.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">while </span><span class="nb">test</span> <span class="s2">&quot;$#&quot;</span> -gt 0; <span class="k">do</span>
<span class="k">      </span><span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$1&quot;</span>
      <span class="nb">shift</span>
<span class="nb">      </span><span class="k">case</span> <span class="nv">$arg</span> in
      *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
  <span class="nv">qarg</span><span class="o">=</span><span class="se">\&quot;</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span><span class="se">\&quot;</span> <span class="c">### testsuite: skip nested quoting test</span>
  ;;
      *<span class="o">)</span> <span class="nv">qarg</span><span class="o">=</span><span class="nv">$arg</span> ;;
      <span class="k">esac</span>
<span class="k">      </span><span class="nv">libtool_args</span><span class="o">=</span><span class="s2">&quot;$libtool_args $qarg&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97">&#182;</a>
</div>
<p>If the previous option needs an argument, assign it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$prev&quot;</span>; <span class="k">then</span>
<span class="k">  case</span> <span class="nv">$prev</span> in
  output<span class="o">)</span>
    <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command @OUTPUT@&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command @OUTPUT@&quot;</span>
    ;;
  <span class="k">esac</span>

<span class="k">  case</span> <span class="nv">$prev</span> in
  dlfiles|dlprefiles<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$preload&quot;</span> <span class="o">=</span> no; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-98" id="section-98">&#182;</a>
</div>
<p>Add the symbol object into the linking commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command @SYMFILE@&quot;</span>
      <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command @SYMFILE@&quot;</span>
      <span class="nv">preload</span><span class="o">=</span>yes
    <span class="k">fi</span>
<span class="k">    case</span> <span class="nv">$arg</span> in
    *.la | *.lo<span class="o">)</span> ;;  <span class="c"># We handle these cases below.</span>
    force<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$dlself&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">        </span><span class="nv">dlself</span><span class="o">=</span>needless
        <span class="nv">export_dynamic</span><span class="o">=</span>yes
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">prev</span><span class="o">=</span>
      <span class="k">continue</span>
      ;;
    self<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlprefiles; <span class="k">then</span>
<span class="k">        </span><span class="nv">dlself</span><span class="o">=</span>yes
      <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlfiles <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$dlopen_self&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>
<span class="k">        </span><span class="nv">dlself</span><span class="o">=</span>yes
      <span class="k">else</span>
<span class="k">        </span><span class="nv">dlself</span><span class="o">=</span>needless
        <span class="nv">export_dynamic</span><span class="o">=</span>yes
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">prev</span><span class="o">=</span>
      <span class="k">continue</span>
      ;;
    *<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlfiles; <span class="k">then</span>
<span class="k">        </span><span class="nv">dlfiles</span><span class="o">=</span><span class="s2">&quot;$dlfiles $arg&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles $arg&quot;</span>
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">prev</span><span class="o">=</span>
      <span class="k">continue</span>
      ;;
    <span class="k">esac</span>
    ;;
  expsyms<span class="o">)</span>
    <span class="nv">export_symbols</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
    <span class="k">if </span><span class="nb">test</span> ! -f <span class="s2">&quot;$arg&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: symbol file \`$arg&#39; does not exist&quot;</span>
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  expsyms_regex<span class="o">)</span>
    <span class="nv">export_symbols_regex</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  inst_prefix<span class="o">)</span>
    <span class="nv">inst_prefix_dir</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  precious_regex<span class="o">)</span>
    <span class="nv">precious_files_regex</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  release<span class="o">)</span>
    <span class="nv">release</span><span class="o">=</span><span class="s2">&quot;-$arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  objectlist<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$arg&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">save_arg</span><span class="o">=</span><span class="nv">$arg</span>
      <span class="nv">moreargs</span><span class="o">=</span>
      <span class="k">for </span>fil in <span class="sb">`</span>cat <span class="nv">$save_arg</span><span class="sb">`</span>
      <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99">&#182;</a>
</div>

<div class="highlight"><pre><code>  <span class="n">moreargs</span><span class="o">=</span><span class="s">&quot;$moreargs $fil&quot;</span>
</code></pre></div>


        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">arg</span><span class="o">=</span><span class="nv">$fil</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100">&#182;</a>
</div>
<p>A libtool-controlled object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101">&#182;</a>
</div>
<p>Check to see that this really is a libtool object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$arg</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
<span class="k">    </span><span class="nv">pic_object</span><span class="o">=</span>
    <span class="nv">non_pic_object</span><span class="o">=</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102">&#182;</a>
</div>
<p>Read the .lo file
If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$arg</span> in
    */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$arg</span> ;;
    *<span class="o">)</span> . ./<span class="nv">$arg</span> ;;
    <span class="k">esac</span>

<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$pic_object&quot;</span> <span class="o">||</span> <span class="se">\</span>
       <span class="nb">test</span> -z <span class="s2">&quot;$non_pic_object&quot;</span> <span class="o">||</span>
       <span class="nb">test</span> <span class="s2">&quot;$pic_object&quot;</span> <span class="o">=</span> none <span class="o">&amp;&amp;</span> <span class="se">\</span>
       <span class="nb">test</span> <span class="s2">&quot;$non_pic_object&quot;</span> <span class="o">=</span> none; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot find name of object for \`$arg&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-103" id="section-103">&#182;</a>
</div>
<p>Extract subdirectory from the argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">xdir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$xdir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$arg&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">xdir</span><span class="o">=</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">xdir</span><span class="o">=</span><span class="s2">&quot;$xdir/&quot;</span>
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$pic_object&quot;</span> !<span class="o">=</span> none; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104">&#182;</a>
</div>
<p>Prepend the subdirectory the object is found in.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">pic_object</span><span class="o">=</span><span class="s2">&quot;$xdir$pic_object&quot;</span>

      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlfiles; <span class="k">then</span>
<span class="k">        if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$dlopen_support&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">          </span><span class="nv">dlfiles</span><span class="o">=</span><span class="s2">&quot;$dlfiles $pic_object&quot;</span>
          <span class="nv">prev</span><span class="o">=</span>
          <span class="k">continue</span>
<span class="k">        else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105">&#182;</a>
</div>
<p>If libtool objects are unsupported, then we need to preload.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nv">prev</span><span class="o">=</span>dlprefiles
        <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-106" id="section-106">&#182;</a>
</div>
<p>CHECK ME:  I think I busted this.  -Ossama</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlprefiles; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-107" id="section-107">&#182;</a>
</div>
<p>Preload the old-style object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles $pic_object&quot;</span>
        <span class="nv">prev</span><span class="o">=</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-108" id="section-108">&#182;</a>
</div>
<p>A PIC object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">libobjs</span><span class="o">=</span><span class="s2">&quot;$libobjs $pic_object&quot;</span>
      <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$pic_object&quot;</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-109" id="section-109">&#182;</a>
</div>
<p>Non-PIC object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$non_pic_object&quot;</span> !<span class="o">=</span> none; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-110" id="section-110">&#182;</a>
</div>
<p>Prepend the subdirectory the object is found in.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">non_pic_object</span><span class="o">=</span><span class="s2">&quot;$xdir$non_pic_object&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-111" id="section-111">&#182;</a>
</div>
<p>A standard non-PIC object</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">non_pic_objects</span><span class="o">=</span><span class="s2">&quot;$non_pic_objects $non_pic_object&quot;</span>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$pic_object&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$pic_object&quot;</span> <span class="o">=</span> none ; <span class="k">then</span>
<span class="k">        </span><span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$non_pic_object&quot;</span>
      <span class="k">fi</span>
<span class="k">    else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-112" id="section-112">&#182;</a>
</div>
<p>If the PIC object exists, use it instead.
$xdir was prepended to $pic_object above.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">non_pic_object</span><span class="o">=</span><span class="s2">&quot;$pic_object&quot;</span>
      <span class="nv">non_pic_objects</span><span class="o">=</span><span class="s2">&quot;$non_pic_objects $non_pic_object&quot;</span>
    <span class="k">fi</span>
<span class="k">        else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-113" id="section-113">&#182;</a>
</div>
<p>Only an error if not doing a dry-run.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$arg&#39; is not a valid libtool object&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-114" id="section-114">&#182;</a>
</div>
<p>Dry-run case.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-115" id="section-115">&#182;</a>
</div>
<p>Extract subdirectory from the argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">xdir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$xdir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$arg&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">xdir</span><span class="o">=</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">xdir</span><span class="o">=</span><span class="s2">&quot;$xdir/&quot;</span>
      <span class="k">fi</span>

<span class="k">      </span><span class="nv">pic_object</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X${xdir}${objdir}/${arg}&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span>
      <span class="nv">non_pic_object</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X${xdir}${arg}&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span>
      <span class="nv">libobjs</span><span class="o">=</span><span class="s2">&quot;$libobjs $pic_object&quot;</span>
      <span class="nv">non_pic_objects</span><span class="o">=</span><span class="s2">&quot;$non_pic_objects $non_pic_object&quot;</span>
    <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">      done</span>
<span class="k">    else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: link input file \`$save_arg&#39; does not exist&quot;</span>
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">arg</span><span class="o">=</span><span class="nv">$save_arg</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  rpath | xrpath<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-116" id="section-116">&#182;</a>
</div>
<p>We need an absolute path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$arg</span> in
    <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> ;;
    *<span class="o">)</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: only absolute run-paths are allowed&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      ;;
    <span class="k">esac</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> rpath; <span class="k">then</span>
<span class="k">      case</span> <span class="s2">&quot;$rpath &quot;</span> in
      *<span class="s2">&quot; $arg &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span> <span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath $arg&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">    else</span>
<span class="k">      case</span> <span class="s2">&quot;$xrpath &quot;</span> in
      *<span class="s2">&quot; $arg &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span> <span class="nv">xrpath</span><span class="o">=</span><span class="s2">&quot;$xrpath $arg&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">    fi</span>
<span class="k">    </span><span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  xcompiler<span class="o">)</span>
    <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $qarg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $qarg&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $qarg&quot;</span>
    <span class="k">continue</span>
    ;;
  xlinker<span class="o">)</span>
    <span class="nv">linker_flags</span><span class="o">=</span><span class="s2">&quot;$linker_flags $qarg&quot;</span>
    <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $wl$qarg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $wl$qarg&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $wl$qarg&quot;</span>
    <span class="k">continue</span>
    ;;
  xcclinker<span class="o">)</span>
    <span class="nv">linker_flags</span><span class="o">=</span><span class="s2">&quot;$linker_flags $qarg&quot;</span>
    <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $qarg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $qarg&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $qarg&quot;</span>
    <span class="k">continue</span>
    ;;
  shrext<span class="o">)</span>
      <span class="nv">shrext_cmds</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  darwin_framework|darwin_framework_skip<span class="o">)</span>
    <span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> <span class="s2">&quot;darwin_framework&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $arg&quot;</span>
    <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  *<span class="o">)</span>
    <span class="nb">eval</span> <span class="s2">&quot;$prev=\&quot;\$arg\&quot;&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
    ;;
  <span class="k">esac</span>
<span class="k">      fi</span> <span class="c"># test -n &quot;$prev&quot;</span>

      <span class="nv">prevarg</span><span class="o">=</span><span class="s2">&quot;$arg&quot;</span>

      <span class="k">case</span> <span class="nv">$arg</span> in
      -all-static<span class="o">)</span>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$link_static_flag&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $link_static_flag&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $link_static_flag&quot;</span>
  <span class="k">fi</span>
<span class="k">  continue</span>
  ;;

      -allow-undefined<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-117" id="section-117">&#182;</a>
</div>
<p>FIXME: remove this flag sometime in the future.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`-allow-undefined&#39; is deprecated because it is the default&quot;</span> 1&gt;&amp;2
  <span class="k">continue</span>
  ;;

      -avoid-version<span class="o">)</span>
  <span class="nv">avoid_version</span><span class="o">=</span>yes
  <span class="k">continue</span>
  ;;

      -dlopen<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>dlfiles
  <span class="k">continue</span>
  ;;

      -dlpreopen<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>dlprefiles
  <span class="k">continue</span>
  ;;

      -export-dynamic<span class="o">)</span>
  <span class="nv">export_dynamic</span><span class="o">=</span>yes
  <span class="k">continue</span>
  ;;

      -export-symbols | -export-symbols-regex<span class="o">)</span>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols&quot;</span> <span class="o">||</span> <span class="nb">test</span> -n <span class="s2">&quot;$export_symbols_regex&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: more than one -exported-symbols argument is not allowed&quot;</span>
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-export-symbols&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">prev</span><span class="o">=</span>expsyms
  <span class="k">else</span>
<span class="k">    </span><span class="nv">prev</span><span class="o">=</span>expsyms_regex
  <span class="k">fi</span>
<span class="k">  continue</span>
  ;;

      -framework|-arch|-isysroot<span class="o">)</span>
  <span class="k">case</span> <span class="s2">&quot; $CC &quot;</span> in
    *<span class="s2">&quot; ${arg} ${1} &quot;</span>* | *<span class="s2">&quot; ${arg} ${1} &quot;</span>*<span class="o">)</span> 
    <span class="nv">prev</span><span class="o">=</span>darwin_framework_skip ;;
    *<span class="o">)</span> <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $arg&quot;</span>
       <span class="nv">prev</span><span class="o">=</span>darwin_framework ;;
  <span class="k">esac</span>
<span class="k">  </span><span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
  <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
  <span class="k">continue</span>
  ;;

      -inst-prefix-dir<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>inst_prefix
  <span class="k">continue</span>
  ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-118" id="section-118">&#182;</a>
</div>
<p>The native IRIX linker understands -LANG:<em>, -LIST:</em> and -LNO:*
so, if we see these flags be careful not to treat them like -L</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      -L<span class="o">[</span>A-Z<span class="o">][</span>A-Z<span class="o">]</span>*:*<span class="o">)</span>
  <span class="k">case</span> <span class="nv">$with_gcc</span>/<span class="nv">$host</span> in
  no/*-*-irix* | /*-*-irix*<span class="o">)</span>
    <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
    <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
    ;;
  <span class="k">esac</span>
<span class="k">  continue</span>
  ;;

      -L*<span class="o">)</span>
  <span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-L//&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-119" id="section-119">&#182;</a>
</div>
<p>We need an absolute path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$dir</span> in
  <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> ;;
  *<span class="o">)</span>
    <span class="nv">absdir</span><span class="o">=</span><span class="sb">`</span><span class="nb">cd</span> <span class="s2">&quot;$dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$absdir&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot determine absolute directory name of \`$dir&#39;&quot;</span> 1&gt;&amp;2
      <span class="nv">absdir</span><span class="o">=</span><span class="s2">&quot;$dir&quot;</span>
      <span class="nv">notinst_path</span><span class="o">=</span><span class="s2">&quot;$notinst_path $dir&quot;</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$absdir&quot;</span>
    ;;
  <span class="k">esac</span>
<span class="k">  case</span> <span class="s2">&quot;$deplibs &quot;</span> in
  *<span class="s2">&quot; -L$dir &quot;</span>*<span class="o">)</span> ;;
  *<span class="o">)</span>
    <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs -L$dir&quot;</span>
    <span class="nv">lib_search_path</span><span class="o">=</span><span class="s2">&quot;$lib_search_path $dir&quot;</span>
    ;;
  <span class="k">esac</span>
<span class="k">  case</span> <span class="nv">$host</span> in
  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*<span class="o">)</span>
    <span class="nv">testbindir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$dir&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s*/lib$*/bin*&#39;</span><span class="sb">`</span>
    <span class="k">case</span> :<span class="nv">$dllsearchpath</span>: in
    *<span class="s2">&quot;:$dir:&quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">dllsearchpath</span><span class="o">=</span><span class="s2">&quot;$dllsearchpath:$dir&quot;</span>;;
    <span class="k">esac</span>
<span class="k">    case</span> :<span class="nv">$dllsearchpath</span>: in
    *<span class="s2">&quot;:$testbindir:&quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">dllsearchpath</span><span class="o">=</span><span class="s2">&quot;$dllsearchpath:$testbindir&quot;</span>;;
    <span class="k">esac</span>
    ;;
  <span class="k">esac</span>
<span class="k">  continue</span>
  ;;

      -l*<span class="o">)</span>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-lc&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-lm&quot;</span>; <span class="k">then</span>
<span class="k">    case</span> <span class="nv">$host</span> in
    *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-beos*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-120" id="section-120">&#182;</a>
</div>
<p>These systems don't actually have a C or math library (as such)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">continue</span>
      ;;
    *-*-os2*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-121" id="section-121">&#182;</a>
</div>
<p>These systems don't actually have a C library (as such)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-lc&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
      ;;
    *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-122" id="section-122">&#182;</a>
</div>
<p>Do not include libc due to us having libc/libc_r.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-lc&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
      ;;
    *-*-rhapsody* | *-*-darwin1.<span class="o">[</span>012<span class="o">])</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-123" id="section-123">&#182;</a>
</div>
<p>Rhapsody C and math libraries are in the System framework</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs -framework System&quot;</span>
      <span class="k">continue</span>
      ;;
    *-*-sco3.2v5* | *-*-sco5v6*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-124" id="section-124">&#182;</a>
</div>
<p>Causes problems with __ctype</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-lc&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
      ;;
    *-*-sysv4.2uw2* | *-*-sysv5* | *-*-unixware* | *-*-OpenUNIX*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-125" id="section-125">&#182;</a>
</div>
<p>Compiler inserts libc in the correct place for threads to work</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-lc&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">continue</span>
      ;;
    <span class="k">esac</span>
<span class="k">  elif </span><span class="nb">test</span> <span class="s2">&quot;X$arg&quot;</span> <span class="o">=</span> <span class="s2">&quot;X-lc_r&quot;</span>; <span class="k">then</span>
<span class="k">   case</span> <span class="nv">$host</span> in
   *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-126" id="section-126">&#182;</a>
</div>
<p>Do not include libc_r directly, use -pthread flag.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
     <span class="k">continue</span>
     ;;
   <span class="k">esac</span>
<span class="k">  fi</span>
<span class="k">  </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs $arg&quot;</span>
  <span class="k">continue</span>
  ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-127" id="section-127">&#182;</a>
</div>
<p>Tru64 UNIX uses -model [arg] to determine the layout of C++
classes, name mangling, and exception handling.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      -model<span class="o">)</span>
  <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
  <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $arg&quot;</span>
  <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
  <span class="nv">prev</span><span class="o">=</span>xcompiler
  <span class="k">continue</span>
  ;;

     -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads<span class="o">)</span>
  <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $arg&quot;</span>
  <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
  <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
  <span class="k">continue</span>
  ;;

      -module<span class="o">)</span>
  <span class="nv">module</span><span class="o">=</span>yes
  <span class="k">continue</span>
  ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-128" id="section-128">&#182;</a>
</div>
<p>-64, -mips[0-9] enable 64-bit mode on the SGI compiler
-r[0-9][0-9]* specifies the processor on the SGI compiler
-xarch=<em>, -xtarget=</em> enable 64-bit mode on the Sun compiler
+DA<em>, +DD</em> enable 64-bit mode on the HP compiler
-q* pass through compiler args for the IBM compiler
-m* pass through architecture-specific compiler args for GCC
-m<em>, -t[45]</em>, -txscale* pass through architecture-specific
compiler args for GCC
-p, -pg, --coverage, -fprofile-* pass through profiling flag for GCC
-F/path gives path to uninstalled frameworks, gcc on darwin
@file GCC response files</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      -64|-mips<span class="o">[</span>0-9<span class="o">]</span>|-r<span class="o">[</span>0-9<span class="o">][</span>0-9<span class="o">]</span>*|-xarch<span class="o">=</span>*|-xtarget<span class="o">=</span>*|+DA*|+DD*|-q*|-m*| <span class="se">\</span>
      -t<span class="o">[</span>45<span class="o">]</span>*|-txscale*|-p|-pg|--coverage|-fprofile-*|-F*|@*<span class="o">)</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-129" id="section-129">&#182;</a>
</div>
<p>Unknown arguments in both finalize_command and compile_command need
to be aesthetically quoted because they are evaled later.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">arg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
  <span class="k">case</span> <span class="nv">$arg</span> in
  *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
    <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;\&quot;$arg\&quot;&quot;</span>
    ;;
  <span class="k">esac</span>
<span class="k">        </span><span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
        <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
        <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $arg&quot;</span>
        <span class="k">continue</span>
        ;;

      -shrext<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>shrext
  <span class="k">continue</span>
  ;;

      -no-fast-install<span class="o">)</span>
  <span class="nv">fast_install</span><span class="o">=</span>no
  <span class="k">continue</span>
  ;;

      -no-install<span class="o">)</span>
  <span class="k">case</span> <span class="nv">$host</span> in
  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-darwin*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-130" id="section-130">&#182;</a>
</div>
<p>The PATH hackery in wrapper scripts is required on Windows
and Darwin in order for the loader to find any dlls it needs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-no-install&#39; is ignored for $host&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: assuming \`-no-fast-install&#39; instead&quot;</span> 1&gt;&amp;2
    <span class="nv">fast_install</span><span class="o">=</span>no
    ;;
  *<span class="o">)</span> <span class="nv">no_install</span><span class="o">=</span>yes ;;
  <span class="k">esac</span>
<span class="k">  continue</span>
  ;;

      -no-undefined<span class="o">)</span>
  <span class="nv">allow_undefined</span><span class="o">=</span>no
  <span class="k">continue</span>
  ;;

      -objectlist<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>objectlist
  <span class="k">continue</span>
  ;;

      -o<span class="o">)</span> <span class="nv">prev</span><span class="o">=</span>output ;;

      -precious-files-regex<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>precious_regex
  <span class="k">continue</span>
  ;;

      -release<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>release
  <span class="k">continue</span>
  ;;

      -rpath<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>rpath
  <span class="k">continue</span>
  ;;

      -R<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>xrpath
  <span class="k">continue</span>
  ;;

      -R*<span class="o">)</span>
  <span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-R//&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-131" id="section-131">&#182;</a>
</div>
<p>We need an absolute path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$dir</span> in
  <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> ;;
  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: only absolute run-paths are allowed&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>
<span class="k">  case</span> <span class="s2">&quot;$xrpath &quot;</span> in
  *<span class="s2">&quot; $dir &quot;</span>*<span class="o">)</span> ;;
  *<span class="o">)</span> <span class="nv">xrpath</span><span class="o">=</span><span class="s2">&quot;$xrpath $dir&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">  continue</span>
  ;;

      -static | -static-libtool-libs<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-132" id="section-132">&#182;</a>
</div>
<p>The effects of -static are defined in a previous loop.
We used to do the same as -all-static on platforms that
didn't have a PIC flag, but the assumption that the effects
would be equivalent was wrong.  It would break on at least
Digital Unix and AIX.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">continue</span>
  ;;

      -thread-safe<span class="o">)</span>
  <span class="nv">thread_safe</span><span class="o">=</span>yes
  <span class="k">continue</span>
  ;;

      -version-info<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>vinfo
  <span class="k">continue</span>
  ;;
      -version-number<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>vinfo
  <span class="nv">vinfo_number</span><span class="o">=</span>yes
  <span class="k">continue</span>
  ;;

      -Wc,*<span class="o">)</span>
  <span class="nv">args</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span> -e <span class="s1">&#39;s/^-Wc,//&#39;</span><span class="sb">`</span>
  <span class="nv">arg</span><span class="o">=</span>
  <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;,&#39;</span>
  <span class="k">for </span>flag in <span class="nv">$args</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="k">case</span> <span class="nv">$flag</span> in
      *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
      <span class="nv">flag</span><span class="o">=</span><span class="s2">&quot;\&quot;$flag\&quot;&quot;</span>
      ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$arg $wl$flag&quot;</span>
    <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $flag&quot;</span>
  <span class="k">done</span>
<span class="k">  </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
  <span class="nv">arg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s/^ //&quot;</span><span class="sb">`</span>
  ;;

      -Wl,*<span class="o">)</span>
  <span class="nv">args</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span> -e <span class="s1">&#39;s/^-Wl,//&#39;</span><span class="sb">`</span>
  <span class="nv">arg</span><span class="o">=</span>
  <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;,&#39;</span>
  <span class="k">for </span>flag in <span class="nv">$args</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="k">case</span> <span class="nv">$flag</span> in
      *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
      <span class="nv">flag</span><span class="o">=</span><span class="s2">&quot;\&quot;$flag\&quot;&quot;</span>
      ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$arg $wl$flag&quot;</span>
    <span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $wl$flag&quot;</span>
    <span class="nv">linker_flags</span><span class="o">=</span><span class="s2">&quot;$linker_flags $flag&quot;</span>
  <span class="k">done</span>
<span class="k">  </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
  <span class="nv">arg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s/^ //&quot;</span><span class="sb">`</span>
  ;;

      -Xcompiler<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>xcompiler
  <span class="k">continue</span>
  ;;

      -Xlinker<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>xlinker
  <span class="k">continue</span>
  ;;

      -XCClinker<span class="o">)</span>
  <span class="nv">prev</span><span class="o">=</span>xcclinker
  <span class="k">continue</span>
  ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-133" id="section-133">&#182;</a>
</div>
<p>Some other compiler flag.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      -* | +*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-134" id="section-134">&#182;</a>
</div>
<p>Unknown arguments in both finalize_command and compile_command need
to be aesthetically quoted because they are evaled later.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">arg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
  <span class="k">case</span> <span class="nv">$arg</span> in
  *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
    <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;\&quot;$arg\&quot;&quot;</span>
    ;;
  <span class="k">esac</span>
  ;;

      *.<span class="nv">$objext</span><span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-135" id="section-135">&#182;</a>
</div>
<p>A standard object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">objs</span><span class="o">=</span><span class="s2">&quot;$objs $arg&quot;</span>
  ;;

      *.lo<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-136" id="section-136">&#182;</a>
</div>
<p>A libtool-controlled object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-137" id="section-137">&#182;</a>
</div>
<p>Check to see that this really is a libtool object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$arg</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
<span class="k">    </span><span class="nv">pic_object</span><span class="o">=</span>
    <span class="nv">non_pic_object</span><span class="o">=</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-138" id="section-138">&#182;</a>
</div>
<p>Read the .lo file
If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$arg</span> in
    */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$arg</span> ;;
    *<span class="o">)</span> . ./<span class="nv">$arg</span> ;;
    <span class="k">esac</span>

<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$pic_object&quot;</span> <span class="o">||</span> <span class="se">\</span>
       <span class="nb">test</span> -z <span class="s2">&quot;$non_pic_object&quot;</span> <span class="o">||</span>
       <span class="nb">test</span> <span class="s2">&quot;$pic_object&quot;</span> <span class="o">=</span> none <span class="o">&amp;&amp;</span> <span class="se">\</span>
       <span class="nb">test</span> <span class="s2">&quot;$non_pic_object&quot;</span> <span class="o">=</span> none; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot find name of object for \`$arg&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-139" id="section-139">&#182;</a>
</div>
<p>Extract subdirectory from the argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">xdir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$xdir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$arg&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">xdir</span><span class="o">=</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">xdir</span><span class="o">=</span><span class="s2">&quot;$xdir/&quot;</span>
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$pic_object&quot;</span> !<span class="o">=</span> none; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-140" id="section-140">&#182;</a>
</div>
<p>Prepend the subdirectory the object is found in.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">pic_object</span><span class="o">=</span><span class="s2">&quot;$xdir$pic_object&quot;</span>

      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlfiles; <span class="k">then</span>
<span class="k">        if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$dlopen_support&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    </span><span class="nv">dlfiles</span><span class="o">=</span><span class="s2">&quot;$dlfiles $pic_object&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
    <span class="k">continue</span>
<span class="k">        else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-141" id="section-141">&#182;</a>
</div>
<p>If libtool objects are unsupported, then we need to preload.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">prev</span><span class="o">=</span>dlprefiles
        <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-142" id="section-142">&#182;</a>
</div>
<p>CHECK ME:  I think I busted this.  -Ossama</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlprefiles; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-143" id="section-143">&#182;</a>
</div>
<p>Preload the old-style object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles $pic_object&quot;</span>
        <span class="nv">prev</span><span class="o">=</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-144" id="section-144">&#182;</a>
</div>
<p>A PIC object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">libobjs</span><span class="o">=</span><span class="s2">&quot;$libobjs $pic_object&quot;</span>
      <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$pic_object&quot;</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-145" id="section-145">&#182;</a>
</div>
<p>Non-PIC object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$non_pic_object&quot;</span> !<span class="o">=</span> none; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-146" id="section-146">&#182;</a>
</div>
<p>Prepend the subdirectory the object is found in.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">non_pic_object</span><span class="o">=</span><span class="s2">&quot;$xdir$non_pic_object&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-147" id="section-147">&#182;</a>
</div>
<p>A standard non-PIC object</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">non_pic_objects</span><span class="o">=</span><span class="s2">&quot;$non_pic_objects $non_pic_object&quot;</span>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$pic_object&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$pic_object&quot;</span> <span class="o">=</span> none ; <span class="k">then</span>
<span class="k">        </span><span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;$non_pic_object&quot;</span>
      <span class="k">fi</span>
<span class="k">    else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-148" id="section-148">&#182;</a>
</div>
<p>If the PIC object exists, use it instead.
$xdir was prepended to $pic_object above.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">non_pic_object</span><span class="o">=</span><span class="s2">&quot;$pic_object&quot;</span>
      <span class="nv">non_pic_objects</span><span class="o">=</span><span class="s2">&quot;$non_pic_objects $non_pic_object&quot;</span>
    <span class="k">fi</span>
<span class="k">  else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-149" id="section-149">&#182;</a>
</div>
<p>Only an error if not doing a dry-run.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$arg&#39; is not a valid libtool object&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-150" id="section-150">&#182;</a>
</div>
<p>Dry-run case.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-151" id="section-151">&#182;</a>
</div>
<p>Extract subdirectory from the argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">xdir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$xdir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$arg&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">xdir</span><span class="o">=</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">xdir</span><span class="o">=</span><span class="s2">&quot;$xdir/&quot;</span>
      <span class="k">fi</span>

<span class="k">      </span><span class="nv">pic_object</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X${xdir}${objdir}/${arg}&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span>
      <span class="nv">non_pic_object</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X${xdir}${arg}&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span>
      <span class="nv">libobjs</span><span class="o">=</span><span class="s2">&quot;$libobjs $pic_object&quot;</span>
      <span class="nv">non_pic_objects</span><span class="o">=</span><span class="s2">&quot;$non_pic_objects $non_pic_object&quot;</span>
    <span class="k">fi</span>
<span class="k">  fi</span>
  ;;

      *.<span class="nv">$libext</span><span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-152" id="section-152">&#182;</a>
</div>
<p>An archive.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs $arg&quot;</span>
  <span class="nv">old_deplibs</span><span class="o">=</span><span class="s2">&quot;$old_deplibs $arg&quot;</span>
  <span class="k">continue</span>
  ;;

      *.la<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-153" id="section-153">&#182;</a>
</div>
<p>A libtool-controlled library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlfiles; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-154" id="section-154">&#182;</a>
</div>
<p>This library was specified with -dlopen.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">dlfiles</span><span class="o">=</span><span class="s2">&quot;$dlfiles $arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
  <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$prev&quot;</span> <span class="o">=</span> dlprefiles; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-155" id="section-155">&#182;</a>
</div>
<p>The library was specified with -dlpreopen.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles $arg&quot;</span>
    <span class="nv">prev</span><span class="o">=</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs $arg&quot;</span>
  <span class="k">fi</span>
<span class="k">  continue</span>
  ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-156" id="section-156">&#182;</a>
</div>
<p>Some other compiler argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-157" id="section-157">&#182;</a>
</div>
<p>Unknown arguments in both finalize_command and compile_command need
to be aesthetically quoted because they are evaled later.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">arg</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$arg&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
  <span class="k">case</span> <span class="nv">$arg</span> in
  *<span class="o">[</span><span class="se">\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ </span><span class="o">]</span>*|*<span class="o">]</span>*|<span class="s2">&quot;&quot;</span><span class="o">)</span>
    <span class="nv">arg</span><span class="o">=</span><span class="s2">&quot;\&quot;$arg\&quot;&quot;</span>
    ;;
  <span class="k">esac</span>
  ;;
      <span class="k">esac</span> <span class="c"># arg</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-158" id="section-158">&#182;</a>
</div>
<p>Now actually substitute the argument into the commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$arg&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
  <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
      <span class="k">fi</span>
<span class="k">    done</span> <span class="c"># argument parsing loop</span>

    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$prev&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: the \`$prevarg&#39; option requires an argument&quot;</span> 1&gt;&amp;2
      <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$export_dynamic&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$export_dynamic_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">arg</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$export_dynamic_flag_spec</span><span class="se">\&quot;</span>
      <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $arg&quot;</span>
      <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $arg&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">oldlibs</span><span class="o">=</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-159" id="section-159">&#182;</a>
</div>
<p>calculate the name of the file, without its directory</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">outputname</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$output&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
    <span class="nv">libobjs_save</span><span class="o">=</span><span class="s2">&quot;$libobjs&quot;</span>

    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$shlibpath_var&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-160" id="section-160">&#182;</a>
</div>
<p>get the directories listed in $shlibpath_var</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">eval </span><span class="nv">shlib_search_path</span><span class="o">=</span><span class="se">\`\$</span><span class="nb">echo</span> <span class="se">\&quot;</span>X<span class="se">\$</span><span class="o">{</span><span class="nv">$shlibpath_var</span><span class="o">}</span><span class="se">\&quot;</span> <span class="se">\|</span> <span class="se">\$</span>Xsed -e <span class="se">\&#39;</span>s/:/ /g<span class="se">\&#39;\`</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">shlib_search_path</span><span class="o">=</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nb">eval </span><span class="nv">sys_lib_search_path</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$sys_lib_search_path_spec</span><span class="se">\&quot;</span>
    <span class="nb">eval </span><span class="nv">sys_lib_dlsearch_path</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$sys_lib_dlsearch_path_spec</span><span class="se">\&quot;</span>

    <span class="nv">output_objdir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$output&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$output_objdir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$output&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">output_objdir</span><span class="o">=</span><span class="s2">&quot;$objdir&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">output_objdir</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$objdir&quot;</span>
    <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-161" id="section-161">&#182;</a>
</div>
<p>Create the object directory.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> ! -d <span class="s2">&quot;$output_objdir&quot;</span>; <span class="k">then</span>
      <span class="nv">$show</span> <span class="s2">&quot;$mkdir $output_objdir&quot;</span>
      <span class="nv">$run</span> <span class="nv">$mkdir</span> <span class="nv">$output_objdir</span>
      <span class="nv">exit_status</span><span class="o">=</span><span class="nv">$?</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$exit_status&quot;</span> -ne 0 <span class="o">&amp;&amp;</span> <span class="nb">test</span> ! -d <span class="s2">&quot;$output_objdir&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">exit</span> <span class="nv">$exit_status</span>
      <span class="k">fi</span>
<span class="k">    fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-162" id="section-162">&#182;</a>
</div>
<p>Determine the type of output</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$output</span> in
    <span class="s2">&quot;&quot;</span><span class="o">)</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: you must specify an output file&quot;</span> 1&gt;&amp;2
      <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      ;;
    *.<span class="nv">$libext</span><span class="o">)</span> <span class="nv">linkmode</span><span class="o">=</span>oldlib ;;
    *.lo | *.<span class="nv">$objext</span><span class="o">)</span> <span class="nv">linkmode</span><span class="o">=</span>obj ;;
    *.la<span class="o">)</span> <span class="nv">linkmode</span><span class="o">=</span>lib ;;
    *<span class="o">)</span> <span class="nv">linkmode</span><span class="o">=</span>prog ;; <span class="c"># Anything else should be a program.</span>
    <span class="k">esac</span>

<span class="k">    case</span> <span class="nv">$host</span> in
    *cygwin* | *mingw* | *pw32*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-163" id="section-163">&#182;</a>
</div>
<p>don't eliminate duplications in $postdeps and $predeps</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">duplicate_compiler_generated_deps</span><span class="o">=</span>yes
      ;;
    *<span class="o">)</span>
      <span class="nv">duplicate_compiler_generated_deps</span><span class="o">=</span><span class="nv">$duplicate_deps</span>
      ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nv">specialdeplibs</span><span class="o">=</span>

    <span class="nv">libs</span><span class="o">=</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-164" id="section-164">&#182;</a>
</div>
<p>Find all interdependent deplibs by searching for libraries
that are linked more than once (e.g. -la -lb -la)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for </span>deplib in <span class="nv">$deplibs</span>; <span class="k">do</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;X$duplicate_deps&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">  case</span> <span class="s2">&quot;$libs &quot;</span> in
  *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> <span class="nv">specialdeplibs</span><span class="o">=</span><span class="s2">&quot;$specialdeplibs $deplib&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      </span><span class="nv">libs</span><span class="o">=</span><span class="s2">&quot;$libs $deplib&quot;</span>
    <span class="k">done</span>

<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> lib; <span class="k">then</span>
<span class="k">      </span><span class="nv">libs</span><span class="o">=</span><span class="s2">&quot;$predeps $libs $compiler_lib_search_path $postdeps&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-165" id="section-165">&#182;</a>
</div>
<p>Compute libraries that are listed more than once in $predeps
$postdeps and mark them as special (i.e., whose duplicates are
not to be eliminated).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">pre_post_deps</span><span class="o">=</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$duplicate_compiler_generated_deps&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">  for </span>pre_post_dep in <span class="nv">$predeps</span> <span class="nv">$postdeps</span>; <span class="k">do</span>
<span class="k">    case</span> <span class="s2">&quot;$pre_post_deps &quot;</span> in
    *<span class="s2">&quot; $pre_post_dep &quot;</span>*<span class="o">)</span> <span class="nv">specialdeplibs</span><span class="o">=</span><span class="s2">&quot;$specialdeplibs $pre_post_deps&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nv">pre_post_deps</span><span class="o">=</span><span class="s2">&quot;$pre_post_deps $pre_post_dep&quot;</span>
  <span class="k">done</span>
<span class="k">      fi</span>
<span class="k">      </span><span class="nv">pre_post_deps</span><span class="o">=</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">deplibs</span><span class="o">=</span>
    <span class="nv">newdependency_libs</span><span class="o">=</span>
    <span class="nv">newlib_search_path</span><span class="o">=</span>
    <span class="nv">need_relink</span><span class="o">=</span>no <span class="c"># whether we&#39;re linking any uninstalled libtool libraries</span>
    <span class="nv">notinst_deplibs</span><span class="o">=</span> <span class="c"># not-installed libtool libraries</span>
    <span class="k">case</span> <span class="nv">$linkmode</span> in
    lib<span class="o">)</span>
  <span class="nv">passes</span><span class="o">=</span><span class="s2">&quot;conv link&quot;</span>
  <span class="k">for </span>file in <span class="nv">$dlfiles</span> <span class="nv">$dlprefiles</span>; <span class="k">do</span>
<span class="k">    case</span> <span class="nv">$file</span> in
    *.la<span class="o">)</span> ;;
    *<span class="o">)</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: libraries can \`-dlopen&#39; only libtool libraries: $file&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      ;;
    <span class="k">esac</span>
<span class="k">  done</span>
  ;;
    prog<span class="o">)</span>
  <span class="nv">compile_deplibs</span><span class="o">=</span>
  <span class="nv">finalize_deplibs</span><span class="o">=</span>
  <span class="nv">alldeplibs</span><span class="o">=</span>no
  <span class="nv">newdlfiles</span><span class="o">=</span>
  <span class="nv">newdlprefiles</span><span class="o">=</span>
  <span class="nv">passes</span><span class="o">=</span><span class="s2">&quot;conv scan dlopen dlpreopen link&quot;</span>
  ;;
    *<span class="o">)</span>  <span class="nv">passes</span><span class="o">=</span><span class="s2">&quot;conv&quot;</span>
  ;;
    <span class="k">esac</span>
<span class="k">    for </span>pass in <span class="nv">$passes</span>; <span class="k">do</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;lib,link&quot;</span> <span class="o">||</span>
   <span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;prog,scan&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">libs</span><span class="o">=</span><span class="s2">&quot;$deplibs&quot;</span>
  <span class="nv">deplibs</span><span class="o">=</span>
      <span class="k">fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog; <span class="k">then</span>
<span class="k">  case</span> <span class="nv">$pass</span> in
  dlopen<span class="o">)</span> <span class="nv">libs</span><span class="o">=</span><span class="s2">&quot;$dlfiles&quot;</span> ;;
  dlpreopen<span class="o">)</span> <span class="nv">libs</span><span class="o">=</span><span class="s2">&quot;$dlprefiles&quot;</span> ;;
  link<span class="o">)</span> <span class="nv">libs</span><span class="o">=</span><span class="s2">&quot;$deplibs %DEPLIBS% $dependency_libs&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> dlopen; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-166" id="section-166">&#182;</a>
</div>
<p>Collect dlpreopened libraries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">save_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs&quot;</span>
  <span class="nv">deplibs</span><span class="o">=</span>
      <span class="k">fi</span>
<span class="k">      for </span>deplib in <span class="nv">$libs</span>; <span class="k">do</span>
<span class="k">  </span><span class="nv">lib</span><span class="o">=</span>
  <span class="nv">found</span><span class="o">=</span>no
  <span class="k">case</span> <span class="nv">$deplib</span> in
  -mt|-mthreads|-kthread|-Kthread|-pthread|-pthreads|--thread-safe|-threads<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;prog,link&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $compile_deplibs&quot;</span>
      <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $finalize_deplibs&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">compiler_flags</span><span class="o">=</span><span class="s2">&quot;$compiler_flags $deplib&quot;</span>
    <span class="k">fi</span>
<span class="k">    continue</span>
    ;;
  -l*<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> !<span class="o">=</span> lib <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> !<span class="o">=</span> prog; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-l&#39; is ignored for archives/objects&quot;</span> 1&gt;&amp;2
      <span class="k">continue</span>
<span class="k">    fi</span>
<span class="k">    </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$deplib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-l//&#39;</span><span class="sb">`</span>
    <span class="k">for </span>searchdir in <span class="nv">$newlib_search_path</span> <span class="nv">$lib_search_path</span> <span class="nv">$sys_lib_search_path</span> <span class="nv">$shlib_search_path</span>; <span class="k">do</span>
<span class="k">      for </span>search_ext in .la <span class="nv">$std_shrext</span> .so .a; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-167" id="section-167">&#182;</a>
</div>
<p>Search the libtool library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">lib</span><span class="o">=</span><span class="s2">&quot;$searchdir/lib${name}${search_ext}&quot;</span>
        <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$lib&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$search_ext&quot;</span> <span class="o">=</span> <span class="s2">&quot;.la&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">found</span><span class="o">=</span>yes
    <span class="k">else</span>
<span class="k">      </span><span class="nv">found</span><span class="o">=</span>no
    <span class="k">fi</span>
<span class="k">    </span><span class="nb">break </span>2
        <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">    done</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$found&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-168" id="section-168">&#182;</a>
</div>
<p>deplib doesn't seem to be a libtool library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;prog,link&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $compile_deplibs&quot;</span>
        <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $finalize_deplibs&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
        <span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> lib <span class="o">&amp;&amp;</span> <span class="nv">newdependency_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $newdependency_libs&quot;</span>
      <span class="k">fi</span>
<span class="k">      continue</span>
<span class="k">    else</span> <span class="c"># deplib is a libtool library</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-169" id="section-169">&#182;</a>
</div>
<p>If $allow_libtool_libs_with_static_runtimes &amp;&amp; $deplib is a stdlib,
We need to do some special things here, and not later.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$allow_libtool_libs_with_static_runtimes&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">        case</span> <span class="s2">&quot; $predeps $postdeps &quot;</span> in
        *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span>
    <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$lib</span> |
                    grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
<span class="k">      </span><span class="nv">library_names</span><span class="o">=</span>
      <span class="nv">old_library</span><span class="o">=</span>
      <span class="k">case</span> <span class="nv">$lib</span> in
      */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$lib</span> ;;
      *<span class="o">)</span> . ./<span class="nv">$lib</span> ;;
      <span class="k">esac</span>
<span class="k">      for </span>l in <span class="nv">$old_library</span> <span class="nv">$library_names</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">ll</span><span class="o">=</span><span class="s2">&quot;$l&quot;</span>
      <span class="k">done</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;X$ll&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$old_library&quot;</span> ; <span class="k">then</span> <span class="c"># only static version available</span>
        <span class="nv">found</span><span class="o">=</span>no
        <span class="nv">ladir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$lib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
        <span class="nb">test</span> <span class="s2">&quot;X$ladir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$lib&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">ladir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>
        <span class="nv">lib</span><span class="o">=</span><span class="nv">$ladir</span>/<span class="nv">$old_library</span>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;prog,link&quot;</span>; <span class="k">then</span>
<span class="k">          </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $compile_deplibs&quot;</span>
          <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $finalize_deplibs&quot;</span>
        <span class="k">else</span>
<span class="k">          </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
          <span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> lib <span class="o">&amp;&amp;</span> <span class="nv">newdependency_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $newdependency_libs&quot;</span>
        <span class="k">fi</span>
<span class="k">        continue</span>
<span class="k">      fi</span>
<span class="k">    fi</span>
          ;;
        *<span class="o">)</span> ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">    fi</span>
    ;; <span class="c"># -l</span>
  -L*<span class="o">)</span>
    <span class="k">case</span> <span class="nv">$linkmode</span> in
    lib<span class="o">)</span>
      <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
      <span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> conv <span class="o">&amp;&amp;</span> <span class="k">continue</span>
<span class="k">      </span><span class="nv">newdependency_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $newdependency_libs&quot;</span>
      <span class="nv">newlib_search_path</span><span class="o">=</span><span class="s2">&quot;$newlib_search_path &quot;</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$deplib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-L//&#39;</span><span class="sb">`</span>
      ;;
    prog<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> conv; <span class="k">then</span>
<span class="k">        </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
        <span class="k">continue</span>
<span class="k">      fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> scan; <span class="k">then</span>
<span class="k">        </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $compile_deplibs&quot;</span>
        <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $finalize_deplibs&quot;</span>
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">newlib_search_path</span><span class="o">=</span><span class="s2">&quot;$newlib_search_path &quot;</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$deplib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-L//&#39;</span><span class="sb">`</span>
      ;;
    *<span class="o">)</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-L&#39; is ignored for archives/objects&quot;</span> 1&gt;&amp;2
      ;;
    <span class="k">esac</span> <span class="c"># linkmode</span>
    <span class="k">continue</span>
    ;; <span class="c"># -L</span>
  -R*<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> link; <span class="k">then</span>
<span class="k">      </span><span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$deplib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-R//&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-170" id="section-170">&#182;</a>
</div>
<p>Make sure the xrpath contains only unique directories.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="s2">&quot;$xrpath &quot;</span> in
      *<span class="s2">&quot; $dir &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span> <span class="nv">xrpath</span><span class="o">=</span><span class="s2">&quot;$xrpath $dir&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">    fi</span>
<span class="k">    </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
    <span class="k">continue</span>
    ;;
  *.la<span class="o">)</span> <span class="nv">lib</span><span class="o">=</span><span class="s2">&quot;$deplib&quot;</span> ;;
  *.<span class="nv">$libext</span><span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> conv; <span class="k">then</span>
<span class="k">      </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
      <span class="k">continue</span>
<span class="k">    fi</span>
<span class="k">    case</span> <span class="nv">$linkmode</span> in
    lib<span class="o">)</span>
      <span class="nv">valid_a_lib</span><span class="o">=</span>no
      <span class="k">case</span> <span class="nv">$deplibs_check_method</span> in
        match_pattern*<span class="o">)</span>
    <span class="nb">set </span>dummy <span class="nv">$deplibs_check_method</span>
          <span class="nv">match_pattern_regex</span><span class="o">=</span><span class="sb">`</span>expr <span class="s2">&quot;$deplibs_check_method&quot;</span> : <span class="s2">&quot;$2 \(.*\)&quot;</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">eval</span> <span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$deplib</span><span class="se">\&quot;</span> 2&gt;/dev/null <span class="se">\</span>
        | <span class="nv">$SED</span> 10q <span class="se">\</span>
        | <span class="nv">$EGREP</span> <span class="s2">&quot;$match_pattern_regex&quot;</span> &gt; /dev/null; <span class="k">then</span>
<span class="k">      </span><span class="nv">valid_a_lib</span><span class="o">=</span>yes
    <span class="k">fi</span>
    ;;
        pass_all<span class="o">)</span>
    <span class="nv">valid_a_lib</span><span class="o">=</span>yes
    ;;
            <span class="k">esac</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$valid_a_lib&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>
        <span class="nv">$echo</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: Trying to link with static lib archive $deplib.&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** I have the capability to make that library automatically link in when&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** you link to this library.  But I can only do this if you have a&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** shared version of the library, which you do not appear to have&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** because the file extensions .$libext of this argument makes me believe&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** that it is just a static archive that I should not used here.&quot;</span>
      <span class="k">else</span>
        <span class="nv">$echo</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: Linking the shared library $output against the&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** static library $deplib is not portable!&quot;</span>
        <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
      <span class="k">fi</span>
<span class="k">      continue</span>
      ;;
    prog<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> !<span class="o">=</span> link; <span class="k">then</span>
<span class="k">        </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $compile_deplibs&quot;</span>
        <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $finalize_deplibs&quot;</span>
      <span class="k">fi</span>
<span class="k">      continue</span>
      ;;
    <span class="k">esac</span> <span class="c"># linkmode</span>
    ;; <span class="c"># *.$libext</span>
  *.lo | *.<span class="nv">$objext</span><span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> conv; <span class="k">then</span>
<span class="k">      </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
    <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> dlpreopen <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$dlopen_support&quot;</span> !<span class="o">=</span> yes <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> no; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-171" id="section-171">&#182;</a>
</div>
<p>If there is no dlopen support or we're linking statically,
we need to preload.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">newdlprefiles</span><span class="o">=</span><span class="s2">&quot;$newdlprefiles $deplib&quot;</span>
        <span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $compile_deplibs&quot;</span>
        <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $finalize_deplibs&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">newdlfiles</span><span class="o">=</span><span class="s2">&quot;$newdlfiles $deplib&quot;</span>
      <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">    continue</span>
    ;;
  %DEPLIBS%<span class="o">)</span>
    <span class="nv">alldeplibs</span><span class="o">=</span>yes
    <span class="k">continue</span>
    ;;
  <span class="k">esac</span> <span class="c"># case $deplib</span>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$found&quot;</span> <span class="o">=</span> yes <span class="o">||</span> <span class="nb">test</span> -f <span class="s2">&quot;$lib&quot;</span>; <span class="k">then</span> :
  <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot find the library \`$lib&#39; or unhandled argument \`$deplib&#39;&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-172" id="section-172">&#182;</a>
</div>
<p>Check to see that this really is a libtool archive.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$lib</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span> :
  <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$lib&#39; is not a valid libtool archive&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>

<span class="k">  </span><span class="nv">ladir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$lib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
  <span class="nb">test</span> <span class="s2">&quot;X$ladir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$lib&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">ladir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>

  <span class="nv">dlname</span><span class="o">=</span>
  <span class="nv">dlopen</span><span class="o">=</span>
  <span class="nv">dlpreopen</span><span class="o">=</span>
  <span class="nv">libdir</span><span class="o">=</span>
  <span class="nv">library_names</span><span class="o">=</span>
  <span class="nv">old_library</span><span class="o">=</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-173" id="section-173">&#182;</a>
</div>
<p>If the library was installed with an old release of libtool,
it will not redefine variables installed, or shouldnotlink</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">installed</span><span class="o">=</span>yes
  <span class="nv">shouldnotlink</span><span class="o">=</span>no
  <span class="nv">avoidtemprpath</span><span class="o">=</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-174" id="section-174">&#182;</a>
</div>
<p>Read the .la file</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$lib</span> in
  */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$lib</span> ;;
  *<span class="o">)</span> . ./<span class="nv">$lib</span> ;;
  <span class="k">esac</span>

<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;lib,link&quot;</span> <span class="o">||</span>
     <span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;prog,scan&quot;</span> <span class="o">||</span>
     <span class="o">{</span> <span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> !<span class="o">=</span> prog <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> !<span class="o">=</span> lib; <span class="o">}</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">test</span> -n <span class="s2">&quot;$dlopen&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">dlfiles</span><span class="o">=</span><span class="s2">&quot;$dlfiles $dlopen&quot;</span>
    <span class="nb">test</span> -n <span class="s2">&quot;$dlpreopen&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles $dlpreopen&quot;</span>
  <span class="k">fi</span>

<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> conv; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-175" id="section-175">&#182;</a>
</div>
<p>Only check for convenience libraries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$lib $deplibs&quot;</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$libdir&quot;</span>; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -z <span class="s2">&quot;$old_library&quot;</span>; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot find name of link library for \`$lib&#39;&quot;</span> 1&gt;&amp;2
        <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-176" id="section-176">&#182;</a>
</div>
<p>It is a libtool convenience library, so add in its objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">convenience</span><span class="o">=</span><span class="s2">&quot;$convenience $ladir/$objdir/$old_library&quot;</span>
      <span class="nv">old_convenience</span><span class="o">=</span><span class="s2">&quot;$old_convenience $ladir/$objdir/$old_library&quot;</span>
      <span class="nv">tmp_libs</span><span class="o">=</span>
      <span class="k">for </span>deplib in <span class="nv">$dependency_libs</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
              <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$duplicate_deps&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">          case</span> <span class="s2">&quot;$tmp_libs &quot;</span> in
          *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> <span class="nv">specialdeplibs</span><span class="o">=</span><span class="s2">&quot;$specialdeplibs $deplib&quot;</span> ;;
          <span class="k">esac</span>
<span class="k">              fi</span>
<span class="k">        </span><span class="nv">tmp_libs</span><span class="o">=</span><span class="s2">&quot;$tmp_libs $deplib&quot;</span>
      <span class="k">done</span>
<span class="k">    elif </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> !<span class="o">=</span> prog <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> !<span class="o">=</span> lib; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$lib&#39; is not a convenience library&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="k">    continue</span>
<span class="k">  fi</span> <span class="c"># $pass = conv</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-177" id="section-177">&#182;</a>
</div>
<p>Get the name of the library we link against.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">linklib</span><span class="o">=</span>
  <span class="k">for </span>l in <span class="nv">$old_library</span> <span class="nv">$library_names</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">linklib</span><span class="o">=</span><span class="s2">&quot;$l&quot;</span>
  <span class="k">done</span>
<span class="k">  if </span><span class="nb">test</span> -z <span class="s2">&quot;$linklib&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot find name of link library for \`$lib&#39;&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-178" id="section-178">&#182;</a>
</div>
<p>This library was specified with -dlopen.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> dlopen; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$libdir&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot -dlopen a convenience library: \`$lib&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$dlname&quot;</span> <span class="o">||</span>
       <span class="nb">test</span> <span class="s2">&quot;$dlopen_support&quot;</span> !<span class="o">=</span> yes <span class="o">||</span>
       <span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> no; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-179" id="section-179">&#182;</a>
</div>
<p>If there is no dlname, no dlopen support or we're linking
statically, we need to preload.  We also need to preload any
dependent libraries so libltdl's deplib preloader doesn't
bomb out in the load deplibs phase.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles $lib $dependency_libs&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">newdlfiles</span><span class="o">=</span><span class="s2">&quot;$newdlfiles $lib&quot;</span>
    <span class="k">fi</span>
<span class="k">    continue</span>
<span class="k">  fi</span> <span class="c"># $pass = dlopen</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-180" id="section-180">&#182;</a>
</div>
<p>We need an absolute path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$ladir</span> in
  <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> <span class="nv">abs_ladir</span><span class="o">=</span><span class="s2">&quot;$ladir&quot;</span> ;;
  *<span class="o">)</span>
    <span class="nv">abs_ladir</span><span class="o">=</span><span class="sb">`</span><span class="nb">cd</span> <span class="s2">&quot;$ladir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$abs_ladir&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: cannot determine absolute directory name of \`$ladir&#39;&quot;</span> 1&gt;&amp;2
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: passing it literally to the linker, although it might fail&quot;</span> 1&gt;&amp;2
      <span class="nv">abs_ladir</span><span class="o">=</span><span class="s2">&quot;$ladir&quot;</span>
    <span class="k">fi</span>
    ;;
  <span class="k">esac</span>
<span class="k">  </span><span class="nv">laname</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$lib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-181" id="section-181">&#182;</a>
</div>
<p>Find the relevant object directory and library name.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$installed&quot;</span> <span class="o">=</span> Xyes; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> ! -f <span class="s2">&quot;$libdir/$linklib&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -f <span class="s2">&quot;$abs_ladir/$linklib&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: library \`$lib&#39; was moved.&quot;</span> 1&gt;&amp;2
      <span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$ladir&quot;</span>
      <span class="nv">absdir</span><span class="o">=</span><span class="s2">&quot;$abs_ladir&quot;</span>
      <span class="nv">libdir</span><span class="o">=</span><span class="s2">&quot;$abs_ladir&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$libdir&quot;</span>
      <span class="nv">absdir</span><span class="o">=</span><span class="s2">&quot;$libdir&quot;</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nb">test</span> <span class="s2">&quot;X$hardcode_automatic&quot;</span> <span class="o">=</span> Xyes <span class="o">&amp;&amp;</span> <span class="nv">avoidtemprpath</span><span class="o">=</span>yes
  <span class="k">else</span>
<span class="k">    if </span><span class="nb">test</span> ! -f <span class="s2">&quot;$ladir/$objdir/$linklib&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -f <span class="s2">&quot;$abs_ladir/$linklib&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$ladir&quot;</span>
      <span class="nv">absdir</span><span class="o">=</span><span class="s2">&quot;$abs_ladir&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-182" id="section-182">&#182;</a>
</div>
<p>Remove this search path later</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">notinst_path</span><span class="o">=</span><span class="s2">&quot;$notinst_path $abs_ladir&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$ladir/$objdir&quot;</span>
      <span class="nv">absdir</span><span class="o">=</span><span class="s2">&quot;$abs_ladir/$objdir&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-183" id="section-183">&#182;</a>
</div>
<p>Remove this search path later</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">notinst_path</span><span class="o">=</span><span class="s2">&quot;$notinst_path $abs_ladir&quot;</span>
    <span class="k">fi</span>
<span class="k">  fi</span> <span class="c"># $installed = yes</span>
  <span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$laname&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/\.la$//&#39;</span> -e <span class="s1">&#39;s/^lib//&#39;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-184" id="section-184">&#182;</a>
</div>
<p>This library was specified with -dlpreopen.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> dlpreopen; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$libdir&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot -dlpreopen a convenience library: \`$lib&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-185" id="section-185">&#182;</a>
</div>
<p>Prefer using a static library (so that no silly _DYNAMIC symbols
are required to link).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$old_library&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">newdlprefiles</span><span class="o">=</span><span class="s2">&quot;$newdlprefiles $dir/$old_library&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-186" id="section-186">&#182;</a>
</div>
<p>Otherwise, use the dlname, so that lt_dlopen finds it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">elif </span><span class="nb">test</span> -n <span class="s2">&quot;$dlname&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">newdlprefiles</span><span class="o">=</span><span class="s2">&quot;$newdlprefiles $dir/$dlname&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">newdlprefiles</span><span class="o">=</span><span class="s2">&quot;$newdlprefiles $dir/$linklib&quot;</span>
    <span class="k">fi</span>
<span class="k">  fi</span> <span class="c"># $pass = dlpreopen</span>

  <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$libdir&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-187" id="section-187">&#182;</a>
</div>
<p>Link the convenience library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> lib; <span class="k">then</span>
<span class="k">      </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$dir/$old_library $deplibs&quot;</span>
    <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;prog,link&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$dir/$old_library $compile_deplibs&quot;</span>
      <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$dir/$old_library $finalize_deplibs&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$lib $deplibs&quot;</span> <span class="c"># used for prog,scan pass</span>
    <span class="k">fi</span>
<span class="k">    continue</span>
<span class="k">  fi</span>


<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> !<span class="o">=</span> link; <span class="k">then</span>
<span class="k">    </span><span class="nv">newlib_search_path</span><span class="o">=</span><span class="s2">&quot;$newlib_search_path $ladir&quot;</span>
    <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$lib $deplibs&quot;</span>

    <span class="nv">linkalldeplibs</span><span class="o">=</span>no
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$link_all_deplibs&quot;</span> !<span class="o">=</span> no <span class="o">||</span> <span class="nb">test</span> -z <span class="s2">&quot;$library_names&quot;</span> <span class="o">||</span>
       <span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">      </span><span class="nv">linkalldeplibs</span><span class="o">=</span>yes
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">tmp_libs</span><span class="o">=</span>
    <span class="k">for </span>deplib in <span class="nv">$dependency_libs</span>; <span class="k">do</span>
<span class="k">      case</span> <span class="nv">$deplib</span> in
      -L*<span class="o">)</span> <span class="nv">newlib_search_path</span><span class="o">=</span><span class="s2">&quot;$newlib_search_path &quot;</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$deplib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-L//&#39;</span><span class="sb">`</span>;; <span class="c">### testsuite: skip nested quoting test</span>
      <span class="k">esac</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-188" id="section-188">&#182;</a>
</div>
<p>Need to link against all dependency_libs?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkalldeplibs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">        </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
      <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-189" id="section-189">&#182;</a>
</div>
<p>Need to hardcode shared library paths
or/and link against static libraries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">newdependency_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $newdependency_libs&quot;</span>
      <span class="k">fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;X$duplicate_deps&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">        case</span> <span class="s2">&quot;$tmp_libs &quot;</span> in
        *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> <span class="nv">specialdeplibs</span><span class="o">=</span><span class="s2">&quot;$specialdeplibs $deplib&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      </span><span class="nv">tmp_libs</span><span class="o">=</span><span class="s2">&quot;$tmp_libs $deplib&quot;</span>
    <span class="k">done</span> <span class="c"># for deplib</span>
    <span class="k">continue</span>
<span class="k">  fi</span> <span class="c"># $linkmode = prog...</span>

  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> <span class="o">=</span> <span class="s2">&quot;prog,link&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$library_names&quot;</span> <span class="o">&amp;&amp;</span>
       <span class="o">{</span> <span class="o">{</span> <span class="nb">test</span> <span class="s2">&quot;$prefer_static_libs&quot;</span> <span class="o">=</span> no <span class="o">||</span>
     <span class="nb">test</span> <span class="s2">&quot;$prefer_static_libs,$installed&quot;</span> <span class="o">=</span> <span class="s2">&quot;built,yes&quot;</span>; <span class="o">}</span> <span class="o">||</span>
         <span class="nb">test</span> -z <span class="s2">&quot;$old_library&quot;</span>; <span class="o">}</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-190" id="section-190">&#182;</a>
</div>
<p>We need to hardcode the library path</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$shlibpath_var&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -z <span class="s2">&quot;$avoidtemprpath&quot;</span> ; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-191" id="section-191">&#182;</a>
</div>
<p>Make sure the rpath contains only unique directories.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">case</span> <span class="s2">&quot;$temp_rpath &quot;</span> in
        *<span class="s2">&quot; $dir &quot;</span>*<span class="o">)</span> ;;
        *<span class="s2">&quot; $absdir &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">temp_rpath</span><span class="o">=</span><span class="s2">&quot;$temp_rpath $absdir&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-192" id="section-192">&#182;</a>
</div>
<p>Hardcode the library path.
Skip directories that are in the system default run-time
search path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="s2">&quot; $sys_lib_dlsearch_path &quot;</span> in
      *<span class="s2">&quot; $absdir &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span>
        <span class="k">case</span> <span class="s2">&quot;$compile_rpath &quot;</span> in
        *<span class="s2">&quot; $absdir &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">compile_rpath</span><span class="o">=</span><span class="s2">&quot;$compile_rpath $absdir&quot;</span>
        <span class="k">esac</span>
        ;;
      <span class="k">esac</span>
<span class="k">      case</span> <span class="s2">&quot; $sys_lib_dlsearch_path &quot;</span> in
      *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span>
        <span class="k">case</span> <span class="s2">&quot;$finalize_rpath &quot;</span> in
        *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">finalize_rpath</span><span class="o">=</span><span class="s2">&quot;$finalize_rpath $libdir&quot;</span>
        <span class="k">esac</span>
        ;;
      <span class="k">esac</span>
<span class="k">    fi</span> <span class="c"># $linkmode,$pass = prog,link...</span>

    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$alldeplibs&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span>
       <span class="o">{</span> <span class="nb">test</span> <span class="s2">&quot;$deplibs_check_method&quot;</span> <span class="o">=</span> pass_all <span class="o">||</span>
         <span class="o">{</span> <span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span>
     <span class="nb">test</span> -n <span class="s2">&quot;$library_names&quot;</span>; <span class="o">}</span>; <span class="o">}</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-193" id="section-193">&#182;</a>
</div>
<p>We only need to search for static libraries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">continue</span>
<span class="k">    fi</span>
<span class="k">  fi</span>

<span class="k">  </span><span class="nv">link_static</span><span class="o">=</span>no <span class="c"># Whether the deplib will be linked statically</span>
  <span class="nv">use_static_libs</span><span class="o">=</span><span class="nv">$prefer_static_libs</span>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$use_static_libs&quot;</span> <span class="o">=</span> built <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$installed&quot;</span> <span class="o">=</span> yes ; <span class="k">then</span>
<span class="k">    </span><span class="nv">use_static_libs</span><span class="o">=</span>no
  <span class="k">fi</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$library_names&quot;</span> <span class="o">&amp;&amp;</span>
     <span class="o">{</span> <span class="nb">test</span> <span class="s2">&quot;$use_static_libs&quot;</span> <span class="o">=</span> no <span class="o">||</span> <span class="nb">test</span> -z <span class="s2">&quot;$old_library&quot;</span>; <span class="o">}</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$installed&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">      </span><span class="nv">notinst_deplibs</span><span class="o">=</span><span class="s2">&quot;$notinst_deplibs $lib&quot;</span>
      <span class="nv">need_relink</span><span class="o">=</span>yes
    <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-194" id="section-194">&#182;</a>
</div>
<p>This is a shared library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-195" id="section-195">&#182;</a>
</div>
<p>Warn about portability, can't link against -module's on
some systems (darwin)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$shouldnotlink&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> link ; <span class="k">then</span>
      <span class="nv">$echo</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: Linking the executable $output against the loadable module&quot;</span>
      <span class="k">else</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: Linking the shared library $output against the loadable module&quot;</span>
      <span class="k">fi</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** $linklib is not portable!&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> lib <span class="o">&amp;&amp;</span>
       <span class="nb">test</span> <span class="s2">&quot;$hardcode_into_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-196" id="section-196">&#182;</a>
</div>
<p>Hardcode the library path.
Skip directories that are in the system default run-time
search path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="s2">&quot; $sys_lib_dlsearch_path &quot;</span> in
      *<span class="s2">&quot; $absdir &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span>
        <span class="k">case</span> <span class="s2">&quot;$compile_rpath &quot;</span> in
        *<span class="s2">&quot; $absdir &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">compile_rpath</span><span class="o">=</span><span class="s2">&quot;$compile_rpath $absdir&quot;</span>
        <span class="k">esac</span>
        ;;
      <span class="k">esac</span>
<span class="k">      case</span> <span class="s2">&quot; $sys_lib_dlsearch_path &quot;</span> in
      *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span>
        <span class="k">case</span> <span class="s2">&quot;$finalize_rpath &quot;</span> in
        *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">finalize_rpath</span><span class="o">=</span><span class="s2">&quot;$finalize_rpath $libdir&quot;</span>
        <span class="k">esac</span>
        ;;
      <span class="k">esac</span>
<span class="k">    fi</span>

<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$old_archive_from_expsyms_cmds&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-197" id="section-197">&#182;</a>
</div>
<p>figure out the soname</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">set </span>dummy <span class="nv">$library_names</span>
      <span class="nv">realname</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>
      <span class="nb">shift</span>; <span class="nb">shift</span>
<span class="nb">      </span><span class="nv">libname</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\\</span><span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$libname_spec</span><span class="se">\&quot;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-198" id="section-198">&#182;</a>
</div>
<p>use dlname if we got it. it's perfectly good, no?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$dlname&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">soname</span><span class="o">=</span><span class="s2">&quot;$dlname&quot;</span>
      <span class="k">elif </span><span class="nb">test</span> -n <span class="s2">&quot;$soname_spec&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-199" id="section-199">&#182;</a>
</div>
<p>bleh windows</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">case</span> <span class="nv">$host</span> in
        *cygwin* | mingw*<span class="o">)</span>
    <span class="nv">major</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$age</span><span class="sb">`</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;-$major&quot;</span>
    ;;
        <span class="k">esac</span>
<span class="k">        </span><span class="nb">eval </span><span class="nv">soname</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$soname_spec</span><span class="se">\&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">soname</span><span class="o">=</span><span class="s2">&quot;$realname&quot;</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-200" id="section-200">&#182;</a>
</div>
<p>Make a new name for the extract_expsyms_cmds to use</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">soroot</span><span class="o">=</span><span class="s2">&quot;$soname&quot;</span>
      <span class="nv">soname</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$soroot</span> | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;s/^.*\///&#39;</span><span class="sb">`</span>
      <span class="nv">newlib</span><span class="o">=</span><span class="s2">&quot;libimp-`$echo $soname | ${SED} &#39;s/^lib//;s/\.dll$//&#39;`.a&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-201" id="section-201">&#182;</a>
</div>
<p>If the library has no export list, then create one now</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$output_objdir/$soname-def&quot;</span>; <span class="k">then</span> :
      <span class="k">else</span>
        <span class="nv">$show</span> <span class="s2">&quot;extracting exported symbol list from \`$soname&#39;&quot;</span>
        <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
        <span class="nv">cmds</span><span class="o">=</span><span class="nv">$extract_expsyms_cmds</span>
        <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
    <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
        <span class="k">done</span>
<span class="k">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-202" id="section-202">&#182;</a>
</div>
<p>Create $newlib</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$output_objdir/$newlib&quot;</span>; <span class="k">then</span> :; <span class="k">else</span>
        <span class="nv">$show</span> <span class="s2">&quot;generating import library for \`$soname&#39;&quot;</span>
        <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
        <span class="nv">cmds</span><span class="o">=</span><span class="nv">$old_archive_from_expsyms_cmds</span>
        <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
    <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
        <span class="k">done</span>
<span class="k">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-203" id="section-203">&#182;</a>
</div>
<p>make sure the library variables are pointing to the new library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">dir</span><span class="o">=</span><span class="nv">$output_objdir</span>
      <span class="nv">linklib</span><span class="o">=</span><span class="nv">$newlib</span>
    <span class="k">fi</span> <span class="c"># test -n &quot;$old_archive_from_expsyms_cmds&quot;</span>

    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> !<span class="o">=</span> relink; <span class="k">then</span>
<span class="k">      </span><span class="nv">add_shlibpath</span><span class="o">=</span>
      <span class="nv">add_dir</span><span class="o">=</span>
      <span class="nv">add</span><span class="o">=</span>
      <span class="nv">lib_linked</span><span class="o">=</span>yes
      <span class="k">case</span> <span class="nv">$hardcode_action</span> in
      immediate | unsupported<span class="o">)</span>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_direct&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">    </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;$dir/$linklib&quot;</span>
    <span class="k">case</span> <span class="nv">$host</span> in
      *-*-sco3.2v5.0.<span class="o">[</span>024<span class="o">]</span>*<span class="o">)</span> <span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;-L$dir&quot;</span> ;;
      *-*-sysv4*uw2*<span class="o">)</span> <span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;-L$dir&quot;</span> ;;
      *-*-sysv5OpenUNIX* | *-*-sysv5UnixWare7.<span class="o">[</span>01<span class="o">]</span>.<span class="o">[</span>10<span class="o">]</span>* | <span class="se">\</span>
        *-*-unixware7*<span class="o">)</span> <span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;-L$dir&quot;</span> ;;
      *-*-darwin* <span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-204" id="section-204">&#182;</a>
</div>
<p>if the lib is a module then we can not link against
it, someone is ignoring the new warnings I added</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> /usr/bin/file -L <span class="nv">$add</span> 2&gt; /dev/null |
                      <span class="nv">$EGREP</span> <span class="s2">&quot;: [^:]* bundle&quot;</span> &gt;/dev/null ; <span class="k">then</span>
          <span class="nv">$echo</span> <span class="s2">&quot;** Warning, lib $linklib is a module, not a shared library&quot;</span>
          <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$old_library&quot;</span> ; <span class="k">then</span>
            <span class="nv">$echo</span>
            <span class="nv">$echo</span> <span class="s2">&quot;** And there doesn&#39;t seem to be a static archive available&quot;</span>
            <span class="nv">$echo</span> <span class="s2">&quot;** The link will probably fail, sorry&quot;</span>
          <span class="k">else</span>
<span class="k">            </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;$dir/$old_library&quot;</span>
          <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">    esac</span>
<span class="k">        elif </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_minus_L&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">    case</span> <span class="nv">$host</span> in
    *-*-sunos*<span class="o">)</span> <span class="nv">add_shlibpath</span><span class="o">=</span><span class="s2">&quot;$dir&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;-L$dir&quot;</span>
    <span class="nv">add</span><span class="o">=</span><span class="s2">&quot;-l$name&quot;</span>
        <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_shlibpath_var&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">    </span><span class="nv">add_shlibpath</span><span class="o">=</span><span class="s2">&quot;$dir&quot;</span>
    <span class="nv">add</span><span class="o">=</span><span class="s2">&quot;-l$name&quot;</span>
        <span class="k">else</span>
<span class="k">    </span><span class="nv">lib_linked</span><span class="o">=</span>no
        <span class="k">fi</span>
        ;;
      relink<span class="o">)</span>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_direct&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;$dir/$linklib&quot;</span>
        <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_minus_L&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    </span><span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;-L$dir&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-205" id="section-205">&#182;</a>
</div>
<p>Try looking first in the location we're being installed to.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$inst_prefix_dir&quot;</span>; <span class="k">then</span>
<span class="k">      case</span> <span class="nv">$libdir</span> in
        <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span>
          <span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;$add_dir -L$inst_prefix_dir$libdir&quot;</span>
          ;;
      <span class="k">esac</span>
<span class="k">    fi</span>
<span class="k">    </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;-l$name&quot;</span>
        <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_shlibpath_var&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    </span><span class="nv">add_shlibpath</span><span class="o">=</span><span class="s2">&quot;$dir&quot;</span>
    <span class="nv">add</span><span class="o">=</span><span class="s2">&quot;-l$name&quot;</span>
        <span class="k">else</span>
<span class="k">    </span><span class="nv">lib_linked</span><span class="o">=</span>no
        <span class="k">fi</span>
        ;;
      *<span class="o">)</span> <span class="nv">lib_linked</span><span class="o">=</span>no ;;
      <span class="k">esac</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$lib_linked&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;$modename: configuration error: unsupported hardcode properties&quot;</span>
        <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$add_shlibpath&quot;</span>; <span class="k">then</span>
<span class="k">        case</span> :<span class="nv">$compile_shlibpath</span>: in
        *<span class="s2">&quot;:$add_shlibpath:&quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">compile_shlibpath</span><span class="o">=</span><span class="s2">&quot;$compile_shlibpath$add_shlibpath:&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog; <span class="k">then</span>
<span class="k">        </span><span class="nb">test</span> -n <span class="s2">&quot;$add_dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$add_dir $compile_deplibs&quot;</span>
        <span class="nb">test</span> -n <span class="s2">&quot;$add&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$add $compile_deplibs&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nb">test</span> -n <span class="s2">&quot;$add_dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$add_dir $deplibs&quot;</span>
        <span class="nb">test</span> -n <span class="s2">&quot;$add&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$add $deplibs&quot;</span>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_direct&quot;</span> !<span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">test</span> <span class="s2">&quot;$hardcode_minus_L&quot;</span> !<span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="se">\</span>
     <span class="nb">test</span> <span class="s2">&quot;$hardcode_shlibpath_var&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    case</span> :<span class="nv">$finalize_shlibpath</span>: in
    *<span class="s2">&quot;:$libdir:&quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">finalize_shlibpath</span><span class="o">=</span><span class="s2">&quot;$finalize_shlibpath$libdir:&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">        fi</span>
<span class="k">      fi</span>
<span class="k">    fi</span>

<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> relink; <span class="k">then</span>
<span class="k">      </span><span class="nv">add_shlibpath</span><span class="o">=</span>
      <span class="nv">add_dir</span><span class="o">=</span>
      <span class="nv">add</span><span class="o">=</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-206" id="section-206">&#182;</a>
</div>
<p>Finalize command for both is simple: just hardcode it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_direct&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">        </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;$libdir/$linklib&quot;</span>
      <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_minus_L&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">        </span><span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;-L$libdir&quot;</span>
        <span class="nv">add</span><span class="o">=</span><span class="s2">&quot;-l$name&quot;</span>
      <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_shlibpath_var&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">        case</span> :<span class="nv">$finalize_shlibpath</span>: in
        *<span class="s2">&quot;:$libdir:&quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">finalize_shlibpath</span><span class="o">=</span><span class="s2">&quot;$finalize_shlibpath$libdir:&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">        </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;-l$name&quot;</span>
      <span class="k">elif </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_automatic&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">        if </span><span class="nb">test</span> -n <span class="s2">&quot;$inst_prefix_dir&quot;</span> <span class="o">&amp;&amp;</span>
     <span class="nb">test</span> -f <span class="s2">&quot;$inst_prefix_dir$libdir/$linklib&quot;</span> ; <span class="k">then</span>
<span class="k">          </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;$inst_prefix_dir$libdir/$linklib&quot;</span>
        <span class="k">else</span>
<span class="k">          </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;$libdir/$linklib&quot;</span>
        <span class="k">fi</span>
<span class="k">      else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-207" id="section-207">&#182;</a>
</div>
<p>We cannot seem to hardcode it, guess we'll fake it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;-L$libdir&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-208" id="section-208">&#182;</a>
</div>
<p>Try looking first in the location we're being installed to.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$inst_prefix_dir&quot;</span>; <span class="k">then</span>
<span class="k">    case</span> <span class="nv">$libdir</span> in
      <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span>
        <span class="nv">add_dir</span><span class="o">=</span><span class="s2">&quot;$add_dir -L$inst_prefix_dir$libdir&quot;</span>
        ;;
    <span class="k">esac</span>
<span class="k">        fi</span>
<span class="k">        </span><span class="nv">add</span><span class="o">=</span><span class="s2">&quot;-l$name&quot;</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog; <span class="k">then</span>
<span class="k">        </span><span class="nb">test</span> -n <span class="s2">&quot;$add_dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$add_dir $finalize_deplibs&quot;</span>
        <span class="nb">test</span> -n <span class="s2">&quot;$add&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$add $finalize_deplibs&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nb">test</span> -n <span class="s2">&quot;$add_dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$add_dir $deplibs&quot;</span>
        <span class="nb">test</span> -n <span class="s2">&quot;$add&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$add $deplibs&quot;</span>
      <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">  elif </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-209" id="section-209">&#182;</a>
</div>
<p>Here we assume that one of hardcode_direct or hardcode_minus_L
is not unsupported.  This is valid on all known static and
shared platforms.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_direct&quot;</span> !<span class="o">=</span> unsupported; <span class="k">then</span>
<span class="k">      </span><span class="nb">test</span> -n <span class="s2">&quot;$old_library&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">linklib</span><span class="o">=</span><span class="s2">&quot;$old_library&quot;</span>
      <span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$dir/$linklib $compile_deplibs&quot;</span>
      <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;$dir/$linklib $finalize_deplibs&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;-l$name -L$dir $compile_deplibs&quot;</span>
      <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="s2">&quot;-l$name -L$dir $finalize_deplibs&quot;</span>
    <span class="k">fi</span>
<span class="k">  elif </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-210" id="section-210">&#182;</a>
</div>
<p>Not a shared library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$deplibs_check_method&quot;</span> !<span class="o">=</span> pass_all; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-211" id="section-211">&#182;</a>
</div>
<p>We're trying link a shared library against a static one
but the system doesn't support it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-212" id="section-212">&#182;</a>
</div>
<p>Just print a warning and add the library to dependency_libs so
that the program can be linked against the static library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">$echo</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: This system can not link to static lib archive $lib.&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** I have the capability to make that library automatically link in when&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** you link to this library.  But I can only do this if you have a&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** shared version of the library, which you do not appear to have.&quot;</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$module&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** But as you try to build a module library, libtool will still create &quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** a static module, that should work as long as the dlopening application&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** is linked with the -dlopen flag to resolve symbols at runtime.&quot;</span>
        <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$global_symbol_pipe&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** However, this would only work if libtool was able to extract symbol&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** lists from a program, using \`nm&#39; or equivalent, but libtool could&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** not find such a program.  So, this module is probably useless.&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** \`nm&#39; from GNU binutils and a full rebuild may help.&quot;</span>
        <span class="k">fi</span>
<span class="k">        if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">    </span><span class="nv">build_libtool_libs</span><span class="o">=</span>module
    <span class="nv">build_old_libs</span><span class="o">=</span>yes
        <span class="k">else</span>
<span class="k">    </span><span class="nv">build_libtool_libs</span><span class="o">=</span>no
        <span class="k">fi</span>
<span class="k">      fi</span>
<span class="k">    else</span>
<span class="k">      </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$dir/$old_library $deplibs&quot;</span>
      <span class="nv">link_static</span><span class="o">=</span>yes
    <span class="k">fi</span>
<span class="k">  fi</span> <span class="c"># link shared/static library?</span>

  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> lib; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$dependency_libs&quot;</span> <span class="o">&amp;&amp;</span>
       <span class="o">{</span> <span class="nb">test</span> <span class="s2">&quot;$hardcode_into_libs&quot;</span> !<span class="o">=</span> yes <span class="o">||</span>
         <span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes <span class="o">||</span>
         <span class="nb">test</span> <span class="s2">&quot;$link_static&quot;</span> <span class="o">=</span> yes; <span class="o">}</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-213" id="section-213">&#182;</a>
</div>
<p>Extract -R from dependency_libs</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">temp_deplibs</span><span class="o">=</span>
      <span class="k">for </span>libdir in <span class="nv">$dependency_libs</span>; <span class="k">do</span>
<span class="k">        case</span> <span class="nv">$libdir</span> in
        -R*<span class="o">)</span> <span class="nv">temp_xrpath</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libdir&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/^-R//&#39;</span><span class="sb">`</span>
       <span class="k">case</span> <span class="s2">&quot; $xrpath &quot;</span> in
       *<span class="s2">&quot; $temp_xrpath &quot;</span>*<span class="o">)</span> ;;
       *<span class="o">)</span> <span class="nv">xrpath</span><span class="o">=</span><span class="s2">&quot;$xrpath $temp_xrpath&quot;</span>;;
       <span class="k">esac</span>;;
        *<span class="o">)</span> <span class="nv">temp_deplibs</span><span class="o">=</span><span class="s2">&quot;$temp_deplibs $libdir&quot;</span>;;
        <span class="k">esac</span>
<span class="k">      done</span>
<span class="k">      </span><span class="nv">dependency_libs</span><span class="o">=</span><span class="s2">&quot;$temp_deplibs&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">newlib_search_path</span><span class="o">=</span><span class="s2">&quot;$newlib_search_path $absdir&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-214" id="section-214">&#182;</a>
</div>
<p>Link against this library</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">test</span> <span class="s2">&quot;$link_static&quot;</span> <span class="o">=</span> no <span class="o">&amp;&amp;</span> <span class="nv">newdependency_libs</span><span class="o">=</span><span class="s2">&quot;$abs_ladir/$laname $newdependency_libs&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-215" id="section-215">&#182;</a>
</div>
<p>... and its dependency_libs</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">tmp_libs</span><span class="o">=</span>
    <span class="k">for </span>deplib in <span class="nv">$dependency_libs</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">newdependency_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $newdependency_libs&quot;</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$duplicate_deps&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">        case</span> <span class="s2">&quot;$tmp_libs &quot;</span> in
        *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> <span class="nv">specialdeplibs</span><span class="o">=</span><span class="s2">&quot;$specialdeplibs $deplib&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      </span><span class="nv">tmp_libs</span><span class="o">=</span><span class="s2">&quot;$tmp_libs $deplib&quot;</span>
    <span class="k">done</span>

<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$link_all_deplibs&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-216" id="section-216">&#182;</a>
</div>
<p>Add the search paths of all dependency libraries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">for </span>deplib in <span class="nv">$dependency_libs</span>; <span class="k">do</span>
<span class="k">        case</span> <span class="nv">$deplib</span> in
        -L*<span class="o">)</span> <span class="nv">path</span><span class="o">=</span><span class="s2">&quot;$deplib&quot;</span> ;;
        *.la<span class="o">)</span>
    <span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$deplib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
    <span class="nb">test</span> <span class="s2">&quot;X$dir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$deplib&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;.&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-217" id="section-217">&#182;</a>
</div>
<p>We need an absolute path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$dir</span> in
    <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> <span class="nv">absdir</span><span class="o">=</span><span class="s2">&quot;$dir&quot;</span> ;;
    *<span class="o">)</span>
      <span class="nv">absdir</span><span class="o">=</span><span class="sb">`</span><span class="nb">cd</span> <span class="s2">&quot;$dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="sb">`</span>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$absdir&quot;</span>; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: cannot determine absolute directory name of \`$dir&#39;&quot;</span> 1&gt;&amp;2
        <span class="nv">absdir</span><span class="o">=</span><span class="s2">&quot;$dir&quot;</span>
      <span class="k">fi</span>
      ;;
    <span class="k">esac</span>
<span class="k">    if </span>grep <span class="s2">&quot;^installed=no&quot;</span> <span class="nv">$deplib</span> &gt; /dev/null; <span class="k">then</span>
<span class="k">      </span><span class="nv">path</span><span class="o">=</span><span class="s2">&quot;$absdir/$objdir&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">libdir</span><span class="o">=</span><span class="sb">`</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -n -e <span class="s1">&#39;s/^libdir=\(.*\)$/\1/p&#39;</span> <span class="nv">$deplib</span><span class="sb">`</span>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$libdir&quot;</span>; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$deplib&#39; is not a valid libtool archive&quot;</span> 1&gt;&amp;2
        <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-218" id="section-218">&#182;</a>
</div>
<p>if test "$absdir" != "$libdir"; then
 $echo "$modename: warning: `$deplib' seems to be moved" 1>&amp;2
fi</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">path</span><span class="o">=</span><span class="s2">&quot;$absdir&quot;</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">depdepl</span><span class="o">=</span>
    <span class="k">case</span> <span class="nv">$host</span> in
    *-*-darwin*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-219" id="section-219">&#182;</a>
</div>
<p>we do not want to link against static libs,
but need to link against shared</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">eval </span><span class="nv">deplibrary_names</span><span class="o">=</span><span class="sb">`</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -n -e <span class="s1">&#39;s/^library_names=\(.*\)$/\1/p&#39;</span> <span class="nv">$deplib</span><span class="sb">`</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$deplibrary_names&quot;</span> ; <span class="k">then</span>
<span class="k">        for </span>tmp in <span class="nv">$deplibrary_names</span> ; <span class="k">do</span>
<span class="k">          </span><span class="nv">depdepl</span><span class="o">=</span><span class="nv">$tmp</span>
        <span class="k">done</span>
<span class="k">        if </span><span class="nb">test</span> -f <span class="s2">&quot;$path/$depdepl&quot;</span> ; <span class="k">then</span>
<span class="k">          </span><span class="nv">depdepl</span><span class="o">=</span><span class="s2">&quot;$path/$depdepl&quot;</span>
        <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-220" id="section-220">&#182;</a>
</div>
<p>do not add paths which are already there</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">case</span> <span class="s2">&quot; $newlib_search_path &quot;</span> in
        *<span class="s2">&quot; $path &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">newlib_search_path</span><span class="o">=</span><span class="s2">&quot;$newlib_search_path $path&quot;</span>;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      </span><span class="nv">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
      ;;
    *<span class="o">)</span>
      <span class="nv">path</span><span class="o">=</span><span class="s2">&quot;-L$path&quot;</span>
      ;;
    <span class="k">esac</span>
    ;;
        -l*<span class="o">)</span>
    <span class="k">case</span> <span class="nv">$host</span> in
    *-*-darwin*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-221" id="section-221">&#182;</a>
</div>
<p>Again, we only want to link against shared libraries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">eval </span><span class="nv">tmp_libs</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$deplib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s,^\-l,,&quot;</span><span class="sb">`</span>
      <span class="k">for </span>tmp in <span class="nv">$newlib_search_path</span> ; <span class="k">do</span>
<span class="k">        if </span><span class="nb">test</span> -f <span class="s2">&quot;$tmp/lib$tmp_libs.dylib&quot;</span> ; <span class="k">then</span>
<span class="k">          </span><span class="nb">eval </span><span class="nv">depdepl</span><span class="o">=</span><span class="s2">&quot;$tmp/lib$tmp_libs.dylib&quot;</span>
          <span class="nb">break</span>
<span class="nb">        </span><span class="k">fi</span>
<span class="k">      done</span>
<span class="k">      </span><span class="nv">path</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
      ;;
    *<span class="o">)</span> <span class="k">continue</span> ;;
    <span class="k">esac</span>
    ;;
        *<span class="o">)</span> <span class="k">continue</span> ;;
        <span class="k">esac</span>
<span class="k">        case</span> <span class="s2">&quot; $deplibs &quot;</span> in
        *<span class="s2">&quot; $path &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$path $deplibs&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">        case</span> <span class="s2">&quot; $deplibs &quot;</span> in
        *<span class="s2">&quot; $depdepl &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$depdepl $deplibs&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">      done</span>
<span class="k">    fi</span> <span class="c"># link_all_deplibs != no</span>
  <span class="k">fi</span> <span class="c"># linkmode = lib</span>
      <span class="k">done</span> <span class="c"># for deplib in $libs</span>
      <span class="nv">dependency_libs</span><span class="o">=</span><span class="s2">&quot;$newdependency_libs&quot;</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> <span class="o">=</span> dlpreopen; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-222" id="section-222">&#182;</a>
</div>
<p>Link the dlpreopened libraries before other libraries</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for </span>deplib in <span class="nv">$save_deplibs</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplib $deplibs&quot;</span>
  <span class="k">done</span>
<span class="k">      fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> !<span class="o">=</span> dlopen; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$pass&quot;</span> !<span class="o">=</span> conv; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-223" id="section-223">&#182;</a>
</div>
<p>Make sure lib_search_path contains only unique directories.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">lib_search_path</span><span class="o">=</span>
    <span class="k">for </span>dir in <span class="nv">$newlib_search_path</span>; <span class="k">do</span>
<span class="k">      case</span> <span class="s2">&quot;$lib_search_path &quot;</span> in
      *<span class="s2">&quot; $dir &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span> <span class="nv">lib_search_path</span><span class="o">=</span><span class="s2">&quot;$lib_search_path $dir&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">    done</span>
<span class="k">    </span><span class="nv">newlib_search_path</span><span class="o">=</span>
  <span class="k">fi</span>

<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode,$pass&quot;</span> !<span class="o">=</span> <span class="s2">&quot;prog,link&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">vars</span><span class="o">=</span><span class="s2">&quot;deplibs&quot;</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nv">vars</span><span class="o">=</span><span class="s2">&quot;compile_deplibs finalize_deplibs&quot;</span>
  <span class="k">fi</span>
<span class="k">  for </span>var in <span class="nv">$vars</span> dependency_libs; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-224" id="section-224">&#182;</a>
</div>
<p>Add libraries to $var in reverse order</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">eval </span><span class="nv">tmp_libs</span><span class="o">=</span><span class="se">\&quot;\$</span><span class="nv">$var</span><span class="se">\&quot;</span>
    <span class="nv">new_libs</span><span class="o">=</span>
    <span class="k">for </span>deplib in <span class="nv">$tmp_libs</span>; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-225" id="section-225">&#182;</a>
</div>
<p>FIXME: Pedantically, this is the right thing to do, so
       that some nasty dependency loop isn't accidentally
       broken:
new_libs="$deplib $new_libs"
Pragmatically, this seems to cause very few problems in
practice:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$deplib</span> in
      -L*<span class="o">)</span> <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $new_libs&quot;</span> ;;
      -R*<span class="o">)</span> ;;
      *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-226" id="section-226">&#182;</a>
</div>
<p>And here is the reason: when a library appears more
than once as an explicit dependence of a library, or
is implicitly linked in more than once by the
compiler, it is considered special, and multiple
occurrences thereof are not removed.  Compare this
with having the same library being listed as a
dependency of multiple other libraries: in this case,
we know (pedantically, we assume) the library does not
need to be listed more than once, so we keep only the
last copy.  This is not always right, but it is rare
enough that we require users that really mean to play
such unportable linking tricks to link the library
using -Wl,-lname, so that libtool does not consider it
for duplicate removal.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">case</span> <span class="s2">&quot; $specialdeplibs &quot;</span> in
        *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $new_libs&quot;</span> ;;
        *<span class="o">)</span>
    <span class="k">case</span> <span class="s2">&quot; $new_libs &quot;</span> in
    *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$deplib $new_libs&quot;</span> ;;
    <span class="k">esac</span>
    ;;
        <span class="k">esac</span>
        ;;
      <span class="k">esac</span>
<span class="k">    done</span>
<span class="k">    </span><span class="nv">tmp_libs</span><span class="o">=</span>
    <span class="k">for </span>deplib in <span class="nv">$new_libs</span>; <span class="k">do</span>
<span class="k">      case</span> <span class="nv">$deplib</span> in
      -L*<span class="o">)</span>
        <span class="k">case</span> <span class="s2">&quot; $tmp_libs &quot;</span> in
        *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">tmp_libs</span><span class="o">=</span><span class="s2">&quot;$tmp_libs $deplib&quot;</span> ;;
        <span class="k">esac</span>
        ;;
      *<span class="o">)</span> <span class="nv">tmp_libs</span><span class="o">=</span><span class="s2">&quot;$tmp_libs $deplib&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">    done</span>
<span class="k">    </span><span class="nb">eval</span> <span class="nv">$var</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$tmp_libs</span><span class="se">\&quot;</span>
  <span class="k">done</span> <span class="c"># for var</span>
      <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-227" id="section-227">&#182;</a>
</div>
<p>Last step: remove runtime libs from dependency_libs
(they stay in deplibs)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">tmp_libs</span><span class="o">=</span>
      <span class="k">for </span>i in <span class="nv">$dependency_libs</span> ; <span class="k">do</span>
<span class="k">  case</span> <span class="s2">&quot; $predeps $postdeps $compiler_lib_search_path &quot;</span> in
  *<span class="s2">&quot; $i &quot;</span>*<span class="o">)</span>
    <span class="nv">i</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    ;;
  <span class="k">esac</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$i&quot;</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nv">tmp_libs</span><span class="o">=</span><span class="s2">&quot;$tmp_libs $i&quot;</span>
  <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">      </span><span class="nv">dependency_libs</span><span class="o">=</span><span class="nv">$tmp_libs</span>
    <span class="k">done</span> <span class="c"># for pass</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$linkmode&quot;</span> <span class="o">=</span> prog; <span class="k">then</span>
<span class="k">      </span><span class="nv">dlfiles</span><span class="o">=</span><span class="s2">&quot;$newdlfiles&quot;</span>
      <span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$newdlprefiles&quot;</span>
    <span class="k">fi</span>

<span class="k">    case</span> <span class="nv">$linkmode</span> in
    oldlib<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$deplibs&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-l&#39; and \`-L&#39; are ignored for archives&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$dlfiles$dlprefiles&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$dlself&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-dlopen&#39; is ignored for archives&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$rpath&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-rpath&#39; is ignored for archives&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$xrpath&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-R&#39; is ignored for archives&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$vinfo&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-version-info/-version-number&#39; is ignored for archives&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$release&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-release&#39; is ignored for archives&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols&quot;</span> <span class="o">||</span> <span class="nb">test</span> -n <span class="s2">&quot;$export_symbols_regex&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-export-symbols&#39; is ignored for archives&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-228" id="section-228">&#182;</a>
</div>
<p>Now set the variables for building old libraries.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">build_libtool_libs</span><span class="o">=</span>no
      <span class="nv">oldlibs</span><span class="o">=</span><span class="s2">&quot;$output&quot;</span>
      <span class="nv">objs</span><span class="o">=</span><span class="s2">&quot;$objs$old_deplibs&quot;</span>
      ;;

    lib<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-229" id="section-229">&#182;</a>
</div>
<p>Make sure we only generate libraries of the form `libNAME.la'.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$outputname</span> in
      lib*<span class="o">)</span>
  <span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$outputname&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/\.la$//&#39;</span> -e <span class="s1">&#39;s/^lib//&#39;</span><span class="sb">`</span>
  <span class="nb">eval </span><span class="nv">shared_ext</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$shrext_cmds</span><span class="se">\&quot;</span>
  <span class="nb">eval </span><span class="nv">libname</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$libname_spec</span><span class="se">\&quot;</span>
  ;;
      *<span class="o">)</span>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$module&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: libtool library \`$output&#39; must begin with \`lib&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$need_lib_prefix&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-230" id="section-230">&#182;</a>
</div>
<p>Add the "lib" prefix for modules if required</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$outputname&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/\.la$//&#39;</span><span class="sb">`</span>
    <span class="nb">eval </span><span class="nv">shared_ext</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$shrext_cmds</span><span class="se">\&quot;</span>
    <span class="nb">eval </span><span class="nv">libname</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$libname_spec</span><span class="se">\&quot;</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nv">libname</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$outputname&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/\.la$//&#39;</span><span class="sb">`</span>
  <span class="k">fi</span>
  ;;
      <span class="k">esac</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$objs&quot;</span>; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$deplibs_check_method&quot;</span> !<span class="o">=</span> pass_all; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot build libtool library \`$output&#39; from non-libtool objects on this host:$objs&quot;</span> 2&gt;&amp;1
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">else</span>
    <span class="nv">$echo</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: Linking the shared library $output against the non-libtool&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** objects $objs is not portable!&quot;</span>
    <span class="nv">libobjs</span><span class="o">=</span><span class="s2">&quot;$libobjs $objs&quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$dlself&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-dlopen self&#39; is ignored for libtool libraries&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      </span><span class="nb">set </span>dummy <span class="nv">$rpath</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$#&quot;</span> -gt 2; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: ignoring multiple \`-rpath&#39;s for a libtool library&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">install_libdir</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>

      <span class="nv">oldlibs</span><span class="o">=</span>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$rpath&quot;</span>; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-231" id="section-231">&#182;</a>
</div>
<p>Building a libtool convenience library.
Some compilers have problems with a `.al' extension so
convenience libraries should have the same extension an
archive normally would.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">oldlibs</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$libname.$libext $oldlibs&quot;</span>
    <span class="nv">build_libtool_libs</span><span class="o">=</span>convenience
    <span class="nv">build_old_libs</span><span class="o">=</span>yes
  <span class="k">fi</span>

<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$vinfo&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-version-info/-version-number&#39; is ignored for convenience libraries&quot;</span> 1&gt;&amp;2
  <span class="k">fi</span>

<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$release&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-release&#39; is ignored for convenience libraries&quot;</span> 1&gt;&amp;2
  <span class="k">fi</span>
<span class="k">      else</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-232" id="section-232">&#182;</a>
</div>
<p>Parse the version information argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;:&#39;</span>
  <span class="nb">set </span>dummy <span class="nv">$vinfo</span> 0 0 0
  <span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>

  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$8&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: too many parameters to \`-version-info&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-233" id="section-233">&#182;</a>
</div>
<p>convert absolute version numbers to libtool ages
this retains compatibility with .la files and attempts
to make the code below a bit more comprehensible</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

  <span class="k">case</span> <span class="nv">$vinfo_number</span> in
  yes<span class="o">)</span>
    <span class="nv">number_major</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>
    <span class="nv">number_minor</span><span class="o">=</span><span class="s2">&quot;$3&quot;</span>
    <span class="nv">number_revision</span><span class="o">=</span><span class="s2">&quot;$4&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-234" id="section-234">&#182;</a>
</div>
<p>There are really only two kinds -- those that
use the current revision as the major version
and those that subtract age and use age as
a minor version.  But, then there is irix
which has an extra 1 added just for fun</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$version_type</span> in
    darwin|linux|osf|windows|none<span class="o">)</span>
      <span class="nv">current</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$number_major</span> + <span class="nv">$number_minor</span><span class="sb">`</span>
      <span class="nv">age</span><span class="o">=</span><span class="s2">&quot;$number_minor&quot;</span>
      <span class="nv">revision</span><span class="o">=</span><span class="s2">&quot;$number_revision&quot;</span>
      ;;
    freebsd-aout|freebsd-elf|sunos<span class="o">)</span>
      <span class="nv">current</span><span class="o">=</span><span class="s2">&quot;$number_major&quot;</span>
      <span class="nv">revision</span><span class="o">=</span><span class="s2">&quot;$number_minor&quot;</span>
      <span class="nv">age</span><span class="o">=</span><span class="s2">&quot;0&quot;</span>
      ;;
    irix|nonstopux<span class="o">)</span>
      <span class="nv">current</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$number_major</span> + <span class="nv">$number_minor</span><span class="sb">`</span>
      <span class="nv">age</span><span class="o">=</span><span class="s2">&quot;$number_minor&quot;</span>
      <span class="nv">revision</span><span class="o">=</span><span class="s2">&quot;$number_minor&quot;</span>
      <span class="nv">lt_irix_increment</span><span class="o">=</span>no
      ;;
    <span class="k">esac</span>
    ;;
  no<span class="o">)</span>
    <span class="nv">current</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>
    <span class="nv">revision</span><span class="o">=</span><span class="s2">&quot;$3&quot;</span>
    <span class="nv">age</span><span class="o">=</span><span class="s2">&quot;$4&quot;</span>
    ;;
  <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-235" id="section-235">&#182;</a>
</div>
<p>Check that each of the things are valid numbers.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$current</span> in
  0|<span class="o">[</span>1-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">])</span> ;;
  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: CURRENT \`$current&#39; must be a nonnegative integer&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$vinfo&#39; is not valid version information&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>

<span class="k">  case</span> <span class="nv">$revision</span> in
  0|<span class="o">[</span>1-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">])</span> ;;
  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: REVISION \`$revision&#39; must be a nonnegative integer&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$vinfo&#39; is not valid version information&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>

<span class="k">  case</span> <span class="nv">$age</span> in
  0|<span class="o">[</span>1-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">]</span>|<span class="o">[</span>1-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">][</span>0-9<span class="o">])</span> ;;
  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: AGE \`$age&#39; must be a nonnegative integer&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$vinfo&#39; is not valid version information&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>

<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$age&quot;</span> -gt <span class="s2">&quot;$current&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: AGE \`$age&#39; is greater than the current interface number \`$current&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$vinfo&#39; is not valid version information&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-236" id="section-236">&#182;</a>
</div>
<p>Calculate the version variables.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">major</span><span class="o">=</span>
  <span class="nv">versuffix</span><span class="o">=</span>
  <span class="nv">verstring</span><span class="o">=</span>
  <span class="k">case</span> <span class="nv">$version_type</span> in
  none<span class="o">)</span> ;;

  darwin<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-237" id="section-237">&#182;</a>
</div>
<p>Like Linux, but with the current version available in
verstring for coding it into the library header</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">major</span><span class="o">=</span>.<span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$age</span><span class="sb">`</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;$major.$age.$revision&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-238" id="section-238">&#182;</a>
</div>
<p>Darwin ld doesn't like 0 for these options...</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">minor_current</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$current</span> + 1<span class="sb">`</span>
    <span class="nv">xlcverstring</span><span class="o">=</span><span class="s2">&quot;${wl}-compatibility_version ${wl}$minor_current ${wl}-current_version ${wl}$minor_current.$revision&quot;</span>
    <span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;-compatibility_version $minor_current -current_version $minor_current.$revision&quot;</span>
    ;;

  freebsd-aout<span class="o">)</span>
    <span class="nv">major</span><span class="o">=</span><span class="s2">&quot;.$current&quot;</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;.$current.$revision&quot;</span>;
    ;;

  freebsd-elf<span class="o">)</span>
    <span class="nv">major</span><span class="o">=</span><span class="s2">&quot;.$current&quot;</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;.$current&quot;</span>;
    ;;

  irix | nonstopux<span class="o">)</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$lt_irix_increment&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xno&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">major</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$age</span><span class="sb">`</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">major</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$age</span> + 1<span class="sb">`</span>
    <span class="k">fi</span>
<span class="k">    case</span> <span class="nv">$version_type</span> in
      nonstopux<span class="o">)</span> <span class="nv">verstring_prefix</span><span class="o">=</span>nonstopux ;;
      *<span class="o">)</span>         <span class="nv">verstring_prefix</span><span class="o">=</span>sgi ;;
    <span class="k">esac</span>
<span class="k">    </span><span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;$verstring_prefix$major.$revision&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-239" id="section-239">&#182;</a>
</div>
<p>Add in all the interfaces that we are compatible with.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">loop</span><span class="o">=</span><span class="nv">$revision</span>
    <span class="k">while </span><span class="nb">test</span> <span class="s2">&quot;$loop&quot;</span> -ne 0; <span class="k">do</span>
<span class="k">      </span><span class="nv">iface</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$revision</span> - <span class="nv">$loop</span><span class="sb">`</span>
      <span class="nv">loop</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$loop</span> - 1<span class="sb">`</span>
      <span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;$verstring_prefix$major.$iface:$verstring&quot;</span>
    <span class="k">done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-240" id="section-240">&#182;</a>
</div>
<p>Before this point, $major must not contain `.'.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">major</span><span class="o">=</span>.<span class="nv">$major</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;$major.$revision&quot;</span>
    ;;

  linux<span class="o">)</span>
    <span class="nv">major</span><span class="o">=</span>.<span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$age</span><span class="sb">`</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;$major.$age.$revision&quot;</span>
    ;;

  osf<span class="o">)</span>
    <span class="nv">major</span><span class="o">=</span>.<span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$age</span><span class="sb">`</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;.$current.$age.$revision&quot;</span>
    <span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;$current.$age.$revision&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-241" id="section-241">&#182;</a>
</div>
<p>Add in all the interfaces that we are compatible with.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">loop</span><span class="o">=</span><span class="nv">$age</span>
    <span class="k">while </span><span class="nb">test</span> <span class="s2">&quot;$loop&quot;</span> -ne 0; <span class="k">do</span>
<span class="k">      </span><span class="nv">iface</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$loop</span><span class="sb">`</span>
      <span class="nv">loop</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$loop</span> - 1<span class="sb">`</span>
      <span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;$verstring:${iface}.0&quot;</span>
    <span class="k">done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-242" id="section-242">&#182;</a>
</div>
<p>Make executables depend on our current version.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;$verstring:${current}.0&quot;</span>
    ;;

  sunos<span class="o">)</span>
    <span class="nv">major</span><span class="o">=</span><span class="s2">&quot;.$current&quot;</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;.$current.$revision&quot;</span>
    ;;

  windows<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-243" id="section-243">&#182;</a>
</div>
<p>Use '-' rather than '.', since we only want one
extension on DOS 8.3 filesystems.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">major</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$current</span> - <span class="nv">$age</span><span class="sb">`</span>
    <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;-$major&quot;</span>
    ;;

  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: unknown library version type \`$version_type&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;Fatal configuration error.  See the $PACKAGE docs for more information.&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-244" id="section-244">&#182;</a>
</div>
<p>Clear the version info if we defaulted, and they specified a release.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$vinfo&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$release&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">major</span><span class="o">=</span>
    <span class="k">case</span> <span class="nv">$version_type</span> in
    darwin<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-245" id="section-245">&#182;</a>
</div>
<p>we can't check for "0.0" in archive_cmds due to quoting
problems, so we reset it completely</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">verstring</span><span class="o">=</span>
      ;;
    *<span class="o">)</span>
      <span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;0.0&quot;</span>
      ;;
    <span class="k">esac</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$need_version&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">      </span><span class="nv">versuffix</span><span class="o">=</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;.0.0&quot;</span>
    <span class="k">fi</span>
<span class="k">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-246" id="section-246">&#182;</a>
</div>
<p>Remove version info from name if versioning should be avoided</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$avoid_version&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$need_version&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">    </span><span class="nv">major</span><span class="o">=</span>
    <span class="nv">versuffix</span><span class="o">=</span>
    <span class="nv">verstring</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-247" id="section-247">&#182;</a>
</div>
<p>Check to see if the archive will have undefined symbols.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$allow_undefined&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$allow_undefined_flag&quot;</span> <span class="o">=</span> unsupported; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: undefined symbols not allowed in $host shared libraries&quot;</span> 1&gt;&amp;2
      <span class="nv">build_libtool_libs</span><span class="o">=</span>no
      <span class="nv">build_old_libs</span><span class="o">=</span>yes
    <span class="k">fi</span>
<span class="k">  else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-248" id="section-248">&#182;</a>
</div>
<p>Don't allow undefined symbols.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">allow_undefined_flag</span><span class="o">=</span><span class="s2">&quot;$no_undefined_flag&quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> !<span class="o">=</span> relink; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-249" id="section-249">&#182;</a>
</div>
<p>Remove our outputs, but don't remove object files since they
may have been created when compiling PIC objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">removelist</span><span class="o">=</span>
  <span class="nv">tempremovelist</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;$output_objdir/*&quot;</span><span class="sb">`</span>
  <span class="k">for </span>p in <span class="nv">$tempremovelist</span>; <span class="k">do</span>
<span class="k">    case</span> <span class="nv">$p</span> in
      *.<span class="nv">$objext</span><span class="o">)</span>
         ;;
      <span class="nv">$output_objdir</span>/<span class="nv">$outputname</span> | <span class="nv">$output_objdir</span>/<span class="nv">$libname</span>.* | <span class="nv">$output_objdir</span>/<span class="k">${</span><span class="nv">libname</span><span class="k">}${</span><span class="nv">release</span><span class="k">}</span>.*<span class="o">)</span>
         <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$precious_files_regex&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X&quot;</span>; <span class="k">then</span>
<span class="k">           if </span><span class="nb">echo</span> <span class="nv">$p</span> | <span class="nv">$EGREP</span> -e <span class="s2">&quot;$precious_files_regex&quot;</span> &gt;/dev/null 2&gt;&amp;1
           <span class="k">then</span>
<span class="k">       continue</span>
<span class="k">     fi</span>
<span class="k">         fi</span>
<span class="k">         </span><span class="nv">removelist</span><span class="o">=</span><span class="s2">&quot;$removelist $p&quot;</span>
         ;;
      *<span class="o">)</span> ;;
    <span class="k">esac</span>
<span class="k">  done</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$removelist&quot;</span>; <span class="k">then</span>
    <span class="nv">$show</span> <span class="s2">&quot;${rm}r $removelist&quot;</span>
    <span class="nv">$run</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="nv">$removelist</span>
  <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-250" id="section-250">&#182;</a>
</div>
<p>Now set the variables for building old libraries.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> !<span class="o">=</span> convenience ; <span class="k">then</span>
<span class="k">  </span><span class="nv">oldlibs</span><span class="o">=</span><span class="s2">&quot;$oldlibs $output_objdir/$libname.$libext&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-251" id="section-251">&#182;</a>
</div>
<p>Transform .lo files to .o files.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">oldobjs</span><span class="o">=</span><span class="s2">&quot;$objs &quot;</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libobjs&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;/\.&#39;</span><span class="k">${</span><span class="nv">libext</span><span class="k">}</span><span class="s1">&#39;$/d&#39;</span> -e <span class="s2">&quot;$lo2o&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-252" id="section-252">&#182;</a>
</div>
<p>Eliminate all temporary directories.
for path in $notinst_path; do
lib_search_path=<code>$echo "$lib_search_path " | ${SED} -e "s% $path % %g"</code>
deplibs=<code>$echo "$deplibs " | ${SED} -e "s% -L$path % %g"</code>
dependency_libs=<code>$echo "$dependency_libs " | ${SED} -e "s% -L$path % %g"</code>
done</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$xrpath&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-253" id="section-253">&#182;</a>
</div>
<p>If the user specified any rpath flags, then add them.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">temp_xrpath</span><span class="o">=</span>
  <span class="k">for </span>libdir in <span class="nv">$xrpath</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">temp_xrpath</span><span class="o">=</span><span class="s2">&quot;$temp_xrpath -R$libdir&quot;</span>
    <span class="k">case</span> <span class="s2">&quot;$finalize_rpath &quot;</span> in
    *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">finalize_rpath</span><span class="o">=</span><span class="s2">&quot;$finalize_rpath $libdir&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">  done</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_into_libs&quot;</span> !<span class="o">=</span> yes <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    </span><span class="nv">dependency_libs</span><span class="o">=</span><span class="s2">&quot;$temp_xrpath $dependency_libs&quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-254" id="section-254">&#182;</a>
</div>
<p>Make sure dlfiles contains only unique files that won't be dlpreopened</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">old_dlfiles</span><span class="o">=</span><span class="s2">&quot;$dlfiles&quot;</span>
      <span class="nv">dlfiles</span><span class="o">=</span>
      <span class="k">for </span>lib in <span class="nv">$old_dlfiles</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="s2">&quot; $dlprefiles $dlfiles &quot;</span> in
  *<span class="s2">&quot; $lib &quot;</span>*<span class="o">)</span> ;;
  *<span class="o">)</span> <span class="nv">dlfiles</span><span class="o">=</span><span class="s2">&quot;$dlfiles $lib&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">      done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-255" id="section-255">&#182;</a>
</div>
<p>Make sure dlprefiles contains only unique files</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">old_dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles&quot;</span>
      <span class="nv">dlprefiles</span><span class="o">=</span>
      <span class="k">for </span>lib in <span class="nv">$old_dlprefiles</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="s2">&quot;$dlprefiles &quot;</span> in
  *<span class="s2">&quot; $lib &quot;</span>*<span class="o">)</span> ;;
  *<span class="o">)</span> <span class="nv">dlprefiles</span><span class="o">=</span><span class="s2">&quot;$dlprefiles $lib&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">      done</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$rpath&quot;</span>; <span class="k">then</span>
<span class="k">    case</span> <span class="nv">$host</span> in
    *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2* | *-*-beos*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-256" id="section-256">&#182;</a>
</div>
<p>these systems don't actually have a c library (as such)!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      ;;
    *-*-rhapsody* | *-*-darwin1.<span class="o">[</span>012<span class="o">])</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-257" id="section-257">&#182;</a>
</div>
<p>Rhapsody C library is in the System framework</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs -framework System&quot;</span>
      ;;
    *-*-netbsd*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-258" id="section-258">&#182;</a>
</div>
<p>Don't link with libc until the a.out ld.so is fixed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      ;;
    *-*-openbsd* | *-*-freebsd* | *-*-dragonfly*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-259" id="section-259">&#182;</a>
</div>
<p>Do not include libc due to us having libc/libc_r.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      ;;
    *-*-sco3.2v5* | *-*-sco5v6*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-260" id="section-260">&#182;</a>
</div>
<p>Causes problems with __ctype</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      ;;
    *-*-sysv4.2uw2* | *-*-sysv5* | *-*-unixware* | *-*-OpenUNIX*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-261" id="section-261">&#182;</a>
</div>
<p>Compiler inserts libc in the correct place for threads to work</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      ;;
    *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-262" id="section-262">&#182;</a>
</div>
<p>Add libc to deplibs on all other systems if necessary.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_need_lc&quot;</span> <span class="o">=</span> <span class="s2">&quot;yes&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$deplibs -lc&quot;</span>
      <span class="k">fi</span>
      ;;
    <span class="k">esac</span>
<span class="k">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-263" id="section-263">&#182;</a>
</div>
<p>Transform deplibs into only deplibs that can be linked in shared.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">name_save</span><span class="o">=</span><span class="nv">$name</span>
  <span class="nv">libname_save</span><span class="o">=</span><span class="nv">$libname</span>
  <span class="nv">release_save</span><span class="o">=</span><span class="nv">$release</span>
  <span class="nv">versuffix_save</span><span class="o">=</span><span class="nv">$versuffix</span>
  <span class="nv">major_save</span><span class="o">=</span><span class="nv">$major</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-264" id="section-264">&#182;</a>
</div>
<p>I'm not sure if I'm treating the release correctly.  I think
release should show up in the -l (ie -lgmp5) so we don't want to
add it in twice.  Is that correct?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">release</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
  <span class="nv">versuffix</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
  <span class="nv">major</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
  <span class="nv">newdeplibs</span><span class="o">=</span>
  <span class="nv">droppeddeps</span><span class="o">=</span>no
  <span class="k">case</span> <span class="nv">$deplibs_check_method</span> in
  pass_all<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-265" id="section-265">&#182;</a>
</div>
<p>Don't check for shared/static.  Everything works.
This might be a little naive.  We might want to check
whether the library exists or not.  But this is on
osf3 &amp; osf4 and I'm not really sure... Just
implementing what was already the behavior.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">newdeplibs</span><span class="o">=</span><span class="nv">$deplibs</span>
    ;;
  test_compile<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-266" id="section-266">&#182;</a>
</div>
<p>This code stresses the "libraries are programs" paradigm to its
limits. Maybe even breaks it.  We compile a program, linking it
against the deplibs as a proxy for the library.  Then we can check
whether they linked in statically or dynamically with ldd.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$rm</span> conftest.c
    cat &gt; conftest.c <span class="s">&lt;&lt;EOF</span>
<span class="s">    int main() { return 0; }</span>
<span class="s">EOF</span>
    <span class="nv">$rm</span> conftest
    <span class="k">if</span> <span class="nv">$LTCC</span> <span class="nv">$LTCFLAGS</span> -o conftest conftest.c <span class="nv">$deplibs</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">ldd_output</span><span class="o">=</span><span class="sb">`</span>ldd conftest<span class="sb">`</span>
      <span class="k">for </span>i in <span class="nv">$deplibs</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$i</span> : <span class="s1">&#39;-l\(.*\)&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-267" id="section-267">&#182;</a>
</div>
<p>If $name is empty we are operating on a -L argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$name&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$name&quot;</span> !<span class="o">=</span> <span class="s2">&quot;0&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;X$allow_libtool_libs_with_static_runtimes&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">      case</span> <span class="s2">&quot; $predeps $postdeps &quot;</span> in
      *<span class="s2">&quot; $i &quot;</span>*<span class="o">)</span>
        <span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $i&quot;</span>
        <span class="nv">i</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
        ;;
      <span class="k">esac</span>
<span class="k">          fi</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$i&quot;</span> ; <span class="k">then</span>
<span class="k">      </span><span class="nv">libname</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\\</span><span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$libname_spec</span><span class="se">\&quot;</span><span class="sb">`</span>
      <span class="nv">deplib_matches</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\\</span><span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$library_names_spec</span><span class="se">\&quot;</span><span class="sb">`</span>
      <span class="nb">set </span>dummy <span class="nv">$deplib_matches</span>
      <span class="nv">deplib_match</span><span class="o">=</span><span class="nv">$2</span>
      <span class="k">if </span><span class="nb">test</span> <span class="sb">`</span>expr <span class="s2">&quot;$ldd_output&quot;</span> : <span class="s2">&quot;.*$deplib_match&quot;</span><span class="sb">`</span> -ne 0 ; <span class="k">then</span>
<span class="k">        </span><span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $i&quot;</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">droppeddeps</span><span class="o">=</span>yes
        <span class="nv">$echo</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: dynamic linker does not accept needed library $i.&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** I have the capability to make that library automatically link in when&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** you link to this library.  But I can only do this if you have a&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** shared version of the library, which I believe you do not have&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** because a test_compile did reveal that the linker did not use it for&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** its dynamic dependency list that programs get resolved with at runtime.&quot;</span>
      <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">        else</span>
<span class="k">    </span><span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $i&quot;</span>
        <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">    else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-268" id="section-268">&#182;</a>
</div>
<p>Error occurred in the first compile.  Let's try to salvage
the situation: Compile a separate program for each library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">for </span>i in <span class="nv">$deplibs</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$i</span> : <span class="s1">&#39;-l\(.*\)&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-269" id="section-269">&#182;</a>
</div>
<p>If $name is empty we are operating on a -L argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
              <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$name&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$name&quot;</span> !<span class="o">=</span> <span class="s2">&quot;0&quot;</span>; <span class="k">then</span>
    <span class="nv">$rm</span> conftest
    <span class="k">if</span> <span class="nv">$LTCC</span> <span class="nv">$LTCFLAGS</span> -o conftest conftest.c <span class="nv">$i</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">ldd_output</span><span class="o">=</span><span class="sb">`</span>ldd conftest<span class="sb">`</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$allow_libtool_libs_with_static_runtimes&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">        case</span> <span class="s2">&quot; $predeps $postdeps &quot;</span> in
        *<span class="s2">&quot; $i &quot;</span>*<span class="o">)</span>
          <span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $i&quot;</span>
          <span class="nv">i</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
          ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$i&quot;</span> ; <span class="k">then</span>
<span class="k">        </span><span class="nv">libname</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\\</span><span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$libname_spec</span><span class="se">\&quot;</span><span class="sb">`</span>
        <span class="nv">deplib_matches</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\\</span><span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$library_names_spec</span><span class="se">\&quot;</span><span class="sb">`</span>
        <span class="nb">set </span>dummy <span class="nv">$deplib_matches</span>
        <span class="nv">deplib_match</span><span class="o">=</span><span class="nv">$2</span>
        <span class="k">if </span><span class="nb">test</span> <span class="sb">`</span>expr <span class="s2">&quot;$ldd_output&quot;</span> : <span class="s2">&quot;.*$deplib_match&quot;</span><span class="sb">`</span> -ne 0 ; <span class="k">then</span>
<span class="k">          </span><span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $i&quot;</span>
        <span class="k">else</span>
<span class="k">          </span><span class="nv">droppeddeps</span><span class="o">=</span>yes
          <span class="nv">$echo</span>
          <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: dynamic linker does not accept needed library $i.&quot;</span>
          <span class="nv">$echo</span> <span class="s2">&quot;*** I have the capability to make that library automatically link in when&quot;</span>
          <span class="nv">$echo</span> <span class="s2">&quot;*** you link to this library.  But I can only do this if you have a&quot;</span>
          <span class="nv">$echo</span> <span class="s2">&quot;*** shared version of the library, which you do not appear to have&quot;</span>
          <span class="nv">$echo</span> <span class="s2">&quot;*** because a test_compile did reveal that the linker did not use this one&quot;</span>
          <span class="nv">$echo</span> <span class="s2">&quot;*** as a dynamic dependency that programs can get resolved with at runtime.&quot;</span>
        <span class="k">fi</span>
<span class="k">      fi</span>
<span class="k">    else</span>
<span class="k">      </span><span class="nv">droppeddeps</span><span class="o">=</span>yes
      <span class="nv">$echo</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** Warning!  Library $i is needed by this library but I was not able to&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** make it link in!  You will probably need to install it or some&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** library that it depends on before this library will be fully&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** functional.  Installing it before continuing would be even better.&quot;</span>
    <span class="k">fi</span>
<span class="k">        else</span>
<span class="k">    </span><span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $i&quot;</span>
        <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">    fi</span>
    ;;
  file_magic*<span class="o">)</span>
    <span class="nb">set </span>dummy <span class="nv">$deplibs_check_method</span>
    <span class="nv">file_magic_regex</span><span class="o">=</span><span class="sb">`</span>expr <span class="s2">&quot;$deplibs_check_method&quot;</span> : <span class="s2">&quot;$2 \(.*\)&quot;</span><span class="sb">`</span>
    <span class="k">for </span>a_deplib in <span class="nv">$deplibs</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$a_deplib</span> : <span class="s1">&#39;-l\(.*\)&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-270" id="section-270">&#182;</a>
</div>
<p>If $name is empty we are operating on a -L argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$name&quot;</span> !<span class="o">=</span> <span class="s2">&quot;&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span>  <span class="s2">&quot;$name&quot;</span> !<span class="o">=</span> <span class="s2">&quot;0&quot;</span>; <span class="k">then</span>
<span class="k">        if </span><span class="nb">test</span> <span class="s2">&quot;X$allow_libtool_libs_with_static_runtimes&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">    case</span> <span class="s2">&quot; $predeps $postdeps &quot;</span> in
    *<span class="s2">&quot; $a_deplib &quot;</span>*<span class="o">)</span>
      <span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $a_deplib&quot;</span>
      <span class="nv">a_deplib</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
      ;;
    <span class="k">esac</span>
<span class="k">        fi</span>
<span class="k">        if </span><span class="nb">test</span> -n <span class="s2">&quot;$a_deplib&quot;</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nv">libname</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\\</span><span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$libname_spec</span><span class="se">\&quot;</span><span class="sb">`</span>
    <span class="k">for </span>i in <span class="nv">$lib_search_path</span> <span class="nv">$sys_lib_search_path</span> <span class="nv">$shlib_search_path</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">potential_libs</span><span class="o">=</span><span class="sb">`</span>ls <span class="nv">$i</span>/<span class="nv">$libname</span><span class="o">[</span>.-<span class="o">]</span>* 2&gt;/dev/null<span class="sb">`</span>
      <span class="k">for </span>potent_lib in <span class="nv">$potential_libs</span>; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-271" id="section-271">&#182;</a>
</div>
<p>Follow soft links.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if </span>ls -lLd <span class="s2">&quot;$potent_lib&quot;</span> 2&gt;/dev/null <span class="se">\</span>
       | grep <span class="s2">&quot; -&gt; &quot;</span> &gt;/dev/null; <span class="k">then</span>
<span class="k">      continue</span>
<span class="k">          fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-272" id="section-272">&#182;</a>
</div>
<p>The statement above tries to avoid entering an
endless loop below, in case of cyclic links.
We might still enter an endless loop, since a link
loop can be closed while we follow links,
but so what?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nv">potlib</span><span class="o">=</span><span class="s2">&quot;$potent_lib&quot;</span>
          <span class="k">while </span><span class="nb">test</span> -h <span class="s2">&quot;$potlib&quot;</span> 2&gt;/dev/null; <span class="k">do</span>
<span class="k">      </span><span class="nv">potliblink</span><span class="o">=</span><span class="sb">`</span>ls -ld <span class="nv">$potlib</span> | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> <span class="s1">&#39;s/.* -&gt; //&#39;</span><span class="sb">`</span>
      <span class="k">case</span> <span class="nv">$potliblink</span> in
      <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> <span class="nv">potlib</span><span class="o">=</span><span class="s2">&quot;$potliblink&quot;</span>;;
      *<span class="o">)</span> <span class="nv">potlib</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$potlib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s,[^/]*$,,&#39;</span><span class="sb">`</span><span class="s2">&quot;$potliblink&quot;</span>;;
      <span class="k">esac</span>
<span class="k">          done</span>
<span class="k">          if </span><span class="nb">eval</span> <span class="nv">$file_magic_cmd</span> <span class="se">\&quot;\$</span>potlib<span class="se">\&quot;</span> 2&gt;/dev/null <span class="se">\</span>
       | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> 10q <span class="se">\</span>
       | <span class="nv">$EGREP</span> <span class="s2">&quot;$file_magic_regex&quot;</span> &gt; /dev/null; <span class="k">then</span>
<span class="k">      </span><span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $a_deplib&quot;</span>
      <span class="nv">a_deplib</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
      <span class="nb">break </span>2
          <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">    done</span>
<span class="k">        fi</span>
<span class="k">        if </span><span class="nb">test</span> -n <span class="s2">&quot;$a_deplib&quot;</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nv">droppeddeps</span><span class="o">=</span>yes
    <span class="nv">$echo</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** I have the capability to make that library automatically link in when&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** you link to this library.  But I can only do this if you have a&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** shared version of the library, which you do not appear to have&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** because I did check the linker path looking for a file starting&quot;</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$potlib&quot;</span> ; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** with $libname but no candidates were found. (...for file magic test)&quot;</span>
    <span class="k">else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** with $libname and none of the candidates passed a file format test&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** using a file magic. Last file checked: $potlib&quot;</span>
    <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">      else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-273" id="section-273">&#182;</a>
</div>
<p>Add a -L argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $a_deplib&quot;</span>
      <span class="k">fi</span>
<span class="k">    done</span> <span class="c"># Gone through all deplibs.</span>
    ;;
  match_pattern*<span class="o">)</span>
    <span class="nb">set </span>dummy <span class="nv">$deplibs_check_method</span>
    <span class="nv">match_pattern_regex</span><span class="o">=</span><span class="sb">`</span>expr <span class="s2">&quot;$deplibs_check_method&quot;</span> : <span class="s2">&quot;$2 \(.*\)&quot;</span><span class="sb">`</span>
    <span class="k">for </span>a_deplib in <span class="nv">$deplibs</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$a_deplib</span> : <span class="s1">&#39;-l\(.*\)&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-274" id="section-274">&#182;</a>
</div>
<p>If $name is empty we are operating on a -L argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$name&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$name&quot;</span> !<span class="o">=</span> <span class="s2">&quot;0&quot;</span>; <span class="k">then</span>
<span class="k">        if </span><span class="nb">test</span> <span class="s2">&quot;X$allow_libtool_libs_with_static_runtimes&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">    case</span> <span class="s2">&quot; $predeps $postdeps &quot;</span> in
    *<span class="s2">&quot; $a_deplib &quot;</span>*<span class="o">)</span>
      <span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $a_deplib&quot;</span>
      <span class="nv">a_deplib</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
      ;;
    <span class="k">esac</span>
<span class="k">        fi</span>
<span class="k">        if </span><span class="nb">test</span> -n <span class="s2">&quot;$a_deplib&quot;</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nv">libname</span><span class="o">=</span><span class="sb">`</span><span class="nb">eval</span> <span class="se">\\</span><span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$libname_spec</span><span class="se">\&quot;</span><span class="sb">`</span>
    <span class="k">for </span>i in <span class="nv">$lib_search_path</span> <span class="nv">$sys_lib_search_path</span> <span class="nv">$shlib_search_path</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">potential_libs</span><span class="o">=</span><span class="sb">`</span>ls <span class="nv">$i</span>/<span class="nv">$libname</span><span class="o">[</span>.-<span class="o">]</span>* 2&gt;/dev/null<span class="sb">`</span>
      <span class="k">for </span>potent_lib in <span class="nv">$potential_libs</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">potlib</span><span class="o">=</span><span class="s2">&quot;$potent_lib&quot;</span> <span class="c"># see symlink-check above in file_magic test</span>
        <span class="k">if </span><span class="nb">eval</span> <span class="nv">$echo</span> <span class="se">\&quot;</span><span class="nv">$potent_lib</span><span class="se">\&quot;</span> 2&gt;/dev/null <span class="se">\</span>
            | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> 10q <span class="se">\</span>
            | <span class="nv">$EGREP</span> <span class="s2">&quot;$match_pattern_regex&quot;</span> &gt; /dev/null; <span class="k">then</span>
<span class="k">          </span><span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $a_deplib&quot;</span>
          <span class="nv">a_deplib</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
          <span class="nb">break </span>2
        <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">    done</span>
<span class="k">        fi</span>
<span class="k">        if </span><span class="nb">test</span> -n <span class="s2">&quot;$a_deplib&quot;</span> ; <span class="k">then</span>
<span class="k">    </span><span class="nv">droppeddeps</span><span class="o">=</span>yes
    <span class="nv">$echo</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: linker path does not have real file for library $a_deplib.&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** I have the capability to make that library automatically link in when&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** you link to this library.  But I can only do this if you have a&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** shared version of the library, which you do not appear to have&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;*** because I did check the linker path looking for a file starting&quot;</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$potlib&quot;</span> ; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** with $libname but no candidates were found. (...for regex pattern test)&quot;</span>
    <span class="k">else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** with $libname and none of the candidates passed a file format test&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** using a regex pattern. Last file checked: $potlib&quot;</span>
    <span class="k">fi</span>
<span class="k">        fi</span>
<span class="k">      else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-275" id="section-275">&#182;</a>
</div>
<p>Add a -L argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;$newdeplibs $a_deplib&quot;</span>
      <span class="k">fi</span>
<span class="k">    done</span> <span class="c"># Gone through all deplibs.</span>
    ;;
  none | unknown | *<span class="o">)</span>
    <span class="nv">newdeplibs</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="nv">tmp_deplibs</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X $deplibs&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/ -lc$//&#39;</span> <span class="se">\</span>
      -e <span class="s1">&#39;s/ -[LR][^ ]*//g&#39;</span><span class="sb">`</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$allow_libtool_libs_with_static_runtimes&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xyes&quot;</span> ; <span class="k">then</span>
<span class="k">      for </span>i in <span class="nv">$predeps</span> <span class="nv">$postdeps</span> ; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-276" id="section-276">&#182;</a>
</div>
<p>can't use Xsed below, because $i might contain '/'</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">tmp_deplibs</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X $tmp_deplibs&quot;</span> | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s2">&quot;1s,^X,,&quot;</span> -e <span class="s2">&quot;s,$i,,&quot;</span><span class="sb">`</span>
      <span class="k">done</span>
<span class="k">    fi</span>
<span class="k">    if</span> <span class="nv">$echo</span> <span class="s2">&quot;X $tmp_deplibs&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/[   ]//g&#39;</span> <span class="se">\</span>
      | grep . &gt;/dev/null; <span class="k">then</span>
      <span class="nv">$echo</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$deplibs_check_method&quot;</span> <span class="o">=</span> <span class="s2">&quot;Xnone&quot;</span>; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: inter-library dependencies are not supported in this platform.&quot;</span>
      <span class="k">else</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: inter-library dependencies are not known to be supported.&quot;</span>
      <span class="k">fi</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** All declared inter-library dependencies are being dropped.&quot;</span>
      <span class="nv">droppeddeps</span><span class="o">=</span>yes
    <span class="k">fi</span>
    ;;
  <span class="k">esac</span>
<span class="k">  </span><span class="nv">versuffix</span><span class="o">=</span><span class="nv">$versuffix_save</span>
  <span class="nv">major</span><span class="o">=</span><span class="nv">$major_save</span>
  <span class="nv">release</span><span class="o">=</span><span class="nv">$release_save</span>
  <span class="nv">libname</span><span class="o">=</span><span class="nv">$libname_save</span>
  <span class="nv">name</span><span class="o">=</span><span class="nv">$name_save</span>

  <span class="k">case</span> <span class="nv">$host</span> in
  *-*-rhapsody* | *-*-darwin1.<span class="o">[</span>012<span class="o">])</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-277" id="section-277">&#182;</a>
</div>
<p>On Rhapsody replace the C library is the System framework</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">newdeplibs</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X $newdeplibs&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/ -lc / -framework System /&#39;</span><span class="sb">`</span>
    ;;
  <span class="k">esac</span>

<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$droppeddeps&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$module&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
      <span class="nv">$echo</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** Warning: libtool could not satisfy all declared inter-library&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** dependencies of module $libname.  Therefore, libtool will create&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** a static module, that should work as long as the dlopening&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** application is linked with the -dlopen flag.&quot;</span>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$global_symbol_pipe&quot;</span>; <span class="k">then</span>
        <span class="nv">$echo</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** However, this would only work if libtool was able to extract symbol&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** lists from a program, using \`nm&#39; or equivalent, but libtool could&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** not find such a program.  So, this module is probably useless.&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** \`nm&#39; from GNU binutils and a full rebuild may help.&quot;</span>
      <span class="k">fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">        </span><span class="nv">oldlibs</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$libname.$libext&quot;</span>
        <span class="nv">build_libtool_libs</span><span class="o">=</span>module
        <span class="nv">build_old_libs</span><span class="o">=</span>yes
      <span class="k">else</span>
<span class="k">        </span><span class="nv">build_libtool_libs</span><span class="o">=</span>no
      <span class="k">fi</span>
<span class="k">    else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** The inter-library dependencies that have been dropped here will be&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** automatically added whenever a program is linked with this library&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;*** or is declared to -dlopen it.&quot;</span>

      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$allow_undefined&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
        <span class="nv">$echo</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** Since this library must not contain undefined symbols,&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** because either the platform does not support them or&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** it was explicitly requested with -no-undefined,&quot;</span>
        <span class="nv">$echo</span> <span class="s2">&quot;*** libtool will only create a static version of it.&quot;</span>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> no; <span class="k">then</span>
<span class="k">    </span><span class="nv">oldlibs</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$libname.$libext&quot;</span>
    <span class="nv">build_libtool_libs</span><span class="o">=</span>module
    <span class="nv">build_old_libs</span><span class="o">=</span>yes
        <span class="k">else</span>
<span class="k">    </span><span class="nv">build_libtool_libs</span><span class="o">=</span>no
        <span class="k">fi</span>
<span class="k">      fi</span>
<span class="k">    fi</span>
<span class="k">  fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-278" id="section-278">&#182;</a>
</div>
<p>Done checking deplibs!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">deplibs</span><span class="o">=</span><span class="nv">$newdeplibs</span>
      <span class="k">fi</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-279" id="section-279">&#182;</a>
</div>
<p>move library search paths that coincide with paths to not yet
installed libraries to the beginning of the library search list</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">new_libs</span><span class="o">=</span>
      <span class="k">for </span>path in <span class="nv">$notinst_path</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="s2">&quot; $new_libs &quot;</span> in
  *<span class="s2">&quot; -L$path/$objdir &quot;</span>*<span class="o">)</span> ;;
  *<span class="o">)</span>
    <span class="k">case</span> <span class="s2">&quot; $deplibs &quot;</span> in
    *<span class="s2">&quot; -L$path/$objdir &quot;</span>*<span class="o">)</span>
      <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$new_libs -L$path/$objdir&quot;</span> ;;
    <span class="k">esac</span>
    ;;
  <span class="k">esac</span>
<span class="k">      done</span>
<span class="k">      for </span>deplib in <span class="nv">$deplibs</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="nv">$deplib</span> in
  -L*<span class="o">)</span>
    <span class="k">case</span> <span class="s2">&quot; $new_libs &quot;</span> in
    *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$new_libs $deplib&quot;</span> ;;
    <span class="k">esac</span>
    ;;
  *<span class="o">)</span> <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$new_libs $deplib&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">      done</span>
<span class="k">      </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$new_libs&quot;</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-280" id="section-280">&#182;</a>
</div>
<p>All the library-specific variables (install_libdir is set above).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">library_names</span><span class="o">=</span>
      <span class="nv">old_library</span><span class="o">=</span>
      <span class="nv">dlname</span><span class="o">=</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-281" id="section-281">&#182;</a>
</div>
<p>Test again, we may have decided not to build it any more</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_into_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-282" id="section-282">&#182;</a>
</div>
<p>Hardcode the library paths</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">hardcode_libdirs</span><span class="o">=</span>
    <span class="nv">dep_rpath</span><span class="o">=</span>
    <span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$finalize_rpath&quot;</span>
    <span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> !<span class="o">=</span> relink <span class="o">&amp;&amp;</span> <span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$compile_rpath$rpath&quot;</span>
    <span class="k">for </span>libdir in <span class="nv">$rpath</span>; <span class="k">do</span>
<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">        if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_separator&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$hardcode_libdirs&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">hardcode_libdirs</span><span class="o">=</span><span class="s2">&quot;$libdir&quot;</span>
    <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-283" id="section-283">&#182;</a>
</div>
<p>Just accumulate the unique libdirs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator</span> in
      *<span class="s2">&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;</span>*<span class="o">)</span>
        ;;
      *<span class="o">)</span>
        <span class="nv">hardcode_libdirs</span><span class="o">=</span><span class="s2">&quot;$hardcode_libdirs$hardcode_libdir_separator$libdir&quot;</span>
        ;;
      <span class="k">esac</span>
<span class="k">    fi</span>
<span class="k">        else</span>
<span class="k">    </span><span class="nb">eval </span><span class="nv">flag</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span>
    <span class="nv">dep_rpath</span><span class="o">=</span><span class="s2">&quot;$dep_rpath $flag&quot;</span>
        <span class="k">fi</span>
<span class="k">      elif </span><span class="nb">test</span> -n <span class="s2">&quot;$runpath_var&quot;</span>; <span class="k">then</span>
<span class="k">        case</span> <span class="s2">&quot;$perm_rpath &quot;</span> in
        *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
        *<span class="o">)</span> <span class="nv">perm_rpath</span><span class="o">=</span><span class="s2">&quot;$perm_rpath $libdir&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">    done</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-284" id="section-284">&#182;</a>
</div>
<p>Substitute the hardcoded libdirs into the rpath.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_separator&quot;</span> <span class="o">&amp;&amp;</span>
       <span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdirs&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">libdir</span><span class="o">=</span><span class="s2">&quot;$hardcode_libdirs&quot;</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_flag_spec_ld&quot;</span>; <span class="k">then</span>
<span class="k">        case</span> <span class="nv">$archive_cmds</span> in
        *<span class="se">\$</span>LD*<span class="o">)</span> <span class="nb">eval </span><span class="nv">dep_rpath</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$hardcode_libdir_flag_spec_ld</span><span class="se">\&quot;</span> ;;
        *<span class="o">)</span>      <span class="nb">eval </span><span class="nv">dep_rpath</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span> ;;
        <span class="k">esac</span>
<span class="k">      else</span>
<span class="k">        </span><span class="nb">eval </span><span class="nv">dep_rpath</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span>
      <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$runpath_var&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$perm_rpath&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-285" id="section-285">&#182;</a>
</div>
<p>We should set the runpath_var.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">rpath</span><span class="o">=</span>
      <span class="k">for </span>dir in <span class="nv">$perm_rpath</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath$dir:&quot;</span>
      <span class="k">done</span>
<span class="k">      </span><span class="nb">eval</span> <span class="s2">&quot;$runpath_var=&#39;$rpath\$$runpath_var&#39;; export $runpath_var&quot;</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nb">test</span> -n <span class="s2">&quot;$dep_rpath&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$dep_rpath $deplibs&quot;</span>
  <span class="k">fi</span>

<span class="k">  </span><span class="nv">shlibpath</span><span class="o">=</span><span class="s2">&quot;$finalize_shlibpath&quot;</span>
  <span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> !<span class="o">=</span> relink <span class="o">&amp;&amp;</span> <span class="nv">shlibpath</span><span class="o">=</span><span class="s2">&quot;$compile_shlibpath$shlibpath&quot;</span>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$shlibpath&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">eval</span> <span class="s2">&quot;$shlibpath_var=&#39;$shlibpath\$$shlibpath_var&#39;; export $shlibpath_var&quot;</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-286" id="section-286">&#182;</a>
</div>
<p>Get the real and link names of the library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">eval </span><span class="nv">shared_ext</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$shrext_cmds</span><span class="se">\&quot;</span>
  <span class="nb">eval </span><span class="nv">library_names</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$library_names_spec</span><span class="se">\&quot;</span>
  <span class="nb">set </span>dummy <span class="nv">$library_names</span>
  <span class="nv">realname</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>
  <span class="nb">shift</span>; <span class="nb">shift</span>

<span class="nb">  </span><span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$soname_spec&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">eval </span><span class="nv">soname</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$soname_spec</span><span class="se">\&quot;</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nv">soname</span><span class="o">=</span><span class="s2">&quot;$realname&quot;</span>
  <span class="k">fi</span>
<span class="k">  if </span><span class="nb">test</span> -z <span class="s2">&quot;$dlname&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">dlname</span><span class="o">=</span><span class="nv">$soname</span>
  <span class="k">fi</span>

<span class="k">  </span><span class="nv">lib</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$realname&quot;</span>
  <span class="nv">linknames</span><span class="o">=</span>
  <span class="k">for </span>link
  <span class="k">do</span>
<span class="k">    </span><span class="nv">linknames</span><span class="o">=</span><span class="s2">&quot;$linknames $link&quot;</span>
  <span class="k">done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-287" id="section-287">&#182;</a>
</div>
<p>Use standard objects if they are pic</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">test</span> -z <span class="s2">&quot;$pic_flag&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">libobjs</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libobjs&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-288" id="section-288">&#182;</a>
</div>
<p>Prepare the list of exported symbols</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$export_symbols&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$always_export_symbols&quot;</span> <span class="o">=</span> yes <span class="o">||</span> <span class="nb">test</span> -n <span class="s2">&quot;$export_symbols_regex&quot;</span>; <span class="k">then</span>
      <span class="nv">$show</span> <span class="s2">&quot;generating symbol list for \`$libname.la&#39;&quot;</span>
      <span class="nv">export_symbols</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$libname.exp&quot;</span>
      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$export_symbols</span>
      <span class="nv">cmds</span><span class="o">=</span><span class="nv">$export_symbols_cmds</span>
      <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
      <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
        <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
        <span class="k">if </span><span class="nv">len</span><span class="o">=</span><span class="sb">`</span>expr <span class="s2">&quot;X$cmd&quot;</span> : <span class="s2">&quot;.*&quot;</span><span class="sb">`</span> <span class="o">&amp;&amp;</span>
         <span class="nb">test</span> <span class="s2">&quot;$len&quot;</span> -le <span class="s2">&quot;$max_cmd_len&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$max_cmd_len&quot;</span> -le -1; <span class="k">then</span>
          <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
          <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
          <span class="nv">skipped_export</span><span class="o">=</span><span class="nb">false</span>
<span class="nb">        </span><span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-289" id="section-289">&#182;</a>
</div>
<p>The command line is too long to execute in one step.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nv">$show</span> <span class="s2">&quot;using reloadable object file for export list...&quot;</span>
          <span class="nv">skipped_export</span><span class="o">=</span>:

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-290" id="section-290">&#182;</a>
</div>
<p>Break out early, otherwise skipped_export may be
set to false by a later but shorter cmd.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">break</span>
<span class="nb">        </span><span class="k">fi</span>
<span class="k">      done</span>
<span class="k">      </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols_regex&quot;</span>; <span class="k">then</span>
        <span class="nv">$show</span> <span class="s2">&quot;$EGREP -e \&quot;$export_symbols_regex\&quot; \&quot;$export_symbols\&quot; &gt; \&quot;${export_symbols}T\&quot;&quot;</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$EGREP -e &quot;$export_symbols_regex&quot; &quot;$export_symbols&quot; &gt; &quot;${export_symbols}T&quot;&#39;</span>
        <span class="nv">$show</span> <span class="s2">&quot;$mv \&quot;${export_symbols}T\&quot; \&quot;$export_symbols\&quot;&quot;</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$mv &quot;${export_symbols}T&quot; &quot;$export_symbols&quot;&#39;</span>
      <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">  fi</span>

<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$include_expsyms&quot;</span>; <span class="k">then</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$echo &quot;X$include_expsyms&quot; | $SP2NL &gt;&gt; &quot;$export_symbols&quot;&#39;</span>
  <span class="k">fi</span>

<span class="k">  </span><span class="nv">tmp_deplibs</span><span class="o">=</span>
  <span class="k">for </span>test_deplib in <span class="nv">$deplibs</span>; <span class="k">do</span>
<span class="k">    case</span> <span class="s2">&quot; $convenience &quot;</span> in
    *<span class="s2">&quot; $test_deplib &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span>
      <span class="nv">tmp_deplibs</span><span class="o">=</span><span class="s2">&quot;$tmp_deplibs $test_deplib&quot;</span>
      ;;
    <span class="k">esac</span>
<span class="k">  done</span>
<span class="k">  </span><span class="nv">deplibs</span><span class="o">=</span><span class="s2">&quot;$tmp_deplibs&quot;</span>

  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$convenience&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$whole_archive_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">save_libobjs</span><span class="o">=</span><span class="nv">$libobjs</span>
      <span class="nb">eval </span><span class="nv">libobjs</span><span class="o">=</span><span class="se">\&quot;\$</span>libobjs <span class="nv">$whole_archive_flag_spec</span><span class="se">\&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">gentop</span><span class="o">=</span><span class="s2">&quot;$output_objdir/${outputname}x&quot;</span>
      <span class="nv">generated</span><span class="o">=</span><span class="s2">&quot;$generated $gentop&quot;</span>

      func_extract_archives <span class="nv">$gentop</span> <span class="nv">$convenience</span>
      <span class="nv">libobjs</span><span class="o">=</span><span class="s2">&quot;$libobjs $func_extract_archives_result&quot;</span>
    <span class="k">fi</span>
<span class="k">  fi</span>
<span class="k">  </span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$thread_safe&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$thread_safe_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">eval </span><span class="nv">flag</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$thread_safe_flag_spec</span><span class="se">\&quot;</span>
    <span class="nv">linker_flags</span><span class="o">=</span><span class="s2">&quot;$linker_flags $flag&quot;</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-291" id="section-291">&#182;</a>
</div>
<p>Make a backup of the uninstalled library when relinking</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> relink; <span class="k">then</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;(cd $output_objdir &amp;&amp; $rm ${realname}U &amp;&amp; $mv $realname ${realname}U)&#39;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-292" id="section-292">&#182;</a>
</div>
<p>Do each of the archive commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$module&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$module_cmds&quot;</span> ; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$module_expsym_cmds&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">test_cmds</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$module_expsym_cmds</span><span class="se">\&quot;</span>
      <span class="nv">cmds</span><span class="o">=</span><span class="nv">$module_expsym_cmds</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">test_cmds</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$module_cmds</span><span class="se">\&quot;</span>
      <span class="nv">cmds</span><span class="o">=</span><span class="nv">$module_cmds</span>
    <span class="k">fi</span>
<span class="k">  else</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$archive_expsym_cmds&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">eval </span><span class="nv">test_cmds</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$archive_expsym_cmds</span><span class="se">\&quot;</span>
    <span class="nv">cmds</span><span class="o">=</span><span class="nv">$archive_expsym_cmds</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nb">eval </span><span class="nv">test_cmds</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$archive_cmds</span><span class="se">\&quot;</span>
    <span class="nv">cmds</span><span class="o">=</span><span class="nv">$archive_cmds</span>
    <span class="k">fi</span>
<span class="k">  fi</span>

<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;X$skipped_export&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X:&quot;</span> <span class="o">&amp;&amp;</span>
     <span class="nv">len</span><span class="o">=</span><span class="sb">`</span>expr <span class="s2">&quot;X$test_cmds&quot;</span> : <span class="s2">&quot;.*&quot;</span> 2&gt;/dev/null<span class="sb">`</span> <span class="o">&amp;&amp;</span>
     <span class="nb">test</span> <span class="s2">&quot;$len&quot;</span> -le <span class="s2">&quot;$max_cmd_len&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$max_cmd_len&quot;</span> -le -1; <span class="k">then</span>
    :
  <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-293" id="section-293">&#182;</a>
</div>
<p>The command line is too long to link in one step, link piecewise.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$echo</span> <span class="s2">&quot;creating reloadable object files...&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-294" id="section-294">&#182;</a>
</div>
<p>Save the value of $output and $libobjs because we want to
use them later.  If we have whole_archive_flag_spec, we
want to use save_libobjs as it was before
whole_archive_flag_spec was expanded, because we can't
assume the linker understands whole_archive_flag_spec.
This may have to be revisited, in case too many
convenience libraries get linked in and end up exceeding
the spec.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$convenience&quot;</span> <span class="o">||</span> <span class="nb">test</span> -z <span class="s2">&quot;$whole_archive_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">save_libobjs</span><span class="o">=</span><span class="nv">$libobjs</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nv">save_output</span><span class="o">=</span><span class="nv">$output</span>
    <span class="nv">output_la</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$output&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$basename&quot;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-295" id="section-295">&#182;</a>
</div>
<p>Clear the reloadable object creation command queue and
initialize k to one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">test_cmds</span><span class="o">=</span>
    <span class="nv">concat_cmds</span><span class="o">=</span>
    <span class="nv">objlist</span><span class="o">=</span>
    <span class="nv">delfiles</span><span class="o">=</span>
    <span class="nv">last_robj</span><span class="o">=</span>
    <span class="nv">k</span><span class="o">=</span>1
    <span class="nv">output</span><span class="o">=</span><span class="nv">$output_objdir</span>/<span class="nv">$output_la</span>-<span class="k">${</span><span class="nv">k</span><span class="k">}</span>.<span class="nv">$objext</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-296" id="section-296">&#182;</a>
</div>
<p>Loop over the list of objects to be linked.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for </span>obj in <span class="nv">$save_libobjs</span>
    <span class="k">do</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">test_cmds</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$reload_cmds</span> <span class="nv">$objlist</span> <span class="nv">$last_robj</span><span class="se">\&quot;</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$objlist&quot;</span> <span class="o">=</span> X <span class="o">||</span>
         <span class="o">{</span> <span class="nv">len</span><span class="o">=</span><span class="sb">`</span>expr <span class="s2">&quot;X$test_cmds&quot;</span> : <span class="s2">&quot;.*&quot;</span> 2&gt;/dev/null<span class="sb">`</span> <span class="o">&amp;&amp;</span>
     <span class="nb">test</span> <span class="s2">&quot;$len&quot;</span> -le <span class="s2">&quot;$max_cmd_len&quot;</span>; <span class="o">}</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">objlist</span><span class="o">=</span><span class="s2">&quot;$objlist $obj&quot;</span>
      <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-297" id="section-297">&#182;</a>
</div>
<p>The command $test_cmds is almost too long, add a
command to the queue.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$k&quot;</span> -eq 1 ; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-298" id="section-298">&#182;</a>
</div>
<p>The first file doesn't have a previous command to add.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">eval </span><span class="nv">concat_cmds</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$reload_cmds</span> <span class="nv">$objlist</span> <span class="nv">$last_robj</span><span class="se">\&quot;</span>
        <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-299" id="section-299">&#182;</a>
</div>
<p>All subsequent reloadable object files will link in
the last one created.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">eval </span><span class="nv">concat_cmds</span><span class="o">=</span><span class="se">\&quot;\$</span>concat_cmds~<span class="nv">$reload_cmds</span> <span class="nv">$objlist</span> <span class="nv">$last_robj</span><span class="se">\&quot;</span>
        <span class="k">fi</span>
<span class="k">        </span><span class="nv">last_robj</span><span class="o">=</span><span class="nv">$output_objdir</span>/<span class="nv">$output_la</span>-<span class="k">${</span><span class="nv">k</span><span class="k">}</span>.<span class="nv">$objext</span>
        <span class="nv">k</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$k</span> + 1<span class="sb">`</span>
        <span class="nv">output</span><span class="o">=</span><span class="nv">$output_objdir</span>/<span class="nv">$output_la</span>-<span class="k">${</span><span class="nv">k</span><span class="k">}</span>.<span class="nv">$objext</span>
        <span class="nv">objlist</span><span class="o">=</span><span class="nv">$obj</span>
        <span class="nv">len</span><span class="o">=</span>1
      <span class="k">fi</span>
<span class="k">    done</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-300" id="section-300">&#182;</a>
</div>
<p>Handle the remaining objects by creating one last
reloadable object file.  All subsequent reloadable object
files will link in the last one created.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">test</span> -z <span class="s2">&quot;$concat_cmds&quot;</span> <span class="o">||</span> <span class="nv">concat_cmds</span><span class="o">=</span><span class="nv">$concat_cmds</span>~
    <span class="nb">eval </span><span class="nv">concat_cmds</span><span class="o">=</span><span class="se">\&quot;\$</span><span class="o">{</span>concat_cmds<span class="o">}</span><span class="nv">$reload_cmds</span> <span class="nv">$objlist</span> <span class="nv">$last_robj</span><span class="se">\&quot;</span>

    <span class="k">if</span> <span class="k">${</span><span class="nv">skipped_export</span><span class="p">-false</span><span class="k">}</span>; <span class="k">then</span>
      <span class="nv">$show</span> <span class="s2">&quot;generating symbol list for \`$libname.la&#39;&quot;</span>
      <span class="nv">export_symbols</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$libname.exp&quot;</span>
      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$export_symbols</span>
      <span class="nv">libobjs</span><span class="o">=</span><span class="nv">$output</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-301" id="section-301">&#182;</a>
</div>
<p>Append the command to create the export file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">eval </span><span class="nv">concat_cmds</span><span class="o">=</span><span class="se">\&quot;\$</span>concat_cmds~<span class="nv">$export_symbols_cmds</span><span class="se">\&quot;</span>
          <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-302" id="section-302">&#182;</a>
</div>
<p>Set up a command to remove the reloadable object files
after they are used.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">i</span><span class="o">=</span>0
    <span class="k">while </span><span class="nb">test</span> <span class="s2">&quot;$i&quot;</span> -lt <span class="s2">&quot;$k&quot;</span>
    <span class="k">do</span>
<span class="k">      </span><span class="nv">i</span><span class="o">=</span><span class="sb">`</span>expr <span class="nv">$i</span> + 1<span class="sb">`</span>
      <span class="nv">delfiles</span><span class="o">=</span><span class="s2">&quot;$delfiles $output_objdir/$output_la-${i}.$objext&quot;</span>
    <span class="k">done</span>

    <span class="nv">$echo</span> <span class="s2">&quot;creating a temporary reloadable object file: $output&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-303" id="section-303">&#182;</a>
</div>
<p>Loop through the commands generated above and execute them.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
    <span class="k">for </span>cmd in <span class="nv">$concat_cmds</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>

    <span class="nv">libobjs</span><span class="o">=</span><span class="nv">$output</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-304" id="section-304">&#182;</a>
</div>
<p>Restore the value of output.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">output</span><span class="o">=</span><span class="nv">$save_output</span>

    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$convenience&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$whole_archive_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">libobjs</span><span class="o">=</span><span class="se">\&quot;\$</span>libobjs <span class="nv">$whole_archive_flag_spec</span><span class="se">\&quot;</span>
    <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-305" id="section-305">&#182;</a>
</div>
<p>Expand the library linking commands again to reset the
value of $libobjs for piecewise linking.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-306" id="section-306">&#182;</a>
</div>
<p>Do each of the archive commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$module&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$module_cmds&quot;</span> ; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$module_expsym_cmds&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">cmds</span><span class="o">=</span><span class="nv">$module_expsym_cmds</span>
      <span class="k">else</span>
<span class="k">        </span><span class="nv">cmds</span><span class="o">=</span><span class="nv">$module_cmds</span>
      <span class="k">fi</span>
<span class="k">    else</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$archive_expsym_cmds&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">cmds</span><span class="o">=</span><span class="nv">$archive_expsym_cmds</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">cmds</span><span class="o">=</span><span class="nv">$archive_cmds</span>
      <span class="k">fi</span>
<span class="k">    fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-307" id="section-307">&#182;</a>
</div>
<p>Append the command to remove the reloadable object files
to the just-reset $cmds.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">eval </span><span class="nv">cmds</span><span class="o">=</span><span class="se">\&quot;\$</span>cmds~<span class="se">\$</span>rm <span class="nv">$delfiles</span><span class="se">\&quot;</span>
  <span class="k">fi</span>
<span class="k">  </span><span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
  <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
    <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="o">{</span>
      <span class="nv">lt_exit</span><span class="o">=</span><span class="nv">$?</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-308" id="section-308">&#182;</a>
</div>
<p>Restore the uninstalled library and exit</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> relink; <span class="k">then</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv ${realname}U $realname)&#39;</span>
      <span class="k">fi</span>

<span class="k">      </span><span class="nb">exit</span> <span class="nv">$lt_exit</span>
    <span class="o">}</span>
  <span class="k">done</span>
<span class="k">  </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-309" id="section-309">&#182;</a>
</div>
<p>Restore the uninstalled library and exit</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> relink; <span class="k">then</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv $realname ${realname}T &amp;&amp; $mv &quot;$realname&quot;U $realname)&#39;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>

    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$convenience&quot;</span>; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -z <span class="s2">&quot;$whole_archive_flag_spec&quot;</span>; <span class="k">then</span>
        <span class="nv">$show</span> <span class="s2">&quot;${rm}r $gentop&quot;</span>
        <span class="nv">$run</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="s2">&quot;$gentop&quot;</span>
      <span class="k">fi</span>
<span class="k">    fi</span>

<span class="k">    </span><span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-310" id="section-310">&#182;</a>
</div>
<p>Create links to the real library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for </span>linkname in <span class="nv">$linknames</span>; <span class="k">do</span>
<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$realname&quot;</span> !<span class="o">=</span> <span class="s2">&quot;$linkname&quot;</span>; <span class="k">then</span>
      <span class="nv">$show</span> <span class="s2">&quot;(cd $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)&quot;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;(cd $output_objdir &amp;&amp; $rm $linkname &amp;&amp; $LN_S $realname $linkname)&#39;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
    <span class="k">fi</span>
<span class="k">  done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-311" id="section-311">&#182;</a>
</div>
<p>If -module or -export-dynamic was specified, set the dlname.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$module&quot;</span> <span class="o">=</span> yes <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$export_dynamic&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-312" id="section-312">&#182;</a>
</div>
<p>On all known operating systems, these are identical.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">dlname</span><span class="o">=</span><span class="s2">&quot;$soname&quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>
      ;;

    obj<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$deplibs&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-l&#39; and \`-L&#39; are ignored for objects&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$dlfiles$dlprefiles&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$dlself&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-dlopen&#39; is ignored for objects&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$rpath&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-rpath&#39; is ignored for objects&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$xrpath&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-R&#39; is ignored for objects&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$vinfo&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-version-info&#39; is ignored for objects&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$release&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-release&#39; is ignored for objects&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      case</span> <span class="nv">$output</span> in
      *.lo<span class="o">)</span>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$objs$old_deplibs&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot build library object \`$output&#39; from non-libtool objects&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>
<span class="k">  </span><span class="nv">libobj</span><span class="o">=</span><span class="s2">&quot;$output&quot;</span>
  <span class="nv">obj</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$output&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span>
  ;;
      *<span class="o">)</span>
  <span class="nv">libobj</span><span class="o">=</span>
  <span class="nv">obj</span><span class="o">=</span><span class="s2">&quot;$output&quot;</span>
  ;;
      <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-313" id="section-313">&#182;</a>
</div>
<p>Delete the old objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$obj</span> <span class="nv">$libobj</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-314" id="section-314">&#182;</a>
</div>
<p>Objects from convenience libraries.  This assumes
single-version convenience libraries.  Whenever we create
different ones for PIC/non-PIC, this we'll have to duplicate
the extraction.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">reload_conv_objs</span><span class="o">=</span>
      <span class="nv">gentop</span><span class="o">=</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-315" id="section-315">&#182;</a>
</div>
<p>reload_cmds runs $LD directly, so let us get rid of
-Wl from whole_archive_flag_spec and hope we can get by with
turning comma into space..</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">wl</span><span class="o">=</span>

      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$convenience&quot;</span>; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$whole_archive_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">eval </span><span class="nv">tmp_whole_archive_flags</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$whole_archive_flag_spec</span><span class="se">\&quot;</span>
    <span class="nv">reload_conv_objs</span><span class="o">=</span><span class="nv">$reload_objs</span><span class="se">\ </span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$tmp_whole_archive_flags&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s|,| |g&#39;</span><span class="sb">`</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nv">gentop</span><span class="o">=</span><span class="s2">&quot;$output_objdir/${obj}x&quot;</span>
    <span class="nv">generated</span><span class="o">=</span><span class="s2">&quot;$generated $gentop&quot;</span>

    func_extract_archives <span class="nv">$gentop</span> <span class="nv">$convenience</span>
    <span class="nv">reload_conv_objs</span><span class="o">=</span><span class="s2">&quot;$reload_objs $func_extract_archives_result&quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-316" id="section-316">&#182;</a>
</div>
<p>Create the old-style object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">reload_objs</span><span class="o">=</span><span class="s2">&quot;$objs$old_deplibs &quot;</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libobjs&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;/\.&#39;</span><span class="k">${</span><span class="nv">libext</span><span class="k">}</span><span class="s1">$&#39;/d&#39;</span> -e <span class="s1">&#39;/\.lib$/d&#39;</span> -e <span class="s2">&quot;$lo2o&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span><span class="s2">&quot; $reload_conv_objs&quot;</span> <span class="c">### testsuite: skip nested quoting test</span>

      <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;$obj&quot;</span>
      <span class="nv">cmds</span><span class="o">=</span><span class="nv">$reload_cmds</span>
      <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
      <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">  </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
  <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
  <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
  <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
      <span class="k">done</span>
<span class="k">      </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-317" id="section-317">&#182;</a>
</div>
<p>Exit if we aren't doing a library object file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$libobj&quot;</span>; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$gentop&quot;</span>; <span class="k">then</span>
    <span class="nv">$show</span> <span class="s2">&quot;${rm}r $gentop&quot;</span>
    <span class="nv">$run</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="nv">$gentop</span>
  <span class="k">fi</span>

<span class="k">  </span><span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$gentop&quot;</span>; <span class="k">then</span>
    <span class="nv">$show</span> <span class="s2">&quot;${rm}r $gentop&quot;</span>
    <span class="nv">$run</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="nv">$gentop</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-318" id="section-318">&#182;</a>
</div>
<p>Create an invalid libtool object if no PIC, so that we don't
accidentally link it into a program.
$show "echo timestamp > $libobj"
$run eval "echo timestamp > $libobj" || exit $?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$pic_flag&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$pic_mode&quot;</span> !<span class="o">=</span> default; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-319" id="section-319">&#182;</a>
</div>
<p>Only do commands if we really have different PIC objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">reload_objs</span><span class="o">=</span><span class="s2">&quot;$libobjs $reload_conv_objs&quot;</span>
  <span class="nv">output</span><span class="o">=</span><span class="s2">&quot;$libobj&quot;</span>
  <span class="nv">cmds</span><span class="o">=</span><span class="nv">$reload_cmds</span>
  <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
  <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
    <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
  <span class="k">done</span>
<span class="k">  </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$gentop&quot;</span>; <span class="k">then</span>
  <span class="nv">$show</span> <span class="s2">&quot;${rm}r $gentop&quot;</span>
  <span class="nv">$run</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="nv">$gentop</span>
      <span class="k">fi</span>

<span class="k">      </span><span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
      ;;

    prog<span class="o">)</span>
      <span class="k">case</span> <span class="nv">$host</span> in
  *cygwin*<span class="o">)</span> <span class="nv">output</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$output</span> | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;s,.exe$,,;s,$,.exe,&#39;</span><span class="sb">`</span> ;;
      <span class="k">esac</span>
<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$vinfo&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-version-info&#39; is ignored for programs&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$release&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`-release&#39; is ignored for programs&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$preload&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$dlopen_support&quot;</span> <span class="o">=</span> unknown <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$dlopen_self&quot;</span> <span class="o">=</span> unknown <span class="o">&amp;&amp;</span>
     <span class="nb">test</span> <span class="s2">&quot;$dlopen_self_static&quot;</span> <span class="o">=</span> unknown; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`AC_LIBTOOL_DLOPEN&#39; not used. Assuming no dlopen support.&quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>

<span class="k">      case</span> <span class="nv">$host</span> in
      *-*-rhapsody* | *-*-darwin1.<span class="o">[</span>012<span class="o">])</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-320" id="section-320">&#182;</a>
</div>
<p>On Rhapsody replace the C library is the System framework</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">compile_deplibs</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X $compile_deplibs&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/ -lc / -framework System /&#39;</span><span class="sb">`</span>
  <span class="nv">finalize_deplibs</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X $finalize_deplibs&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s/ -lc / -framework System /&#39;</span><span class="sb">`</span>
  ;;
      <span class="k">esac</span>

<span class="k">      case</span> <span class="nv">$host</span> in
      *darwin*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-321" id="section-321">&#182;</a>
</div>
<p>Don't allow lazy linking, it breaks C++ global constructors</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$tagname&quot;</span> <span class="o">=</span> CXX ; <span class="k">then</span>
<span class="k">        </span><span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command ${wl}-bind_at_load&quot;</span>
        <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command ${wl}-bind_at_load&quot;</span>
        <span class="k">fi</span>
        ;;
      <span class="k">esac</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-322" id="section-322">&#182;</a>
</div>
<p>move library search paths that coincide with paths to not yet
installed libraries to the beginning of the library search list</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">new_libs</span><span class="o">=</span>
      <span class="k">for </span>path in <span class="nv">$notinst_path</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="s2">&quot; $new_libs &quot;</span> in
  *<span class="s2">&quot; -L$path/$objdir &quot;</span>*<span class="o">)</span> ;;
  *<span class="o">)</span>
    <span class="k">case</span> <span class="s2">&quot; $compile_deplibs &quot;</span> in
    *<span class="s2">&quot; -L$path/$objdir &quot;</span>*<span class="o">)</span>
      <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$new_libs -L$path/$objdir&quot;</span> ;;
    <span class="k">esac</span>
    ;;
  <span class="k">esac</span>
<span class="k">      done</span>
<span class="k">      for </span>deplib in <span class="nv">$compile_deplibs</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="nv">$deplib</span> in
  -L*<span class="o">)</span>
    <span class="k">case</span> <span class="s2">&quot; $new_libs &quot;</span> in
    *<span class="s2">&quot; $deplib &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$new_libs $deplib&quot;</span> ;;
    <span class="k">esac</span>
    ;;
  *<span class="o">)</span> <span class="nv">new_libs</span><span class="o">=</span><span class="s2">&quot;$new_libs $deplib&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">      done</span>
<span class="k">      </span><span class="nv">compile_deplibs</span><span class="o">=</span><span class="s2">&quot;$new_libs&quot;</span>


      <span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$compile_command $compile_deplibs&quot;</span>
      <span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$finalize_command $finalize_deplibs&quot;</span>

      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$rpath$xrpath&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-323" id="section-323">&#182;</a>
</div>
<p>If the user specified any rpath flags, then add them.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for </span>libdir in <span class="nv">$rpath</span> <span class="nv">$xrpath</span>; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-324" id="section-324">&#182;</a>
</div>
<p>This is the magic to use -rpath.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="s2">&quot;$finalize_rpath &quot;</span> in
    *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">finalize_rpath</span><span class="o">=</span><span class="s2">&quot;$finalize_rpath $libdir&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">  done</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-325" id="section-325">&#182;</a>
</div>
<p>Now hardcode the library paths</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">rpath</span><span class="o">=</span>
      <span class="nv">hardcode_libdirs</span><span class="o">=</span>
      <span class="k">for </span>libdir in <span class="nv">$compile_rpath</span> <span class="nv">$finalize_rpath</span>; <span class="k">do</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_separator&quot;</span>; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -z <span class="s2">&quot;$hardcode_libdirs&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">hardcode_libdirs</span><span class="o">=</span><span class="s2">&quot;$libdir&quot;</span>
      <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-326" id="section-326">&#182;</a>
</div>
<p>Just accumulate the unique libdirs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">case</span> <span class="nv">$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator</span> in
        *<span class="s2">&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;</span>*<span class="o">)</span>
    ;;
        *<span class="o">)</span>
    <span class="nv">hardcode_libdirs</span><span class="o">=</span><span class="s2">&quot;$hardcode_libdirs$hardcode_libdir_separator$libdir&quot;</span>
    ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">    else</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">flag</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span>
      <span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath $flag&quot;</span>
    <span class="k">fi</span>
<span class="k">  elif </span><span class="nb">test</span> -n <span class="s2">&quot;$runpath_var&quot;</span>; <span class="k">then</span>
<span class="k">    case</span> <span class="s2">&quot;$perm_rpath &quot;</span> in
    *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">perm_rpath</span><span class="o">=</span><span class="s2">&quot;$perm_rpath $libdir&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">  fi</span>
<span class="k">  case</span> <span class="nv">$host</span> in
  *-*-cygwin* | *-*-mingw* | *-*-pw32* | *-*-os2*<span class="o">)</span>
    <span class="nv">testbindir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$libdir&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s*/lib$*/bin*&#39;</span><span class="sb">`</span>
    <span class="k">case</span> :<span class="nv">$dllsearchpath</span>: in
    *<span class="s2">&quot;:$libdir:&quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">dllsearchpath</span><span class="o">=</span><span class="s2">&quot;$dllsearchpath:$libdir&quot;</span>;;
    <span class="k">esac</span>
<span class="k">    case</span> :<span class="nv">$dllsearchpath</span>: in
    *<span class="s2">&quot;:$testbindir:&quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">dllsearchpath</span><span class="o">=</span><span class="s2">&quot;$dllsearchpath:$testbindir&quot;</span>;;
    <span class="k">esac</span>
    ;;
  <span class="k">esac</span>
<span class="k">      done</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-327" id="section-327">&#182;</a>
</div>
<p>Substitute the hardcoded libdirs into the rpath.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_separator&quot;</span> <span class="o">&amp;&amp;</span>
   <span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdirs&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">libdir</span><span class="o">=</span><span class="s2">&quot;$hardcode_libdirs&quot;</span>
  <span class="nb">eval </span><span class="nv">rpath</span><span class="o">=</span><span class="se">\&quot;</span> <span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span>
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">compile_rpath</span><span class="o">=</span><span class="s2">&quot;$rpath&quot;</span>

      <span class="nv">rpath</span><span class="o">=</span>
      <span class="nv">hardcode_libdirs</span><span class="o">=</span>
      <span class="k">for </span>libdir in <span class="nv">$finalize_rpath</span>; <span class="k">do</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_separator&quot;</span>; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -z <span class="s2">&quot;$hardcode_libdirs&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">hardcode_libdirs</span><span class="o">=</span><span class="s2">&quot;$libdir&quot;</span>
      <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-328" id="section-328">&#182;</a>
</div>
<p>Just accumulate the unique libdirs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">case</span> <span class="nv">$hardcode_libdir_separator$hardcode_libdirs$hardcode_libdir_separator</span> in
        *<span class="s2">&quot;$hardcode_libdir_separator$libdir$hardcode_libdir_separator&quot;</span>*<span class="o">)</span>
    ;;
        *<span class="o">)</span>
    <span class="nv">hardcode_libdirs</span><span class="o">=</span><span class="s2">&quot;$hardcode_libdirs$hardcode_libdir_separator$libdir&quot;</span>
    ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">    else</span>
<span class="k">      </span><span class="nb">eval </span><span class="nv">flag</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span>
      <span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath $flag&quot;</span>
    <span class="k">fi</span>
<span class="k">  elif </span><span class="nb">test</span> -n <span class="s2">&quot;$runpath_var&quot;</span>; <span class="k">then</span>
<span class="k">    case</span> <span class="s2">&quot;$finalize_perm_rpath &quot;</span> in
    *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">finalize_perm_rpath</span><span class="o">=</span><span class="s2">&quot;$finalize_perm_rpath $libdir&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">  fi</span>
<span class="k">      done</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-329" id="section-329">&#182;</a>
</div>
<p>Substitute the hardcoded libdirs into the rpath.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_separator&quot;</span> <span class="o">&amp;&amp;</span>
   <span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdirs&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">libdir</span><span class="o">=</span><span class="s2">&quot;$hardcode_libdirs&quot;</span>
  <span class="nb">eval </span><span class="nv">rpath</span><span class="o">=</span><span class="se">\&quot;</span> <span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span>
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">finalize_rpath</span><span class="o">=</span><span class="s2">&quot;$rpath&quot;</span>

      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$libobjs&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-330" id="section-330">&#182;</a>
</div>
<p>Transform all the library objects into standard objects.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">compile_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$compile_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
  <span class="nv">finalize_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$finalize_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
      <span class="k">fi</span>

<span class="k">      </span><span class="nv">dlsyms</span><span class="o">=</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$dlfiles$dlprefiles&quot;</span> <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$dlself&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$NM&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$global_symbol_pipe&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">dlsyms</span><span class="o">=</span><span class="s2">&quot;${outputname}S.c&quot;</span>
  <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: not configured to extract global symbols from dlpreopened files&quot;</span> 1&gt;&amp;2
  <span class="k">fi</span>
<span class="k">      fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$dlsyms&quot;</span>; <span class="k">then</span>
<span class="k">  case</span> <span class="nv">$dlsyms</span> in
  <span class="s2">&quot;&quot;</span><span class="o">)</span> ;;
  *.c<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-331" id="section-331">&#182;</a>
</div>
<p>Discover the nlist of each of the dlfiles.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">nlist</span><span class="o">=</span><span class="s2">&quot;$output_objdir/${outputname}.nm&quot;</span>

    <span class="nv">$show</span> <span class="s2">&quot;$rm $nlist ${nlist}S ${nlist}T&quot;</span>
    <span class="nv">$run</span> <span class="nv">$rm</span> <span class="s2">&quot;$nlist&quot;</span> <span class="s2">&quot;${nlist}S&quot;</span> <span class="s2">&quot;${nlist}T&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-332" id="section-332">&#182;</a>
</div>
<p>Parse the name list into a source file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$show</span> <span class="s2">&quot;creating $output_objdir/$dlsyms&quot;</span>

    <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$echo</span> &gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span> <span class="s2">&quot;\</span>
<span class="s2">/* $dlsyms - symbol resolution table for \`$outputname&#39; dlsym emulation. */</span>
<span class="s2">/* Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP */</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-333" id="section-333">&#182;</a>
</div>
<p>ifdef __cplusplus</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">extern \&quot;C\&quot; {</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-334" id="section-334">&#182;</a>
</div>
<p>endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">/* Prevent the only kind of declaration conflicts we can make. */</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-335" id="section-335">&#182;</a>
</div>
<p>define lt_preloaded_symbols some_other_symbol</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">/* External symbol declarations for the compiler. */\</span>
<span class="s2">&quot;</span>

    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$dlself&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
      <span class="nv">$show</span> <span class="s2">&quot;generating symbol list for \`$output&#39;&quot;</span>

      <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$echo</span> <span class="s1">&#39;: @PROGRAM@ &#39;</span> &gt; <span class="s2">&quot;$nlist&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-336" id="section-336">&#182;</a>
</div>
<p>Add our own program objects to the symbol list.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">progfiles</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$objs$old_deplibs&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
      <span class="k">for </span>arg in <span class="nv">$progfiles</span>; <span class="k">do</span>
        <span class="nv">$show</span> <span class="s2">&quot;extracting global C symbols from \`$arg&#39;&quot;</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$NM $arg | $global_symbol_pipe &gt;&gt; &#39;$nlist&#39;&quot;</span>
      <span class="k">done</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$exclude_expsyms&quot;</span>; <span class="k">then</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$EGREP -v &quot; ($exclude_expsyms)$&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T&#39;</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$mv &quot;$nlist&quot;T &quot;$nlist&quot;&#39;</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$export_symbols_regex&quot;</span>; <span class="k">then</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$EGREP -e &quot;$export_symbols_regex&quot; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T&#39;</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$mv &quot;$nlist&quot;T &quot;$nlist&quot;&#39;</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-337" id="section-337">&#182;</a>
</div>
<p>Prepare the list of exported symbols</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$export_symbols&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">export_symbols</span><span class="o">=</span><span class="s2">&quot;$output_objdir/$outputname.exp&quot;</span>
        <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$export_symbols</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;${SED} -n -e &#39;/^: @PROGRAM@ $/d&#39; -e &#39;s/^.* \(.*\)$/\1/p&#39; &quot;</span><span class="s1">&#39;&lt; &quot;$nlist&quot; &gt; &quot;$export_symbols&quot;&#39;</span>
              <span class="k">case</span> <span class="nv">$host</span> in
              *cygwin* | *mingw* <span class="o">)</span>
          <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;echo EXPORTS &quot;</span><span class="s1">&#39;&gt; &quot;$output_objdir/$outputname.def&quot;&#39;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;cat &quot;$export_symbols&quot; &gt;&gt; &quot;$output_objdir/$outputname.def&quot;&#39;</span>
                ;;
              <span class="k">esac</span>
<span class="k">      else</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;${SED} -e &#39;s/\([].[*^$]\)/\\\\\1/g&#39; -e &#39;s/^/ /&#39; -e &#39;s/$/$/&#39;&quot;</span><span class="s1">&#39; &lt; &quot;$export_symbols&quot; &gt; &quot;$output_objdir/$outputname.exp&quot;&#39;</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;grep -f &quot;$output_objdir/$outputname.exp&quot; &lt; &quot;$nlist&quot; &gt; &quot;$nlist&quot;T&#39;</span>
        <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;mv &quot;$nlist&quot;T &quot;$nlist&quot;&#39;</span>
              <span class="k">case</span> <span class="nv">$host</span> in
              *cygwin* | *mingw* <span class="o">)</span>
          <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;echo EXPORTS &quot;</span><span class="s1">&#39;&gt; &quot;$output_objdir/$outputname.def&quot;&#39;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;cat &quot;$nlist&quot; &gt;&gt; &quot;$output_objdir/$outputname.def&quot;&#39;</span>
                ;;
              <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">    fi</span>

<span class="k">    for </span>arg in <span class="nv">$dlprefiles</span>; <span class="k">do</span>
      <span class="nv">$show</span> <span class="s2">&quot;extracting global C symbols from \`$arg&#39;&quot;</span>
      <span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;$arg&quot;</span> | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;$echo &quot;: $name &quot; &gt;&gt; &quot;$nlist&quot;&#39;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$NM $arg | $global_symbol_pipe &gt;&gt; &#39;$nlist&#39;&quot;</span>
    <span class="k">done</span>

<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-338" id="section-338">&#182;</a>
</div>
<p>Make sure we have at least an empty file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -f <span class="s2">&quot;$nlist&quot;</span> <span class="o">||</span> : &gt; <span class="s2">&quot;$nlist&quot;</span>

      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$exclude_expsyms&quot;</span>; <span class="k">then</span>
        <span class="nv">$EGREP</span> -v <span class="s2">&quot; ($exclude_expsyms)$&quot;</span> <span class="s2">&quot;$nlist&quot;</span> &gt; <span class="s2">&quot;$nlist&quot;</span>T
        <span class="nv">$mv</span> <span class="s2">&quot;$nlist&quot;</span>T <span class="s2">&quot;$nlist&quot;</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-339" id="section-339">&#182;</a>
</div>
<p>Try sorting and uniquifying the output.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span>grep -v <span class="s2">&quot;^: &quot;</span> &lt; <span class="s2">&quot;$nlist&quot;</span> |
    <span class="k">if </span>sort -k 3 &lt;/dev/null &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
<span class="k">      </span>sort -k 3
    <span class="k">else</span>
<span class="k">      </span>sort +2
    <span class="k">fi</span> |
    uniq &gt; <span class="s2">&quot;$nlist&quot;</span>S; <span class="k">then</span>
        :
      <span class="k">else</span>
<span class="k">        </span>grep -v <span class="s2">&quot;^: &quot;</span> &lt; <span class="s2">&quot;$nlist&quot;</span> &gt; <span class="s2">&quot;$nlist&quot;</span>S
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -f <span class="s2">&quot;$nlist&quot;</span>S; <span class="k">then</span>
<span class="k">        </span><span class="nb">eval</span> <span class="s2">&quot;$global_symbol_to_cdecl&quot;</span><span class="s1">&#39; &lt; &quot;$nlist&quot;S &gt;&gt; &quot;$output_objdir/$dlsyms&quot;&#39;</span>
      <span class="k">else</span>
        <span class="nv">$echo</span> <span class="s1">&#39;/* NONE */&#39;</span> &gt;&gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span>
      <span class="k">fi</span>

      <span class="nv">$echo</span> &gt;&gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span> <span class="s2">&quot;\</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-340" id="section-340">&#182;</a>
</div>
<p>undef lt_preloaded_symbols</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-341" id="section-341">&#182;</a>
</div>
<p>if defined (<strong>STDC</strong>) &amp;&amp; <strong>STDC</strong>
define lt_ptr void *
else
define lt_ptr char *
define const
endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">/* The mapping between symbol names and symbols. */</span>
<span class="s2">&quot;</span>

      <span class="k">case</span> <span class="nv">$host</span> in
      *cygwin* | *mingw* <span class="o">)</span>
    <span class="nv">$echo</span> &gt;&gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span> <span class="s2">&quot;\</span>
<span class="s2">/* DATA imports from DLLs on WIN32 can&#39;t be const, because</span>
<span class="s2">   runtime relocations are performed -- see ld&#39;s documentation</span>
<span class="s2">   on pseudo-relocs */</span>
<span class="s2">struct {</span>
<span class="s2">&quot;</span>
        ;;
      * <span class="o">)</span>
    <span class="nv">$echo</span> &gt;&gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span> <span class="s2">&quot;\</span>
<span class="s2">const struct {</span>
<span class="s2">&quot;</span>
        ;;
      <span class="k">esac</span>


    <span class="nv">$echo</span> &gt;&gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span> <span class="s2">&quot;\</span>
<span class="s2">  const char *name;</span>
<span class="s2">  lt_ptr address;</span>
<span class="s2">}</span>
<span class="s2">lt_preloaded_symbols[] =</span>
<span class="s2">{\</span>
<span class="s2">&quot;</span>

      <span class="nb">eval</span> <span class="s2">&quot;$global_symbol_to_c_name_address&quot;</span> &lt; <span class="s2">&quot;$nlist&quot;</span> &gt;&gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span>

      <span class="nv">$echo</span> &gt;&gt; <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span> <span class="s2">&quot;\</span>
<span class="s2">  {0, (lt_ptr) 0}</span>
<span class="s2">};</span>

<span class="s2">/* This works around a problem in FreeBSD linker */</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-342" id="section-342">&#182;</a>
</div>
<p>ifdef FREEBSD_WORKAROUND</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">static const void *lt_preloaded_setup() {</span>
<span class="s2">  return lt_preloaded_symbols;</span>
<span class="s2">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-343" id="section-343">&#182;</a>
</div>
<p>endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-344" id="section-344">&#182;</a>
</div>
<p>ifdef __cplusplus</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-345" id="section-345">&#182;</a>
</div>
<p>endif\</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">&quot;</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">pic_flag_for_symtable</span><span class="o">=</span>
    <span class="k">case</span> <span class="nv">$host</span> in

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-346" id="section-346">&#182;</a>
</div>
<p>compiling the symbol table file with pic_flag works around
a FreeBSD bug that causes programs to crash when -lm is
linked before any other PIC object.  But we must not use
pic_flag when linking with -static.  The problem exists in
FreeBSD 2.2.6 and is fixed in FreeBSD 3.1.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    *-*-freebsd2*|*-*-freebsd3.0*|*-*-freebsdelf3.0*<span class="o">)</span>
      <span class="k">case</span> <span class="s2">&quot;$compile_command &quot;</span> in
      *<span class="s2">&quot; -static &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span> <span class="nv">pic_flag_for_symtable</span><span class="o">=</span><span class="s2">&quot; $pic_flag -DFREEBSD_WORKAROUND&quot;</span>;;
      <span class="k">esac</span>;;
    *-*-hpux*<span class="o">)</span>
      <span class="k">case</span> <span class="s2">&quot;$compile_command &quot;</span> in
      *<span class="s2">&quot; -static &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span> <span class="nv">pic_flag_for_symtable</span><span class="o">=</span><span class="s2">&quot; $pic_flag&quot;</span>;;
      <span class="k">esac</span>
<span class="k">    esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-347" id="section-347">&#182;</a>
</div>
<p>Now compile the dynamic symbol file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$show</span> <span class="s2">&quot;(cd $output_objdir &amp;&amp; $LTCC  $LTCFLAGS -c$no_builtin_flag$pic_flag_for_symtable \&quot;$dlsyms\&quot;)&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;(cd $output_objdir &amp;&amp; $LTCC  $LTCFLAGS -c$no_builtin_flag$pic_flag_for_symtable &quot;$dlsyms&quot;)&#39;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-348" id="section-348">&#182;</a>
</div>
<p>Clean up the generated files.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$show</span> <span class="s2">&quot;$rm $output_objdir/$dlsyms $nlist ${nlist}S ${nlist}T&quot;</span>
    <span class="nv">$run</span> <span class="nv">$rm</span> <span class="s2">&quot;$output_objdir/$dlsyms&quot;</span> <span class="s2">&quot;$nlist&quot;</span> <span class="s2">&quot;${nlist}S&quot;</span> <span class="s2">&quot;${nlist}T&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-349" id="section-349">&#182;</a>
</div>
<p>Transform the symbol file into the correct name.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">case</span> <span class="nv">$host</span> in
          *cygwin* | *mingw* <span class="o">)</span>
            <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$output_objdir/${outputname}.def&quot;</span> ; <span class="k">then</span>
<span class="k">              </span><span class="nv">compile_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$compile_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s%@SYMFILE@%$output_objdir/${outputname}.def $output_objdir/${outputname}S.${objext}%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
              <span class="nv">finalize_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$finalize_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s%@SYMFILE@%$output_objdir/${outputname}.def $output_objdir/${outputname}S.${objext}%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
            <span class="k">else</span>
<span class="k">              </span><span class="nv">compile_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$compile_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
              <span class="nv">finalize_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$finalize_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
             <span class="k">fi</span>
            ;;
          * <span class="o">)</span>
            <span class="nv">compile_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$compile_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
            <span class="nv">finalize_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$finalize_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s%@SYMFILE@%$output_objdir/${outputname}S.${objext}%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
            ;;
          <span class="k">esac</span>
    ;;
  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: unknown suffix for \`$dlsyms&#39;&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>
<span class="k">      else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-350" id="section-350">&#182;</a>
</div>
<p>We keep going just in case the user didn't refer to
lt_preloaded_symbols.  The linker will fail if global_symbol_pipe
really was required.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-351" id="section-351">&#182;</a>
</div>
<p>Nullify the symbol file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">compile_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$compile_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s% @SYMFILE@%%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
  <span class="nv">finalize_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$finalize_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s% @SYMFILE@%%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$need_relink&quot;</span> <span class="o">=</span> no <span class="o">||</span> <span class="nb">test</span> <span class="s2">&quot;$build_libtool_libs&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-352" id="section-352">&#182;</a>
</div>
<p>Replace the output file specification.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">compile_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$compile_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%@OUTPUT@%&#39;</span><span class="s2">&quot;$output&quot;</span><span class="s1">&#39;%g&#39;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
  <span class="nv">link_command</span><span class="o">=</span><span class="s2">&quot;$compile_command$compile_rpath&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-353" id="section-353">&#182;</a>
</div>
<p>We have no uninstalled library dependencies, so finalize right now.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">$show</span> <span class="s2">&quot;$link_command&quot;</span>
  <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$link_command&quot;</span>
  <span class="nv">exit_status</span><span class="o">=</span><span class="nv">$?</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-354" id="section-354">&#182;</a>
</div>
<p>Delete the generated files.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$dlsyms&quot;</span>; <span class="k">then</span>
    <span class="nv">$show</span> <span class="s2">&quot;$rm $output_objdir/${outputname}S.${objext}&quot;</span>
    <span class="nv">$run</span> <span class="nv">$rm</span> <span class="s2">&quot;$output_objdir/${outputname}S.${objext}&quot;</span>
  <span class="k">fi</span>

<span class="k">  </span><span class="nb">exit</span> <span class="nv">$exit_status</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$shlibpath_var&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-355" id="section-355">&#182;</a>
</div>
<p>We should set the shlibpath_var</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">rpath</span><span class="o">=</span>
  <span class="k">for </span>dir in <span class="nv">$temp_rpath</span>; <span class="k">do</span>
<span class="k">    case</span> <span class="nv">$dir</span> in
    <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-356" id="section-356">&#182;</a>
</div>
<p>Absolute path.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath$dir:&quot;</span>
      ;;
    *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-357" id="section-357">&#182;</a>
</div>
<p>Relative path: add a thisdir entry.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath\$thisdir/$dir:&quot;</span>
      ;;
    <span class="k">esac</span>
<span class="k">  done</span>
<span class="k">  </span><span class="nv">temp_rpath</span><span class="o">=</span><span class="s2">&quot;$rpath&quot;</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$compile_shlibpath$finalize_shlibpath&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">compile_command</span><span class="o">=</span><span class="s2">&quot;$shlibpath_var=\&quot;$compile_shlibpath$finalize_shlibpath\$$shlibpath_var\&quot; $compile_command&quot;</span>
      <span class="k">fi</span>
<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$finalize_shlibpath&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">finalize_command</span><span class="o">=</span><span class="s2">&quot;$shlibpath_var=\&quot;$finalize_shlibpath\$$shlibpath_var\&quot; $finalize_command&quot;</span>
      <span class="k">fi</span>

<span class="k">      </span><span class="nv">compile_var</span><span class="o">=</span>
      <span class="nv">finalize_var</span><span class="o">=</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$runpath_var&quot;</span>; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$perm_rpath&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-358" id="section-358">&#182;</a>
</div>
<p>We should set the runpath_var.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">rpath</span><span class="o">=</span>
    <span class="k">for </span>dir in <span class="nv">$perm_rpath</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath$dir:&quot;</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nv">compile_var</span><span class="o">=</span><span class="s2">&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;</span>
  <span class="k">fi</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$finalize_perm_rpath&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-359" id="section-359">&#182;</a>
</div>
<p>We should set the runpath_var.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">rpath</span><span class="o">=</span>
    <span class="k">for </span>dir in <span class="nv">$finalize_perm_rpath</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">rpath</span><span class="o">=</span><span class="s2">&quot;$rpath$dir:&quot;</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nv">finalize_var</span><span class="o">=</span><span class="s2">&quot;$runpath_var=\&quot;$rpath\$$runpath_var\&quot; &quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$no_install&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-360" id="section-360">&#182;</a>
</div>
<p>We don't need to create a wrapper script.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">link_command</span><span class="o">=</span><span class="s2">&quot;$compile_var$compile_command$compile_rpath&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-361" id="section-361">&#182;</a>
</div>
<p>Replace the output file specification.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">link_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$link_command&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%@OUTPUT@%&#39;</span><span class="s2">&quot;$output&quot;</span><span class="s1">&#39;%g&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-362" id="section-362">&#182;</a>
</div>
<p>Delete the old output file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$output</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-363" id="section-363">&#182;</a>
</div>
<p>Link the executable and exit</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">$show</span> <span class="s2">&quot;$link_command&quot;</span>
  <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$link_command&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$hardcode_action&quot;</span> <span class="o">=</span> relink; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-364" id="section-364">&#182;</a>
</div>
<p>Fast installation is not supported</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">link_command</span><span class="o">=</span><span class="s2">&quot;$compile_var$compile_command$compile_rpath&quot;</span>
  <span class="nv">relink_command</span><span class="o">=</span><span class="s2">&quot;$finalize_var$finalize_command$finalize_rpath&quot;</span>

  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: this platform does not like uninstalled shared libraries&quot;</span> 1&gt;&amp;2
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$output&#39; will be relinked during installation&quot;</span> 1&gt;&amp;2
      <span class="k">else</span>
<span class="k">  if </span><span class="nb">test</span> <span class="s2">&quot;$fast_install&quot;</span> !<span class="o">=</span> no; <span class="k">then</span>
<span class="k">    </span><span class="nv">link_command</span><span class="o">=</span><span class="s2">&quot;$finalize_var$compile_command$finalize_rpath&quot;</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$fast_install&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">      </span><span class="nv">relink_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$compile_var$compile_command$compile_rpath&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%@OUTPUT@%\$progdir/\$file%g&#39;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
    <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-365" id="section-365">&#182;</a>
</div>
<p>fast_install is set to needless</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">relink_command</span><span class="o">=</span>
    <span class="k">fi</span>
<span class="k">  else</span>
<span class="k">    </span><span class="nv">link_command</span><span class="o">=</span><span class="s2">&quot;$compile_var$compile_command$compile_rpath&quot;</span>
    <span class="nv">relink_command</span><span class="o">=</span><span class="s2">&quot;$finalize_var$finalize_command$finalize_rpath&quot;</span>
  <span class="k">fi</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-366" id="section-366">&#182;</a>
</div>
<p>Replace the output file specification.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">link_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$link_command&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%@OUTPUT@%&#39;</span><span class="s2">&quot;$output_objdir/$outputname&quot;</span><span class="s1">&#39;%g&#39;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-367" id="section-367">&#182;</a>
</div>
<p>Delete the old output files.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$output</span> <span class="nv">$output_objdir</span>/<span class="nv">$outputname</span> <span class="nv">$output_objdir</span>/lt-<span class="nv">$outputname</span>

      <span class="nv">$show</span> <span class="s2">&quot;$link_command&quot;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$link_command&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-368" id="section-368">&#182;</a>
</div>
<p>Now create the wrapper script.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">$show</span> <span class="s2">&quot;creating $output&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-369" id="section-369">&#182;</a>
</div>
<p>Quote the relink command for shipping.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$relink_command&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-370" id="section-370">&#182;</a>
</div>
<p>Preserve any variables that may affect compiler behavior</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for </span>var in <span class="nv">$variables_saved_for_relink</span>; <span class="k">do</span>
<span class="k">    if </span><span class="nb">eval test</span> -z <span class="se">\&quot;\$</span><span class="o">{</span><span class="nv">$var</span>+set<span class="o">}</span><span class="se">\&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">relink_command</span><span class="o">=</span><span class="s2">&quot;{ test -z \&quot;\${$var+set}\&quot; || unset $var || { $var=; export $var; }; }; $relink_command&quot;</span>
    <span class="k">elif </span><span class="nb">eval </span><span class="nv">var_value</span><span class="o">=</span><span class="se">\$</span><span class="nv">$var</span>; <span class="nb">test</span> -z <span class="s2">&quot;$var_value&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">relink_command</span><span class="o">=</span><span class="s2">&quot;$var=; export $var; $relink_command&quot;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">var_value</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$var_value&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
      <span class="nv">relink_command</span><span class="o">=</span><span class="s2">&quot;$var=\&quot;$var_value\&quot;; export $var; $relink_command&quot;</span>
    <span class="k">fi</span>
<span class="k">  done</span>
<span class="k">  </span><span class="nv">relink_command</span><span class="o">=</span><span class="s2">&quot;(cd `pwd`; $relink_command)&quot;</span>
  <span class="nv">relink_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$relink_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-371" id="section-371">&#182;</a>
</div>
<p>Quote $echo for shipping.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$echo&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$SHELL $progpath --fallback-echo&quot;</span>; <span class="k">then</span>
<span class="k">  case</span> <span class="nv">$progpath</span> in
  <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> <span class="nv">qecho</span><span class="o">=</span><span class="s2">&quot;$SHELL $progpath --fallback-echo&quot;</span>;;
  *<span class="o">)</span> <span class="nv">qecho</span><span class="o">=</span><span class="s2">&quot;$SHELL `pwd`/$progpath --fallback-echo&quot;</span>;;
  <span class="k">esac</span>
<span class="k">  </span><span class="nv">qecho</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$qecho&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
      <span class="k">else</span>
<span class="k">  </span><span class="nv">qecho</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$echo&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-372" id="section-372">&#182;</a>
</div>
<p>Only actually do things if our run command is non-null.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-373" id="section-373">&#182;</a>
</div>
<p>win32 will think the script is a binary if it has
a .exe suffix, so we strip it off here.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$output</span> in
    *.exe<span class="o">)</span> <span class="nv">output</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$output</span>|<span class="k">${</span><span class="nv">SED</span><span class="k">}</span> <span class="s1">&#39;s,.exe$,,&#39;</span><span class="sb">`</span> ;;
  <span class="k">esac</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-374" id="section-374">&#182;</a>
</div>
<p>test for cygwin because mv fails w/o .exe extensions</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$host</span> in
    *cygwin*<span class="o">)</span>
      <span class="nv">exeext</span><span class="o">=</span>.exe
      <span class="nv">outputname</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$outputname</span>|<span class="k">${</span><span class="nv">SED</span><span class="k">}</span> <span class="s1">&#39;s,.exe$,,&#39;</span><span class="sb">`</span> ;;
    *<span class="o">)</span> <span class="nv">exeext</span><span class="o">=</span> ;;
  <span class="k">esac</span>
<span class="k">  case</span> <span class="nv">$host</span> in
    *cygwin* | *mingw* <span class="o">)</span>
            <span class="nv">output_name</span><span class="o">=</span><span class="sb">`</span>basename <span class="nv">$output</span><span class="sb">`</span>
            <span class="nv">output_path</span><span class="o">=</span><span class="sb">`</span>dirname <span class="nv">$output</span><span class="sb">`</span>
            <span class="nv">cwrappersource</span><span class="o">=</span><span class="s2">&quot;$output_path/$objdir/lt-$output_name.c&quot;</span>
            <span class="nv">cwrapper</span><span class="o">=</span><span class="s2">&quot;$output_path/$output_name.exe&quot;</span>
            <span class="nv">$rm</span> <span class="nv">$cwrappersource</span> <span class="nv">$cwrapper</span>
            <span class="nb">trap</span> <span class="s2">&quot;$rm $cwrappersource $cwrapper; exit $EXIT_FAILURE&quot;</span> 1 2 15

      cat &gt; <span class="nv">$cwrappersource</span> <span class="s">&lt;&lt;EOF</span>

<span class="s">/* $cwrappersource - temporary wrapper executable for $objdir/$outputname</span>
<span class="s">   Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP</span>

<span class="s">   The $output program cannot be directly executed until all the libtool</span>
<span class="s">   libraries that it depends on are installed.</span>

<span class="s">   This wrapper executable should never be moved out of the build directory.</span>
<span class="s">   If it is, it will not operate correctly.</span>

<span class="s">   Currently, it simply execs the wrapper *script* &quot;/bin/sh $output&quot;,</span>
<span class="s">   but could eventually absorb all of the scripts functionality and</span>
<span class="s">   exec $objdir/$outputname directly.</span>
<span class="s">*/</span>
<span class="s">EOF</span>
      cat &gt;&gt; <span class="nv">$cwrappersource</span>&lt;&lt;<span class="s2">&quot;EOF&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-375" id="section-375">&#182;</a>
</div>
<p>include <stdio.h>
include <stdlib.h>
include <unistd.h>
include <malloc.h>
include <stdarg.h>
include <assert.h>
include <string.h>
include <ctype.h>
include <sys/stat.h></p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-376" id="section-376">&#182;</a>
</div>
<p>if defined(PATH_MAX)
define LT_PATHMAX PATH_MAX
elif defined(MAXPATHLEN)
define LT_PATHMAX MAXPATHLEN
else
define LT_PATHMAX 1024
endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-377" id="section-377">&#182;</a>
</div>
<p>ifndef DIR_SEPARATOR
define DIR_SEPARATOR '/'
define PATH_SEPARATOR ':'
endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-378" id="section-378">&#182;</a>
</div>
<p>if defined (_WIN32) || defined (<strong>MSDOS</strong>) || defined (<strong>DJGPP</strong>) || \</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  defined <span class="o">(</span>__OS2__<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-379" id="section-379">&#182;</a>
</div>
<p>define HAVE_DOS_BASED_FILE_SYSTEM
ifndef DIR_SEPARATOR_2
 define DIR_SEPARATOR_2 '\'
endif
ifndef PATH_SEPARATOR_2
 define PATH_SEPARATOR_2 ';'
endif
endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-380" id="section-380">&#182;</a>
</div>
<p>ifndef DIR_SEPARATOR_2
define IS_DIR_SEPARATOR(ch) ((ch) == DIR_SEPARATOR)
else /* DIR_SEPARATOR_2 */
define IS_DIR_SEPARATOR(ch) \</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="o">(((</span>ch<span class="o">)</span> <span class="o">==</span> DIR_SEPARATOR<span class="o">)</span> <span class="o">||</span> <span class="o">((</span>ch<span class="o">)</span> <span class="o">==</span> DIR_SEPARATOR_2<span class="o">))</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-381" id="section-381">&#182;</a>
</div>
<p>endif /* DIR_SEPARATOR_2 */</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-382" id="section-382">&#182;</a>
</div>
<p>ifndef PATH_SEPARATOR_2
define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR)
else /* PATH_SEPARATOR_2 <em>/
define IS_PATH_SEPARATOR(ch) ((ch) == PATH_SEPARATOR_2)
endif /</em> PATH_SEPARATOR_2 */</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-383" id="section-383">&#182;</a>
</div>
<p>define XMALLOC(type, num)      ((type *) xmalloc ((num) * sizeof(type)))
define XFREE(stale) do { \</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span>stale<span class="o">)</span> <span class="o">{</span> free <span class="o">((</span>void *<span class="o">)</span> stale<span class="o">)</span>; <span class="nv">stale</span> <span class="o">=</span> 0; <span class="o">}</span> <span class="se">\</span>
<span class="o">}</span> <span class="k">while</span> <span class="o">(</span>0<span class="o">)</span>

/* -DDEBUG is fairly common in CFLAGS.  */

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-384" id="section-384">&#182;</a>
</div>
<p>undef DEBUG
if defined DEBUGWRAPPER
define DEBUG(format, ...) fprintf(stderr, format, <strong>VA_ARGS</strong>)
else
define DEBUG(format, ...)
endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

const char *program_name <span class="o">=</span> NULL;

void * xmalloc <span class="o">(</span>size_t num<span class="o">)</span>;
char * xstrdup <span class="o">(</span>const char *string<span class="o">)</span>;
const char * base_name <span class="o">(</span>const char *name<span class="o">)</span>;
char * find_executable<span class="o">(</span>const char *wrapper<span class="o">)</span>;
int    check_executable<span class="o">(</span>const char *path<span class="o">)</span>;
char * strendzap<span class="o">(</span>char *str, const char *pat<span class="o">)</span>;
void lt_fatal <span class="o">(</span>const char *message, ...<span class="o">)</span>;

int
main <span class="o">(</span>int argc, char *argv<span class="o">[])</span>
<span class="o">{</span>
  char **newargz;
  int i;

  <span class="nv">program_name</span> <span class="o">=</span> <span class="o">(</span>char *<span class="o">)</span> xstrdup <span class="o">(</span>base_name <span class="o">(</span>argv<span class="o">[</span>0<span class="o">]))</span>;
  DEBUG<span class="o">(</span><span class="s2">&quot;(main) argv[0]      : %s\n&quot;</span>,argv<span class="o">[</span>0<span class="o">])</span>;
  DEBUG<span class="o">(</span><span class="s2">&quot;(main) program_name : %s\n&quot;</span>,program_name<span class="o">)</span>;
  <span class="nv">newargz</span> <span class="o">=</span> XMALLOC<span class="o">(</span>char *, argc+2<span class="o">)</span>;
EOF

            cat &gt;&gt; <span class="nv">$cwrappersource</span> <span class="s">&lt;&lt;EOF</span>
<span class="s">  newargz[0] = (char *) xstrdup(&quot;$SHELL&quot;);</span>
<span class="s">EOF</span>

            cat &gt;&gt; <span class="nv">$cwrappersource</span> &lt;&lt;<span class="s2">&quot;EOF&quot;</span>
  newargz<span class="o">[</span>1<span class="o">]</span> <span class="o">=</span> find_executable<span class="o">(</span>argv<span class="o">[</span>0<span class="o">])</span>;
  <span class="k">if</span> <span class="o">(</span>newargz<span class="o">[</span>1<span class="o">]</span> <span class="o">==</span> NULL<span class="o">)</span>
    lt_fatal<span class="o">(</span><span class="s2">&quot;Couldn&#39;t find %s&quot;</span>, argv<span class="o">[</span>0<span class="o">])</span>;
  DEBUG<span class="o">(</span><span class="s2">&quot;(main) found exe at : %s\n&quot;</span>,newargz<span class="o">[</span>1<span class="o">])</span>;
  /* we know the script has the same name, without the .exe */
  /* so make sure newargz<span class="o">[</span>1<span class="o">]</span> doesn<span class="s1">&#39;t end in .exe */</span>
<span class="s1">  strendzap(newargz[1],&quot;.exe&quot;);</span>
<span class="s1">  for (i = 1; i &lt; argc; i++)</span>
<span class="s1">    newargz[i+1] = xstrdup(argv[i]);</span>
<span class="s1">  newargz[argc+1] = NULL;</span>

<span class="s1">  for (i=0; i&lt;argc+1; i++)</span>
<span class="s1">  {</span>
<span class="s1">    DEBUG(&quot;(main) newargz[%d]   : %s\n&quot;,i,newargz[i]);</span>
<span class="s1">    ;</span>
<span class="s1">  }</span>

<span class="s1">EOF</span>

<span class="s1">            case $host_os in</span>
<span class="s1">              mingw*)</span>
<span class="s1">                cat &gt;&gt; $cwrappersource &lt;&lt;EOF</span>
<span class="s1">  execv(&quot;$SHELL&quot;,(char const **)newargz);</span>
<span class="s1">EOF</span>
<span class="s1">              ;;</span>
<span class="s1">              *)</span>
<span class="s1">                cat &gt;&gt; $cwrappersource &lt;&lt;EOF</span>
<span class="s1">  execv(&quot;$SHELL&quot;,newargz);</span>
<span class="s1">EOF</span>
<span class="s1">              ;;</span>
<span class="s1">            esac</span>

<span class="s1">            cat &gt;&gt; $cwrappersource &lt;&lt;&quot;EOF&quot;</span>
<span class="s1">  return 127;</span>
<span class="s1">}</span>

<span class="s1">void *</span>
<span class="s1">xmalloc (size_t num)</span>
<span class="s1">{</span>
<span class="s1">  void * p = (void *) malloc (num);</span>
<span class="s1">  if (!p)</span>
<span class="s1">    lt_fatal (&quot;Memory exhausted&quot;);</span>

<span class="s1">  return p;</span>
<span class="s1">}</span>

<span class="s1">char *</span>
<span class="s1">xstrdup (const char *string)</span>
<span class="s1">{</span>
<span class="s1">  return string ? strcpy ((char *) xmalloc (strlen (string) + 1), string) : NULL</span>
<span class="s1">;</span>
<span class="s1">}</span>

<span class="s1">const char *</span>
<span class="s1">base_name (const char *name)</span>
<span class="s1">{</span>
<span class="s1">  const char *base;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-385" id="section-385">&#182;</a>
</div>
<p>if defined (HAVE_DOS_BASED_FILE_SYSTEM)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  /* Skip over the disk name in MSDOS pathnames. */</span>
<span class="s1">  if (isalpha ((unsigned char)name[0]) &amp;&amp; name[1] == &#39;</span>:<span class="s1">&#39;)</span>
<span class="s1">    name += 2;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-386" id="section-386">&#182;</a>
</div>
<p>endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s1">  for (base = name; *name; name++)</span>
<span class="s1">    if (IS_DIR_SEPARATOR (*name))</span>
<span class="s1">      base = name + 1;</span>
<span class="s1">  return base;</span>
<span class="s1">}</span>

<span class="s1">int</span>
<span class="s1">check_executable(const char * path)</span>
<span class="s1">{</span>
<span class="s1">  struct stat st;</span>

<span class="s1">  DEBUG(&quot;(check_executable)  : %s\n&quot;, path ? (*path ? path : &quot;EMPTY!&quot;) : &quot;NULL!&quot;);</span>
<span class="s1">  if ((!path) || (!*path))</span>
<span class="s1">    return 0;</span>

<span class="s1">  if ((stat (path, &amp;st) &gt;= 0) &amp;&amp;</span>
<span class="s1">      (</span>
<span class="s1">        /* MinGW &amp; native WIN32 do not support S_IXOTH or S_IXGRP */</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-387" id="section-387">&#182;</a>
</div>
<p>if defined (S_IXOTH)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">       ((st.st_mode &amp; S_IXOTH) == S_IXOTH) ||</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-388" id="section-388">&#182;</a>
</div>
<p>endif
if defined (S_IXGRP)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">       ((st.st_mode &amp; S_IXGRP) == S_IXGRP) ||</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-389" id="section-389">&#182;</a>
</div>
<p>endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">       ((st.st_mode &amp; S_IXUSR) == S_IXUSR))</span>
<span class="s1">      )</span>
<span class="s1">    return 1;</span>
<span class="s1">  else</span>
<span class="s1">    return 0;</span>
<span class="s1">}</span>

<span class="s1">/* Searches for the full path of the wrapper.  Returns</span>
<span class="s1">   newly allocated full path name if found, NULL otherwise */</span>
<span class="s1">char *</span>
<span class="s1">find_executable (const char* wrapper)</span>
<span class="s1">{</span>
<span class="s1">  int has_slash = 0;</span>
<span class="s1">  const char* p;</span>
<span class="s1">  const char* p_next;</span>
<span class="s1">  /* static buffer for getcwd */</span>
<span class="s1">  char tmp[LT_PATHMAX + 1];</span>
<span class="s1">  int tmp_len;</span>
<span class="s1">  char* concat_name;</span>

<span class="s1">  DEBUG(&quot;(find_executable)  : %s\n&quot;, wrapper ? (*wrapper ? wrapper : &quot;EMPTY!&quot;) : &quot;NULL!&quot;);</span>

<span class="s1">  if ((wrapper == NULL) || (*wrapper == &#39;</span><span class="se">\0</span><span class="s1">&#39;))</span>
<span class="s1">    return NULL;</span>

<span class="s1">  /* Absolute path? */</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-390" id="section-390">&#182;</a>
</div>
<p>if defined (HAVE_DOS_BASED_FILE_SYSTEM)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  if (isalpha ((unsigned char)wrapper[0]) &amp;&amp; wrapper[1] == &#39;</span>:<span class="s1">&#39;)</span>
<span class="s1">  {</span>
<span class="s1">    concat_name = xstrdup (wrapper);</span>
<span class="s1">    if (check_executable(concat_name))</span>
<span class="s1">      return concat_name;</span>
<span class="s1">    XFREE(concat_name);</span>
<span class="s1">  }</span>
<span class="s1">  else</span>
<span class="s1">  {</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-391" id="section-391">&#182;</a>
</div>
<p>endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    if (IS_DIR_SEPARATOR (wrapper[0]))</span>
<span class="s1">    {</span>
<span class="s1">      concat_name = xstrdup (wrapper);</span>
<span class="s1">      if (check_executable(concat_name))</span>
<span class="s1">        return concat_name;</span>
<span class="s1">      XFREE(concat_name);</span>
<span class="s1">    }</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-392" id="section-392">&#182;</a>
</div>
<p>if defined (HAVE_DOS_BASED_FILE_SYSTEM)</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  }</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-393" id="section-393">&#182;</a>
</div>
<p>endif</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s1">  for (p = wrapper; *p; p++)</span>
<span class="s1">    if (*p == &#39;</span>/<span class="s1">&#39;)</span>
<span class="s1">    {</span>
<span class="s1">      has_slash = 1;</span>
<span class="s1">      break;</span>
<span class="s1">    }</span>
<span class="s1">  if (!has_slash)</span>
<span class="s1">  {</span>
<span class="s1">    /* no slashes; search PATH */</span>
<span class="s1">    const char* path = getenv (&quot;PATH&quot;);</span>
<span class="s1">    if (path != NULL)</span>
<span class="s1">    {</span>
<span class="s1">      for (p = path; *p; p = p_next)</span>
<span class="s1">      {</span>
<span class="s1">        const char* q;</span>
<span class="s1">        size_t p_len;</span>
<span class="s1">        for (q = p; *q; q++)</span>
<span class="s1">          if (IS_PATH_SEPARATOR(*q))</span>
<span class="s1">            break;</span>
<span class="s1">        p_len = q - p;</span>
<span class="s1">        p_next = (*q == &#39;</span><span class="se">\0</span><span class="s1">&#39; ? q : q + 1);</span>
<span class="s1">        if (p_len == 0)</span>
<span class="s1">        {</span>
<span class="s1">          /* empty path: current directory */</span>
<span class="s1">          if (getcwd (tmp, LT_PATHMAX) == NULL)</span>
<span class="s1">            lt_fatal (&quot;getcwd failed&quot;);</span>
<span class="s1">          tmp_len = strlen(tmp);</span>
<span class="s1">          concat_name = XMALLOC(char, tmp_len + 1 + strlen(wrapper) + 1);</span>
<span class="s1">          memcpy (concat_name, tmp, tmp_len);</span>
<span class="s1">          concat_name[tmp_len] = &#39;</span>/<span class="s1">&#39;;</span>
<span class="s1">          strcpy (concat_name + tmp_len + 1, wrapper);</span>
<span class="s1">        }</span>
<span class="s1">        else</span>
<span class="s1">        {</span>
<span class="s1">          concat_name = XMALLOC(char, p_len + 1 + strlen(wrapper) + 1);</span>
<span class="s1">          memcpy (concat_name, p, p_len);</span>
<span class="s1">          concat_name[p_len] = &#39;</span>/<span class="s1">&#39;;</span>
<span class="s1">          strcpy (concat_name + p_len + 1, wrapper);</span>
<span class="s1">        }</span>
<span class="s1">        if (check_executable(concat_name))</span>
<span class="s1">          return concat_name;</span>
<span class="s1">        XFREE(concat_name);</span>
<span class="s1">      }</span>
<span class="s1">    }</span>
<span class="s1">    /* not found in PATH; assume curdir */</span>
<span class="s1">  }</span>
<span class="s1">  /* Relative path | not found in path: prepend cwd */</span>
<span class="s1">  if (getcwd (tmp, LT_PATHMAX) == NULL)</span>
<span class="s1">    lt_fatal (&quot;getcwd failed&quot;);</span>
<span class="s1">  tmp_len = strlen(tmp);</span>
<span class="s1">  concat_name = XMALLOC(char, tmp_len + 1 + strlen(wrapper) + 1);</span>
<span class="s1">  memcpy (concat_name, tmp, tmp_len);</span>
<span class="s1">  concat_name[tmp_len] = &#39;</span>/<span class="s1">&#39;;</span>
<span class="s1">  strcpy (concat_name + tmp_len + 1, wrapper);</span>

<span class="s1">  if (check_executable(concat_name))</span>
<span class="s1">    return concat_name;</span>
<span class="s1">  XFREE(concat_name);</span>
<span class="s1">  return NULL;</span>
<span class="s1">}</span>

<span class="s1">char *</span>
<span class="s1">strendzap(char *str, const char *pat)</span>
<span class="s1">{</span>
<span class="s1">  size_t len, patlen;</span>

<span class="s1">  assert(str != NULL);</span>
<span class="s1">  assert(pat != NULL);</span>

<span class="s1">  len = strlen(str);</span>
<span class="s1">  patlen = strlen(pat);</span>

<span class="s1">  if (patlen &lt;= len)</span>
<span class="s1">  {</span>
<span class="s1">    str += len - patlen;</span>
<span class="s1">    if (strcmp(str, pat) == 0)</span>
<span class="s1">      *str = &#39;</span><span class="se">\0</span><span class="s1">&#39;;</span>
<span class="s1">  }</span>
<span class="s1">  return str;</span>
<span class="s1">}</span>

<span class="s1">static void</span>
<span class="s1">lt_error_core (int exit_status, const char * mode,</span>
<span class="s1">          const char * message, va_list ap)</span>
<span class="s1">{</span>
<span class="s1">  fprintf (stderr, &quot;%s: %s: &quot;, program_name, mode);</span>
<span class="s1">  vfprintf (stderr, message, ap);</span>
<span class="s1">  fprintf (stderr, &quot;.\n&quot;);</span>

<span class="s1">  if (exit_status &gt;= 0)</span>
<span class="s1">    exit (exit_status);</span>
<span class="s1">}</span>

<span class="s1">void</span>
<span class="s1">lt_fatal (const char *message, ...)</span>
<span class="s1">{</span>
<span class="s1">  va_list ap;</span>
<span class="s1">  va_start (ap, message);</span>
<span class="s1">  lt_error_core (EXIT_FAILURE, &quot;FATAL&quot;, message, ap);</span>
<span class="s1">  va_end (ap);</span>
<span class="s1">}</span>
<span class="s1">EOF</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-394" id="section-394">&#182;</a>
</div>
<p>we should really use a build-platform specific compiler
here, but OTOH, the wrappers (shell script and this C one)
are only useful if you want to execute the "real" binary.
Since the "real" binary is built for $host, then this
wrapper might as well be built for $host, too.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">          $run $LTCC $LTCFLAGS -s -o $cwrapper $cwrappersource</span>
<span class="s1">          ;;</span>
<span class="s1">        esac</span>
<span class="s1">        $rm $output</span>
<span class="s1">        trap &quot;$rm $output; exit $EXIT_FAILURE&quot; 1 2 15</span>

<span class="s1">  $echo &gt; $output &quot;\</span>
<span class="s1">#! $SHELL</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-395" id="section-395">&#182;</a>
</div>
<p>$output - temporary wrapper script for $objdir/$outputname
Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP</p>

<p>The $output program cannot be directly executed until all the libtool
libraries that it depends on are installed.</p>

<p>This wrapper script should never be moved out of the build directory.
If it is, it will not operate correctly.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-396" id="section-396">&#182;</a>
</div>
<p>Sed substitution that helps us do robust quoting.  It backslashifies
metacharacters that are still active within double-quoted strings.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">Xsed=&#39;</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e 1s/^X//<span class="s1">&#39;</span>
<span class="s1">sed_quote_subst=&#39;</span><span class="nv">$sed_quote_subst</span><span class="s1">&#39;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-397" id="section-397">&#182;</a>
</div>
<p>Be Bourne compatible (taken from Autoconf:_AS_BOURNE_COMPATIBLE).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">if test -n \&quot;\${ZSH_VERSION+set}\&quot; &amp;&amp; (emulate sh) &gt;/dev/null 2&gt;&amp;1; then</span>
<span class="s1">  emulate sh</span>
<span class="s1">  NULLCMD=:</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-398" id="section-398">&#182;</a>
</div>
<p>Zsh 3.x and 4.x performs word splitting on \${1+\"\$@\"}, which
is contrary to our usage.  Disable this feature.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  alias -g &#39;</span><span class="se">\$</span><span class="o">{</span>1+<span class="se">\&quot;\$</span>@<span class="se">\&quot;</span><span class="o">}</span><span class="s1">&#39;=&#39;</span><span class="se">\&quot;\$</span>@<span class="se">\&quot;</span><span class="s1">&#39;</span>
<span class="s1">  setopt NO_GLOB_SUBST</span>
<span class="s1">else</span>
<span class="s1">  case \`(set -o) 2&gt;/dev/null\` in *posix*) set -o posix;; esac</span>
<span class="s1">fi</span>
<span class="s1">BIN_SH=xpg4; export BIN_SH # for Tru64</span>
<span class="s1">DUALCASE=1; export DUALCASE # for MKS sh</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-399" id="section-399">&#182;</a>
</div>
<p>The HP-UX ksh and POSIX shell print the target directory to stdout
if CDPATH is set.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">(unset CDPATH) &gt;/dev/null 2&gt;&amp;1 &amp;&amp; unset CDPATH</span>

<span class="s1">relink_command=\&quot;$relink_command\&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-400" id="section-400">&#182;</a>
</div>
<p>This environment variable determines our operation mode.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">if test \&quot;\$libtool_install_magic\&quot; = \&quot;$magic\&quot;; then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-401" id="section-401">&#182;</a>
</div>
<p>install mode needs the following variable:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  notinst_deplibs=&#39;</span><span class="nv">$notinst_deplibs</span><span class="s1">&#39;</span>
<span class="s1">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-402" id="section-402">&#182;</a>
</div>
<p>When we are sourced in execute mode, \$file and \$echo are already set.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then</span>
<span class="s1">    echo=\&quot;$qecho\&quot;</span>
<span class="s1">    file=\&quot;\$0\&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-403" id="section-403">&#182;</a>
</div>
<p>Make sure echo works.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    if test \&quot;X\$1\&quot; = X--no-reexec; then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-404" id="section-404">&#182;</a>
</div>
<p>Discard the --no-reexec flag, and continue.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">      shift</span>
<span class="s1">    elif test \&quot;X\`(\$echo &#39;</span><span class="se">\t</span><span class="s1">&#39;) 2&gt;/dev/null\`\&quot; = &#39;</span>X<span class="se">\t</span><span class="s1">&#39;; then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-405" id="section-405">&#182;</a>
</div>
<p>Yippee, \$echo works!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">      :</span>
<span class="s1">    else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-406" id="section-406">&#182;</a>
</div>
<p>Restart under the correct shell, and then maybe \$echo will work.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">      exec $SHELL \&quot;\$0\&quot; --no-reexec \${1+\&quot;\$@\&quot;}</span>
<span class="s1">    fi</span>
<span class="s1">  fi\</span>
<span class="s1">&quot;</span>
<span class="s1">  $echo &gt;&gt; $output &quot;\</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-407" id="section-407">&#182;</a>
</div>
<p>Find the directory that this script lives in.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  thisdir=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e &#39;</span>s%/<span class="o">[</span>^/<span class="o">]</span>*<span class="nv">$%</span>%<span class="s1">&#39;\`</span>
<span class="s1">  test \&quot;x\$thisdir\&quot; = \&quot;x\$file\&quot; &amp;&amp; thisdir=.</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-408" id="section-408">&#182;</a>
</div>
<p>Follow symbolic links until we get to the real thisdir.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  file=\`ls -ld \&quot;\$file\&quot; | ${SED} -n &#39;</span>s/.*-&gt; //p<span class="s1">&#39;\`</span>
<span class="s1">  while test -n \&quot;\$file\&quot;; do</span>
<span class="s1">    destdir=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e &#39;</span>s%/<span class="o">[</span>^/<span class="o">]</span>*<span class="se">\$</span>%%<span class="s1">&#39;\`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-409" id="section-409">&#182;</a>
</div>
<p>If there was a directory component, then change thisdir.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    if test \&quot;x\$destdir\&quot; != \&quot;x\$file\&quot;; then</span>
<span class="s1">      case \&quot;\$destdir\&quot; in</span>
<span class="s1">      [\\\\/]* | [A-Za-z]:[\\\\/]*) thisdir=\&quot;\$destdir\&quot; ;;</span>
<span class="s1">      *) thisdir=\&quot;\$thisdir/\$destdir\&quot; ;;</span>
<span class="s1">      esac</span>
<span class="s1">    fi</span>

<span class="s1">    file=\`\$echo \&quot;X\$file\&quot; | \$Xsed -e &#39;</span>s%^.*/%%<span class="s1">&#39;\`</span>
<span class="s1">    file=\`ls -ld \&quot;\$thisdir/\$file\&quot; | ${SED} -n &#39;</span>s/.*-&gt; //p<span class="s1">&#39;\`</span>
<span class="s1">  done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-410" id="section-410">&#182;</a>
</div>
<p>Try to get the absolute directory name.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  absdir=\`cd \&quot;\$thisdir\&quot; &amp;&amp; pwd\`</span>
<span class="s1">  test -n \&quot;\$absdir\&quot; &amp;&amp; thisdir=\&quot;\$absdir\&quot;</span>
<span class="s1">&quot;</span>

<span class="s1">  if test &quot;$fast_install&quot; = yes; then</span>
<span class="s1">    $echo &gt;&gt; $output &quot;\</span>
<span class="s1">  program=lt-&#39;</span><span class="nv">$outputname</span><span class="s1">&#39;$exeext</span>
<span class="s1">  progdir=\&quot;\$thisdir/$objdir\&quot;</span>

<span class="s1">  if test ! -f \&quot;\$progdir/\$program\&quot; || \\</span>
<span class="s1">     { file=\`ls -1dt \&quot;\$progdir/\$program\&quot; \&quot;\$progdir/../\$program\&quot; 2&gt;/dev/null | ${SED} 1q\`; \\</span>
<span class="s1">       test \&quot;X\$file\&quot; != \&quot;X\$progdir/\$program\&quot;; }; then</span>

<span class="s1">    file=\&quot;\$\$-\$program\&quot;</span>

<span class="s1">    if test ! -d \&quot;\$progdir\&quot;; then</span>
<span class="s1">      $mkdir \&quot;\$progdir\&quot;</span>
<span class="s1">    else</span>
<span class="s1">      $rm \&quot;\$progdir/\$file\&quot;</span>
<span class="s1">    fi&quot;</span>

<span class="s1">    $echo &gt;&gt; $output &quot;\</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-411" id="section-411">&#182;</a>
</div>
<p>relink executable if necessary</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    if test -n \&quot;\$relink_command\&quot;; then</span>
<span class="s1">      if relink_command_output=\`eval \$relink_command 2&gt;&amp;1\`; then :</span>
<span class="s1">      else</span>
<span class="s1">  $echo \&quot;\$relink_command_output\&quot; &gt;&amp;2</span>
<span class="s1">  $rm \&quot;\$progdir/\$file\&quot;</span>
<span class="s1">  exit $EXIT_FAILURE</span>
<span class="s1">      fi</span>
<span class="s1">    fi</span>

<span class="s1">    $mv \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot; 2&gt;/dev/null ||</span>
<span class="s1">    { $rm \&quot;\$progdir/\$program\&quot;;</span>
<span class="s1">      $mv \&quot;\$progdir/\$file\&quot; \&quot;\$progdir/\$program\&quot;; }</span>
<span class="s1">    $rm \&quot;\$progdir/\$file\&quot;</span>
<span class="s1">  fi&quot;</span>
<span class="s1">  else</span>
<span class="s1">    $echo &gt;&gt; $output &quot;\</span>
<span class="s1">  program=&#39;</span><span class="nv">$outputname</span><span class="s1">&#39;</span>
<span class="s1">  progdir=\&quot;\$thisdir/$objdir\&quot;</span>
<span class="s1">&quot;</span>
<span class="s1">  fi</span>

<span class="s1">  $echo &gt;&gt; $output &quot;\</span>

<span class="s1">  if test -f \&quot;\$progdir/\$program\&quot;; then&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-412" id="section-412">&#182;</a>
</div>
<p>Export our shlibpath_var if we have one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  if test &quot;$shlibpath_overrides_runpath&quot; = yes &amp;&amp; test -n &quot;$shlibpath_var&quot; &amp;&amp; test -n &quot;$temp_rpath&quot;; then</span>
<span class="s1">    $echo &gt;&gt; $output &quot;\</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-413" id="section-413">&#182;</a>
</div>
<p>Add our own library path to $shlibpath_var</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    $shlibpath_var=\&quot;$temp_rpath\$$shlibpath_var\&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-414" id="section-414">&#182;</a>
</div>
<p>Some systems cannot cope with colon-terminated $shlibpath_var
The second colon is a workaround for a bug in BeOS R4 sed</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    $shlibpath_var=\`\$echo \&quot;X\$$shlibpath_var\&quot; | \$Xsed -e &#39;</span>s/::*<span class="se">\$</span>//<span class="s1">&#39;\`</span>

<span class="s1">    export $shlibpath_var</span>
<span class="s1">&quot;</span>
<span class="s1">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-415" id="section-415">&#182;</a>
</div>
<p>fixup the dll searchpath if we need to.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  if test -n &quot;$dllsearchpath&quot;; then</span>
<span class="s1">    $echo &gt;&gt; $output &quot;\</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-416" id="section-416">&#182;</a>
</div>
<p>Add the dll search path components to the executable PATH</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    PATH=$dllsearchpath:\$PATH</span>
<span class="s1">&quot;</span>
<span class="s1">  fi</span>

<span class="s1">  $echo &gt;&gt; $output &quot;\</span>
<span class="s1">    if test \&quot;\$libtool_execute_magic\&quot; != \&quot;$magic\&quot;; then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-417" id="section-417">&#182;</a>
</div>
<p>Run the actual program with our arguments.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">&quot;</span>
<span class="s1">  case $host in</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-418" id="section-418">&#182;</a>
</div>
<p>Backslashes separate directories on plain windows</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  *-*-mingw | *-*-os2*)</span>
<span class="s1">    $echo &gt;&gt; $output &quot;\</span>
<span class="s1">      exec \&quot;\$progdir\\\\\$program\&quot; \${1+\&quot;\$@\&quot;}</span>
<span class="s1">&quot;</span>
<span class="s1">    ;;</span>

<span class="s1">  *)</span>
<span class="s1">    $echo &gt;&gt; $output &quot;\</span>
<span class="s1">      exec \&quot;\$progdir/\$program\&quot; \${1+\&quot;\$@\&quot;}</span>
<span class="s1">&quot;</span>
<span class="s1">    ;;</span>
<span class="s1">  esac</span>
<span class="s1">  $echo &gt;&gt; $output &quot;\</span>
<span class="s1">      \$echo \&quot;\$0: cannot exec \$program \$*\&quot;</span>
<span class="s1">      exit $EXIT_FAILURE</span>
<span class="s1">    fi</span>
<span class="s1">  else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-419" id="section-419">&#182;</a>
</div>
<p>The program doesn't exist.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    \$echo \&quot;\$0: error: \\\`\$progdir/\$program&#39;</span> does not exist<span class="se">\&quot;</span> 1&gt;&amp;2
    <span class="se">\$</span><span class="nb">echo</span> <span class="se">\&quot;</span>This script is just a wrapper <span class="k">for</span> <span class="se">\$</span>program.<span class="se">\&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="se">\&quot;</span>See the <span class="nv">$PACKAGE</span> documentation <span class="k">for </span>more information.<span class="se">\&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>
<span class="k">fi</span><span class="se">\</span>
<span class="s2">&quot;</span>
<span class="s2">  chmod +x $output</span>
<span class="s2">      fi</span>
<span class="s2">      exit $EXIT_SUCCESS</span>
<span class="s2">      ;;</span>
<span class="s2">    esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-420" id="section-420">&#182;</a>
</div>
<p>See if we need to build an old-fashioned archive.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">    for oldlib in $oldlibs; do</span>

<span class="s2">      if test &quot;</span><span class="nv">$build_libtool_libs</span><span class="s2">&quot; = convenience; then</span>
<span class="s2">  oldobjs=&quot;</span><span class="nv">$libobjs_save</span><span class="s2">&quot;</span>
<span class="s2">  addlibs=&quot;</span><span class="nv">$convenience</span><span class="s2">&quot;</span>
<span class="s2">  build_libtool_libs=no</span>
<span class="s2">      else</span>
<span class="s2">  if test &quot;</span><span class="nv">$build_libtool_libs</span><span class="s2">&quot; = module; then</span>
<span class="s2">    oldobjs=&quot;</span><span class="nv">$libobjs_save</span><span class="s2">&quot;</span>
<span class="s2">    build_libtool_libs=no</span>
<span class="s2">  else</span>
<span class="s2">    oldobjs=&quot;</span><span class="nv">$old_deplibs</span> <span class="nv">$non_pic_objects</span><span class="s2">&quot;</span>
<span class="s2">  fi</span>
<span class="s2">  addlibs=&quot;</span><span class="nv">$old_convenience</span><span class="s2">&quot;</span>
<span class="s2">      fi</span>

<span class="s2">      if test -n &quot;</span><span class="nv">$addlibs</span><span class="s2">&quot;; then</span>
<span class="s2">  gentop=&quot;</span><span class="nv">$output_objdir</span>/<span class="k">${</span><span class="nv">outputname</span><span class="k">}</span>x<span class="s2">&quot;</span>
<span class="s2">  generated=&quot;</span><span class="nv">$generated</span> <span class="nv">$gentop</span><span class="s2">&quot;</span>

<span class="s2">  func_extract_archives $gentop $addlibs</span>
<span class="s2">  oldobjs=&quot;</span><span class="nv">$oldobjs</span> <span class="nv">$func_extract_archives_result</span><span class="s2">&quot;</span>
<span class="s2">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-421" id="section-421">&#182;</a>
</div>
<p>Do each command in the archive commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">      if test -n &quot;</span><span class="nv">$old_archive_from_new_cmds</span><span class="s2">&quot; &amp;&amp; test &quot;</span><span class="nv">$build_libtool_libs</span><span class="s2">&quot; = yes; then</span>
<span class="s2">       cmds=$old_archive_from_new_cmds</span>
<span class="s2">      else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-422" id="section-422">&#182;</a>
</div>
<p>POSIX demands no paths to be encoded in archives.  We have
to avoid creating archives with duplicate basenames if we
might have to extract them afterwards, e.g., when creating a
static archive out of a convenience library, or when linking
the entirety of a libtool archive into another (currently
not supported by libtool).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">  if (for obj in $oldobjs</span>
<span class="s2">      do</span>
<span class="s2">        $echo &quot;</span>X<span class="nv">$obj</span><span class="s2">&quot; | $Xsed -e &#39;s%^.*/%%&#39;</span>
<span class="s2">      done | sort | sort -uc &gt;/dev/null 2&gt;&amp;1); then</span>
<span class="s2">    :</span>
<span class="s2">  else</span>
<span class="s2">    $echo &quot;</span>copying selected object files to avoid basename conflicts...<span class="s2">&quot;</span>

<span class="s2">    if test -z &quot;</span><span class="nv">$gentop</span><span class="s2">&quot;; then</span>
<span class="s2">      gentop=&quot;</span><span class="nv">$output_objdir</span>/<span class="k">${</span><span class="nv">outputname</span><span class="k">}</span>x<span class="s2">&quot;</span>
<span class="s2">      generated=&quot;</span><span class="nv">$generated</span> <span class="nv">$gentop</span><span class="s2">&quot;</span>

<span class="s2">      $show &quot;</span><span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="nv">$gentop</span><span class="s2">&quot;</span>
<span class="s2">      $run ${rm}r &quot;</span><span class="nv">$gentop</span><span class="s2">&quot;</span>
<span class="s2">      $show &quot;</span><span class="nv">$mkdir</span> <span class="nv">$gentop</span><span class="s2">&quot;</span>
<span class="s2">      $run $mkdir &quot;</span><span class="nv">$gentop</span><span class="s2">&quot;</span>
<span class="s2">      exit_status=$?</span>
<span class="s2">      if test &quot;</span><span class="nv">$exit_status</span><span class="s2">&quot; -ne 0 &amp;&amp; test ! -d &quot;</span><span class="nv">$gentop</span><span class="s2">&quot;; then</span>
<span class="s2">        exit $exit_status</span>
<span class="s2">      fi</span>
<span class="s2">    fi</span>

<span class="s2">    save_oldobjs=$oldobjs</span>
<span class="s2">    oldobjs=</span>
<span class="s2">    counter=1</span>
<span class="s2">    for obj in $save_oldobjs</span>
<span class="s2">    do</span>
<span class="s2">      objbase=`$echo &quot;</span>X<span class="nv">$obj</span><span class="s2">&quot; | $Xsed -e &#39;s%^.*/%%&#39;`</span>
<span class="s2">      case &quot;</span> <span class="nv">$oldobjs</span> <span class="s2">&quot; in</span>
<span class="s2">      &quot;</span> <span class="s2">&quot;) oldobjs=$obj ;;</span>
<span class="s2">      *[\ /]&quot;</span><span class="nv">$objbase</span> <span class="s2">&quot;*)</span>
<span class="s2">        while :; do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-423" id="section-423">&#182;</a>
</div>
<p>Make sure we don't pick an alternate name that also
overlaps.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">    newobj=lt$counter-$objbase</span>
<span class="s2">    counter=`expr $counter + 1`</span>
<span class="s2">    case &quot;</span> <span class="nv">$oldobjs</span> <span class="s2">&quot; in</span>
<span class="s2">    *[\ /]&quot;</span><span class="nv">$newobj</span> <span class="s2">&quot;*) ;;</span>
<span class="s2">    *) if test ! -f &quot;</span><span class="nv">$gentop</span>/<span class="nv">$newobj</span><span class="s2">&quot;; then break; fi ;;</span>
<span class="s2">    esac</span>
<span class="s2">        done</span>
<span class="s2">        $show &quot;</span>ln <span class="nv">$obj</span> <span class="nv">$gentop</span>/<span class="nv">$newobj</span> <span class="o">||</span> cp <span class="nv">$obj</span> <span class="nv">$gentop</span>/<span class="nv">$newobj</span><span class="s2">&quot;</span>
<span class="s2">        $run ln &quot;</span><span class="nv">$obj</span><span class="s2">&quot; &quot;</span><span class="nv">$gentop</span>/<span class="nv">$newobj</span><span class="s2">&quot; ||</span>
<span class="s2">        $run cp &quot;</span><span class="nv">$obj</span><span class="s2">&quot; &quot;</span><span class="nv">$gentop</span>/<span class="nv">$newobj</span><span class="s2">&quot;</span>
<span class="s2">        oldobjs=&quot;</span><span class="nv">$oldobjs</span> <span class="nv">$gentop</span>/<span class="nv">$newobj</span><span class="s2">&quot;</span>
<span class="s2">        ;;</span>
<span class="s2">      *) oldobjs=&quot;</span><span class="nv">$oldobjs</span> <span class="nv">$obj</span><span class="s2">&quot; ;;</span>
<span class="s2">      esac</span>
<span class="s2">    done</span>
<span class="s2">  fi</span>

<span class="s2">  eval cmds=\&quot;$old_archive_cmds\&quot;</span>

<span class="s2">  if len=`expr &quot;</span>X<span class="nv">$cmds</span><span class="s2">&quot; : &quot;</span>.*<span class="s2">&quot;` &amp;&amp;</span>
<span class="s2">       test &quot;</span><span class="nv">$len</span><span class="s2">&quot; -le &quot;</span><span class="nv">$max_cmd_len</span><span class="s2">&quot; || test &quot;</span><span class="nv">$max_cmd_len</span><span class="s2">&quot; -le -1; then</span>
<span class="s2">    cmds=$old_archive_cmds</span>
<span class="s2">  else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-424" id="section-424">&#182;</a>
</div>
<p>the command line is too long to link in one step, link in parts</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">    $echo &quot;</span>using piecewise archive linking...<span class="s2">&quot;</span>
<span class="s2">    save_RANLIB=$RANLIB</span>
<span class="s2">    RANLIB=:</span>
<span class="s2">    objlist=</span>
<span class="s2">    concat_cmds=</span>
<span class="s2">    save_oldobjs=$oldobjs</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-425" id="section-425">&#182;</a>
</div>
<p>Is there a better way of finding the last object in the list?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">    for obj in $save_oldobjs</span>
<span class="s2">    do</span>
<span class="s2">      last_oldobj=$obj</span>
<span class="s2">    done</span>
<span class="s2">    for obj in $save_oldobjs</span>
<span class="s2">    do</span>
<span class="s2">      oldobjs=&quot;</span><span class="nv">$objlist</span> <span class="nv">$obj</span><span class="s2">&quot;</span>
<span class="s2">      objlist=&quot;</span><span class="nv">$objlist</span> <span class="nv">$obj</span><span class="s2">&quot;</span>
<span class="s2">      eval test_cmds=\&quot;$old_archive_cmds\&quot;</span>
<span class="s2">      if len=`expr &quot;</span>X<span class="nv">$test_cmds</span><span class="s2">&quot; : &quot;</span>.*<span class="s2">&quot; 2&gt;/dev/null` &amp;&amp;</span>
<span class="s2">         test &quot;</span><span class="nv">$len</span><span class="s2">&quot; -le &quot;</span><span class="nv">$max_cmd_len</span><span class="s2">&quot;; then</span>
<span class="s2">        :</span>
<span class="s2">      else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-426" id="section-426">&#182;</a>
</div>
<p>the above command should be used before it gets too long</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">        oldobjs=$objlist</span>
<span class="s2">        if test &quot;</span><span class="nv">$obj</span><span class="s2">&quot; = &quot;</span><span class="nv">$last_oldobj</span><span class="s2">&quot; ; then</span>
<span class="s2">          RANLIB=$save_RANLIB</span>
<span class="s2">        fi</span>
<span class="s2">        test -z &quot;</span><span class="nv">$concat_cmds</span><span class="s2">&quot; || concat_cmds=$concat_cmds~</span>
<span class="s2">        eval concat_cmds=\&quot;\${concat_cmds}$old_archive_cmds\&quot;</span>
<span class="s2">        objlist=</span>
<span class="s2">      fi</span>
<span class="s2">    done</span>
<span class="s2">    RANLIB=$save_RANLIB</span>
<span class="s2">    oldobjs=$objlist</span>
<span class="s2">    if test &quot;</span>X<span class="nv">$oldobjs</span><span class="s2">&quot; = &quot;</span>X<span class="s2">&quot; ; then</span>
<span class="s2">      eval cmds=\&quot;\$concat_cmds\&quot;</span>
<span class="s2">    else</span>
<span class="s2">      eval cmds=\&quot;\$concat_cmds~\$old_archive_cmds\&quot;</span>
<span class="s2">    fi</span>
<span class="s2">  fi</span>
<span class="s2">      fi</span>
<span class="s2">      save_ifs=&quot;</span><span class="nv">$IFS</span><span class="s2">&quot;; IFS=&#39;~&#39;</span>
<span class="s2">      for cmd in $cmds; do</span>
<span class="s2">        eval cmd=\&quot;$cmd\&quot;</span>
<span class="s2">  IFS=&quot;</span><span class="nv">$save_ifs</span><span class="s2">&quot;</span>
<span class="s2">  $show &quot;</span><span class="nv">$cmd</span><span class="s2">&quot;</span>
<span class="s2">  $run eval &quot;</span><span class="nv">$cmd</span><span class="s2">&quot; || exit $?</span>
<span class="s2">      done</span>
<span class="s2">      IFS=&quot;</span><span class="nv">$save_ifs</span><span class="s2">&quot;</span>
<span class="s2">    done</span>

<span class="s2">    if test -n &quot;</span><span class="nv">$generated</span><span class="s2">&quot;; then</span>
<span class="s2">      $show &quot;</span><span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r<span class="nv">$generated</span><span class="s2">&quot;</span>
<span class="s2">      $run ${rm}r$generated</span>
<span class="s2">    fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-427" id="section-427">&#182;</a>
</div>
<p>Now create the libtool archive.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">    case $output in</span>
<span class="s2">    *.la)</span>
<span class="s2">      old_library=</span>
<span class="s2">      test &quot;</span><span class="nv">$build_old_libs</span><span class="s2">&quot; = yes &amp;&amp; old_library=&quot;</span><span class="nv">$libname</span>.<span class="nv">$libext</span><span class="s2">&quot;</span>
<span class="s2">      $show &quot;</span>creating <span class="nv">$output</span><span class="s2">&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-428" id="section-428">&#182;</a>
</div>
<p>Preserve any variables that may affect compiler behavior</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">      for var in $variables_saved_for_relink; do</span>
<span class="s2">  if eval test -z \&quot;\${$var+set}\&quot;; then</span>
<span class="s2">    relink_command=&quot;</span><span class="o">{</span> <span class="nb">test</span> -z <span class="se">\&quot;\$</span><span class="o">{</span><span class="nv">$var</span>+set<span class="o">}</span><span class="se">\&quot;</span> <span class="o">||</span> <span class="nb">unset</span> <span class="nv">$var</span> <span class="o">||</span> <span class="o">{</span> <span class="nv">$var</span><span class="o">=</span>; <span class="nb">export</span> <span class="nv">$var</span>; <span class="o">}</span>; <span class="o">}</span>; <span class="nv">$relink_command</span><span class="s2">&quot;</span>
<span class="s2">  elif eval var_value=\$$var; test -z &quot;</span><span class="nv">$var_value</span><span class="s2">&quot;; then</span>
<span class="s2">    relink_command=&quot;</span><span class="nv">$var</span><span class="o">=</span>; <span class="nb">export</span> <span class="nv">$var</span>; <span class="nv">$relink_command</span><span class="s2">&quot;</span>
<span class="s2">  else</span>
<span class="s2">    var_value=`$echo &quot;</span>X<span class="nv">$var_value</span><span class="s2">&quot; | $Xsed -e &quot;</span><span class="nv">$sed_quote_subst</span><span class="s2">&quot;`</span>
<span class="s2">    relink_command=&quot;</span><span class="nv">$var</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$var_value</span><span class="se">\&quot;</span>; <span class="nb">export</span> <span class="nv">$var</span>; <span class="nv">$relink_command</span><span class="s2">&quot;</span>
<span class="s2">  fi</span>
<span class="s2">      done</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-429" id="section-429">&#182;</a>
</div>
<p>Quote the link command for shipping.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">      relink_command=&quot;</span><span class="o">(</span><span class="nb">cd</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>; <span class="nv">$SHELL</span> <span class="nv">$progpath</span> <span class="nv">$preserve_args</span> --mode<span class="o">=</span>relink <span class="nv">$libtool_args</span> @inst_prefix_dir@<span class="o">)</span><span class="s2">&quot;</span>
<span class="s2">      relink_command=`$echo &quot;</span>X<span class="nv">$relink_command</span><span class="s2">&quot; | $SP2NL | $Xsed -e &quot;</span><span class="nv">$sed_quote_subst</span><span class="s2">&quot; | $NL2SP`</span>
<span class="s2">      if test &quot;</span><span class="nv">$hardcode_automatic</span><span class="s2">&quot; = yes ; then</span>
<span class="s2">  relink_command=</span>
<span class="s2">      fi</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-430" id="section-430">&#182;</a>
</div>
<p>Only create the output if not a dry run.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">      if test -z &quot;</span><span class="nv">$run</span><span class="s2">&quot;; then</span>
<span class="s2">  for installed in no yes; do</span>
<span class="s2">    if test &quot;</span><span class="nv">$installed</span><span class="s2">&quot; = yes; then</span>
<span class="s2">      if test -z &quot;</span><span class="nv">$install_libdir</span><span class="s2">&quot;; then</span>
<span class="s2">        break</span>
<span class="s2">      fi</span>
<span class="s2">      output=&quot;</span><span class="nv">$output_objdir</span>/<span class="nv">$outputname</span><span class="s2">&quot;i</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-431" id="section-431">&#182;</a>
</div>
<p>Replace all uninstalled libtool libraries with the installed ones</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">      newdependency_libs=</span>
<span class="s2">      for deplib in $dependency_libs; do</span>
<span class="s2">        case $deplib in</span>
<span class="s2">        *.la)</span>
<span class="s2">    name=`$echo &quot;</span>X<span class="nv">$deplib</span><span class="s2">&quot; | $Xsed -e &#39;s%^.*/%%&#39;`</span>
<span class="s2">    eval libdir=`${SED} -n -e &#39;s/^libdir=\(.*\)$/\1/p&#39; $deplib`</span>
<span class="s2">    if test -z &quot;</span><span class="nv">$libdir</span><span class="s2">&quot;; then</span>
<span class="s2">      $echo &quot;</span><span class="nv">$modename</span>: <span class="se">\`</span><span class="nv">$deplib</span><span class="s1">&#39; is not a valid libtool archive&quot; 1&gt;&amp;2</span>
<span class="s1">      exit $EXIT_FAILURE</span>
<span class="s1">    fi</span>
<span class="s1">    newdependency_libs=&quot;$newdependency_libs $libdir/$name&quot;</span>
<span class="s1">    ;;</span>
<span class="s1">        *) newdependency_libs=&quot;$newdependency_libs $deplib&quot; ;;</span>
<span class="s1">        esac</span>
<span class="s1">      done</span>
<span class="s1">      dependency_libs=&quot;$newdependency_libs&quot;</span>
<span class="s1">      newdlfiles=</span>
<span class="s1">      for lib in $dlfiles; do</span>
<span class="s1">        name=`$echo &quot;X$lib&quot; | $Xsed -e &#39;</span>s%^.*/%%<span class="s1">&#39;`</span>
<span class="s1">        eval libdir=`${SED} -n -e &#39;</span>s/^libdir<span class="o">=</span><span class="se">\(</span>.*<span class="se">\)</span><span class="nv">$/</span><span class="se">\1</span>/p<span class="s1">&#39; $lib`</span>
<span class="s1">        if test -z &quot;$libdir&quot;; then</span>
<span class="s1">    $echo &quot;$modename: \`$lib&#39;</span> is not a valid libtool archive<span class="s2">&quot; 1&gt;&amp;2</span>
<span class="s2">    exit $EXIT_FAILURE</span>
<span class="s2">        fi</span>
<span class="s2">        newdlfiles=&quot;</span><span class="nv">$newdlfiles</span> <span class="nv">$libdir</span>/<span class="nv">$name</span><span class="s2">&quot;</span>
<span class="s2">      done</span>
<span class="s2">      dlfiles=&quot;</span><span class="nv">$newdlfiles</span><span class="s2">&quot;</span>
<span class="s2">      newdlprefiles=</span>
<span class="s2">      for lib in $dlprefiles; do</span>
<span class="s2">        name=`$echo &quot;</span>X<span class="nv">$lib</span><span class="s2">&quot; | $Xsed -e &#39;s%^.*/%%&#39;`</span>
<span class="s2">        eval libdir=`${SED} -n -e &#39;s/^libdir=\(.*\)$/\1/p&#39; $lib`</span>
<span class="s2">        if test -z &quot;</span><span class="nv">$libdir</span><span class="s2">&quot;; then</span>
<span class="s2">    $echo &quot;</span><span class="nv">$modename</span>: <span class="se">\`</span><span class="nv">$lib</span><span class="s1">&#39; is not a valid libtool archive&quot; 1&gt;&amp;2</span>
<span class="s1">    exit $EXIT_FAILURE</span>
<span class="s1">        fi</span>
<span class="s1">        newdlprefiles=&quot;$newdlprefiles $libdir/$name&quot;</span>
<span class="s1">      done</span>
<span class="s1">      dlprefiles=&quot;$newdlprefiles&quot;</span>
<span class="s1">    else</span>
<span class="s1">      newdlfiles=</span>
<span class="s1">      for lib in $dlfiles; do</span>
<span class="s1">        case $lib in</span>
<span class="s1">    [\\/]* | [A-Za-z]:[\\/]*) abs=&quot;$lib&quot; ;;</span>
<span class="s1">    *) abs=`pwd`&quot;/$lib&quot; ;;</span>
<span class="s1">        esac</span>
<span class="s1">        newdlfiles=&quot;$newdlfiles $abs&quot;</span>
<span class="s1">      done</span>
<span class="s1">      dlfiles=&quot;$newdlfiles&quot;</span>
<span class="s1">      newdlprefiles=</span>
<span class="s1">      for lib in $dlprefiles; do</span>
<span class="s1">        case $lib in</span>
<span class="s1">    [\\/]* | [A-Za-z]:[\\/]*) abs=&quot;$lib&quot; ;;</span>
<span class="s1">    *) abs=`pwd`&quot;/$lib&quot; ;;</span>
<span class="s1">        esac</span>
<span class="s1">        newdlprefiles=&quot;$newdlprefiles $abs&quot;</span>
<span class="s1">      done</span>
<span class="s1">      dlprefiles=&quot;$newdlprefiles&quot;</span>
<span class="s1">    fi</span>
<span class="s1">    $rm $output</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-432" id="section-432">&#182;</a>
</div>
<p>place dlname in correct position for cygwin</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    tdlname=$dlname</span>
<span class="s1">    case $host,$output,$installed,$module,$dlname in</span>
<span class="s1">      *cygwin*,*lai,yes,no,*.dll | *mingw*,*lai,yes,no,*.dll) tdlname=../bin/$dlname ;;</span>
<span class="s1">    esac</span>
<span class="s1">    $echo &gt; $output &quot;\</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-433" id="section-433">&#182;</a>
</div>
<p>$outputname - a libtool library file
Generated by $PROGRAM - GNU $PACKAGE $VERSION$TIMESTAMP</p>

<p>Please DO NOT delete this file!
It is necessary for linking the library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-434" id="section-434">&#182;</a>
</div>
<p>The name that we can dlopen(3).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">dlname=&#39;</span><span class="nv">$tdlname</span><span class="s1">&#39;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-435" id="section-435">&#182;</a>
</div>
<p>Names of this library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">library_names=&#39;</span><span class="nv">$library_names</span><span class="s1">&#39;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-436" id="section-436">&#182;</a>
</div>
<p>The name of the static archive.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">old_library=&#39;</span><span class="nv">$old_library</span><span class="s1">&#39;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-437" id="section-437">&#182;</a>
</div>
<p>Libraries that this one depends upon.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">dependency_libs=&#39;</span><span class="nv">$dependency_libs</span><span class="s1">&#39;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-438" id="section-438">&#182;</a>
</div>
<p>Version information for $libname.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">current=$current</span>
<span class="s1">age=$age</span>
<span class="s1">revision=$revision</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-439" id="section-439">&#182;</a>
</div>
<p>Is this an already installed library?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">installed=$installed</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-440" id="section-440">&#182;</a>
</div>
<p>Should we warn about portability when linking against -modules?</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">shouldnotlink=$module</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-441" id="section-441">&#182;</a>
</div>
<p>Files to dlopen/dlpreopen</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">dlopen=&#39;</span><span class="nv">$dlfiles</span><span class="s1">&#39;</span>
<span class="s1">dlpreopen=&#39;</span><span class="nv">$dlprefiles</span><span class="s1">&#39;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-442" id="section-442">&#182;</a>
</div>
<p>Directory that this library needs to be installed in:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">libdir=&#39;</span><span class="nv">$install_libdir</span><span class="s1">&#39;&quot;</span>
<span class="s1">    if test &quot;$installed&quot; = no &amp;&amp; test &quot;$need_relink&quot; = yes; then</span>
<span class="s1">      $echo &gt;&gt; $output &quot;\</span>
<span class="s1">relink_command=\&quot;$relink_command\&quot;&quot;</span>
<span class="s1">    fi</span>
<span class="s1">  done</span>
<span class="s1">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-443" id="section-443">&#182;</a>
</div>
<p>Do a symbolic link so that the libtool archive can be found in
LD_LIBRARY_PATH before the program is installed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">      $show &quot;(cd $output_objdir &amp;&amp; $rm $outputname &amp;&amp; $LN_S ../$outputname $outputname)&quot;</span>
<span class="s1">      $run eval &#39;</span><span class="o">(</span><span class="nb">cd</span> <span class="nv">$output_objdir</span> <span class="o">&amp;&amp;</span> <span class="nv">$rm</span> <span class="nv">$outputname</span> <span class="o">&amp;&amp;</span> <span class="nv">$LN_S</span> ../<span class="nv">$outputname</span> <span class="nv">$outputname</span><span class="o">)</span><span class="s1">&#39; || exit $?</span>
<span class="s1">      ;;</span>
<span class="s1">    esac</span>
<span class="s1">    exit $EXIT_SUCCESS</span>
<span class="s1">    ;;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-444" id="section-444">&#182;</a>
</div>
<p>libtool install mode</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  install)</span>
<span class="s1">    modename=&quot;$modename: install&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-445" id="section-445">&#182;</a>
</div>
<p>There may be an optional sh(1) argument at the beginning of
install_prog (especially on Windows NT).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    if test &quot;$nonopt&quot; = &quot;$SHELL&quot; || test &quot;$nonopt&quot; = /bin/sh ||</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-446" id="section-446">&#182;</a>
</div>
<p>Allow the use of GNU shtool's install command.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">       $echo &quot;X$nonopt&quot; | grep shtool &gt; /dev/null; then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-447" id="section-447">&#182;</a>
</div>
<p>Aesthetically quote it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">      arg=`$echo &quot;X$nonopt&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`</span>
<span class="s1">      case $arg in</span>
<span class="s1">      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ ]*|*]*|&quot;&quot;)</span>
<span class="s1">  arg=&quot;\&quot;$arg\&quot;&quot;</span>
<span class="s1">  ;;</span>
<span class="s1">      esac</span>
<span class="s1">      install_prog=&quot;$arg &quot;</span>
<span class="s1">      arg=&quot;$1&quot;</span>
<span class="s1">      shift</span>
<span class="s1">    else</span>
<span class="s1">      install_prog=</span>
<span class="s1">      arg=$nonopt</span>
<span class="s1">    fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-448" id="section-448">&#182;</a>
</div>
<p>The real first argument should be the name of the installation program.
Aesthetically quote it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`</span>
<span class="s1">    case $arg in</span>
<span class="s1">    *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ ]*|*]*|&quot;&quot;)</span>
<span class="s1">      arg=&quot;\&quot;$arg\&quot;&quot;</span>
<span class="s1">      ;;</span>
<span class="s1">    esac</span>
<span class="s1">    install_prog=&quot;$install_prog$arg&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-449" id="section-449">&#182;</a>
</div>
<p>We need to accept at least all the BSD install flags.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">    dest=</span>
<span class="s1">    files=</span>
<span class="s1">    opts=</span>
<span class="s1">    prev=</span>
<span class="s1">    install_type=</span>
<span class="s1">    isdir=no</span>
<span class="s1">    stripme=</span>
<span class="s1">    for arg</span>
<span class="s1">    do</span>
<span class="s1">      if test -n &quot;$dest&quot;; then</span>
<span class="s1">  files=&quot;$files $dest&quot;</span>
<span class="s1">  dest=$arg</span>
<span class="s1">  continue</span>
<span class="s1">      fi</span>

<span class="s1">      case $arg in</span>
<span class="s1">      -d) isdir=yes ;;</span>
<span class="s1">      -f) </span>
<span class="s1">        case &quot; $install_prog &quot; in</span>
<span class="s1">  *[\\\ /]cp\ *) ;;</span>
<span class="s1">  *) prev=$arg ;;</span>
<span class="s1">  esac</span>
<span class="s1">  ;;</span>
<span class="s1">      -g | -m | -o) prev=$arg ;;</span>
<span class="s1">      -s)</span>
<span class="s1">  stripme=&quot; -s&quot;</span>
<span class="s1">  continue</span>
<span class="s1">  ;;</span>
<span class="s1">      -*)</span>
<span class="s1">  ;;</span>
<span class="s1">      *)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-450" id="section-450">&#182;</a>
</div>
<p>If the previous option needed an argument, then skip it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">  if test -n &quot;$prev&quot;; then</span>
<span class="s1">    prev=</span>
<span class="s1">  else</span>
<span class="s1">    dest=$arg</span>
<span class="s1">    continue</span>
<span class="s1">  fi</span>
<span class="s1">  ;;</span>
<span class="s1">      esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-451" id="section-451">&#182;</a>
</div>
<p>Aesthetically quote the argument.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s1">      arg=`$echo &quot;X$arg&quot; | $Xsed -e &quot;$sed_quote_subst&quot;`</span>
<span class="s1">      case $arg in</span>
<span class="s1">      *[\[\~\#\^\&amp;\*\(\)\{\}\|\;\&lt;\&gt;\?\&#39;\ \ ]*|*]*|&quot;&quot;)</span>
<span class="s1">  arg=&quot;\&quot;$arg\&quot;&quot;</span>
<span class="s1">  ;;</span>
<span class="s1">      esac</span>
<span class="s1">      install_prog=&quot;$install_prog $arg&quot;</span>
<span class="s1">    done</span>

<span class="s1">    if test -z &quot;$install_prog&quot;; then</span>
<span class="s1">      $echo &quot;$modename: you must specify an install program&quot; 1&gt;&amp;2</span>
<span class="s1">      $echo &quot;$help&quot; 1&gt;&amp;2</span>
<span class="s1">      exit $EXIT_FAILURE</span>
<span class="s1">    fi</span>

<span class="s1">    if test -n &quot;$prev&quot;; then</span>
<span class="s1">      $echo &quot;$modename: the \`$prev&#39;</span> option requires an argument<span class="s2">&quot; 1&gt;&amp;2</span>
<span class="s2">      $echo &quot;</span><span class="nv">$help</span><span class="s2">&quot; 1&gt;&amp;2</span>
<span class="s2">      exit $EXIT_FAILURE</span>
<span class="s2">    fi</span>

<span class="s2">    if test -z &quot;</span><span class="nv">$files</span><span class="s2">&quot;; then</span>
<span class="s2">      if test -z &quot;</span><span class="nv">$dest</span><span class="s2">&quot;; then</span>
<span class="s2">  $echo &quot;</span><span class="nv">$modename</span>: no file or destination specified<span class="s2">&quot; 1&gt;&amp;2</span>
<span class="s2">      else</span>
<span class="s2">  $echo &quot;</span><span class="nv">$modename</span>: you must specify a destination<span class="s2">&quot; 1&gt;&amp;2</span>
<span class="s2">      fi</span>
<span class="s2">      $echo &quot;</span><span class="nv">$help</span><span class="s2">&quot; 1&gt;&amp;2</span>
<span class="s2">      exit $EXIT_FAILURE</span>
<span class="s2">    fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-452" id="section-452">&#182;</a>
</div>
<p>Strip any trailing slash from the destination.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">    dest=`$echo &quot;</span>X<span class="nv">$dest</span><span class="s2">&quot; | $Xsed -e &#39;s%/$%%&#39;`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-453" id="section-453">&#182;</a>
</div>
<p>Check to see that the destination is a directory.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">    test -d &quot;</span><span class="nv">$dest</span><span class="s2">&quot; &amp;&amp; isdir=yes</span>
<span class="s2">    if test &quot;</span><span class="nv">$isdir</span><span class="s2">&quot; = yes; then</span>
<span class="s2">      destdir=&quot;</span><span class="nv">$dest</span><span class="s2">&quot;</span>
<span class="s2">      destname=</span>
<span class="s2">    else</span>
<span class="s2">      destdir=`$echo &quot;</span>X<span class="nv">$dest</span><span class="s2">&quot; | $Xsed -e &#39;s%/[^/]*$%%&#39;`</span>
<span class="s2">      test &quot;</span>X<span class="nv">$destdir</span><span class="s2">&quot; = &quot;</span>X<span class="nv">$dest</span><span class="s2">&quot; &amp;&amp; destdir=.</span>
<span class="s2">      destname=`$echo &quot;</span>X<span class="nv">$dest</span><span class="s2">&quot; | $Xsed -e &#39;s%^.*/%%&#39;`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-454" id="section-454">&#182;</a>
</div>
<p>Not a directory, so check to see that there is only one file specified.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="s2">      set dummy $files</span>
<span class="s2">      if test &quot;</span><span class="nv">$#&quot;</span> -gt 2; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$dest&#39; is not a directory&quot;</span> 1&gt;&amp;2
  <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">    case</span> <span class="nv">$destdir</span> in
    <span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>* | <span class="o">[</span>A-Za-z<span class="o">]</span>:<span class="o">[</span><span class="se">\\</span>/<span class="o">]</span>*<span class="o">)</span> ;;
    *<span class="o">)</span>
      <span class="k">for </span>file in <span class="nv">$files</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="nv">$file</span> in
  *.lo<span class="o">)</span> ;;
  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$destdir&#39; must be an absolute directory name&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>
<span class="k">      done</span>
      ;;
    <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-455" id="section-455">&#182;</a>
</div>
<p>This variable tells wrapper scripts just to set variables rather
than running their programs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">libtool_install_magic</span><span class="o">=</span><span class="s2">&quot;$magic&quot;</span>

    <span class="nv">staticlibs</span><span class="o">=</span>
    <span class="nv">future_libdirs</span><span class="o">=</span>
    <span class="nv">current_libdirs</span><span class="o">=</span>
    <span class="k">for </span>file in <span class="nv">$files</span>; <span class="k">do</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-456" id="section-456">&#182;</a>
</div>
<p>Do each installation.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">case</span> <span class="nv">$file</span> in
      *.<span class="nv">$libext</span><span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-457" id="section-457">&#182;</a>
</div>
<p>Do the static libraries later.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">staticlibs</span><span class="o">=</span><span class="s2">&quot;$staticlibs $file&quot;</span>
  ;;

      *.la<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-458" id="section-458">&#182;</a>
</div>
<p>Check to see that this really is a libtool archive.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$file</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span> :
  <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$file&#39; is not a valid libtool archive&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>

<span class="k">  </span><span class="nv">library_names</span><span class="o">=</span>
  <span class="nv">old_library</span><span class="o">=</span>
  <span class="nv">relink_command</span><span class="o">=</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-459" id="section-459">&#182;</a>
</div>
<p>If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$file</span> in
  */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$file</span> ;;
  *<span class="o">)</span> . ./<span class="nv">$file</span> ;;
  <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-460" id="section-460">&#182;</a>
</div>
<p>Add the libdir to current_libdirs if it is the destination.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$destdir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$libdir&quot;</span>; <span class="k">then</span>
<span class="k">    case</span> <span class="s2">&quot;$current_libdirs &quot;</span> in
    *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">current_libdirs</span><span class="o">=</span><span class="s2">&quot;$current_libdirs $libdir&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">  else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-461" id="section-461">&#182;</a>
</div>
<p>Note the libdir as a future libdir.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="s2">&quot;$future_libdirs &quot;</span> in
    *<span class="s2">&quot; $libdir &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">future_libdirs</span><span class="o">=</span><span class="s2">&quot;$future_libdirs $libdir&quot;</span> ;;
    <span class="k">esac</span>
<span class="k">  fi</span>

<span class="k">  </span><span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>/
  <span class="nb">test</span> <span class="s2">&quot;X$dir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$file/&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">dir</span><span class="o">=</span>
  <span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$dir$objdir&quot;</span>

  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$relink_command&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-462" id="section-462">&#182;</a>
</div>
<p>Determine the prefix the user has applied to our future dir.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">inst_prefix_dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;$destdir&quot;</span> | <span class="nv">$SED</span> <span class="s2">&quot;s%$libdir\$%%&quot;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-463" id="section-463">&#182;</a>
</div>
<p>Don't allow the user to place us outside of our expected
location b/c this prevents finding dependent libraries that
are installed to the same prefix.
At present, this check doesn't affect windows .dll's that
are installed into $libdir/../bin (currently, that works fine)
but it's something to keep an eye on.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$inst_prefix_dir&quot;</span> <span class="o">=</span> <span class="s2">&quot;$destdir&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: error: cannot install \`$file&#39; to a directory not ending in $libdir&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$inst_prefix_dir&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-464" id="section-464">&#182;</a>
</div>
<p>Stick the inst_prefix_dir data into the link command.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">relink_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;$relink_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$SED</span> <span class="s2">&quot;s%@inst_prefix_dir@%-inst-prefix-dir $inst_prefix_dir%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">relink_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;$relink_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$SED</span> <span class="s2">&quot;s%@inst_prefix_dir@%%&quot;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>
    <span class="k">fi</span>

    <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: relinking \`$file&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$show</span> <span class="s2">&quot;$relink_command&quot;</span>
    <span class="k">if</span> <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$relink_command&quot;</span>; <span class="k">then</span> :
    <span class="k">else</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: error: relink \`$file&#39; with the above command before installing it&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="k">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-465" id="section-465">&#182;</a>
</div>
<p>See the names of the shared library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">set </span>dummy <span class="nv">$library_names</span>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$2&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">realname</span><span class="o">=</span><span class="s2">&quot;$2&quot;</span>
    <span class="nb">shift</span>
<span class="nb">    shift</span>

<span class="nb">    </span><span class="nv">srcname</span><span class="o">=</span><span class="s2">&quot;$realname&quot;</span>
    <span class="nb">test</span> -n <span class="s2">&quot;$relink_command&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">srcname</span><span class="o">=</span><span class="s2">&quot;$realname&quot;</span>T


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-466" id="section-466">&#182;</a>
</div>
<p>Install the shared library and build the symlinks.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$show</span> <span class="s2">&quot;$install_prog $dir/$srcname $destdir/$realname&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$install_prog $dir/$srcname $destdir/$realname&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$stripme&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$striplib&quot;</span>; <span class="k">then</span>
      <span class="nv">$show</span> <span class="s2">&quot;$striplib $destdir/$realname&quot;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$striplib $destdir/$realname&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> <span class="s2">&quot;$#&quot;</span> -gt 0; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-467" id="section-467">&#182;</a>
</div>
<p>Delete the old symlinks, and create new ones.
Try <code>ln -sf' first, because the</code>ln' binary might depend on
the symlink we replace!  Solaris /bin/ln does not understand -f,
so we also need to try rm &amp;&amp; ln -s.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">for </span>linkname
      <span class="k">do</span>
<span class="k">        if </span><span class="nb">test</span> <span class="s2">&quot;$linkname&quot;</span> !<span class="o">=</span> <span class="s2">&quot;$realname&quot;</span>; <span class="k">then</span>
                <span class="nv">$show</span> <span class="s2">&quot;(cd $destdir &amp;&amp; { $LN_S -f $realname $linkname || { $rm $linkname &amp;&amp; $LN_S $realname $linkname; }; })&quot;</span>
                <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;(cd $destdir &amp;&amp; { $LN_S -f $realname $linkname || { $rm $linkname &amp;&amp; $LN_S $realname $linkname; }; })&quot;</span>
        <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">    fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-468" id="section-468">&#182;</a>
</div>
<p>Do each command in the postinstall commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">lib</span><span class="o">=</span><span class="s2">&quot;$destdir/$realname&quot;</span>
    <span class="nv">cmds</span><span class="o">=</span><span class="nv">$postinstall_cmds</span>
    <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
    <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
      <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="o">{</span>
        <span class="nv">lt_exit</span><span class="o">=</span><span class="nv">$?</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-469" id="section-469">&#182;</a>
</div>
<p>Restore the uninstalled library and exit</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> relink; <span class="k">then</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s1">&#39;(cd $output_objdir &amp;&amp; $rm ${realname}T &amp;&amp; $mv ${realname}U $realname)&#39;</span>
        <span class="k">fi</span>

<span class="k">        </span><span class="nb">exit</span> <span class="nv">$lt_exit</span>
      <span class="o">}</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-470" id="section-470">&#182;</a>
</div>
<p>Install the pseudo-library for information purposes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
  <span class="nv">instname</span><span class="o">=</span><span class="s2">&quot;$dir/$name&quot;</span>i
  <span class="nv">$show</span> <span class="s2">&quot;$install_prog $instname $destdir/$name&quot;</span>
  <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$install_prog $instname $destdir/$name&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-471" id="section-471">&#182;</a>
</div>
<p>Maybe install the static library, too.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">test</span> -n <span class="s2">&quot;$old_library&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">staticlibs</span><span class="o">=</span><span class="s2">&quot;$staticlibs $dir/$old_library&quot;</span>
  ;;

      *.lo<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-472" id="section-472">&#182;</a>
</div>
<p>Install (i.e. copy) a libtool object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-473" id="section-473">&#182;</a>
</div>
<p>Figure out destination file name, if it wasn't already specified.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$destname&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">destfile</span><span class="o">=</span><span class="s2">&quot;$destdir/$destname&quot;</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nv">destfile</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
    <span class="nv">destfile</span><span class="o">=</span><span class="s2">&quot;$destdir/$destfile&quot;</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-474" id="section-474">&#182;</a>
</div>
<p>Deduce the name of the destination old-style object file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$destfile</span> in
  *.lo<span class="o">)</span>
    <span class="nv">staticdest</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$destfile&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span>
    ;;
  *.<span class="nv">$objext</span><span class="o">)</span>
    <span class="nv">staticdest</span><span class="o">=</span><span class="s2">&quot;$destfile&quot;</span>
    <span class="nv">destfile</span><span class="o">=</span>
    ;;
  *<span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot copy a libtool object to \`$destfile&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-475" id="section-475">&#182;</a>
</div>
<p>Install the libtool object if requested.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$destfile&quot;</span>; <span class="k">then</span>
    <span class="nv">$show</span> <span class="s2">&quot;$install_prog $file $destfile&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$install_prog $file $destfile&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-476" id="section-476">&#182;</a>
</div>
<p>Install the old object if enabled.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$build_old_libs&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-477" id="section-477">&#182;</a>
</div>
<p>Deduce the name of the old-style object file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">staticobj</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$lo2o&quot;</span><span class="sb">`</span>

    <span class="nv">$show</span> <span class="s2">&quot;$install_prog $staticobj $staticdest&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$install_prog \$staticobj \$staticdest&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
  <span class="k">fi</span>
<span class="k">  </span><span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
  ;;

      *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-478" id="section-478">&#182;</a>
</div>
<p>Figure out destination file name, if it wasn't already specified.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$destname&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">destfile</span><span class="o">=</span><span class="s2">&quot;$destdir/$destname&quot;</span>
  <span class="k">else</span>
<span class="k">    </span><span class="nv">destfile</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
    <span class="nv">destfile</span><span class="o">=</span><span class="s2">&quot;$destdir/$destfile&quot;</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-479" id="section-479">&#182;</a>
</div>
<p>If the file is missing, and there is a .exe on the end, strip it
because it is most likely a libtool script we actually want to
install</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">stripped_ext</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
  <span class="k">case</span> <span class="nv">$file</span> in
    *.exe<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> ! -f <span class="s2">&quot;$file&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$file</span>|<span class="k">${</span><span class="nv">SED</span><span class="k">}</span> <span class="s1">&#39;s,.exe$,,&#39;</span><span class="sb">`</span>
        <span class="nv">stripped_ext</span><span class="o">=</span><span class="s2">&quot;.exe&quot;</span>
      <span class="k">fi</span>
      ;;
  <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-480" id="section-480">&#182;</a>
</div>
<p>Do a test to see if this is really a libtool program.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$host</span> in
  *cygwin*|*mingw*<span class="o">)</span>
      <span class="nv">wrapper</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$file</span> | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;s,.exe$,,&#39;</span><span class="sb">`</span>
      ;;
  *<span class="o">)</span>
      <span class="nv">wrapper</span><span class="o">=</span><span class="nv">$file</span>
      ;;
  <span class="k">esac</span>
<span class="k">  if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;4q&#39;</span> <span class="nv">$wrapper</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span>&gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
<span class="k">    </span><span class="nv">notinst_deplibs</span><span class="o">=</span>
    <span class="nv">relink_command</span><span class="o">=</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-481" id="section-481">&#182;</a>
</div>
<p>Note that it is not necessary on cygwin/mingw to append a dot to
foo even if both foo and FILE.exe exist: automatic-append-.exe
behavior happens only for exec(3), not for open(2)!  Also, sourcing
`FILE.' does not work on cygwin managed mounts.</p>

<p>If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$wrapper</span> in
    */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="k">${</span><span class="nv">wrapper</span><span class="k">}</span> ;;
    *<span class="o">)</span> . ./<span class="k">${</span><span class="nv">wrapper</span><span class="k">}</span> ;;
    <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-482" id="section-482">&#182;</a>
</div>
<p>Check the variables that should have been set.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$notinst_deplibs&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: invalid libtool wrapper script \`$wrapper&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">finalize</span><span class="o">=</span>yes
    <span class="k">for </span>lib in <span class="nv">$notinst_deplibs</span>; <span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-483" id="section-483">&#182;</a>
</div>
<p>Check to see that each library is installed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">libdir</span><span class="o">=</span>
      <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$lib&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-484" id="section-484">&#182;</a>
</div>
<p>If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">case</span> <span class="nv">$lib</span> in
        */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$lib</span> ;;
        *<span class="o">)</span> . ./<span class="nv">$lib</span> ;;
        <span class="k">esac</span>
<span class="k">      fi</span>
<span class="k">      </span><span class="nv">libfile</span><span class="o">=</span><span class="s2">&quot;$libdir/&quot;</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$lib&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%g&#39;</span><span class="sb">`</span> <span class="c">### testsuite: skip nested quoting test</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$libdir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> ! -f <span class="s2">&quot;$libfile&quot;</span>; <span class="k">then</span>
        <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`$lib&#39; has not been installed in \`$libdir&#39;&quot;</span> 1&gt;&amp;2
        <span class="nv">finalize</span><span class="o">=</span>no
      <span class="k">fi</span>
<span class="k">    done</span>

<span class="k">    </span><span class="nv">relink_command</span><span class="o">=</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-485" id="section-485">&#182;</a>
</div>
<p>Note that it is not necessary on cygwin/mingw to append a dot to
foo even if both foo and FILE.exe exist: automatic-append-.exe
behavior happens only for exec(3), not for open(2)!  Also, sourcing
`FILE.' does not work on cygwin managed mounts.</p>

<p>If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$wrapper</span> in
    */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="k">${</span><span class="nv">wrapper</span><span class="k">}</span> ;;
    *<span class="o">)</span> . ./<span class="k">${</span><span class="nv">wrapper</span><span class="k">}</span> ;;
    <span class="k">esac</span>

<span class="k">    </span><span class="nv">outputname</span><span class="o">=</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$fast_install&quot;</span> <span class="o">=</span> no <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$relink_command&quot;</span>; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;$finalize&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">tmpdir</span><span class="o">=</span><span class="sb">`</span>func_mktempdir<span class="sb">`</span>
        <span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file$stripped_ext&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
        <span class="nv">outputname</span><span class="o">=</span><span class="s2">&quot;$tmpdir/$file&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-486" id="section-486">&#182;</a>
</div>
<p>Replace the output file specification.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">relink_command</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$relink_command&quot;</span> | <span class="nv">$SP2NL</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%@OUTPUT@%&#39;</span><span class="s2">&quot;$outputname&quot;</span><span class="s1">&#39;%g&#39;</span> | <span class="nv">$NL2SP</span><span class="sb">`</span>

        <span class="nv">$show</span> <span class="s2">&quot;$relink_command&quot;</span>
        <span class="k">if</span> <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$relink_command&quot;</span>; <span class="k">then</span> :
        <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: error: relink \`$file&#39; with the above command before installing it&quot;</span> 1&gt;&amp;2
    <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="s2">&quot;$tmpdir&quot;</span>
    <span class="k">continue</span>
<span class="k">        fi</span>
<span class="k">        </span><span class="nv">file</span><span class="o">=</span><span class="s2">&quot;$outputname&quot;</span>
      <span class="k">else</span>
        <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: cannot relink \`$file&#39;&quot;</span> 1&gt;&amp;2
      <span class="k">fi</span>
<span class="k">    else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-487" id="section-487">&#182;</a>
</div>
<p>Install the binary that we compiled earlier.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file$stripped_ext&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;s%\([^/]*\)$%$objdir/\1%&quot;</span><span class="sb">`</span>
    <span class="k">fi</span>
<span class="k">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-488" id="section-488">&#182;</a>
</div>
<p>remove .exe since cygwin /usr/bin/install will append another
one anyway </p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$install_prog</span>,<span class="nv">$host</span> in
  */usr/bin/install*,*cygwin*<span class="o">)</span>
    <span class="k">case</span> <span class="nv">$file</span>:<span class="nv">$destfile</span> in
    *.exe:*.exe<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-489" id="section-489">&#182;</a>
</div>
<p>this is ok</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      ;;
    *.exe:*<span class="o">)</span>
      <span class="nv">destfile</span><span class="o">=</span><span class="nv">$destfile</span>.exe
      ;;
    *:*.exe<span class="o">)</span>
      <span class="nv">destfile</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$destfile</span> | <span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;s,.exe$,,&#39;</span><span class="sb">`</span>
      ;;
    <span class="k">esac</span>
    ;;
  <span class="k">esac</span>
  <span class="nv">$show</span> <span class="s2">&quot;$install_prog$stripme $file $destfile&quot;</span>
  <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$install_prog\$stripme \$file \$destfile&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
  <span class="nb">test</span> -n <span class="s2">&quot;$outputname&quot;</span> <span class="o">&amp;&amp;</span> <span class="k">${</span><span class="nv">rm</span><span class="k">}</span>r <span class="s2">&quot;$tmpdir&quot;</span>
  ;;
      <span class="k">esac</span>
<span class="k">    done</span>

<span class="k">    for </span>file in <span class="nv">$staticlibs</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-490" id="section-490">&#182;</a>
</div>
<p>Set up the ranlib parameters.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">oldlib</span><span class="o">=</span><span class="s2">&quot;$destdir/$name&quot;</span>

      <span class="nv">$show</span> <span class="s2">&quot;$install_prog $file $oldlib&quot;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$install_prog \$file \$oldlib&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>

      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$stripme&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$old_striplib&quot;</span>; <span class="k">then</span>
  <span class="nv">$show</span> <span class="s2">&quot;$old_striplib $oldlib&quot;</span>
  <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$old_striplib $oldlib&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-491" id="section-491">&#182;</a>
</div>
<p>Do each command in the postinstall commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">cmds</span><span class="o">=</span><span class="nv">$old_postinstall_cmds</span>
      <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
      <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">  </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
  <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
  <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
  <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nb">exit</span> <span class="nv">$?</span>
      <span class="k">done</span>
<span class="k">      </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="k">done</span>

<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$future_libdirs&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: remember to run \`$progname --finish$future_libdirs&#39;&quot;</span> 1&gt;&amp;2
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$current_libdirs&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-492" id="section-492">&#182;</a>
</div>
<p>Maybe just do a dry run.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">test</span> -n <span class="s2">&quot;$run&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">current_libdirs</span><span class="o">=</span><span class="s2">&quot; -n$current_libdirs&quot;</span>
      <span class="nv">exec_cmd</span><span class="o">=</span><span class="s1">&#39;$SHELL $progpath $preserve_args --finish$current_libdirs&#39;</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
    <span class="k">fi</span>
    ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-493" id="section-493">&#182;</a>
</div>
<p>libtool finish mode</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  finish<span class="o">)</span>
    <span class="nv">modename</span><span class="o">=</span><span class="s2">&quot;$modename: finish&quot;</span>
    <span class="nv">libdirs</span><span class="o">=</span><span class="s2">&quot;$nonopt&quot;</span>
    <span class="nv">admincmds</span><span class="o">=</span>

    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$finish_cmds$finish_eval&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$libdirs&quot;</span>; <span class="k">then</span>
<span class="k">      for </span>dir
      <span class="k">do</span>
<span class="k">  </span><span class="nv">libdirs</span><span class="o">=</span><span class="s2">&quot;$libdirs $dir&quot;</span>
      <span class="k">done</span>

<span class="k">      for </span>libdir in <span class="nv">$libdirs</span>; <span class="k">do</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$finish_cmds&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-494" id="section-494">&#182;</a>
</div>
<p>Do each command in the finish commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">cmds</span><span class="o">=</span><span class="nv">$finish_cmds</span>
    <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
    <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
      <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
      <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span> <span class="o">||</span> <span class="nv">admincmds</span><span class="o">=</span><span class="s2">&quot;$admincmds</span>
<span class="s2">       $cmd&quot;</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
  <span class="k">fi</span>
<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$finish_eval&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-495" id="section-495">&#182;</a>
</div>
<p>Do the single finish_eval.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">eval </span><span class="nv">cmds</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$finish_eval</span><span class="se">\&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmds&quot;</span> <span class="o">||</span> <span class="nv">admincmds</span><span class="o">=</span><span class="s2">&quot;$admincmds</span>
<span class="s2">       $cmds&quot;</span>
  <span class="k">fi</span>
<span class="k">      done</span>
<span class="k">    fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-496" id="section-496">&#182;</a>
</div>
<p>Exit here if they wanted silent mode.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">test</span> <span class="s2">&quot;$show&quot;</span> <span class="o">=</span> : <span class="o">&amp;&amp;</span> <span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>

    <span class="nv">$echo</span> <span class="s2">&quot;X----------------------------------------------------------------------&quot;</span> | <span class="nv">$Xsed</span>
    <span class="nv">$echo</span> <span class="s2">&quot;Libraries have been installed in:&quot;</span>
    <span class="k">for </span>libdir in <span class="nv">$libdirs</span>; <span class="k">do</span>
      <span class="nv">$echo</span> <span class="s2">&quot;   $libdir&quot;</span>
    <span class="k">done</span>
    <span class="nv">$echo</span>
    <span class="nv">$echo</span> <span class="s2">&quot;If you ever happen to want to link against installed libraries&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;in a given directory, LIBDIR, you must either use libtool, and&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;specify the full pathname of the library, or use the \`-LLIBDIR&#39;&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;flag during linking and do at least one of the following:&quot;</span>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$shlibpath_var&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;   - add LIBDIR to the \`$shlibpath_var&#39; environment variable&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;     during execution&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$runpath_var&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;   - add LIBDIR to the \`$runpath_var&#39; environment variable&quot;</span>
      <span class="nv">$echo</span> <span class="s2">&quot;     during linking&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$hardcode_libdir_flag_spec&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">libdir</span><span class="o">=</span>LIBDIR
      <span class="nb">eval </span><span class="nv">flag</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$hardcode_libdir_flag_spec</span><span class="se">\&quot;</span>

      <span class="nv">$echo</span> <span class="s2">&quot;   - use the \`$flag&#39; linker flag&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> -n <span class="s2">&quot;$admincmds&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;   - have your system administrator run these commands:$admincmds&quot;</span>
    <span class="k">fi</span>
<span class="k">    if </span><span class="nb">test</span> -f /etc/ld.so.conf; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;   - have your system administrator add LIBDIR to \`/etc/ld.so.conf&#39;&quot;</span>
    <span class="k">fi</span>
    <span class="nv">$echo</span>
    <span class="nv">$echo</span> <span class="s2">&quot;See any operating system documentation about shared libraries for&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;more information, such as the ld(1) and ld.so(8) manual pages.&quot;</span>
    <span class="nv">$echo</span> <span class="s2">&quot;X----------------------------------------------------------------------&quot;</span> | <span class="nv">$Xsed</span>
    <span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
    ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-497" id="section-497">&#182;</a>
</div>
<p>libtool execute mode</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  execute<span class="o">)</span>
    <span class="nv">modename</span><span class="o">=</span><span class="s2">&quot;$modename: execute&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-498" id="section-498">&#182;</a>
</div>
<p>The first argument is the command name.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">cmd</span><span class="o">=</span><span class="s2">&quot;$nonopt&quot;</span>
    <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$cmd&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: you must specify a COMMAND&quot;</span> 1&gt;&amp;2
      <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span>
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-499" id="section-499">&#182;</a>
</div>
<p>Handle -dlopen flags immediately.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for </span>file in <span class="nv">$execute_dlfiles</span>; <span class="k">do</span>
<span class="k">      if </span><span class="nb">test</span> ! -f <span class="s2">&quot;$file&quot;</span>; <span class="k">then</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$file&#39; is not a file&quot;</span> 1&gt;&amp;2
  <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
      <span class="k">fi</span>

<span class="k">      </span><span class="nv">dir</span><span class="o">=</span>
      <span class="k">case</span> <span class="nv">$file</span> in
      *.la<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-500" id="section-500">&#182;</a>
</div>
<p>Check to see that this really is a libtool archive.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$file</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span> :
  <span class="k">else</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: \`$lib&#39; is not a valid libtool archive&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-501" id="section-501">&#182;</a>
</div>
<p>Read the libtool library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">dlname</span><span class="o">=</span>
  <span class="nv">library_names</span><span class="o">=</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-502" id="section-502">&#182;</a>
</div>
<p>If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$file</span> in
  */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$file</span> ;;
  *<span class="o">)</span> . ./<span class="nv">$file</span> ;;
  <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-503" id="section-503">&#182;</a>
</div>
<p>Skip this library if it cannot be dlopened.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$dlname&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-504" id="section-504">&#182;</a>
</div>
<p>Warn if it was a shared library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">test</span> -n <span class="s2">&quot;$library_names&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning: \`$file&#39; was not linked with \`-export-dynamic&#39;&quot;</span>
    <span class="k">continue</span>
<span class="k">  fi</span>

<span class="k">  </span><span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
  <span class="nb">test</span> <span class="s2">&quot;X$dir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$file&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">dir</span><span class="o">=</span>.

  <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$dir/$objdir/$dlname&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$dir/$objdir&quot;</span>
  <span class="k">else</span>
<span class="k">    if </span><span class="nb">test</span> ! -f <span class="s2">&quot;$dir/$dlname&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: cannot find \`$dlname&#39; in \`$dir&#39; or \`$dir/$objdir&#39;&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>
<span class="k">  fi</span>
  ;;

      *.lo<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-505" id="section-505">&#182;</a>
</div>
<p>Just add the directory containing the .lo file.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
  <span class="nb">test</span> <span class="s2">&quot;X$dir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$file&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">dir</span><span class="o">=</span>.
  ;;

      *<span class="o">)</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: warning \`-dlopen&#39; is ignored for non-libtool libraries and objects&quot;</span> 1&gt;&amp;2
  <span class="k">continue</span>
  ;;
      <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-506" id="section-506">&#182;</a>
</div>
<p>Get the absolute pathname.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">absdir</span><span class="o">=</span><span class="sb">`</span><span class="nb">cd</span> <span class="s2">&quot;$dir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">pwd</span><span class="sb">`</span>
      <span class="nb">test</span> -n <span class="s2">&quot;$absdir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">dir</span><span class="o">=</span><span class="s2">&quot;$absdir&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-507" id="section-507">&#182;</a>
</div>
<p>Now add the directory to shlibpath_var.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">eval</span> <span class="s2">&quot;test -z \&quot;\$$shlibpath_var\&quot;&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">eval</span> <span class="s2">&quot;$shlibpath_var=\&quot;\$dir\&quot;&quot;</span>
      <span class="k">else</span>
<span class="k">  </span><span class="nb">eval</span> <span class="s2">&quot;$shlibpath_var=\&quot;\$dir:\$$shlibpath_var\&quot;&quot;</span>
      <span class="k">fi</span>
<span class="k">    done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-508" id="section-508">&#182;</a>
</div>
<p>This variable tells wrapper scripts just to set shlibpath_var
rather than running their programs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">libtool_execute_magic</span><span class="o">=</span><span class="s2">&quot;$magic&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-509" id="section-509">&#182;</a>
</div>
<p>Check if any of the arguments is a wrapper script.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">args</span><span class="o">=</span>
    <span class="k">for </span>file
    <span class="k">do</span>
<span class="k">      case</span> <span class="nv">$file</span> in
      -*<span class="o">)</span> ;;
      *<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-510" id="section-510">&#182;</a>
</div>
<p>Do a test to see if this is really a libtool program.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;4q&#39;</span> <span class="nv">$file</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-511" id="section-511">&#182;</a>
</div>
<p>If there is no directory component, then add one.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$file</span> in
    */* | *<span class="se">\\</span>*<span class="o">)</span> . <span class="nv">$file</span> ;;
    *<span class="o">)</span> . ./<span class="nv">$file</span> ;;
    <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-512" id="section-512">&#182;</a>
</div>
<p>Transform arg to wrapped name.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">file</span><span class="o">=</span><span class="s2">&quot;$progdir/$program&quot;</span>
  <span class="k">fi</span>
  ;;
      <span class="k">esac</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-513" id="section-513">&#182;</a>
</div>
<p>Quote arguments (to preserve shell metacharacters).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s2">&quot;$sed_quote_subst&quot;</span><span class="sb">`</span>
      <span class="nv">args</span><span class="o">=</span><span class="s2">&quot;$args \&quot;$file\&quot;&quot;</span>
    <span class="k">done</span>

<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$run&quot;</span>; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$shlibpath_var&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-514" id="section-514">&#182;</a>
</div>
<p>Export the shlibpath_var.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">eval</span> <span class="s2">&quot;export $shlibpath_var&quot;</span>
      <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-515" id="section-515">&#182;</a>
</div>
<p>Restore saved environment variables</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">for </span>lt_var in LANG LC_ALL LC_CTYPE LC_COLLATE LC_MESSAGES
      <span class="k">do</span>
<span class="k">  </span><span class="nb">eval</span> <span class="s2">&quot;if test \&quot;\${save_$lt_var+set}\&quot; = set; then</span>
<span class="s2">    $lt_var=\$save_$lt_var; export $lt_var</span>
<span class="s2">        fi&quot;</span>
      <span class="k">done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-516" id="section-516">&#182;</a>
</div>
<p>Now prepare to actually exec the command.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">exec_cmd</span><span class="o">=</span><span class="s2">&quot;\$cmd$args&quot;</span>
    <span class="k">else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-517" id="section-517">&#182;</a>
</div>
<p>Display what would be done.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$shlibpath_var&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">eval</span> <span class="s2">&quot;\$echo \&quot;\$shlibpath_var=\$$shlibpath_var\&quot;&quot;</span>
  <span class="nv">$echo</span> <span class="s2">&quot;export $shlibpath_var&quot;</span>
      <span class="k">fi</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$cmd$args&quot;</span>
      <span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
    <span class="k">fi</span>
    ;;


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-518" id="section-518">&#182;</a>
</div>
<p>libtool clean and uninstall mode</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  clean | uninstall<span class="o">)</span>
    <span class="nv">modename</span><span class="o">=</span><span class="s2">&quot;$modename: $mode&quot;</span>
    <span class="nv">rm</span><span class="o">=</span><span class="s2">&quot;$nonopt&quot;</span>
    <span class="nv">files</span><span class="o">=</span>
    <span class="nv">rmforce</span><span class="o">=</span>
    <span class="nv">exit_status</span><span class="o">=</span>0


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-519" id="section-519">&#182;</a>
</div>
<p>This variable tells wrapper scripts just to set variables rather
than running their programs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">libtool_install_magic</span><span class="o">=</span><span class="s2">&quot;$magic&quot;</span>

    <span class="k">for </span>arg
    <span class="k">do</span>
<span class="k">      case</span> <span class="nv">$arg</span> in
      -f<span class="o">)</span> <span class="nv">rm</span><span class="o">=</span><span class="s2">&quot;$rm $arg&quot;</span>; <span class="nv">rmforce</span><span class="o">=</span>yes ;;
      -*<span class="o">)</span> <span class="nv">rm</span><span class="o">=</span><span class="s2">&quot;$rm $arg&quot;</span> ;;
      *<span class="o">)</span> <span class="nv">files</span><span class="o">=</span><span class="s2">&quot;$files $arg&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">    done</span>

<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$rm&quot;</span>; <span class="k">then</span>
      <span class="nv">$echo</span> <span class="s2">&quot;$modename: you must specify an RM program&quot;</span> 1&gt;&amp;2
      <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
      <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">rmdirs</span><span class="o">=</span>

    <span class="nv">origobjdir</span><span class="o">=</span><span class="s2">&quot;$objdir&quot;</span>
    <span class="k">for </span>file in <span class="nv">$files</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">dir</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%/[^/]*$%%&#39;</span><span class="sb">`</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;X$dir&quot;</span> <span class="o">=</span> <span class="s2">&quot;X$file&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">dir</span><span class="o">=</span>.
  <span class="nv">objdir</span><span class="o">=</span><span class="s2">&quot;$origobjdir&quot;</span>
      <span class="k">else</span>
<span class="k">  </span><span class="nv">objdir</span><span class="o">=</span><span class="s2">&quot;$dir/$origobjdir&quot;</span>
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">name</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="s2">&quot;X$file&quot;</span> | <span class="nv">$Xsed</span> -e <span class="s1">&#39;s%^.*/%%&#39;</span><span class="sb">`</span>
      <span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> uninstall <span class="o">&amp;&amp;</span> <span class="nv">objdir</span><span class="o">=</span><span class="s2">&quot;$dir&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-520" id="section-520">&#182;</a>
</div>
<p>Remember objdir for removal later, being careful to avoid duplicates</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> clean; <span class="k">then</span>
<span class="k">  case</span> <span class="s2">&quot; $rmdirs &quot;</span> in
    *<span class="s2">&quot; $objdir &quot;</span>*<span class="o">)</span> ;;
    *<span class="o">)</span> <span class="nv">rmdirs</span><span class="o">=</span><span class="s2">&quot;$rmdirs $objdir&quot;</span> ;;
  <span class="k">esac</span>
<span class="k">      fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-521" id="section-521">&#182;</a>
</div>
<p>Don't error if the file doesn't exist and rm -f was used.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="k">if</span> <span class="o">(</span><span class="nb">test</span> -L <span class="s2">&quot;$file&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1 <span class="se">\</span>
  <span class="o">||</span> <span class="o">(</span><span class="nb">test</span> -h <span class="s2">&quot;$file&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1 <span class="se">\</span>
  <span class="o">||</span> <span class="nb">test</span> -f <span class="s2">&quot;$file&quot;</span>; <span class="k">then</span>
  :
      <span class="k">elif </span><span class="nb">test</span> -d <span class="s2">&quot;$file&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nv">exit_status</span><span class="o">=</span>1
  <span class="k">continue</span>
<span class="k">      elif </span><span class="nb">test</span> <span class="s2">&quot;$rmforce&quot;</span> <span class="o">=</span> yes; <span class="k">then</span>
<span class="k">  continue</span>
<span class="k">      fi</span>

<span class="k">      </span><span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$file&quot;</span>

      <span class="k">case</span> <span class="nv">$name</span> in
      *.la<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-522" id="section-522">&#182;</a>
</div>
<p>Possibly a libtool archive, so verify it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$file</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
    . <span class="nv">$dir</span>/<span class="nv">$name</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-523" id="section-523">&#182;</a>
</div>
<p>Delete the libtool libraries and symlinks.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for </span>n in <span class="nv">$library_names</span>; <span class="k">do</span>
<span class="k">      </span><span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $objdir/$n&quot;</span>
    <span class="k">done</span>
<span class="k">    </span><span class="nb">test</span> -n <span class="s2">&quot;$old_library&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $objdir/$old_library&quot;</span>

    <span class="k">case</span> <span class="s2">&quot;$mode&quot;</span> in
    clean<span class="o">)</span>
      <span class="k">case</span> <span class="s2">&quot;  $library_names &quot;</span> in

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-524" id="section-524">&#182;</a>
</div>
<p>"  " in the beginning catches empty $dlname</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      *<span class="s2">&quot; $dlname &quot;</span>*<span class="o">)</span> ;;
      *<span class="o">)</span> <span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $objdir/$dlname&quot;</span> ;;
      <span class="k">esac</span>
<span class="k">       </span><span class="nb">test</span> -n <span class="s2">&quot;$libdir&quot;</span> <span class="o">&amp;&amp;</span> <span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $objdir/$name $objdir/${name}i&quot;</span>
      ;;
    uninstall<span class="o">)</span>
      <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$library_names&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-525" id="section-525">&#182;</a>
</div>
<p>Do each command in the postuninstall commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">cmds</span><span class="o">=</span><span class="nv">$postuninstall_cmds</span>
        <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
        <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
    <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$?&quot;</span> -ne 0 <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$rmforce&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>
<span class="k">      </span><span class="nv">exit_status</span><span class="o">=</span>1
    <span class="k">fi</span>
<span class="k">        done</span>
<span class="k">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="k">fi</span>

<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$old_library&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-526" id="section-526">&#182;</a>
</div>
<p>Do each command in the old_postuninstall commands.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nv">cmds</span><span class="o">=</span><span class="nv">$old_postuninstall_cmds</span>
        <span class="nv">save_ifs</span><span class="o">=</span><span class="s2">&quot;$IFS&quot;</span>; <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;~&#39;</span>
        <span class="k">for </span>cmd in <span class="nv">$cmds</span>; <span class="k">do</span>
<span class="k">    </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
    <span class="nb">eval </span><span class="nv">cmd</span><span class="o">=</span><span class="se">\&quot;</span><span class="nv">$cmd</span><span class="se">\&quot;</span>
    <span class="nv">$show</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="nv">$run</span> <span class="nb">eval</span> <span class="s2">&quot;$cmd&quot;</span>
    <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$?&quot;</span> -ne 0 <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$rmforce&quot;</span> !<span class="o">=</span> yes; <span class="k">then</span>
<span class="k">      </span><span class="nv">exit_status</span><span class="o">=</span>1
    <span class="k">fi</span>
<span class="k">        done</span>
<span class="k">        </span><span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;$save_ifs&quot;</span>
      <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-527" id="section-527">&#182;</a>
</div>
<p>FIXME: should reinstall the best remaining shared library.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      ;;
    <span class="k">esac</span>
<span class="k">  fi</span>
  ;;

      *.lo<span class="o">)</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-528" id="section-528">&#182;</a>
</div>
<p>Possibly a libtool object, so verify it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;2q&#39;</span> <span class="nv">$file</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-529" id="section-529">&#182;</a>
</div>
<p>Read the .lo file</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    . <span class="nv">$dir</span>/<span class="nv">$name</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-530" id="section-530">&#182;</a>
</div>
<p>Add PIC object to the list of files to remove.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$pic_object&quot;</span> <span class="se">\</span>
       <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$pic_object&quot;</span> !<span class="o">=</span> none; <span class="k">then</span>
<span class="k">      </span><span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $dir/$pic_object&quot;</span>
    <span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-531" id="section-531">&#182;</a>
</div>
<p>Add non-PIC object to the list of files to remove.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$non_pic_object&quot;</span> <span class="se">\</span>
       <span class="o">&amp;&amp;</span> <span class="nb">test</span> <span class="s2">&quot;$non_pic_object&quot;</span> !<span class="o">=</span> none; <span class="k">then</span>
<span class="k">      </span><span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $dir/$non_pic_object&quot;</span>
    <span class="k">fi</span>
<span class="k">  fi</span>
  ;;

      *<span class="o">)</span>
  <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$mode&quot;</span> <span class="o">=</span> clean ; <span class="k">then</span>
<span class="k">    </span><span class="nv">noexename</span><span class="o">=</span><span class="nv">$name</span>
    <span class="k">case</span> <span class="nv">$file</span> in
    *.exe<span class="o">)</span>
      <span class="nv">file</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$file</span>|<span class="k">${</span><span class="nv">SED</span><span class="k">}</span> <span class="s1">&#39;s,.exe$,,&#39;</span><span class="sb">`</span>
      <span class="nv">noexename</span><span class="o">=</span><span class="sb">`</span><span class="nv">$echo</span> <span class="nv">$name</span>|<span class="k">${</span><span class="nv">SED</span><span class="k">}</span> <span class="s1">&#39;s,.exe$,,&#39;</span><span class="sb">`</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-532" id="section-532">&#182;</a>
</div>
<p>$file with .exe has already been added to rmfiles,
add $file without .exe</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $file&quot;</span>
      ;;
    <span class="k">esac</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-533" id="section-533">&#182;</a>
</div>
<p>Do a test to see if this is a libtool program.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="o">(</span><span class="k">${</span><span class="nv">SED</span><span class="k">}</span> -e <span class="s1">&#39;4q&#39;</span> <span class="nv">$file</span> | grep <span class="s2">&quot;^# Generated by .*$PACKAGE&quot;</span><span class="o">)</span> &gt;/dev/null 2&gt;&amp;1; <span class="k">then</span>
<span class="k">      </span><span class="nv">relink_command</span><span class="o">=</span>
      . <span class="nv">$dir</span>/<span class="nv">$noexename</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-534" id="section-534">&#182;</a>
</div>
<p>note $name still contains .exe if it was in $file originally
as does the version of $file that was added into $rmfiles</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $objdir/$name $objdir/${name}S.${objext}&quot;</span>
      <span class="k">if </span><span class="nb">test</span> <span class="s2">&quot;$fast_install&quot;</span> <span class="o">=</span> yes <span class="o">&amp;&amp;</span> <span class="nb">test</span> -n <span class="s2">&quot;$relink_command&quot;</span>; <span class="k">then</span>
<span class="k">        </span><span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $objdir/lt-$name&quot;</span>
      <span class="k">fi</span>
<span class="k">      if </span><span class="nb">test</span> <span class="s2">&quot;X$noexename&quot;</span> !<span class="o">=</span> <span class="s2">&quot;X$name&quot;</span> ; <span class="k">then</span>
<span class="k">        </span><span class="nv">rmfiles</span><span class="o">=</span><span class="s2">&quot;$rmfiles $objdir/lt-${noexename}.c&quot;</span>
      <span class="k">fi</span>
<span class="k">    fi</span>
<span class="k">  fi</span>
  ;;
      <span class="k">esac</span>
      <span class="nv">$show</span> <span class="s2">&quot;$rm $rmfiles&quot;</span>
      <span class="nv">$run</span> <span class="nv">$rm</span> <span class="nv">$rmfiles</span> <span class="o">||</span> <span class="nv">exit_status</span><span class="o">=</span>1
    <span class="k">done</span>
<span class="k">    </span><span class="nv">objdir</span><span class="o">=</span><span class="s2">&quot;$origobjdir&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-535" id="section-535">&#182;</a>
</div>
<p>Try to remove the ${objdir}s in the directories where we deleted files</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">for </span>dir in <span class="nv">$rmdirs</span>; <span class="k">do</span>
<span class="k">      if </span><span class="nb">test</span> -d <span class="s2">&quot;$dir&quot;</span>; <span class="k">then</span>
  <span class="nv">$show</span> <span class="s2">&quot;rmdir $dir&quot;</span>
  <span class="nv">$run</span> rmdir <span class="nv">$dir</span> &gt;/dev/null 2&gt;&amp;1
      <span class="k">fi</span>
<span class="k">    done</span>

<span class="k">    </span><span class="nb">exit</span> <span class="nv">$exit_status</span>
    ;;

  <span class="s2">&quot;&quot;</span><span class="o">)</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: you must specify a MODE&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$generic_help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
    ;;
  <span class="k">esac</span>

<span class="k">  if </span><span class="nb">test</span> -z <span class="s2">&quot;$exec_cmd&quot;</span>; <span class="k">then</span>
    <span class="nv">$echo</span> <span class="s2">&quot;$modename: invalid operation mode \`$mode&#39;&quot;</span> 1&gt;&amp;2
    <span class="nv">$echo</span> <span class="s2">&quot;$generic_help&quot;</span> 1&gt;&amp;2
    <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  <span class="k">fi</span>
<span class="k">fi</span> <span class="c"># test -z &quot;$show_help&quot;</span>

<span class="k">if </span><span class="nb">test</span> -n <span class="s2">&quot;$exec_cmd&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">eval exec</span> <span class="nv">$exec_cmd</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
<span class="k">fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-536" id="section-536">&#182;</a>
</div>
<p>We need to display help for each of the modes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="k">case</span> <span class="nv">$mode</span> in
<span class="s2">&quot;&quot;</span><span class="o">)</span> <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... [MODE-ARG]...</span>

<span class="s2">Provide generalized library-building support services.</span>

<span class="s2">    --config          show all configuration variables</span>
<span class="s2">    --debug           enable verbose shell tracing</span>
<span class="s2">-n, --dry-run         display commands without modifying any files</span>
<span class="s2">    --features        display basic configuration information and exit</span>
<span class="s2">    --finish          same as \`--mode=finish&#39;</span>
<span class="s2">    --help            display this help message and exit</span>
<span class="s2">    --mode=MODE       use operation mode MODE [default=inferred from MODE-ARGS]</span>
<span class="s2">    --quiet           same as \`--silent&#39;</span>
<span class="s2">    --silent          don&#39;t print informational messages</span>
<span class="s2">    --tag=TAG         use configuration variables from tag TAG</span>
<span class="s2">    --version         print version information</span>

<span class="s2">MODE must be one of the following:</span>

<span class="s2">      clean           remove files from the build directory</span>
<span class="s2">      compile         compile a source file into a libtool object</span>
<span class="s2">      execute         automatically set library path, then run a program</span>
<span class="s2">      finish          complete the installation of libtool libraries</span>
<span class="s2">      install         install libraries or executables</span>
<span class="s2">      link            create a library or an executable</span>
<span class="s2">      uninstall       remove libraries from an installed directory</span>

<span class="s2">MODE-ARGS vary depending on the MODE.  Try \`$modename --help --mode=MODE&#39; for</span>
<span class="s2">a more detailed description of MODE.</span>

<span class="s2">Report bugs to &lt;bug-libtool@gnu.org&gt;.&quot;</span>
  <span class="nb">exit</span> <span class="nv">$EXIT_SUCCESS</span>
  ;;

clean<span class="o">)</span>
  <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... --mode=clean RM [RM-OPTION]... FILE...</span>

<span class="s2">Remove files from the build directory.</span>

<span class="s2">RM is the name of the program to use to delete files associated with each FILE</span>
<span class="s2">(typically \`/bin/rm&#39;).  RM-OPTIONS are options (such as \`-f&#39;) to be passed</span>
<span class="s2">to RM.</span>

<span class="s2">If FILE is a libtool library, object or program, all the files associated</span>
<span class="s2">with it are deleted. Otherwise, only FILE itself is deleted using RM.&quot;</span>
  ;;

compile<span class="o">)</span>
  <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... --mode=compile COMPILE-COMMAND... SOURCEFILE</span>

<span class="s2">Compile a source file into a libtool library object.</span>

<span class="s2">This mode accepts the following additional options:</span>

<span class="s2">  -o OUTPUT-FILE    set the output file name to OUTPUT-FILE</span>
<span class="s2">  -prefer-pic       try to building PIC objects only</span>
<span class="s2">  -prefer-non-pic   try to building non-PIC objects only</span>
<span class="s2">  -static           always build a \`.o&#39; file suitable for static linking</span>

<span class="s2">COMPILE-COMMAND is a command to be used in creating a \`standard&#39; object file</span>
<span class="s2">from the given SOURCEFILE.</span>

<span class="s2">The output file name is determined by removing the directory component from</span>
<span class="s2">SOURCEFILE, then substituting the C source code suffix \`.c&#39; with the</span>
<span class="s2">library object suffix, \`.lo&#39;.&quot;</span>
  ;;

execute<span class="o">)</span>
  <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... --mode=execute COMMAND [ARGS]...</span>

<span class="s2">Automatically set library path, then run a program.</span>

<span class="s2">This mode accepts the following additional options:</span>

<span class="s2">  -dlopen FILE      add the directory containing FILE to the library path</span>

<span class="s2">This mode sets the library path environment variable according to \`-dlopen&#39;</span>
<span class="s2">flags.</span>

<span class="s2">If any of the ARGS are libtool executable wrappers, then they are translated</span>
<span class="s2">into their corresponding uninstalled binary, and any of their required library</span>
<span class="s2">directories are added to the library path.</span>

<span class="s2">Then, COMMAND is executed, with ARGS as arguments.&quot;</span>
  ;;

finish<span class="o">)</span>
  <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... --mode=finish [LIBDIR]...</span>

<span class="s2">Complete the installation of libtool libraries.</span>

<span class="s2">Each LIBDIR is a directory that contains libtool libraries.</span>

<span class="s2">The commands that this mode executes may require superuser privileges.  Use</span>
<span class="s2">the \`--dry-run&#39; option if you just want to see what would be executed.&quot;</span>
  ;;

install<span class="o">)</span>
  <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... --mode=install INSTALL-COMMAND...</span>

<span class="s2">Install executables or libraries.</span>

<span class="s2">INSTALL-COMMAND is the installation command.  The first component should be</span>
<span class="s2">either the \`install&#39; or \`cp&#39; program.</span>

<span class="s2">The rest of the components are interpreted as arguments to that command (only</span>
<span class="s2">BSD-compatible install options are recognized).&quot;</span>
  ;;

link<span class="o">)</span>
  <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... --mode=link LINK-COMMAND...</span>

<span class="s2">Link object files or libraries together to form another library, or to</span>
<span class="s2">create an executable program.</span>

<span class="s2">LINK-COMMAND is a command using the C compiler that you would use to create</span>
<span class="s2">a program from several object files.</span>

<span class="s2">The following components of LINK-COMMAND are treated specially:</span>

<span class="s2">  -all-static       do not do any dynamic linking at all</span>
<span class="s2">  -avoid-version    do not add a version suffix if possible</span>
<span class="s2">  -dlopen FILE      \`-dlpreopen&#39; FILE if it cannot be dlopened at runtime</span>
<span class="s2">  -dlpreopen FILE   link in FILE and add its symbols to lt_preloaded_symbols</span>
<span class="s2">  -export-dynamic   allow symbols from OUTPUT-FILE to be resolved with dlsym(3)</span>
<span class="s2">  -export-symbols SYMFILE</span>
<span class="s2">                    try to export only the symbols listed in SYMFILE</span>
<span class="s2">  -export-symbols-regex REGEX</span>
<span class="s2">                    try to export only the symbols matching REGEX</span>
<span class="s2">  -LLIBDIR          search LIBDIR for required installed libraries</span>
<span class="s2">  -lNAME            OUTPUT-FILE requires the installed library libNAME</span>
<span class="s2">  -module           build a library that can dlopened</span>
<span class="s2">  -no-fast-install  disable the fast-install mode</span>
<span class="s2">  -no-install       link a not-installable executable</span>
<span class="s2">  -no-undefined     declare that a library does not refer to external symbols</span>
<span class="s2">  -o OUTPUT-FILE    create OUTPUT-FILE from the specified objects</span>
<span class="s2">  -objectlist FILE  Use a list of object files found in FILE to specify objects</span>
<span class="s2">  -precious-files-regex REGEX</span>
<span class="s2">                    don&#39;t remove output files matching REGEX</span>
<span class="s2">  -release RELEASE  specify package release information</span>
<span class="s2">  -rpath LIBDIR     the created library will eventually be installed in LIBDIR</span>
<span class="s2">  -R[ ]LIBDIR       add LIBDIR to the runtime path of programs and libraries</span>
<span class="s2">  -static           do not do any dynamic linking of uninstalled libtool libraries</span>
<span class="s2">  -static-libtool-libs</span>
<span class="s2">                    do not do any dynamic linking of libtool libraries</span>
<span class="s2">  -version-info CURRENT[:REVISION[:AGE]]</span>
<span class="s2">                    specify library version info [each variable defaults to 0]</span>

<span class="s2">All other options (arguments beginning with \`-&#39;) are ignored.</span>

<span class="s2">Every other argument is treated as a filename.  Files ending in \`.la&#39; are</span>
<span class="s2">treated as uninstalled libtool libraries, other files are standard or library</span>
<span class="s2">object files.</span>

<span class="s2">If the OUTPUT-FILE ends in \`.la&#39;, then a libtool library is created,</span>
<span class="s2">only library objects (\`.lo&#39; files) may be specified, and \`-rpath&#39; is</span>
<span class="s2">required, except when creating a convenience library.</span>

<span class="s2">If OUTPUT-FILE ends in \`.a&#39; or \`.lib&#39;, then a standard library is created</span>
<span class="s2">using \`ar&#39; and \`ranlib&#39;, or on Windows using \`lib&#39;.</span>

<span class="s2">If OUTPUT-FILE ends in \`.lo&#39; or \`.${objext}&#39;, then a reloadable object file</span>
<span class="s2">is created, otherwise an executable program is created.&quot;</span>
  ;;

uninstall<span class="o">)</span>
  <span class="nv">$echo</span> <span class="se">\</span>
<span class="s2">&quot;Usage: $modename [OPTION]... --mode=uninstall RM [RM-OPTION]... FILE...</span>

<span class="s2">Remove libraries from an installation directory.</span>

<span class="s2">RM is the name of the program to use to delete files associated with each FILE</span>
<span class="s2">(typically \`/bin/rm&#39;).  RM-OPTIONS are options (such as \`-f&#39;) to be passed</span>
<span class="s2">to RM.</span>

<span class="s2">If FILE is a libtool library, all the files associated with it are deleted.</span>
<span class="s2">Otherwise, only FILE itself is deleted using RM.&quot;</span>
  ;;

*<span class="o">)</span>
  <span class="nv">$echo</span> <span class="s2">&quot;$modename: invalid operation mode \`$mode&#39;&quot;</span> 1&gt;&amp;2
  <span class="nv">$echo</span> <span class="s2">&quot;$help&quot;</span> 1&gt;&amp;2
  <span class="nb">exit</span> <span class="nv">$EXIT_FAILURE</span>
  ;;
<span class="k">esac</span>

<span class="nv">$echo</span>
<span class="nv">$echo</span> <span class="s2">&quot;Try \`$modename --help&#39; for more information about other modes.&quot;</span>

<span class="nb">exit</span> <span class="nv">$?</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-537" id="section-537">&#182;</a>
</div>
<p>The TAGs below are defined such that we never get into a situation
in which we disable both kinds of libraries.  Given conflicting
choices, we go for a static library, that is the most portable,
since we can't tell whether shared libraries were disabled because
the user asked for that or because the platform doesn't support
them.  This is particularly important on AIX, because we don't
support having both static and shared libraries enabled at the same
time on that platform, so we default to a shared-only configuration.
If a disable-shared tag is given, we'll fallback to a static-only
configuration.  But we'll never go from static-only to shared-only.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="begin-libtool-tag-config--disable-shared">
  <h3>
    <a href="#begin-libtool-tag-config--disable-shared" class="pilcrow">&#182;</a>
    BEGIN LIBTOOL TAG CONFIG: disable-shared
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">disable_libs</span><span class="o">=</span>shared

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="end-libtool-tag-config--disable-shared">
  <h3>
    <a href="#end-libtool-tag-config--disable-shared" class="pilcrow">&#182;</a>
    END LIBTOOL TAG CONFIG: disable-shared
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="begin-libtool-tag-config--disable-static">
  <h3>
    <a href="#begin-libtool-tag-config--disable-static" class="pilcrow">&#182;</a>
    BEGIN LIBTOOL TAG CONFIG: disable-static
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">disable_libs</span><span class="o">=</span>static

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="end-libtool-tag-config--disable-static">
  <h3>
    <a href="#end-libtool-tag-config--disable-static" class="pilcrow">&#182;</a>
    END LIBTOOL TAG CONFIG: disable-static
  </h3>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-542" id="section-542">&#182;</a>
</div>
<p>Local Variables:
mode:shell-script
sh-indentation:2
End:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
