<!DOCTYPE html>
<html>
<head>
  <title>install-sh</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../../../doc-style.css" />
  <script src="../../../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../../../", thisFile = "node_modules/sqlite3/deps/sqlite3/install-sh", defaultSidebar = true;
  </script>
  <script src="../../../../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>install-sh</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="c">#!/bin/sh</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>install - install a program, script, or datafile</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nv">scriptversion</span><span class="o">=</span>2005-05-14.22


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>This originates from X11R5 (mit/util/scripts/install.sh), which was
later released in X11R6 (xc/config/util/install.sh) with the
following copyright and license.</p>

<p>Copyright (C) 1994 X Consortium</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to
deal in the Software without restriction, including without limitation the
rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
sell copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
X CONSORTIUM BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN
AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNEC-
TION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>

<p>Except as contained in this notice, the name of the X Consortium shall not
be used in advertising or otherwise to promote the sale, use or other deal-
ings in this Software without prior written authorization from the X Consor-
tium.</p>

<p>FSF changes to this file are in the public domain.</p>

<p>Calling this script install-sh is preferred over install.sh, to prevent
`make' implicit rules from creating a file called install from it
when there is no Makefile.</p>

<p>This script is compatible with the BSD install script, but was written
from scratch.  It can only install one file at a time, a restriction
shared with many OS's install programs.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>set DOITPROG to echo to test this script</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Don't use :- since 4.3BSD and earlier shells don't like it.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nv">doit</span><span class="o">=</span><span class="s2">&quot;${DOITPROG-}&quot;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>put in absolute paths if you don't have them in your path; or use env. vars.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="nv">mvprog</span><span class="o">=</span><span class="s2">&quot;${MVPROG-mv}&quot;</span>
<span class="nv">cpprog</span><span class="o">=</span><span class="s2">&quot;${CPPROG-cp}&quot;</span>
<span class="nv">chmodprog</span><span class="o">=</span><span class="s2">&quot;${CHMODPROG-chmod}&quot;</span>
<span class="nv">chownprog</span><span class="o">=</span><span class="s2">&quot;${CHOWNPROG-chown}&quot;</span>
<span class="nv">chgrpprog</span><span class="o">=</span><span class="s2">&quot;${CHGRPPROG-chgrp}&quot;</span>
<span class="nv">stripprog</span><span class="o">=</span><span class="s2">&quot;${STRIPPROG-strip}&quot;</span>
<span class="nv">rmprog</span><span class="o">=</span><span class="s2">&quot;${RMPROG-rm}&quot;</span>
<span class="nv">mkdirprog</span><span class="o">=</span><span class="s2">&quot;${MKDIRPROG-mkdir}&quot;</span>

<span class="nv">chmodcmd</span><span class="o">=</span><span class="s2">&quot;$chmodprog 0755&quot;</span>
<span class="nv">chowncmd</span><span class="o">=</span>
<span class="nv">chgrpcmd</span><span class="o">=</span>
<span class="nv">stripcmd</span><span class="o">=</span>
<span class="nv">rmcmd</span><span class="o">=</span><span class="s2">&quot;$rmprog -f&quot;</span>
<span class="nv">mvcmd</span><span class="o">=</span><span class="s2">&quot;$mvprog&quot;</span>
<span class="nv">src</span><span class="o">=</span>
<span class="nv">dst</span><span class="o">=</span>
<span class="nv">dir_arg</span><span class="o">=</span>
<span class="nv">dstarg</span><span class="o">=</span>
<span class="nv">no_target_directory</span><span class="o">=</span>

<span class="nv">usage</span><span class="o">=</span><span class="s2">&quot;Usage: $0 [OPTION]... [-T] SRCFILE DSTFILE</span>
<span class="s2">   or: $0 [OPTION]... SRCFILES... DIRECTORY</span>
<span class="s2">   or: $0 [OPTION]... -t DIRECTORY SRCFILES...</span>
<span class="s2">   or: $0 [OPTION]... -d DIRECTORIES...</span>

<span class="s2">In the 1st form, copy SRCFILE to DSTFILE.</span>
<span class="s2">In the 2nd and 3rd, copy all SRCFILES to DIRECTORY.</span>
<span class="s2">In the 4th, create DIRECTORIES.</span>

<span class="s2">Options:</span>
<span class="s2">-c         (ignored)</span>
<span class="s2">-d         create directories instead of installing files.</span>
<span class="s2">-g GROUP   $chgrpprog installed files to GROUP.</span>
<span class="s2">-m MODE    $chmodprog installed files to MODE.</span>
<span class="s2">-o USER    $chownprog installed files to USER.</span>
<span class="s2">-s         $stripprog installed files.</span>
<span class="s2">-t DIRECTORY  install into DIRECTORY.</span>
<span class="s2">-T         report an error if DSTFILE is a directory.</span>
<span class="s2">--help     display this help and exit.</span>
<span class="s2">--version  display version info and exit.</span>

<span class="s2">Environment variables override the default commands:</span>
<span class="s2">  CHGRPPROG CHMODPROG CHOWNPROG CPPROG MKDIRPROG MVPROG RMPROG STRIPPROG</span>
<span class="s2">&quot;</span>

<span class="k">while </span><span class="nb">test</span> -n <span class="s2">&quot;$1&quot;</span>; <span class="k">do</span>
<span class="k">  case</span> <span class="nv">$1</span> in
    -c<span class="o">)</span> <span class="nb">shift</span>
<span class="nb">        </span><span class="k">continue</span>;;

    -d<span class="o">)</span> <span class="nv">dir_arg</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">        shift</span>
<span class="nb">        </span><span class="k">continue</span>;;

    -g<span class="o">)</span> <span class="nv">chgrpcmd</span><span class="o">=</span><span class="s2">&quot;$chgrpprog $2&quot;</span>
        <span class="nb">shift</span>
<span class="nb">        shift</span>
<span class="nb">        </span><span class="k">continue</span>;;

    --help<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;$usage&quot;</span>; <span class="nb">exit</span> <span class="nv">$?</span>;;

    -m<span class="o">)</span> <span class="nv">chmodcmd</span><span class="o">=</span><span class="s2">&quot;$chmodprog $2&quot;</span>
        <span class="nb">shift</span>
<span class="nb">        shift</span>
<span class="nb">        </span><span class="k">continue</span>;;

    -o<span class="o">)</span> <span class="nv">chowncmd</span><span class="o">=</span><span class="s2">&quot;$chownprog $2&quot;</span>
        <span class="nb">shift</span>
<span class="nb">        shift</span>
<span class="nb">        </span><span class="k">continue</span>;;

    -s<span class="o">)</span> <span class="nv">stripcmd</span><span class="o">=</span><span class="nv">$stripprog</span>
        <span class="nb">shift</span>
<span class="nb">        </span><span class="k">continue</span>;;

    -t<span class="o">)</span> <span class="nv">dstarg</span><span class="o">=</span><span class="nv">$2</span>
  <span class="nb">shift</span>
<span class="nb">  shift</span>
<span class="nb">  </span><span class="k">continue</span>;;

    -T<span class="o">)</span> <span class="nv">no_target_directory</span><span class="o">=</span><span class="nb">true</span>
<span class="nb">  shift</span>
<span class="nb">  </span><span class="k">continue</span>;;

    --version<span class="o">)</span> <span class="nb">echo</span> <span class="s2">&quot;$0 $scriptversion&quot;</span>; <span class="nb">exit</span> <span class="nv">$?</span>;;

    *<span class="o">)</span>  <span class="c"># When -d is used, all remaining arguments are directories to create.</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>When -t is used, the destination is already specified.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">test</span> -n <span class="s2">&quot;$dir_arg$dstarg&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">break</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>Otherwise, the last argument is the destination.  Remove it from $@.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">for </span>arg
  <span class="k">do</span>
<span class="k">          if </span><span class="nb">test</span> -n <span class="s2">&quot;$dstarg&quot;</span>; <span class="k">then</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>$@ is not empty: it contains at least $arg.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
      <span class="nb">set </span>fnord <span class="s2">&quot;$@&quot;</span> <span class="s2">&quot;$dstarg&quot;</span>
      <span class="nb">shift</span> <span class="c"># fnord</span>
    <span class="k">fi</span>
<span class="k">    </span><span class="nb">shift</span> <span class="c"># arg</span>
    <span class="nv">dstarg</span><span class="o">=</span><span class="nv">$arg</span>
  <span class="k">done</span>
<span class="k">  </span><span class="nb">break</span>;;
  <span class="k">esac</span>
<span class="k">done</span>

<span class="k">if </span><span class="nb">test</span> -z <span class="s2">&quot;$1&quot;</span>; <span class="k">then</span>
<span class="k">  if </span><span class="nb">test</span> -z <span class="s2">&quot;$dir_arg&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nb">echo</span> <span class="s2">&quot;$0: no input file specified.&quot;</span> &gt;&amp;2
    <span class="nb">exit </span>1
  <span class="k">fi</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>It's OK to call `install-sh -d' without argument.
This can happen when creating conditional directories.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">exit </span>0
<span class="k">fi</span>

<span class="k">for </span>src
<span class="k">do</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>Protect names starting with `-'.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">case</span> <span class="nv">$src</span> in
    -*<span class="o">)</span> <span class="nv">src</span><span class="o">=</span>./<span class="nv">$src</span> ;;
  <span class="k">esac</span>

<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$dir_arg&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">dst</span><span class="o">=</span><span class="nv">$src</span>
    <span class="nv">src</span><span class="o">=</span>

    <span class="k">if </span><span class="nb">test</span> -d <span class="s2">&quot;$dst&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nv">mkdircmd</span><span class="o">=</span>:
      <span class="nv">chmodcmd</span><span class="o">=</span>
    <span class="k">else</span>
<span class="k">      </span><span class="nv">mkdircmd</span><span class="o">=</span><span class="nv">$mkdirprog</span>
    <span class="k">fi</span>
<span class="k">  else</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Waiting for this to be detected by the "$cpprog $src $dsttmp" command
might cause directories to be created, which would be especially bad
if $src (and thus $dsttmp) contains '*'.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> ! -f <span class="s2">&quot;$src&quot;</span> <span class="o">&amp;&amp;</span> <span class="nb">test</span> ! -d <span class="s2">&quot;$src&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nb">echo</span> <span class="s2">&quot;$0: $src does not exist.&quot;</span> &gt;&amp;2
      <span class="nb">exit </span>1
    <span class="k">fi</span>

<span class="k">    if </span><span class="nb">test</span> -z <span class="s2">&quot;$dstarg&quot;</span>; <span class="k">then</span>
<span class="k">      </span><span class="nb">echo</span> <span class="s2">&quot;$0: no destination specified.&quot;</span> &gt;&amp;2
      <span class="nb">exit </span>1
    <span class="k">fi</span>

<span class="k">    </span><span class="nv">dst</span><span class="o">=</span><span class="nv">$dstarg</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Protect names starting with `-'.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">case</span> <span class="nv">$dst</span> in
      -*<span class="o">)</span> <span class="nv">dst</span><span class="o">=</span>./<span class="nv">$dst</span> ;;
    <span class="k">esac</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>If destination is a directory, append the input filename; won't work
if double slashes aren't ignored.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if </span><span class="nb">test</span> -d <span class="s2">&quot;$dst&quot;</span>; <span class="k">then</span>
<span class="k">      if </span><span class="nb">test</span> -n <span class="s2">&quot;$no_target_directory&quot;</span>; <span class="k">then</span>
<span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;$0: $dstarg: Is a directory&quot;</span> &gt;&amp;2
  <span class="nb">exit </span>1
      <span class="k">fi</span>
<span class="k">      </span><span class="nv">dst</span><span class="o">=</span><span class="nv">$dst</span>/<span class="sb">`</span>basename <span class="s2">&quot;$src&quot;</span><span class="sb">`</span>
    <span class="k">fi</span>
<span class="k">  fi</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>This sed command emulates the dirname command.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nv">dstdir</span><span class="o">=</span><span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;$dst&quot;</span> | sed -e <span class="s1">&#39;s,/*$,,;s,[^/]*$,,;s,/*$,,;s,^$,.,&#39;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Make sure that the destination directory exists.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Skip lots of stat calls in the usual case.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if </span><span class="nb">test</span> ! -d <span class="s2">&quot;$dstdir&quot;</span>; <span class="k">then</span>
<span class="k">    </span><span class="nv">defaultIFS</span><span class="o">=</span><span class="s1">&#39;</span>
<span class="s1">   &#39;</span>
    <span class="nv">IFS</span><span class="o">=</span><span class="s2">&quot;${IFS-$defaultIFS}&quot;</span>

    <span class="nv">oIFS</span><span class="o">=</span><span class="nv">$IFS</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>Some sh's can't handle IFS=/ for some reason.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">IFS</span><span class="o">=</span><span class="s1">&#39;%&#39;</span>
    <span class="nb">set </span>x <span class="sb">`</span><span class="nb">echo</span> <span class="s2">&quot;$dstdir&quot;</span> | sed -e <span class="s1">&#39;s@/@%@g&#39;</span> -e <span class="s1">&#39;s@^%@/@&#39;</span><span class="sb">`</span>
    <span class="nb">shift</span>
<span class="nb">    </span><span class="nv">IFS</span><span class="o">=</span><span class="nv">$oIFS</span>

    <span class="nv">pathcomp</span><span class="o">=</span>

    <span class="k">while </span><span class="nb">test</span> <span class="nv">$# </span>-ne 0 ; <span class="k">do</span>
<span class="k">      </span><span class="nv">pathcomp</span><span class="o">=</span><span class="nv">$pathcomp$1</span>
      <span class="nb">shift</span>
<span class="nb">      </span><span class="k">if </span><span class="nb">test</span> ! -d <span class="s2">&quot;$pathcomp&quot;</span>; <span class="k">then</span>
        <span class="nv">$mkdirprog</span> <span class="s2">&quot;$pathcomp&quot;</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>mkdir can fail with a `File exist' error in case several
install-sh are creating the directory concurrently.  This
is OK.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nb">test</span> -d <span class="s2">&quot;$pathcomp&quot;</span> <span class="o">||</span> <span class="nb">exit</span>
<span class="nb">      </span><span class="k">fi</span>
<span class="k">      </span><span class="nv">pathcomp</span><span class="o">=</span><span class="nv">$pathcomp</span>/
    <span class="k">done</span>
<span class="k">  fi</span>

<span class="k">  if </span><span class="nb">test</span> -n <span class="s2">&quot;$dir_arg&quot;</span>; <span class="k">then</span>
    <span class="nv">$doit</span> <span class="nv">$mkdircmd</span> <span class="s2">&quot;$dst&quot;</span> <span class="se">\</span>
      <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$chowncmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$chowncmd</span> <span class="s2">&quot;$dst&quot;</span>; <span class="o">}</span> <span class="se">\</span>
      <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$chgrpcmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$chgrpcmd</span> <span class="s2">&quot;$dst&quot;</span>; <span class="o">}</span> <span class="se">\</span>
      <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$stripcmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$stripcmd</span> <span class="s2">&quot;$dst&quot;</span>; <span class="o">}</span> <span class="se">\</span>
      <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$chmodcmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$chmodcmd</span> <span class="s2">&quot;$dst&quot;</span>; <span class="o">}</span>

  <span class="k">else</span>
<span class="k">    </span><span class="nv">dstfile</span><span class="o">=</span><span class="sb">`</span>basename <span class="s2">&quot;$dst&quot;</span><span class="sb">`</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>Make a couple of temp file names in the proper directory.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">dsttmp</span><span class="o">=</span><span class="nv">$dstdir</span>/_inst.<span class="nv">$$</span>_
    <span class="nv">rmtmp</span><span class="o">=</span><span class="nv">$dstdir</span>/_rm.<span class="nv">$$</span>_


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Trap to clean up those temp files at exit.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nb">trap</span> <span class="s1">&#39;ret=$?; rm -f &quot;$dsttmp&quot; &quot;$rmtmp&quot; &amp;&amp; exit $ret&#39;</span> 0
    <span class="nb">trap</span> <span class="s1">&#39;(exit $?); exit&#39;</span> 1 2 13 15


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Copy the file name to the temp name.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nv">$doit</span> <span class="nv">$cpprog</span> <span class="s2">&quot;$src&quot;</span> <span class="s2">&quot;$dsttmp&quot;</span> <span class="o">&amp;&amp;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>and set any options; do chmod last to preserve setuid bits.</p>

<p>If any of these fail, we abort the whole thing.  If we want to
ignore errors from any of these, just make sure not to ignore
errors from the above "$doit $cpprog $src $dsttmp" command.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$chowncmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$chowncmd</span> <span class="s2">&quot;$dsttmp&quot;</span>; <span class="o">}</span> <span class="se">\</span>
      <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$chgrpcmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$chgrpcmd</span> <span class="s2">&quot;$dsttmp&quot;</span>; <span class="o">}</span> <span class="se">\</span>
      <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$stripcmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$stripcmd</span> <span class="s2">&quot;$dsttmp&quot;</span>; <span class="o">}</span> <span class="se">\</span>
      <span class="o">&amp;&amp;</span> <span class="o">{</span> <span class="nb">test</span> -z <span class="s2">&quot;$chmodcmd&quot;</span> <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$chmodcmd</span> <span class="s2">&quot;$dsttmp&quot;</span>; <span class="o">}</span> <span class="o">&amp;&amp;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>Now rename the file to the real destination.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="o">{</span> <span class="nv">$doit</span> <span class="nv">$mvcmd</span> -f <span class="s2">&quot;$dsttmp&quot;</span> <span class="s2">&quot;$dstdir/$dstfile&quot;</span> 2&gt;/dev/null <span class="se">\</span>
      <span class="o">||</span> <span class="o">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>The rename failed, perhaps because mv can't rename something else
to itself, or perhaps because mv is so ancient that it does not
support -f.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<p>Now remove or move aside any old file at destination location.
We try this two ways since rm can't unlink itself on some
systems and the destination file might be busy for other
reasons.  In this case, the final cleanup might fail but the new
file should still install successfully.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
     <span class="o">{</span>
       <span class="k">if </span><span class="nb">test</span> -f <span class="s2">&quot;$dstdir/$dstfile&quot;</span>; <span class="k">then</span>
         <span class="nv">$doit</span> <span class="nv">$rmcmd</span> -f <span class="s2">&quot;$dstdir/$dstfile&quot;</span> 2&gt;/dev/null <span class="se">\</span>
         <span class="o">||</span> <span class="nv">$doit</span> <span class="nv">$mvcmd</span> -f <span class="s2">&quot;$dstdir/$dstfile&quot;</span> <span class="s2">&quot;$rmtmp&quot;</span> 2&gt;/dev/null <span class="se">\</span>
         <span class="o">||</span> <span class="o">{</span>
     <span class="nb">echo</span> <span class="s2">&quot;$0: cannot unlink or rename $dstdir/$dstfile&quot;</span> &gt;&amp;2
     <span class="o">(</span><span class="nb">exit </span>1<span class="o">)</span>; <span class="nb">exit </span>1
         <span class="o">}</span>
       <span class="k">else</span>
         :
       <span class="k">fi</span>
     <span class="o">}</span> <span class="o">&amp;&amp;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<p>Now rename the file to the real destination.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
     <span class="nv">$doit</span> <span class="nv">$mvcmd</span> <span class="s2">&quot;$dsttmp&quot;</span> <span class="s2">&quot;$dstdir/$dstfile&quot;</span>
   <span class="o">}</span>
    <span class="o">}</span>
  <span class="k">fi</span> <span class="o">||</span> <span class="o">{</span> <span class="o">(</span><span class="nb">exit </span>1<span class="o">)</span>; <span class="nb">exit </span>1; <span class="o">}</span>
<span class="k">done</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<p>The final little trick to "correctly" pass the exit status to the exit trap.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="o">{</span>
  <span class="o">(</span><span class="nb">exit </span>0<span class="o">)</span>; <span class="nb">exit </span>0
<span class="o">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<p>Local variables:
eval: (add-hook 'write-file-hooks 'time-stamp)
time-stamp-start: "scriptversion="
time-stamp-format: "%:y-%02m-%02d.%02H"
time-stamp-end: "$"
End:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
