<!DOCTYPE html>
<html>
<head>
  <title>sql.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "Users/yoshiesasaki/sunapee//sql.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#users-module">Users Module</a>
      </div>
      <div class="heading h2">
        <a href="#in-memory-user-database">In Memory User Database</a>
      </div>
      <div class="heading h2">
        <a href="#functions">Functions</a>
      </div>
      <div class="heading h3">
        <a href="#function--getuserbyid">function: getUserById</a>
      </div>
      <div class="heading h3">
        <a href="#function--getfollowing">function: getFollowing</a>
      </div>
      <div class="heading h3">
        <a href="#function--getrecentt">function: getRecentT</a>
      </div>
      <div class="heading h3">
        <a href="#function--getusert">function: getUserT</a>
      </div>
      <div class="heading h3">
        <a href="#function--gettnumberbyid">function: getTNumberById</a>
      </div>
      <div class="heading h3">
        <a href="#function--getuserstats">function: getUserStats</a>
      </div>
      <div class="heading h3">
        <a href="#function--addtweet">function: addTweet</a>
      </div>
      <div class="heading h3">
        <a href="#function--addatht">function: addAtHt</a>
      </div>
      <div class="heading h3">
        <a href="#function--msgparse">function: msgParse</a>
      </div>
      <div class="heading h3">
        <a href="#function--getusernt">function: getUserNT</a>
      </div>
      <div class="heading h3">
        <a href="#function--getfollowerlist">function: getFollowerList</a>
      </div>
      <div class="heading h3">
        <a href="#function--getfollowinglist">function: getFollowingList</a>
      </div>
      <div class="heading h3">
        <a href="#function--isfollowing">function: isFollowing</a>
      </div>
      <div class="heading h3">
        <a href="#function--deletefollower">function: deleteFollower</a>
      </div>
      <div class="heading h3">
        <a href="#function--unfollow">function: unfollow</a>
      </div>
      <div class="heading h3">
        <a href="#function--follow">function: follow</a>
      </div>
      <div class="heading h3">
        <a href="#function--getuserinfo">function: getUserInfo</a>
      </div>
      <div class="heading h3">
        <a href="#function--searchtweets">function: searchTweets</a>
      </div>
      <div class="heading h3">
        <a href="#function--searchpeople">function: searchPeople</a>
      </div>
      <div class="heading h3">
        <a href="#function--gettbymention">function: getTByMention</a>
      </div>
      <div class="heading h3">
        <a href="#function--changeusersettings">function: changeUserSettings</a>
      </div>
      <div class="heading h3">
        <a href="#function--checkprofilepermission">function: checkProfilePermission</a>
      </div>
      <div class="heading h3">
        <a href="#function--changeuserprofile">function: changeUserProfile</a>
      </div>
      <div class="heading h3">
        <a href="#function--changeprofilepic">function: changeprofilepic</a>
      </div>
      <div class="heading h3">
        <a href="#function--gettweetconvobytweetid">function: getTweetConvoByTweetID</a>
      </div>
      <div class="heading h3">
        <a href="#function--gettweetbyid">function: getTweetByID</a>
      </div>
      <div class="heading h3">
        <a href="#function--deletetweet">function: deleteTweet</a>
      </div>
      <div class="heading h3">
        <a href="#function--gettrendinght">function: getTrendingHT</a>
      </div>
      <div class="heading h3">
        <a href="#function--isf">function: isF</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
<div class="pilwrap" id="users-module">
  <h1>
    <a href="#users-module" class="pilcrow">&#182;</a>
    Users Module
  </h1>
</div>


<p>This is a module for accessing user data and functions.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="in-memory-user-database">
  <h2>
    <a href="#in-memory-user-database" class="pilcrow">&#182;</a>
    In Memory User Database
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">sqlite3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;sqlite3&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">async</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;async&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">sqlite3</span><span class="p">.</span><span class="nx">Database</span><span class="p">(</span><span class="s1">&#39;./data/all.db&#39;</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="functions">
  <h2>
    <a href="#functions" class="pilcrow">&#182;</a>
    Functions
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getuserbyid">
  <h3>
    <a href="#function--getuserbyid" class="pilcrow">&#182;</a>
    <em>function</em>: getUserById
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Gets the user object by username</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {user object} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getUserById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from users where username=?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">uname</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">u</span><span class="p">){</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getfollowing">
  <h3>
    <a href="#function--getfollowing" class="pilcrow">&#182;</a>
    <em>function</em>: getFollowing
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Gets the following user association.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of following associations} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getFollowing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;select fusername from isfollowings where username=?&#39;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">fl</span><span class="p">){</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">fl</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getrecentt">
  <h3>
    <a href="#function--getrecentt" class="pilcrow">&#182;</a>
    <em>function</em>: getRecentT
  </h3>
</div>


<div class="dox">
  <div class="summary">
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of tweets} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getRecentT</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;select * from tweets t, (select f.fusername from isfollowings f where f.username = ?) fu where t.username = fu.fusername order by date desc&#39;</span>
    <span class="p">,[</span><span class="nx">uname</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tl</span><span class="p">){</span>
          <span class="nx">cb</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">tl</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">getUserT</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;select * from tweets where username=?&#39;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">tl</span><span class="p">){</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">tl</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getusert">
  <h3>
    <a href="#function--getusert" class="pilcrow">&#182;</a>
    <em>function</em>: getUserT
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Get the user's tweets</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of tweets} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getUserT</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;select * from tweets where username=? order by date desc&#39;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">tl</span><span class="p">){</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">tl</span><span class="p">);</span>
   <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--gettnumberbyid">
  <h3>
    <a href="#function--gettnumberbyid" class="pilcrow">&#182;</a>
    <em>function</em>: getTNumberById
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Get the location of the tweet in the database </p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {number} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getTNumberById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;select count(*) as n from tweets where username=?&#39;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">n</span><span class="p">){</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">n</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">]);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getuserstats">
  <h3>
    <a href="#function--getuserstats" class="pilcrow">&#182;</a>
    <em>function</em>: getUserStats
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Get the user Statistics</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {"stats" object} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getUserStats</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;select count(*) as n from tweets where username=?&#39;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tweetN</span><span class="p">){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select count(*) as n from isfollowings where username=?&quot;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">followingN</span><span class="p">){</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select count(*) as n from isfollowings where fusername=?&quot;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">followerN</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">stats</span> <span class="o">=</span> <span class="p">{</span><span class="nx">tweetN</span><span class="o">:</span> <span class="nx">tweetN</span><span class="p">.</span><span class="nx">n</span><span class="p">,</span> <span class="nx">followingN</span><span class="o">:</span> <span class="nx">followingN</span><span class="p">.</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="nx">followerN</span><span class="o">:</span> <span class="nx">followerN</span><span class="p">.</span><span class="nx">n</span><span class="o">-</span><span class="mi">1</span><span class="p">};</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">stats</span><span class="p">);</span>
      <span class="p">});</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--addtweet">
  <h3>
    <a href="#function--addtweet" class="pilcrow">&#182;</a>
    <em>function</em>: addTweet
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Adds the tweet to the database</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nusername</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nmsg</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nreply</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">nretweet</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">addTweet</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">nname</span><span class="p">,</span> <span class="nx">nusername</span><span class="p">,</span> <span class="nx">nmsg</span><span class="p">,</span> <span class="nx">nreply</span><span class="p">,</span> <span class="nx">nretweet</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">nreply</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>check if that tweet is already in a convo</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;select convo from tweets where tweetid=?&#39;</span><span class="p">,[</span><span class="nx">nreply</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">convo</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">convo</span><span class="p">[</span><span class="s1">&#39;convo&#39;</span><span class="p">]</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>        
        <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;insert into tweets values (null,?,?,datetime(&quot;now&quot;,&quot;localtime&quot;),?,?,?,?)&#39;</span><span class="p">,[</span><span class="nx">nusername</span><span class="p">,</span><span class="nx">nname</span><span class="p">,</span><span class="nx">nmsg</span><span class="p">,</span><span class="nx">nreply</span><span class="p">,</span><span class="nx">nretweet</span><span class="p">,</span><span class="nx">convo</span><span class="p">[</span><span class="s1">&#39;convo&#39;</span><span class="p">]]</span>
            <span class="p">,</span><span class="nx">addAtHt</span><span class="p">(</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">nmsg</span><span class="p">,</span> <span class="nx">nreply</span><span class="p">,</span> <span class="nx">nretweet</span><span class="p">,</span> <span class="nx">cb</span><span class="p">));</span>
        <span class="p">});</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>if not yet in a convo, add new convo</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>update convo for old tweet</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;update tweets set convo=? where tweetid=?&#39;</span><span class="p">,[</span><span class="nx">nreply</span><span class="p">,</span><span class="nx">nreply</span><span class="p">]);</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;insert into tweets values (null,?,?,datetime(&quot;now&quot;,&quot;localtime&quot;),?,?,?,?)&#39;</span><span class="p">,[</span><span class="nx">nusername</span><span class="p">,</span><span class="nx">nname</span><span class="p">,</span><span class="nx">nmsg</span><span class="p">,</span><span class="nx">nreply</span><span class="p">,</span><span class="nx">nretweet</span><span class="p">,</span><span class="nx">nreply</span><span class="p">]</span>
              <span class="p">,</span><span class="nx">addAtHt</span><span class="p">(</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">nmsg</span><span class="p">,</span> <span class="nx">nreply</span><span class="p">,</span> <span class="nx">nretweet</span><span class="p">,</span> <span class="nx">cb</span><span class="p">));</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>   
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>this tweet is not a reply to anything</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;insert into tweets values (null,?,?,datetime(&quot;now&quot;,&quot;localtime&quot;),?,?,?,?)&#39;</span><span class="p">,[</span><span class="nx">nusername</span><span class="p">,</span><span class="nx">nname</span><span class="p">,</span><span class="nx">nmsg</span><span class="p">,</span><span class="nx">nreply</span><span class="p">,</span><span class="nx">nretweet</span><span class="p">,</span><span class="kc">null</span><span class="p">]</span>
      <span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">b</span><span class="p">){});</span>
      <span class="p">});</span>
      <span class="nx">addAtHt</span><span class="p">(</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">nmsg</span><span class="p">,</span> <span class="nx">nreply</span><span class="p">,</span> <span class="nx">nretweet</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--addatht">
  <h3>
    <a href="#function--addatht" class="pilcrow">&#182;</a>
    <em>function</em>: addAtHt
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Adds mentions and hashtags to tables</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">username</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">msg</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">reply</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">retweet</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">addAtHt</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">msg</span><span class="p">,</span> <span class="nx">reply</span><span class="p">,</span> <span class="nx">retweet</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;select tweetid from tweets where username=? order by date desc&#39;</span><span class="p">,[</span><span class="nx">username</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">id</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">msgParse</span><span class="p">(</span><span class="nx">msg</span><span class="p">);</span>
    <span class="nx">async</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">at</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">at</span><span class="p">,</span><span class="nx">cb1</span><span class="p">){</span> <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;insert or ignore into mentions values (?,?)&#39;</span><span class="p">,[</span><span class="nx">id</span><span class="p">.</span><span class="nx">tweetid</span><span class="p">,</span><span class="nx">at</span><span class="p">]);</span> <span class="nx">cb1</span><span class="p">(</span><span class="kc">null</span><span class="p">);},</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">async</span><span class="p">.</span><span class="nx">each</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">ht</span><span class="p">,</span> 
          <span class="kd">function</span><span class="p">(</span><span class="nx">ht</span><span class="p">,</span><span class="nx">cb2</span><span class="p">){</span> <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;insert or ignore into hashtags values (?,?)&#39;</span><span class="p">,[</span><span class="nx">id</span><span class="p">.</span><span class="nx">tweetid</span><span class="p">,</span><span class="nx">ht</span><span class="p">]);</span> <span class="nx">cb2</span><span class="p">(</span><span class="kc">null</span><span class="p">);},</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">);}</span>
    <span class="p">);</span>  
  <span class="p">});</span>
  
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--msgparse">
  <h3>
    <a href="#function--msgparse" class="pilcrow">&#182;</a>
    <em>function</em>: msgParse
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Recognizez list of mentions and hashtags in tweet message and 
store then into a JSON object</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">msg
</span>
      <span class="dox_type">string</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">msgParse</span><span class="p">(</span><span class="nx">msg</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">msg</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">at</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">ht</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">word</span> <span class="o">=</span> <span class="nx">msg</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">word</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;@&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">word</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\@&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">at</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">word</span><span class="p">.</span><span class="nx">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">word</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">===</span> <span class="s2">&quot;#&quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">word</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;\#&quot;</span><span class="p">).</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">ht</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">word</span><span class="p">);</span>
    <span class="p">}</span> 
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">{</span><span class="nx">at</span><span class="o">:</span> <span class="nx">at</span><span class="p">,</span> <span class="nx">ht</span><span class="o">:</span> <span class="nx">ht</span><span class="p">};</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getusernt">
  <h3>
    <a href="#function--getusernt" class="pilcrow">&#182;</a>
    <em>function</em>: getUserNT
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Gets the new tweet </p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {new tweet obj} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getUserNT</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;select * from tweets where username=? order by date desc&#39;</span><span class="p">,[</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">t</span><span class="p">){</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
            <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nx">cb</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getfollowerlist">
  <h3>
    <a href="#function--getfollowerlist" class="pilcrow">&#182;</a>
    <em>function</em>: getFollowerList
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Gets the follower list </p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of follower associations} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getFollowerList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;select f.username, u.name from isfollowings f, users u where f.fusername=? and f.username != ? and u.username = f.username&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">uname</span><span class="p">,</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">fl</span><span class="p">){</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">fl</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getfollowinglist">
  <h3>
    <a href="#function--getfollowinglist" class="pilcrow">&#182;</a>
    <em>function</em>: getFollowingList
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Gets the following list </p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of following associations} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getFollowingList</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uname</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s1">&#39;select f.fusername as username, u.name from isfollowings f, users u where f.username=? and f.fusername != ? and u.username = f.fusername&#39;</span><span class="p">,</span>
    <span class="p">[</span><span class="nx">uname</span><span class="p">,</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">fl</span><span class="p">){</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">fl</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--isfollowing">
  <h3>
    <a href="#function--isfollowing" class="pilcrow">&#182;</a>
    <em>function</em>: isFollowing
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Gets the association between the loggedinuser and uname.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loggedinuname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of 2 elements, string} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">isFollowing</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loggedinuname</span><span class="p">,</span> <span class="nx">uname</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;select * from isfollowings where username=? and fusername=?&#39;</span><span class="p">,[</span><span class="nx">loggedinuname</span><span class="p">,</span><span class="nx">uname</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">rows</span><span class="p">){</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">rows</span><span class="o">===</span><span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">ret</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">ret</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--deletefollower">
  <h3>
    <a href="#function--deletefollower" class="pilcrow">&#182;</a>
    <em>function</em>: deleteFollower
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Deletes a following user in the perspective of the loggedinuser.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loggedinuname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">unametbd</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">deleteFollower</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loggedinuname</span><span class="p">,</span> <span class="nx">unametbd</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;delete from isfollowings where username=? and fusername=?&#39;</span><span class="p">,[</span><span class="nx">unametbd</span><span class="p">,</span><span class="nx">loggedinuname</span><span class="p">],</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--unfollow">
  <h3>
    <a href="#function--unfollow" class="pilcrow">&#182;</a>
    <em>function</em>: unfollow
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Unfollows a user in the perspective of the loggedinuser.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loggedinuname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">unametbd</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {}</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">unfollow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loggedinuname</span><span class="p">,</span> <span class="nx">unametbd</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;delete from isfollowings where username=? and fusername=?&#39;</span><span class="p">,[</span><span class="nx">loggedinuname</span><span class="p">,</span><span class="nx">unametbd</span><span class="p">],</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--follow">
  <h3>
    <a href="#function--follow" class="pilcrow">&#182;</a>
    <em>function</em>: follow
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Allows a user to follow another.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loggedinuname</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">funame</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">follow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">loggedinuname</span><span class="p">,</span> <span class="nx">funame</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;insert into isfollowings values (?,?)&#39;</span><span class="p">,[</span><span class="nx">loggedinuname</span><span class="p">,</span><span class="nx">funame</span><span class="p">],</span><span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--getuserinfo">
  <h3>
    <a href="#function--getuserinfo" class="pilcrow">&#182;</a>
    <em>function</em>: getUserInfo
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>A function that returns the user object.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">username</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {user obj} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getUserInfo</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from users where username = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">u</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">uid</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">],</span> 
        <span class="nx">username</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> 
        <span class="nx">name</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="nx">password</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
        <span class="nx">email</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
        <span class="nx">location</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">],</span>
        <span class="nx">website</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;website&#39;</span><span class="p">],</span>
        <span class="nx">profilepic</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;profilepic&#39;</span><span class="p">],</span>
        <span class="nx">profvis</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;profvis&#39;</span><span class="p">],</span>
        <span class="nx">background</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> 
      <span class="p">};</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--searchtweets">
  <h3>
    <a href="#function--searchtweets" class="pilcrow">&#182;</a>
    <em>function</em>: searchTweets
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>A function that searches for hashtags and user mentions of the query..</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">username</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">number</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of tweet obj} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">searchTweets</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;select * from tweets where msg like &#39;%#&quot;</span><span class="o">+</span><span class="nx">query</span><span class="o">+</span><span class="s2">&quot;%&#39; or msg like &#39;%@&quot;</span><span class="o">+</span><span class="nx">query</span><span class="o">+</span><span class="s2">&quot;%&#39;&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">u</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{;</span>
          <span class="nx">cb</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">u</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--searchpeople">
  <h3>
    <a href="#function--searchpeople" class="pilcrow">&#182;</a>
    <em>function</em>: searchPeople
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>A function that searches the user entered in the query.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">query</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of user obj} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">searchPeople</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">query</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;select * from users where username like &#39;%&quot;</span><span class="o">+</span><span class="nx">query</span><span class="o">+</span><span class="s2">&quot;%&#39; or name like &#39;%&quot;</span><span class="o">+</span><span class="nx">query</span><span class="o">+</span><span class="s2">&quot;%&#39;&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">u</span><span class="p">){</span>
      <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">){</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="nx">cb</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">u</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--gettbymention">
  <h3>
    <a href="#function--gettbymention" class="pilcrow">&#182;</a>
    <em>function</em>: getTByMention
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>A function that gets the tweets of the user.</p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">username</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">number</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {array of tweet obj} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getTByMention</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">number</span><span class="p">,</span> <span class="nx">cb</span><span class="p">){</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;select t.* from tweets t, mentions m where t.tweetid=m.tweetid and m.atusername=? order by date desc&quot;</span><span class="p">,[</span><span class="nx">username</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">u</span><span class="p">){</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">u</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--changeusersettings">
  <h3>
    <a href="#function--changeusersettings" class="pilcrow">&#182;</a>
    <em>function</em>: changeUserSettings
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Changes user settings or permission for viewing user's profile, mentioning user in tweets and sending user private messages.
 @param {string} username of logged in user
 @param {string} profile visibility permission</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">changeUserSettings</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">nprofvis</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from users where username = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span> 
      <span class="kd">var</span> <span class="nx">uid</span> <span class="o">=</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">nprofvis</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set profvis = ? where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nprofvis</span><span class="p">,</span><span class="nx">uid</span><span class="p">],</span> <span class="nx">cb</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--checkprofilepermission">
  <h3>
    <a href="#function--checkprofilepermission" class="pilcrow">&#182;</a>
    <em>function</em>: checkProfilePermission
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Checks and sets profile permission.
 If "Public", any user can view profile.
 If "Followers Only", only followers of this user can view this profile.
 If "Only Me", only profile owner can view profile.
 @param {string} username of loggedin user
 @param {string} username of profile owner
 @return {boolean} whether logged in user has permission to view profile</p>
  </div>
  <div class="body">
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">checkProfilePermission</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">loggedin</span><span class="p">,</span> <span class="nx">profileowner</span><span class="p">,</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>

    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from users where username = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">profileowner</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">p</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">profperm</span> <span class="o">=</span> <span class="nx">p</span><span class="p">.</span><span class="nx">profvis</span><span class="p">;</span> 
      <span class="k">if</span> <span class="p">(</span><span class="nx">profperm</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s2">&quot;Public&quot;</span><span class="p">)</span><span class="o">!==</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">allow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">allow</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">profperm</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s2">&quot;Followers Only&quot;</span><span class="p">)</span><span class="o">!==</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from isfollowings where username=? and fusername=?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">loggedin</span><span class="p">,</span><span class="nx">profileowner</span><span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rows</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">rows</span><span class="o">===</span><span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">allow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
              <span class="nx">cb</span><span class="p">(</span><span class="nx">allow</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
              <span class="kd">var</span> <span class="nx">allow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
              <span class="nx">cb</span><span class="p">(</span><span class="nx">allow</span><span class="p">);</span>
            <span class="p">}</span>
          <span class="p">});</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">profperm</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="s2">&quot;Only Me&quot;</span><span class="p">)</span><span class="o">!==</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">loggedin</span> <span class="o">===</span> <span class="nx">profileowner</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">allow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
          <span class="nx">cb</span><span class="p">(</span><span class="nx">allow</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">allow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
          <span class="nx">cb</span><span class="p">(</span><span class="nx">allow</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">allow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">allow</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>

<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--changeuserprofile">
  <h3>
    <a href="#function--changeuserprofile" class="pilcrow">&#182;</a>
    <em>function</em>: changeUserProfile
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Changes user profile according to parameters passed. Current password must be entered before information is changed.
 username, name, email are required fields while location and website are not</p>
  </div>
  <div class="body"><p>@param {string} username of loggedin user
 @param {string} username of new name
 @param {string} username of new username
 @param {string} username of new email
 @param {string} username of new location
 @param {string} username of new website
 @param {string} username of new password
 @param {string} username of new password confirmation
 @param {string} username of current password
 @return {object} boolean for valid change, loggedin user, error msg</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">changeUserProfile</span><span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">nname</span><span class="p">,</span> <span class="nx">nusername</span><span class="p">,</span> <span class="nx">nemail</span><span class="p">,</span> <span class="nx">nlocation</span><span class="p">,</span> <span class="nx">nwebsite</span><span class="p">,</span> <span class="nx">nnewpass</span><span class="p">,</span> <span class="nx">nconfirmnewpass</span><span class="p">,</span> <span class="nx">ncurrentpass</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from users where username = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">ncurrentpass</span> <span class="o">===</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">un</span> <span class="o">=</span> <span class="nx">username</span><span class="p">;</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">nnewpass</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">((</span><span class="nx">nnewpass</span> <span class="o">===</span> <span class="nx">nconfirmnewpass</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">nnewpass</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
              <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set password = ? where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nnewpass</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]]);</span>
            <span class="p">});</span>
          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">validChange</span> <span class="o">=</span> <span class="p">{</span><span class="nx">b</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">uid</span><span class="o">:</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">],</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;Changes not saved. New password must be at least 6 characters long. New password must match.&#39;</span><span class="p">};</span>
            <span class="nx">cb</span><span class="p">(</span><span class="nx">validChange</span><span class="p">);</span>
          <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">nname</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set name = ? where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nname</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]]);</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s1">&#39;update tweets set name = ? where username=?&#39;</span><span class="p">,[</span><span class="nx">nname</span><span class="p">,</span> <span class="nx">username</span><span class="p">]);</span>
          <span class="p">});</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>use of foreign key will update tweets with update name</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">nusername</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set username = ? where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]]);</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update isfollowings set username = ? where username = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">username</span><span class="p">]);</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update isfollowings set fusername = ? where fusername = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">username</span><span class="p">]);</span>
            
            <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;select * from mentions where atusername = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">username</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tl</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">tl</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from tweets where tweetid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">tl</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">tweetid</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
                  <span class="kd">var</span> <span class="nx">m</span> <span class="o">=</span> <span class="nx">t</span><span class="p">.</span><span class="nx">msg</span><span class="p">;</span>
                  <span class="nx">m</span> <span class="o">=</span> <span class="nx">m</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="nx">username</span><span class="p">,</span><span class="s2">&quot;@&quot;</span><span class="o">+</span><span class="nx">nusername</span><span class="p">);</span>
                  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update tweets set msg = ? where tweetid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">m</span><span class="p">,</span> <span class="nx">t</span><span class="p">.</span><span class="nx">tweetid</span><span class="p">]);</span>
                <span class="p">});</span>
              <span class="p">}</span>
            <span class="p">});</span>
            
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update tweets set username = ? where username = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">username</span><span class="p">]);</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update mentions set atusername = ? where atusername = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nusername</span><span class="p">,</span> <span class="nx">username</span><span class="p">]);</span>
            
            <span class="nx">un</span> <span class="o">=</span> <span class="nx">nusername</span><span class="p">;</span>
          <span class="p">});</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>use of foreign key will update isfollowings, tweets, mentions</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="p">}</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">nemail</span> <span class="o">!==</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set email = ? where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nemail</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]]);</span>
          <span class="p">});</span>
        <span class="p">}</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<p>can be empty</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set location = ? where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nlocation</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]]);</span>
        <span class="p">});</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set website = ? where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">nwebsite</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">]]);</span>
        <span class="p">});</span>
              
        <span class="kd">var</span> <span class="nx">validChange</span> <span class="o">=</span> <span class="p">{</span><span class="nx">b</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">uid</span><span class="o">:</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">],</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">un</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">};</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">validChange</span><span class="p">);</span>        
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">validChange</span> <span class="o">=</span> <span class="p">{</span><span class="nx">b</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="nx">uid</span><span class="o">:</span> <span class="nx">row</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">],</span> <span class="nx">username</span><span class="o">:</span> <span class="nx">username</span><span class="p">,</span> <span class="nx">error</span><span class="o">:</span> <span class="s1">&#39;Changes not saved. Current password must be entered.&#39;</span><span class="p">};</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">validChange</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">changeUserProfile</span> <span class="o">=</span> <span class="nx">changeUserProfile</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--changeprofilepic">
  <h3>
    <a href="#function--changeprofilepic" class="pilcrow">&#182;</a>
    <em>function</em>: changeprofilepic
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Changes profile picture of loggedin user. Does not require password.</p>
  </div>
  <div class="body"><p>@param {string} loggedin user's username
 @param {string} path to profile pic</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">changeprofilepic</span> <span class="p">(</span><span class="nx">username</span><span class="p">,</span> <span class="nx">profilepic</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;update users set profilepic = ? where username = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">profilepic</span><span class="p">,</span> <span class="nx">username</span><span class="p">]);</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">changeprofilepic</span> <span class="o">=</span> <span class="nx">changeprofilepic</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--gettweetconvobytweetid">
  <h3>
    <a href="#function--gettweetconvobytweetid" class="pilcrow">&#182;</a>
    <em>function</em>: getTweetConvoByTweetID
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Returns conversation that tweet belongs to.</p>
  </div>
  <div class="body"><p>@param {integer} tweet id
 @return {object} list of tweets, length of list</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">function</span> <span class="nx">getTweetConvoByTweetID</span><span class="p">(</span><span class="nx">tid</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">tweetList</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from tweets where tweetid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">tid</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">rt</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">rt</span><span class="p">[</span><span class="s1">&#39;convo&#39;</span><span class="p">]</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">myReturn</span> <span class="o">=</span> <span class="p">{</span><span class="nx">tc</span><span class="o">:</span> <span class="nx">rt</span><span class="p">,</span> <span class="nx">length</span><span class="o">:</span> <span class="mi">1</span><span class="p">};</span>
        <span class="nx">cb</span><span class="p">(</span><span class="nx">myReturn</span><span class="p">);</span> 
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;select * from tweets where convo = ? order by date asc&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">rt</span><span class="p">[</span><span class="s1">&#39;convo&#39;</span><span class="p">]],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">tl</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">tl</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
              <span class="nx">tweetList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">tl</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
            <span class="p">}</span>
            <span class="kd">var</span> <span class="nx">myReturn</span> <span class="o">=</span> <span class="p">{</span><span class="nx">tc</span><span class="o">:</span> <span class="nx">tweetList</span><span class="p">,</span> <span class="nx">length</span><span class="o">:</span> <span class="nx">tl</span><span class="p">.</span><span class="nx">length</span><span class="p">};</span>
            <span class="nx">cb</span><span class="p">(</span><span class="nx">myReturn</span><span class="p">);</span>
          <span class="p">});</span>
        <span class="p">});</span>
      <span class="p">}</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getTweetConvoByTweetID</span> <span class="o">=</span> <span class="nx">getTweetConvoByTweetID</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--gettweetbyid">
  <h3>
    <a href="#function--gettweetbyid" class="pilcrow">&#182;</a>
    <em>function</em>: getTweetByID
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Returns tweet with tweet id.</p>
  </div>
  <div class="body"><p>@param {integer} tweet id
 @return {object} tweet</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getTweetById</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">getTweetById</span> <span class="p">(</span><span class="nx">tweetId</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from tweets where tweetid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">tweetId</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">t</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">t</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--deletetweet">
  <h3>
    <a href="#function--deletetweet" class="pilcrow">&#182;</a>
    <em>function</em>: deleteTweet
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Deletes tweet.</p>
  </div>
  <div class="body"><p>@param {integer} tweet id</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">deleteTweet</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">deleteTweet</span><span class="p">(</span><span class="nx">tweetId</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">run</span><span class="p">(</span><span class="s2">&quot;delete from tweets where tweetid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">tweetId</span><span class="p">]);</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--gettrendinght">
  <h3>
    <a href="#function--gettrendinght" class="pilcrow">&#182;</a>
    <em>function</em>: getTrendingHT
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>Returns list of 5 most recent hashtags currently in the database.</p>
  </div>
  <div class="body"><p>@return {list} list of hashtags</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">getTrendingHT</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">getTrendingHT</span><span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">htList</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="s2">&quot;select distinct hashtag from hashtags order by tweetid desc&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">ht</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">ht</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">ht</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">htList</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ht</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">hashtag</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">cb</span><span class="p">(</span><span class="nx">htList</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">}</span>

<span class="nx">exports</span><span class="p">.</span><span class="nx">getUserInfoById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">serialize</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from users where uid = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">id</span><span class="p">],</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">u</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">uid</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;uid&#39;</span><span class="p">],</span> 
        <span class="nx">username</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> 
        <span class="nx">name</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="nx">password</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
        <span class="nx">email</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">],</span>
        <span class="nx">location</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;location&#39;</span><span class="p">],</span>
        <span class="nx">website</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;website&#39;</span><span class="p">],</span>
        <span class="nx">profilepic</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;profilepic&#39;</span><span class="p">],</span>
        <span class="nx">profvis</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;profvis&#39;</span><span class="p">],</span>
        <span class="nx">background</span><span class="o">:</span> <span class="nx">u</span><span class="p">[</span><span class="s1">&#39;background&#39;</span><span class="p">]</span> 
      <span class="p">};</span>
      <span class="nx">cb</span><span class="p">(</span><span class="nx">user</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
<span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="function--isf">
  <h3>
    <a href="#function--isf" class="pilcrow">&#182;</a>
    <em>function</em>: isF
  </h3>
</div>


<div class="dox">
  <div class="summary"><p>A function that checks the isfollowings table if the the logged in user 
 is following the other user. </p>
  </div>
  <div class="body">
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loggedinuser</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">tweeter</span>
      <span class="dox_type">string</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>-> {boolean} </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">exports</span><span class="p">.</span><span class="nx">isF</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">isF</span> <span class="p">(</span><span class="nx">loggedinuser</span><span class="p">,</span> <span class="nx">tweeter</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;select * from isfollowings where username = ? and fusername = ?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="nx">loggedinuser</span><span class="p">,</span><span class="nx">tweeter</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">b</span><span class="o">!==</span><span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">cb</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">});</span>
<span class="p">}</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
